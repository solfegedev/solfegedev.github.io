import"./index-pErSQAtW.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as pe,T as tt}from"./Toast-COaeoAQl.js";import{A as O}from"./api-CH_Pe6Vg.js";import{B as U}from"./button-D6DGr86I.js";import{T as he}from"./trash-2-DQbJ9aIh.js";import{E as at}from"./eye-Jn_UhOO1.js";import{P as Ee}from"./pencil-DHu_drsE.js";import{L as st,a as ne,I as ee}from"./label-j-A5YPyd.js";import{L as rt}from"./log-out-B0TqtotO.js";import{A as nt,P as ot}from"./Auth-uEj7rJlD.js";import{U as it,D as lt}from"./upload--Rbr-3Yq.js";import{R as ct}from"./refresh-cw-pTx9cW3g.js";import{F as dt}from"./folder-plus-BkAA-aX2.js";import{G as ve}from"./grip-vertical-BjGCJcsX.js";import{c as ut}from"./createLucideIcon-DtX1aPOG.js";import{B as mt,P as ht}from"./index-BehiXGmn.js";import"./circle-check-F4iM422t.js";import"./x-BS-d4QNZ.js";import"./clsx-B-dksMZM.js";const pt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ft=ut("star",pt),Le=React.createContext(void 0),xt=({children:t})=>{const[o,n]=React.useState(()=>({user:null,token:typeof window<"u"?localStorage.getItem("odds_token")||sessionStorage.getItem("odds_token"):null,status:"idle"})),u=React.useCallback((h,l,p)=>{p?localStorage.setItem("odds_token",h):sessionStorage.setItem("odds_token",h),n({user:l,token:h,status:"success"})},[]),m=React.useCallback(async()=>{try{await fetch(`${O}/bookmarks/logout`,{method:"POST",credentials:"include"})}catch(h){console.error("Logout API call failed",h)}localStorage.removeItem("odds_token"),sessionStorage.removeItem("odds_token"),n({user:null,token:null,status:"idle"})},[]),s=async(h,l,p=!0)=>{n(j=>({...j,status:"loading"}));try{const j=await fetch(`${O}/odds/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:h,password:l,remember:p})});if(!j.ok)throw new Error("Invalid credentials");const g=await j.json();p?localStorage.setItem("odds_token",g.access_token):sessionStorage.setItem("odds_token",g.access_token),n({user:g.user,token:g.access_token,status:"success"})}catch(j){throw n(g=>({...g,status:"error"})),j}},y=React.useCallback(async h=>{try{const l=await fetch(`${O}/odds/me`,{headers:h?{Authorization:`Bearer ${h}`}:{},credentials:"include"});if(l.ok){const p=await l.json();n(j=>({...j,user:p,status:"success"}))}else m()}catch(l){console.error("Failed to fetch user",l),m()}},[m]);return React.useEffect(()=>{o.token&&!o.user&&y(o.token)},[o.token,o.user,y]),e.jsx(Le.Provider,{value:{...o,login:s,logout:m,onAuthSuccess:u},children:t})},Ie=()=>{const t=React.useContext(Le);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},bt=t=>t.state?.status==="ACTIVE",gt=t=>t.state?.status==="LOSER",wt=t=>t.state?.status==="WINNER",je=t=>{if(!t||t.length===0)return null;const[o]=t;return typeof o.price!="number"||typeof o.size!="number"?null:{price:o.price,size:o.size}},yt=(t,o,n,u)=>{const m=[],s=l=>typeof l!="number"?1:l<=0?0:1/l;if(typeof t=="number"&&t>0&&m.push({price:t,weight:s(n)}),typeof o=="number"&&o>0&&m.push({price:o,weight:s(u)}),m.length===0)return null;const y=m.reduce((l,p)=>l+p.weight,0);return y===0?null:1/(m.reduce((l,p)=>l+p.price*p.weight,0)/y)},Ce="* ",ke="1.244214540",vt=(t,o)=>{const n=t.eventTypes?.[0]?.eventNodes?.[0]?.marketNodes?.[0],u=n?{marketId:n.marketId,status:n.state.status,inplay:n.state.inplay,numberOfWinners:n.state.numberOfWinners,description:n.description,runners:n.runners}:void 0,m=u?.description?.marketName??"—",s=u?.runners??[],y=s.filter(bt),h=s.filter(gt),l=s.filter(wt),p=S=>{const M=S.description?.runnerName??"Unknown runner",P=je(S.exchange?.availableToBack),E=je(S.exchange?.availableToLay),$=P?.price??(typeof S.state?.lastPriceTraded=="number"?S.state?.lastPriceTraded:null),L=E?.price??null,z=P?.size??null,W=E?.size??null,v=S.state?.status,N=v==="ACTIVE"||v==="LOSER"||v==="WINNER"?v:"UNKNOWN",w=N==="WINNER",a=w?Ce+M:M,r=w?1:yt($,L,z,W),c=w?1:typeof L=="number"&&L>0?1/L:null,x=w?1:typeof $=="number"&&$>0?1/$:null;return{id:S.selectionId,name:a,status:N,bestBack:$,bestLay:L,impliedProbability:r,probabilityMin:c,probabilityMax:x}},g=[...[...y,...l].map(p)].sort((S,M)=>{const P=S.impliedProbability??0,E=M.impliedProbability??0;if(P!==E)return E-P;const $=S.bestBack??Number.POSITIVE_INFINITY,L=M.bestBack??Number.POSITIVE_INFINITY;return $!==L?$-L:0}),b=g.filter(S=>(S.impliedProbability??0)>=.01),k=b.reduce((S,M)=>S+(M.impliedProbability??0),0),R=Math.max(0,1-k),D=g.length-b.length,A={id:-1,name:D>0?`Others ${D}`:"Others",bestBack:null,bestLay:null,status:"AGGREGATE",impliedProbability:R,probabilityMin:R,probabilityMax:R},F=[...b,A].sort((S,M)=>{const P=S.impliedProbability??0,E=M.impliedProbability??0;return P!==E?E-P:0});return{marketId:u?.marketId??"unknown",marketName:m,runners:F,fetchedAt:o.toISOString(),status:u?.status??"UNKNOWN",inplay:!!u?.inplay,numberOfWinners:u?.numberOfWinners??1,activeRunnerCount:y.length,loserRunnerCount:h.length,winnerRunnerCount:l.length,totalRunners:y.length+h.length+l.length}},jt=()=>{const{errorToast:t}=pe(),{user:o,token:n,logout:u}=Ie(),[m,s]=React.useState([]),[y,h]=React.useState("idle"),[l,p]=React.useState(()=>typeof window>"u"?ke:new URLSearchParams(window.location.search).get("marketId")??ke),[j,g]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[b,k]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit");React.useEffect(()=>{if(typeof window>"u")return;const a=new URLSearchParams(window.location.search),r=a.get("marketId");if(l&&r!==l){a.set("marketId",l);const c=`${window.location.pathname}?${a.toString()}${window.location.hash}`;window.history.replaceState({},"",c)}},[l]),React.useEffect(()=>{const a=()=>{const r=new URLSearchParams(window.location.search);g(r.get("view")==="login"),k(r.get("view")==="edit")};return window.addEventListener("popstate",a),()=>window.removeEventListener("popstate",a)},[]);const R=()=>{const a=new URLSearchParams(window.location.search);a.get("view")!=="login"&&(a.set("view","login"),window.history.pushState({},"",`?${a.toString()}`),g(!0),k(!1))},D=()=>{const a=new URLSearchParams(window.location.search);a.get("view")!=="edit"&&(a.set("view","edit"),window.history.pushState({},"",`?${a.toString()}`),k(!0),g(!1))},A=()=>{const a=new URLSearchParams(window.location.search);if(a.has("view")){a.delete("view");const r=a.toString();window.history.pushState({},"",r?`?${r}`:window.location.pathname),g(!1),k(!1)}else g(!1),k(!1)},F=React.useCallback(async()=>{h("loading");try{const a=new URL(`${O}/odds/`);b&&a.searchParams.set("include_expired","true");const r=await fetch(a.toString());if(!r.ok)throw new Error("Fetch failed");const c=await r.json();s(Array.isArray(c)?c:c.markets??[]),h("success")}catch{h("error")}},[b]),S=async(a,r)=>{if(n)try{const c=await fetch(`${O}/odds/markets/${a}/favorite`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({favorite:r})});if(!c.ok)throw new Error("Patch failed");const x=await c.json();s(x.markets)}catch{t("Failed to toggle favorite")}},M=async a=>{const r=await fetch(`${O}/odds/market-name/${a}`);if(!r.ok)throw new Error("Name fetch failed");return(await r.json()).name},P=async a=>{if(!n)return;const r=await fetch(`${O}/odds/markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(a)});if(!r.ok){const x=await r.json().catch(()=>({}));throw new Error(x.detail||"Failed to add market")}const c=await r.json();s(c.markets),p(a.id)},E=async(a,r)=>{if(!n)return;const c=await fetch(`${O}/odds/markets/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(r)});if(!c.ok){const T=await c.json().catch(()=>({}));throw new Error(T.detail||"Failed to update market")}const x=await c.json();s(x.markets)},$=async a=>{if(!n||!window.confirm("Delete market?"))return;const r=await fetch(`${O}/odds/markets/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(!r.ok){const x=await r.json().catch(()=>({}));throw new Error(x.detail||"Failed to delete market")}const c=await r.json();s(c.markets)},L=async a=>{if(!n)return;const r=await fetch(`${O}/odds/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({label:a})});if(!r.ok){const x=await r.json().catch(()=>({}));throw new Error(x.detail||"Failed to add group")}const c=await r.json();s(c.markets)},z=async a=>{if(!n||!window.confirm("Delete group?"))return;const r=await fetch(`${O}/odds/groups/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(!r.ok)throw new Error("Delete failed");const c=await r.json();s(c.markets)},W=async a=>{if(!n)return;const c=await(await fetch(`${O}/odds/reorder-groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({group_ids:a})})).json();s(c.markets)},v=async(a,r)=>{if(!n)return;const x=await(await fetch(`${O}/odds/reorder-markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({group_id:a,market_ids:r})})).json();s(x.markets)},N=async a=>{if(!n)return;const c=await(await fetch(`${O}/odds/import`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(a)})).json();s(c.markets)},w=async()=>{if(!n)return;const r=await(await fetch(`${O}/odds/export`,{headers:{Authorization:`Bearer ${n}`}})).blob(),c=window.URL.createObjectURL(r),x=document.createElement("a");x.href=c,x.download="odds_backup.yml",x.click()};return React.useEffect(()=>{F()},[F]),React.useEffect(()=>{o&&new URLSearchParams(window.location.search).get("view")!=="edit"&&D()},[o]),{user:o,token:n,logout:u,marketGroups:m,marketListState:y,selectedMarketId:l,setSelectedMarketId:p,showLogin:j,showEdit:b,navigateToLogin:R,navigateToEdit:D,navigateToPublic:A,handleToggleFavorite:S,handleGetMarketName:M,handleAddMarket:P,handleUpdateMarket:E,handleDeleteMarket:$,handleAddGroup:L,handleDeleteGroup:z,handleReorderGroups:W,handleReorderMarkets:v,handleImportYaml:N,handleExportYaml:w}},Ne=t=>{const o=t.filter(u=>!!u.favorite),n=t.filter(u=>!u.favorite);return[...o,...n]},kt=(t,o)=>{const n=[];return t.forEach(u=>{const m=`group-${u.id}`;n.push({kind:"group",id:m,groupId:u.id,label:u.label}),o.has(u.id)&&u.markets.forEach(s=>{n.push({kind:"option",id:`option-${s.id}`,groupId:u.id,marketId:s.id,label:s.label})})}),n},Nt=(t,o)=>t.find(n=>n.markets.some(u=>u.id===o)),Re=t=>t.flatMap(o=>o.markets),De=({favorite:t})=>t?e.jsx("span",{className:"text-base leading-none text-[#ffdc00]","aria-hidden":"true",children:"★"}):null,Rt=t=>{if(!t)return"";try{const o=new Date(t);return Number.isNaN(o.getTime())?t:o.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}catch{return t}},$e=({label:t,favorite:o,expiryDate:n})=>e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(De,{favorite:o}),e.jsx("span",{children:t}),n?e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{className:"text-sm font-semibold text-[#9aa5c0]",children:Rt(n)})]}):null]}),St=({selectedMarket:t,isOpen:o,onToggle:n,onClose:u,toggleRef:m})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-xl border border-white/10 bg-white/20 px-3 py-2.5 text-left font-semibold text-[#e8ecf5] shadow-[0_16px_32px_rgba(0,0,0,0.35)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946] focus-visible:ring-offset-2 focus-visible:ring-offset-transparent","aria-haspopup":"listbox","aria-expanded":o,onClick:n,onKeyDown:s=>{s.key==="Escape"&&u()},ref:m,"data-testid":"market-dropdown-trigger",children:[e.jsx($e,{label:t?.label??"",favorite:t?.favorite,expiryDate:t?.expiry_date}),e.jsx("span",{className:"ml-1 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),Mt=({requestState:t})=>e.jsx("li",{children:e.jsx("span",{className:"flex w-full items-center justify-between gap-2 rounded-lg border border-transparent bg-white/10 px-2.5 py-2 text-left font-semibold text-[#e8ecf5]",children:t==="loading"?"Loading markets...":"No markets available"})}),Et=({group:t,isExpanded:o,headerId:n,onToggle:u,onKeyDown:m,setItemRef:s,isFocused:y,onFocus:h})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-lg bg-[#26356d] px-2.5 py-2 text-left font-bold text-[#e8ecf5] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]","aria-expanded":o,"aria-controls":`${t.id}-options`,onClick:u,onKeyDown:l=>m(l,n),"data-kind":"group",tabIndex:y?0:-1,ref:l=>s(n,l),onFocus:h,children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[t.isFavorites?e.jsx(De,{favorite:!0}):null,e.jsx("span",{children:t.label})]}),e.jsx("span",{className:o?"text-sm font-bold text-[#9aa5c0]":"-rotate-90 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),Lt=({market:t,isActive:o,optionId:n,onSelect:u,onDelete:m,onKeyDown:s,setItemRef:y,isFocused:h,onFocus:l})=>e.jsxs("div",{className:"group/item flex items-center gap-1",children:[e.jsx("button",{type:"button",className:o?"flex flex-1 items-center justify-between gap-3 rounded-lg border border-[rgba(230,57,70,0.35)] bg-[rgba(230,57,70,0.14)] px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-[rgba(230,57,70,0.18)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]":"flex flex-1 items-center justify-between gap-3 rounded-lg border border-transparent bg-white/20 px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]",role:"option","aria-selected":o,onClick:()=>u(t.id),onKeyDown:p=>s(p,n),"data-kind":"option",tabIndex:h?0:-1,ref:p=>y(n,p),onFocus:l,children:e.jsx($e,{label:t.label,favorite:t.favorite,expiryDate:t.expiry_date})}),m&&e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),m(t.id)},className:"p-2 text-[#9aa5c0] opacity-0 transition-opacity group-hover/item:opacity-100 hover:text-[#e63946]",title:"Delete market",children:e.jsx(he,{size:16})})]}),It=({group:t,selectedMarketId:o,onSelect:n,onDelete:u,onKeyDown:m,setItemRef:s,focusedItemId:y,onFocusItem:h})=>e.jsx("ul",{className:"mt-1 flex list-none flex-col gap-1 pr-1 pb-2 pl-4",id:`${t.id}-options`,role:"group",children:t.markets.map(l=>{const p=`option-${l.id}`,j=l.id===o;return e.jsx("li",{children:e.jsx(Lt,{market:l,isActive:j,optionId:p,onSelect:g=>n(g),onDelete:u,onKeyDown:m,setItemRef:s,isFocused:y===p,onFocus:()=>h(p)})},p)})}),Ct=({normalizedGroups:t,expandedGroupIds:o,focusedItemId:n,onToggleGroup:u,onKeyDown:m,setItemRef:s,onFocusItem:y,selectedMarketId:h,onSelect:l,onDelete:p,requestState:j,dropdownStyle:g})=>e.jsx("ul",{className:"fixed z-10 mt-1 list-none space-y-1 overflow-y-auto rounded-xl border border-white/10 bg-[#0b111d] p-1 shadow-[0_16px_40px_rgba(0,0,0,0.35)]",role:"listbox","aria-label":"Choose market",style:g,children:t.length===0?e.jsx(Mt,{requestState:j}):t.map(b=>{const k=o.has(b.id),R=`group-${b.id}`;return e.jsxs("li",{className:"py-1",children:[e.jsx(Et,{group:b,isExpanded:k,headerId:R,onToggle:()=>u(b.id),onKeyDown:m,setItemRef:s,isFocused:n===R,onFocus:()=>y(R)}),k?e.jsx(It,{group:b,selectedMarketId:h,onSelect:D=>{l(D)},onDelete:p,onKeyDown:m,setItemRef:s,focusedItemId:n,onFocusItem:y}):null]},b.id)})}),Se=({groups:t,selectedMarketId:o,onSelect:n,onDelete:u,requestState:m})=>{const s=React.useMemo(()=>t.map((a,r)=>({...a,id:`group-${r}-${a.label||"group"}`,markets:Ne(a.markets)})),[t]),y=React.useMemo(()=>{const a=Re(s).filter(r=>!!r.favorite);return a.length===0?null:{id:0,label:"Favorites",markets:Ne(a),isFavorites:!0}},[s]),h=React.useMemo(()=>y?[y,...s]:s,[s,y]),[l,p]=React.useState(!1),[j,g]=React.useState(new Set),[b,k]=React.useState(null),[R,D]=React.useState({}),A=React.useRef(null),F=React.useRef(null),S=React.useRef(new Map),M=React.useMemo(()=>Re(h),[h]),P=React.useMemo(()=>M.length===0?{id:o,label:m==="loading"?"Loading markets...":"No markets available"}:M.find(a=>a.id===o)??M[0],[M,o,m]),E=React.useMemo(()=>kt(h,j),[h,j]);React.useEffect(()=>{if(!l)return;const a=Nt(h,o)??h[0];g(x=>{const T=a?new Set([a.id]):new Set;return x.size===T.size&&[...T].every(te=>x.has(te))?x:T});const r=a?.markets[0],c=a?.markets.find(x=>x.id===o)?.id??r?.id;k(c?`option-${c}`:null)},[h,l,o]),React.useEffect(()=>{const a=r=>{A.current&&!A.current.contains(r.target)&&p(!1)};return l&&document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[l]),React.useEffect(()=>{if(!l||!b)return;S.current.get(b)?.focus()},[b,l]),React.useEffect(()=>{if(!l)return;const a=()=>{if(!F.current)return;const r=F.current.getBoundingClientRect(),c=window.innerHeight,x=window.innerWidth,T=12,V=Math.min(720,x-T*2),J=r.left+r.width/2-V/2,oe=Math.min(Math.max(J,T),Math.max(T,x-V-T)),K=c-r.bottom-T,Q=r.top-T,X=K<240&&Q>K,ie=Math.max(140,Math.min(720,X?Q:K));D({position:"fixed",width:`${V}px`,maxHeight:`${ie}px`,left:`${oe}px`,transform:"none",top:X?void 0:`${r.bottom+8}px`,bottom:X?`${c-r.top+8}px`:void 0})};return a(),window.addEventListener("resize",a),window.addEventListener("scroll",a,{passive:!0}),()=>{window.removeEventListener("resize",a),window.removeEventListener("scroll",a)}},[l,h,o]);const $=a=>{g(r=>r.has(a)?new Set:new Set([a]))},L=a=>{if(E.length===0)return;const r=E.findIndex(V=>V.id===b),c=r===-1?0:r,x=Math.min(E.length-1,Math.max(0,c+a)),T=E[x];k(T?.id??null)},z=(a,r)=>{if(a.key==="ArrowDown"&&(a.preventDefault(),L(1)),a.key==="ArrowUp"&&(a.preventDefault(),L(-1)),a.key==="Escape"){a.preventDefault(),p(!1);return}const c=E.find(x=>x.id===r);c&&(c.kind==="group"&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),$(c.groupId)),c.kind==="option"&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),n(c.marketId),p(!1)))},W=(a,r)=>{S.current.set(a,r)},v=()=>p(!1),N=()=>p(a=>!a),w=a=>{n(a),v()};return e.jsxs("div",{className:"relative flex min-w-[220px] flex-col gap-1 text-[#e8ecf5]",ref:A,children:[e.jsx(St,{selectedMarket:P??null,isOpen:l,onToggle:N,onClose:v,toggleRef:F}),l?e.jsx(Ct,{normalizedGroups:h,expandedGroupIds:j,focusedItemId:b,onToggleGroup:$,onKeyDown:z,setItemRef:W,onFocusItem:k,selectedMarketId:o,onSelect:w,onDelete:u,requestState:m,dropdownStyle:R}):null]})},Dt=({title:t,isAdmin:o,userEmail:n,userFirstName:u,showEdit:m,onEditClick:s,onPublicClick:y,onLoginClick:h,onLogoutClick:l,onLogoClick:p,showLoginButton:j,marketGroups:g,selectedMarketId:b,onSelectMarket:k,marketListState:R})=>e.jsxs("nav",{className:"sticky top-0 z-50 w-full border-b border-white/10 bg-[#0e1422]/90 shadow-sm backdrop-blur-md","data-testid":"navbar",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-1 items-center gap-4",children:e.jsx("button",{onClick:p,className:"flex items-center gap-3 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/favicon_odds.png",alt:"",className:"h-8 w-8 object-contain","aria-hidden":"true"}),e.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-white",children:[t," ",o&&"Admin"]})]})})}),e.jsx("div",{className:"mx-4 hidden max-w-md flex-1 md:block","data-testid":"navbar-market-dropdown",children:e.jsx(Se,{groups:g,selectedMarketId:b,onSelect:k,requestState:R})}),e.jsxs("div",{className:"flex flex-1 items-center justify-end gap-4",children:[o&&e.jsx("div",{className:"flex items-center gap-2 border-r border-white/10 pr-4",children:m?e.jsxs(U,{variant:"ghost",className:"gap-2 text-[#e8ecf5] hover:bg-white/5",onClick:y,"data-testid":"view-button",children:[e.jsx(at,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Default View"})]}):e.jsxs(U,{variant:"ghost",className:"gap-2 text-[#e8ecf5] hover:bg-white/5",onClick:s,"data-testid":"edit-button",children:[e.jsx(Ee,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Edit"})]})}),j&&e.jsxs(U,{variant:"ghost",className:"gap-2 text-[#e8ecf5] hover:bg-white/5",onClick:h,"data-testid":"login-button",children:[e.jsx(st,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Login"})]}),n&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"hidden text-sm font-medium text-[#9aa5c0] md:inline","data-testid":"user-display-name",children:u||n}),e.jsx(U,{variant:"ghost",size:"icon",onClick:l,className:"text-[#9aa5c0] hover:bg-white/5 hover:text-[#e63946]",title:"Logout","data-testid":"logout-button",children:e.jsx(rt,{size:20})})]})]})]}),e.jsx("div",{className:"px-6 pb-4 md:hidden","data-testid":"mobile-navbar-market-dropdown",children:e.jsx(Se,{groups:g,selectedMarketId:b,onSelect:k,requestState:R})})]}),$t=()=>{const{onAuthSuccess:t}=Ie();return e.jsx("div",{"data-testid":"login-view",children:e.jsx(nt,{appName:"Odds",loginEndpoint:"/odds/login",onSuccess:(o,n)=>t(o.access_token,o.user,n)})})},Tt=({marketGroups:t,onAddMarket:o,onUpdateMarket:n,onDeleteMarket:u,onToggleFavorite:m,onGetMarketName:s,onAddGroup:y,onDeleteGroup:h,onReorderGroups:l,onReorderMarkets:p,onImportYaml:j,onExportYaml:g,requestState:b})=>{const{errorToast:k}=pe(),[R,D]=React.useState(t),[A,F]=React.useState(""),[S,M]=React.useState(""),[P,E]=React.useState(""),[$,L]=React.useState(""),[z,W]=React.useState(""),[v,N]=React.useState(""),[w,a]=React.useState(!1),[r,c]=React.useState(!1),[x,T]=React.useState(null),[V,te]=React.useState(null),[J,oe]=React.useState(!1),[K,Q]=React.useState(null),[X,de]=React.useState(""),[ie,fe]=React.useState(""),[xe,be]=React.useState(""),le=React.useRef(null),ue=React.useRef(R),q=React.useRef(null);React.useEffect(()=>{ue.current=R},[R]),React.useEffect(()=>{D(t)},[t]),React.useEffect(()=>{!z&&t.length>0&&W(t[0].label)},[t,z]);const[H,ge]=React.useState(null),[Ae,ae]=React.useState(null),[se,we]=React.useState(null),[Pe,re]=React.useState(null),_e=async d=>{const i=d.trim();if(/^1\.\d{4,}$/.test(i)){oe(!0);try{const f=await s(i);E(f),M(f)}catch(f){console.error("Failed to fetch market name",f)}finally{oe(!1)}}},Oe=async d=>{d.preventDefault(),T(null),a(!0);try{const i=A.trim();await o({id:i,label:S,api_label:P,group_label:z,expiry_date:$||null}),F(""),M(""),E(""),L("")}catch(i){const f=i instanceof Error?i.message:"Failed to add market. Ensure the ID is unique.";T(f)}finally{a(!1)}},Fe=d=>{Q(d.id),de(d.label||d.api_label||""),fe(d.group_label||""),be(d.expiry_date||"")},Ge=async d=>{try{a(!0),await n(d,{label:X,group_label:ie,expiry_date:xe||null}),Q(null)}catch(i){const f=i instanceof Error?i.message:"Failed to update market.";T(f)}finally{a(!1)}},ze=async d=>{d.preventDefault(),te(null),c(!0);try{await y(v),N("")}catch(i){const f=i instanceof Error?i.message:"Failed to add group. Ensure the label is unique.";te(f)}finally{c(!1)}},Be=async d=>{const i=d.target.files?.[0];if(!i)return;const f=new FileReader;f.onload=async _=>{try{const B=(await Promise.resolve(jsyaml)).load(_.target?.result);await j(B),le.current&&(le.current.value="")}catch(I){console.error("Failed to import YAML",I);const B=I instanceof Error?I.message:String(I);k(`Failed to import YAML: ${B}`)}},f.readAsText(i)},Ue=d=>{ge(d)},We=(d,i,f)=>{d.preventDefault(),!(H===null||H===i)&&D(_=>{const I=[..._],B=I.findIndex(C=>C.markets.some(Y=>Y.id===H)),Z=I.findIndex(C=>C.id===f);if(B===-1||Z===-1)return _;const G={...I[B]},Je=G.markets.findIndex(C=>C.id===H),[ye]=G.markets.splice(Je,1);if(B===Z){const C=G.markets.findIndex(Y=>Y.id===i);G.markets.splice(C,0,ye),I[B]=G}else{const C={...I[Z]},Y=C.markets.findIndex(et=>et.id===i);C.markets.splice(Y,0,ye),I[B]=G,I[Z]=C}const Ke=_.flatMap(C=>C.markets.map(Y=>Y.id)).join(","),Qe=I.flatMap(C=>C.markets.map(Y=>Y.id)).join(","),Xe=_.map(C=>C.id).join(","),Ze=I.map(C=>C.id).join(",");return Ke!==Qe||Xe!==Ze?I:_})},Ve=async()=>{if(H===null)return;const d=H;ge(null),ae(null),q.current&&clearTimeout(q.current),q.current=setTimeout(async()=>{const i=ue.current.find(f=>f.markets.some(_=>_.id===d));i&&await p(i.id,i.markets.map(f=>f.id)),q.current=null},100)},Ye=d=>{we(d)},qe=(d,i)=>{d.preventDefault(),!(se===null||se===i)&&D(f=>{const _=[...f],I=_.findIndex(G=>G.id===se),B=_.findIndex(G=>G.id===i);if(I===-1||B===-1)return f;const[Z]=_.splice(I,1);return _.splice(B,0,Z),_.map(G=>G.id).join(",")!==f.map(G=>G.id).join(",")?_:f})},He=async()=>{se!==null&&(we(null),re(null),q.current&&clearTimeout(q.current),q.current=setTimeout(async()=>{await l(ue.current.map(d=>d.id)),q.current=null},100))};return e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-8 px-6 pt-8 pb-12","data-testid":"management-view",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 px-2 sm:flex-row sm:items-center sm:gap-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Market Management"}),e.jsxs("div",{className:"flex w-full flex-col gap-3 sm:w-auto sm:flex-row",children:[e.jsx("input",{type:"file",ref:le,onChange:Be,accept:".yml,.yaml",className:"hidden"}),e.jsxs(U,{variant:"outline",onClick:()=>le.current?.click(),className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"import-yaml-button",children:[e.jsx(it,{size:18}),"Import YAML"]}),e.jsxs(U,{variant:"outline",onClick:g,className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"export-yaml-button",children:[e.jsx(lt,{size:18}),"Export YAML"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-market-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(ot,{className:"text-emerald-400",size:24}),"Add New Market"]}),e.jsxs("form",{onSubmit:Oe,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ne,{htmlFor:"marketId",children:["Betfair Market ID (or paste URL)",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ee,{id:"marketId",value:A,onChange:d=>{const i=d.target.value,f=i.match(/1\.\d{4,}/);f&&f[0]!==i?F(f[0]):F(i)},required:!0,placeholder:"e.g. 1.230433061 or https://...",className:"border-white/10 bg-white/5 text-white","data-testid":"market-id-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ne,{htmlFor:"label",children:["Market Label"," ",J&&e.jsx("span",{className:"ml-2 animate-pulse text-xs text-indigo-400",children:"(Fetching...)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{id:"label",value:S,onChange:d=>M(d.target.value),placeholder:J?"Fetching name...":"e.g. Premier League",className:"border-white/10 bg-white/5 text-white","data-testid":"market-label-input"}),e.jsxs(U,{type:"button",variant:"outline",onClick:()=>_e(A),disabled:J||!/^1\.\d{4,}$/.test(A.trim()),className:"gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white",title:"Fetch name from Betfair","data-testid":"fetch-market-name-button",children:[e.jsx(ct,{size:16,className:J?"animate-spin":""}),"Fetch"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"expiryDate",children:"Expiry Date (Optional)"}),e.jsx(ee,{id:"expiryDate",type:"date",value:$,onChange:d=>L(d.target.value),className:"border-white/10 bg-white/5 text-white","data-testid":"market-expiry-date-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ne,{htmlFor:"group",children:["Group ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"group",value:z,onChange:d=>W(d.target.value),required:!0,className:"focus-visible:ring-ring flex h-11 w-full rounded-md border border-white/10 bg-white/5 px-3 py-1 text-sm text-white shadow-sm transition-colors focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50","data-testid":"group-select",children:[e.jsx("option",{value:"",disabled:!0,className:"bg-[#0e1422]",children:"Select a group"}),t.map(d=>e.jsx("option",{value:d.label,className:"bg-[#0e1422]",children:d.label},d.id))]})]}),e.jsxs("div",{className:"pt-2",children:[x&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"market-error-message",children:x}),e.jsx(U,{type:"submit",className:"h-11 w-full bg-emerald-600 text-white hover:bg-emerald-700",disabled:w,"data-testid":"add-market-button",children:w?"Adding...":"Add Market"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-group-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(dt,{className:"text-indigo-400",size:24}),"Add New Group"]}),e.jsxs("form",{onSubmit:ze,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ne,{htmlFor:"groupLabel",children:["Group Label ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ee,{id:"groupLabel",value:v,onChange:d=>N(d.target.value),required:!0,placeholder:"e.g. Misc",className:"border-white/10 bg-white/5 text-white","data-testid":"new-group-label"})]}),e.jsxs("div",{className:"pt-2",children:[V&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"group-error-message",children:V}),e.jsx(U,{type:"submit",className:"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700",disabled:r,"data-testid":"add-group-button",children:r?"Adding...":"Add Group"})]})]})]})]}),e.jsxs("section",{className:"flex flex-col gap-6","data-testid":"tracked-markets-section",children:[e.jsx("h3",{className:"px-2 text-xl font-bold text-white",children:"Tracked Markets"}),b==="loading"&&R.length===0?e.jsx("div",{className:"animate-pulse space-y-4","data-testid":"markets-loading-skeleton",children:[1,2,3].map(d=>e.jsx("div",{className:"h-20 rounded-xl bg-white/5"},d))}):e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[R.map(d=>e.jsxs("div",{className:`group-container overflow-hidden rounded-2xl border border-white/10 bg-[#0e1422] shadow-lg transition-all ${se===d.id?"opacity-20":""}`,"data-testid":`group-container-${d.label}`,draggable:Pe===d.id,onDragStart:()=>Ye(d.id),onDragOver:i=>qe(i,d.id),onDragEnd:He,children:[e.jsxs("div",{className:"flex items-center justify-between bg-[#26356d] px-6 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"cursor-grab text-white/40 transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>re(d.id),onMouseUp:()=>re(null),onTouchStart:()=>re(d.id),onTouchEnd:()=>re(null),children:e.jsx(ve,{size:20})}),e.jsx("h4",{className:"font-bold text-white",children:d.label})]}),e.jsx("button",{onClick:()=>h(d.id),className:"rounded-lg p-1.5 text-white/40 transition-all hover:bg-white/5 hover:text-red-400",title:"Delete group and all markets","data-testid":`delete-group-button-${d.label}`,children:e.jsx(he,{size:16})})]}),e.jsxs("div",{className:"divide-y divide-white/5",children:[d.markets.map(i=>e.jsxs("div",{className:`group flex items-center justify-between px-6 py-4 transition-colors hover:bg-white/5 ${H===i.id?"opacity-20":""}`,draggable:Ae===i.id,onDragStart:()=>Ue(i.id),onDragOver:f=>We(f,i.id,d.id),onDragEnd:Ve,"data-testid":`market-item-${i.id}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"cursor-grab text-[#9aa5c0] transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>ae(i.id),onMouseUp:()=>ae(null),onTouchStart:()=>ae(i.id),onTouchEnd:()=>ae(null),children:e.jsx(ve,{size:18})}),K===i.id?e.jsxs("div",{className:"flex flex-col gap-2 py-2",children:[e.jsx(ee,{value:X,onChange:f=>de(f.target.value),placeholder:"Label",className:"h-8 border-white/10 bg-white/5 text-xs text-white",autoFocus:!0}),e.jsx("select",{value:ie,onChange:f=>fe(f.target.value),className:"focus-visible:ring-ring flex h-8 w-full rounded-md border border-white/10 bg-[#0e1422] px-3 py-1 text-xs text-white shadow-sm transition-colors focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",children:t.map(f=>e.jsx("option",{value:f.label,className:"bg-[#0e1422]",children:f.label},f.id))}),e.jsx(ee,{type:"date",value:xe,onChange:f=>be(f.target.value),className:"h-8 border-white/10 bg-white/5 text-xs text-white"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{size:"sm",onClick:()=>Ge(i.id),className:"h-7 bg-emerald-600 px-2 text-[10px] hover:bg-emerald-700",children:"Save"}),e.jsx(U,{size:"sm",variant:"outline",onClick:()=>Q(null),className:"h-7 border-white/10 px-2 text-[10px] text-[#9aa5c0] hover:bg-white/5 hover:text-white",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-[#e8ecf5]",children:i.label||i.api_label}),i.expiry_date&&new Date(i.expiry_date)<new Date(new Date().setDate(new Date().getDate()-7))&&e.jsx("span",{className:"rounded bg-red-500/20 px-1.5 py-0.5 text-[10px] font-bold text-red-400 uppercase",children:"Expired"})]}),i.api_label&&i.api_label!==i.label&&e.jsx("span",{className:"text-xs text-[#9aa5c0] italic",children:i.api_label})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:K!==i.id&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Fe(i),className:"rounded-lg p-2 text-[#9aa5c0] transition-all hover:bg-white/10 hover:text-white",title:"Edit market",children:e.jsx(Ee,{size:18})}),e.jsx("button",{onClick:()=>m(i.id,!i.favorite),className:`rounded-lg p-2 transition-all hover:bg-white/10 ${i.favorite?"text-yellow-400":"text-[#9aa5c0]"}`,title:i.favorite?"Remove from favorites":"Add to favorites","data-testid":`favorite-button-${i.id}`,children:e.jsx(ft,{size:18,fill:i.favorite?"currentColor":"none"})}),e.jsx("button",{onClick:()=>u(i.id),className:"rounded-lg p-2 text-[#9aa5c0] transition-all hover:bg-white/10 hover:text-[#e63946]",title:"Delete market","data-testid":`delete-market-button-${i.id}`,children:e.jsx(he,{size:18})})]})})]},i.id)),d.markets.length===0&&e.jsx("div",{className:"px-6 py-4 text-sm text-[#9aa5c0] italic","data-testid":"empty-group-message",children:"No markets in this group."})]})]},d.id)),R.length===0&&e.jsx("div",{className:"rounded-2xl border-2 border-dashed border-white/10 py-12 text-center",children:e.jsx("p",{className:"text-[#9aa5c0]",children:"No markets tracked yet."})})]})]})]})},Me=({label:t,variant:o="danger",className:n="","aria-label":u})=>{const m={danger:"border-[rgba(230,57,70,0.45)] bg-[rgba(230,57,70,0.15)] text-[#e8ecf5]",warning:"border-[#ffd447] bg-[#ffd447] text-[#0e1422] animate-pulse shadow-[0_0_0_0_rgba(255,212,71,0.45)]"};return e.jsx("div",{className:`inline-flex items-center justify-center rounded-full border px-3 py-1 text-sm font-semibold ${m[o]} ${n}`,"aria-label":u,"data-testid":`status-badge-${t.toLowerCase()}`,children:t})},At=({status:t,isLive:o,externalUrl:n,lastUpdated:u,stats:m})=>e.jsxs("div",{className:"flex flex-col gap-2","data-testid":"market-header",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t!=="OPEN"&&t&&e.jsx(Me,{label:t,"aria-label":"Market status"}),o&&e.jsx(Me,{label:"LIVE",variant:"warning","aria-label":"Market live"})]}),e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1",children:[e.jsx("a",{className:"text-xs font-semibold text-[#9aa5c0] underline decoration-slate-500 underline-offset-4 hover:text-[#e8ecf5]",href:n,target:"_blank",rel:"noreferrer noopener","data-testid":"external-market-link",children:"Original data"}),e.jsx("div",{className:"text-xs font-medium text-[#9aa5c0]","data-testid":"last-updated",children:u?`Updated ${u}`:"Fetching data..."})]}),m&&e.jsx("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-xs font-semibold text-[#e8ecf5]","aria-label":"Total runners","data-testid":"market-stats",children:m})]})]}),Pt={id:"valueLabel",afterDatasetsDraw(t,o,n){const u=t.config.type;if(u&&u!=="bar")return;const{ctx:m,data:s}=t,y=n?.color??"#e8ecf5";m.save();const h=t.getSortedVisibleDatasetMetas(),l=h[h.length-1];l&&(l.data.forEach((p,j)=>{const g=n?.impliedProbabilities?.[j],b=typeof g=="number"?g:s.datasets?.reduce((R,D)=>{const A=D?.data?.[j];return typeof A=="number"?R+A:R},0);if(typeof b!="number"||b<=0)return;const k=p.tooltipPosition(!0);k.x===null||k.y===null||(m.fillStyle=y,m.font='600 12px "Inter", system-ui, -apple-system, sans-serif',m.textBaseline="middle",m.textAlign="left",m.fillText(`${b.toFixed(1)}%`,k.x+6,k.y))}),m.restore())}};Chart.Chart.register(Chart.ArcElement,Chart.BarElement,Chart.CategoryScale,Chart.LinearScale,Chart.Legend,Chart.Title,Chart.Tooltip,Pt);const ce=["#ba0034","#0293d9","#ff901a","#50469d","#eb9fa2","#87365c","#97d76f","#ed2fa4","#0b6109","#ffa1e4","#01dbc6"],me=t=>t===null||Number.isNaN(t)?"—":`${(t*100).toFixed(1)}%`,_t=({marketGroups:t,marketListState:o,selectedMarketId:n})=>{const{loadingToast:u,removeToast:m}=pe(),[s,y]=React.useState(null),[h,l]=React.useState("idle"),[p,j]=React.useState(null),g=React.useRef(!0),b=React.useRef(null),k=React.useCallback(async(v,N=!1)=>{l("loading"),j(null),N&&b.current===null&&(b.current=u("Refreshing prices..."));try{const w=await fetch(`${O}/odds/market-data/${v}`);if(!w.ok)throw new Error(`Request failed with status ${w.status}`);const a=await w.json(),r=vt(a,new Date);y(r),l("success")}catch(w){console.error("Failed to fetch market",w),l("error"),j("We could not load market prices. Please retry.")}finally{if(b.current!==null){const w=b.current;setTimeout(()=>{m(w),b.current===w&&(b.current=null)},1e3)}}},[u,m]);React.useEffect(()=>{if(n){const v=!g.current;k(n,v),g.current=!1}},[k,n]);const R=React.useMemo(()=>s?new Date(s.fetchedAt).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",weekday:"short",month:"short",day:"numeric",hour12:!1}):null,[s]),D=React.useMemo(()=>{if(!s)return null;const v=s.runners.map(r=>r.name),N=s.runners.map((r,c)=>r.name.startsWith("Others")?"#9aa0ae":ce[c%ce.length]),w=s.runners.map(r=>Math.max(0,r.probabilityMin??0)*100),a=s.runners.map(r=>{const c=Math.max(0,r.probabilityMin??0),x=Math.max(c,r.probabilityMax??c);return Math.max(0,x-c)*100});return{labels:v,datasets:[{label:"Minimum probability (%)",data:w,backgroundColor:N,borderColor:N,borderWidth:1,borderSkipped:!1,stack:"probability"},{label:"Spread from min to max (%)",data:a,backgroundColor:"#ffffff",borderColor:"#ffffff",borderWidth:1,borderRadius:{topRight:3,bottomRight:3,topLeft:0,bottomLeft:0},borderSkipped:!1,stack:"probability"}]}},[s]),A=React.useMemo(()=>{if(!s)return null;const v=s.runners.map(a=>(a.impliedProbability??0)*100),N=s.runners.reduce((a,r)=>{const c=(r.probabilityMax??0)*100;return c>a?c:a},0),w=Math.max(5,N);return{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(a){const r=s.runners[a.dataIndex],c=me(r.probabilityMin),x=me(r.probabilityMax);return`${r.name} — ${c} to ${x}`}}},valueLabel:{color:"#e8ecf5",impliedProbabilities:v}},scales:{x:{stacked:!0,grid:{color:"rgba(232, 236, 245, 0.50)"},ticks:{color:"#e8ecf5",callback:a=>`${a}%`},suggestedMax:w},y:{stacked:!0,grid:{display:!1},ticks:{color:a=>{const r=a.tick?.label;if(typeof r=="string"){if(r.startsWith(Ce))return"#ff3b30";if(r.startsWith("Others"))return"#9aa0ae"}return"#e8ecf5"},autoSkip:!1}}}}},[s]),F=React.useMemo(()=>{if(!s)return null;const v=s.runners.map(w=>w.name),N=s.runners.map((w,a)=>w.name.startsWith("Others")?"#9aa0ae":ce[a%ce.length]);return{labels:v,datasets:[{label:"Implied probability",data:s.runners.map(w=>(w.impliedProbability??0)*100),backgroundColor:N,borderWidth:0}]}},[s]),S=React.useMemo(()=>s?{animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(v){const N=s.runners[v.dataIndex];return`${N.name}: ${me(N.impliedProbability)}`}}}}}:null,[s]),M=React.useMemo(()=>s?Math.max(320,s.runners.length*34):320,[s]),P=React.useMemo(()=>{if(!s)return"bar-empty";const v=s.runners.map(N=>N.id).join("-");return`${s.marketId}-${v}-${s.fetchedAt}`},[s]),E=React.useMemo(()=>{if(!s)return"";const v=s.runners.filter(a=>a.status==="ACTIVE"&&!a.name.startsWith("Others")).length,N=Math.max(0,s.activeRunnerCount-v),w=s.numberOfWinners-s.winnerRunnerCount;return[`${s.activeRunnerCount} still active`,N>0?` (${v} displayed + ${N} others below 1%)`:"",s.winnerRunnerCount>0?` + ${s.winnerRunnerCount} already won`:"",s.loserRunnerCount>0?` + ${s.loserRunnerCount} already lost`:"",s.winnerRunnerCount+s.loserRunnerCount>0?` = ${s.totalRunners} starters`:"",w>1?` ; ${w} winning spots left`:""].join("")},[s]),$=React.useMemo(()=>`https://www.betfair.com/exchange/plus/politics/market/${n}`,[n]),L=h==="loading"&&!s,z=s?.runners.length===0,W=s?.inplay??!1;return e.jsxs("div",{className:"mx-auto flex max-w-[1200px] flex-col gap-6 pb-[clamp(1.25rem,4vw,2.5rem)] md:px-8 md:pt-2 md:pt-8","data-testid":"public-view",children:[p&&e.jsxs("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[rgba(230,57,70,0.5)] bg-[rgba(230,57,70,0.1)] px-4 py-3 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:flex-row md:items-center md:justify-between",role:"alert","aria-live":"assertive","data-testid":"error-message",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-lg font-bold text-[#e8ecf5]",children:"Price fetch failed"}),e.jsx("p",{className:"m-0 mt-1 text-sm text-[#9aa5c0]",children:p})]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-lg border border-white/15 bg-white/5 px-3 py-2 font-semibold text-[#e8ecf5] hover:border-white/30",onClick:()=>{k(n)},"data-testid":"retry-button",children:"Retry"})]}),e.jsx("section",{className:"grid grid-cols-1 gap-4","data-testid":"charts-section",children:e.jsxs("div",{className:"w-full border border-white/10 bg-[#0e1422] py-4 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:rounded-2xl md:p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-4 px-2 md:flex-row md:items-center md:justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Probability"}),e.jsx(At,{status:s?.status,isLive:W,externalUrl:$,lastUpdated:R,stats:E})]}),L&&e.jsx("div",{className:"mt-3 flex flex-col gap-2","aria-hidden":"true","data-testid":"loading-skeleton",children:Array.from({length:5}).map((v,N)=>e.jsx("div",{className:"h-4 animate-pulse rounded-md bg-white/10"},N))}),!L&&s&&!z&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"bar-chart-container",children:D&&e.jsx("div",{className:"w-full",style:{height:`${M}px`},children:e.jsx(mt,{data:D,options:A},P)})}),e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"pie-chart-container",children:F&&e.jsx("div",{className:"min-h-[260px] w-full",children:e.jsx(ht,{data:F,options:S})})})]}),!L&&z&&e.jsx("p",{className:"mt-3 text-[#9aa5c0]",role:"status","data-testid":"no-runners-message",children:"No runners available right now."})]})})]})},Ot=()=>{const t=jt(),o=()=>t.user&&t.showEdit?e.jsx(Tt,{marketGroups:t.marketGroups,onAddMarket:t.handleAddMarket,onUpdateMarket:t.handleUpdateMarket,onDeleteMarket:t.handleDeleteMarket,onToggleFavorite:t.handleToggleFavorite,onGetMarketName:t.handleGetMarketName,onAddGroup:t.handleAddGroup,onDeleteGroup:t.handleDeleteGroup,onReorderGroups:t.handleReorderGroups,onReorderMarkets:t.handleReorderMarkets,onImportYaml:t.handleImportYaml,onExportYaml:t.handleExportYaml,requestState:t.marketListState}):t.showLogin?e.jsx($t,{}):e.jsx(_t,{marketGroups:t.marketGroups,marketListState:t.marketListState,selectedMarketId:t.selectedMarketId});return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_-10%,rgba(230,57,70,0.18),transparent_35%),radial-gradient(circle_at_80%_20%,rgba(118,174,255,0.12),transparent_40%),#060910] font-sans text-[#e8ecf5]",style:{colorScheme:"dark"},children:[e.jsx(Dt,{title:"Odds",isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,showEdit:t.showEdit,onEditClick:t.navigateToEdit,onPublicClick:t.navigateToPublic,onLoginClick:t.navigateToLogin,onLogoutClick:t.logout,onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,showLoginButton:!t.user&&!t.showLogin,marketGroups:t.marketGroups,selectedMarketId:t.selectedMarketId,onSelectMarket:t.setSelectedMarketId,marketListState:t.marketListState}),o()]})},Te=document.getElementById("root");if(!Te)throw new Error("Root element #root not found");document.body.classList.add("odds-page");ReactDOM.createRoot(Te).render(e.jsx(React.StrictMode,{children:e.jsx(tt,{children:e.jsx(xt,{children:e.jsx(Ot,{})})})}));
