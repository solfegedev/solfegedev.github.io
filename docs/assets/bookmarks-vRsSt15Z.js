import"./index-CiIqH9NT.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{P as Me,u as ye,T as Oe}from"./Toast-CC0uQ94P.js";import{A as Ne}from"./api-CH_Pe6Vg.js";import{c as Pe}from"./utils-CN4411gJ.js";import{S as qe}from"./search-Cfl0sis-.js";import{X as Ve}from"./x-BS-d4QNZ.js";import{c as ze}from"./createLucideIcon-DtX1aPOG.js";import{T as He}from"./trash-2-DQbJ9aIh.js";import{G as Je,D as Ye,U as Ke}from"./upload-CK6mc6ZD.js";import{R as We}from"./refresh-cw-pTx9cW3g.js";import{C as Xe}from"./copy-CzC7y2Qs.js";import{S as Ze}from"./save-rN7CZjMN.js";import{P as Qe}from"./pencil-DHu_drsE.js";import"./clsx-B-dksMZM.js";const et=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],tt=ze("folder",et),Q=`${Ne}/bookmarks`,ee=async s=>{if(s.ok)return s.status===204?null:s.json();throw await s.json().catch(()=>({detail:s.statusText}))},x={get:(s,n)=>fetch(`${Q}${s}`,{headers:n?{Authorization:`Bearer ${n}`}:{}}).then(ee),post:(s,n,i)=>fetch(`${Q}${s}`,{method:"POST",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify(n)}).then(ee),put:(s,n,i)=>fetch(`${Q}${s}`,{method:"PUT",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify(n)}).then(ee),delete:(s,n)=>fetch(`${Q}${s}`,{method:"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}).then(ee)},I=React.forwardRef(({variant:s="default",className:n="",...i},l)=>{const u="w-full bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",d={default:"px-4 py-2",small:"px-3 py-1.5 text-sm"};return e.jsx("input",{ref:l,className:`${u} ${d[s]} ${n}`,...i})});I.displayName="Input";const f=React.forwardRef(({variant:s="primary",className:n="",children:i,...l},u)=>{const d="transition-colors rounded-lg font-bold",c={primary:"bg-gradient-to-r from-indigo-500 to-violet-500 text-white py-2 px-8 shadow-[0_15px_35px_rgba(108,99,255,0.35)] hover:from-indigo-400 hover:to-violet-400 rounded-full uppercase tracking-[0.08em]",secondary:"bg-slate-700 hover:bg-slate-600 text-white py-2 px-8 h-[42px]",icon:"text-slate-500 hover:text-blue-400 p-1 transition-all",danger:"text-rose-500 hover:text-rose-400 p-2 hover:bg-rose-500/10 rounded-lg","icon-danger":"text-red-400 hover:text-red-300 p-1"};return e.jsx("button",{ref:u,className:Pe(d,c[s],n),...l,children:i})});f.displayName="Button";const B=({label:s,htmlFor:n,hint:i,id:l,...u})=>{const d=l||n;return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:d,className:"mb-1 block text-sm font-medium text-slate-400",children:[s," ",i&&e.jsx("span",{className:"text-slate-500",children:i})]}),e.jsx(I,{id:d,...u})]})},se=React.forwardRef(({className:s="",children:n,...i},l)=>e.jsx("select",{ref:l,className:`w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${s}`,...i,children:n}));se.displayName="Select";const re=({className:s})=>e.jsx(He,{className:`h-5 w-5 ${s||""}`}),st=({className:s})=>e.jsx(Qe,{className:`h-4 w-4 ${s||""}`}),at=({className:s})=>e.jsx(Ze,{className:`h-5 w-5 ${s||""}`}),te=({className:s})=>e.jsx(Ve,{className:`h-4 w-4 ${s||""}`}),rt=({className:s})=>e.jsx(qe,{className:`h-4 w-4 ${s||""}`}),je=({className:s})=>e.jsx(tt,{className:`h-5 w-5 ${s||""}`}),ve=({className:s})=>e.jsx(Je,{className:`h-5 w-5 ${s||""}`}),ot=({className:s})=>e.jsx(Ye,{className:`h-5 w-5 ${s||""}`}),lt=({className:s})=>e.jsx(Ke,{className:`h-5 w-5 ${s||""}`}),nt=({className:s})=>e.jsx(Me,{className:`h-4 w-4 ${s||""}`}),it=({className:s})=>e.jsx(Xe,{className:`h-4 w-4 ${s||""}`}),ct=({className:s})=>e.jsx(We,{className:`h-4 w-4 ${s||""}`}),dt=({onLogin:s})=>{const[n,i]=React.useState(""),[l,u]=React.useState(""),[d,c]=React.useState(null),[N,D]=React.useState(!1),y=async v=>{v.preventDefault(),D(!0),c(null);try{const w=await x.post("/login",{email:n,password:l});s(w)}catch(w){c(w.detail||"Login failed")}finally{D(!1)}};return e.jsxs("div",{className:"mx-auto mt-20 max-w-md rounded-xl border border-slate-800 bg-slate-900 p-6 shadow-xl",children:[e.jsx("h2",{className:"mb-6 text-center text-2xl font-bold",children:"Login to Bookmarks"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx(B,{label:"Email",type:"email",autoComplete:"email",required:!0,"data-testid":"login-email",value:n,onChange:v=>i(v.target.value)}),e.jsx(B,{label:"Password",type:"password",autoComplete:"current-password",required:!0,"data-testid":"login-password",value:l,onChange:v=>u(v.target.value)}),d&&e.jsx("p",{className:"text-sm text-red-400",children:d}),e.jsx(f,{type:"submit",disabled:N,"data-testid":"login-submit",variant:"primary",className:"w-full disabled:opacity-50",children:N?"Logging in...":"Login"})]})]})},oe=s=>Array.isArray(s)?s.map(n=>oe(n)):s!==null&&typeof s=="object"?Object.entries(s).reduce((n,[i,l])=>(l!==null&&(n[i]=oe(l)),n),{}):s,ut=s=>{const n=oe(s);return jsyaml.dump(n,{indent:2,sortKeys:!0,lineWidth:-1,noRefs:!0,skipInvalid:!0})},mt=({auth:s})=>{const{successToast:n,errorToast:i}=ye(),[l,u]=React.useState([]),[d,c]=React.useState([]),[N,D]=React.useState(!0),[y,v]=React.useState(null),[w,k]=React.useState(null),[R,F]=React.useState(null),[T,S]=React.useState(null),[E,M]=React.useState(""),[C,H]=React.useState(""),[U,J]=React.useState(""),[Y,K]=React.useState(""),[$,o]=React.useState(null),[b,A]=React.useState(!1),[O,le]=React.useState(!1),[ne,P]=React.useState(null),[ie,ce]=React.useState(""),[de,ue]=React.useState(""),[me,pe]=React.useState(""),[W,X]=React.useState("Default"),[G,xe]=React.useState(""),ae=async()=>{try{const t=await x.get("/",s.access_token);u(t)}catch(t){console.error("Failed to fetch bookmarks",t)}finally{D(!1)}},L=async()=>{try{const t=await x.get("/groups",s.access_token);c(t)}catch(t){console.error("Failed to fetch groups",t)}};React.useEffect(()=>{ae(),L()},[s]);const we=async t=>{t.preventDefault(),o(null);try{const a=await x.post("/",{title:E,url:C,group:U.trim()||null},s.access_token);u([...l,a]),M(""),H(""),J(""),A(!1),a.group&&X(a.group),L()}catch(a){o(a.detail||"Failed to add bookmark")}},ke=async t=>{t.preventDefault(),o(null);try{const a=await x.post("/groups",{name:Y},s.access_token);c([...d,a]),K("")}catch(a){o(a.detail||"Failed to add group")}},Se=async t=>{const a=d.find(r=>r.name===t);if(a&&confirm(`Are you sure you want to delete the group "${t}"? Bookmarks will move to Default group.`))try{await x.delete(`/groups/${a.id}`,s.access_token),c(d.filter(r=>r.id!==a.id)),ae()}catch(r){console.error("Failed to delete group",r)}},Re=async t=>{if(confirm("Are you sure you want to delete this bookmark?"))try{await x.delete(`/${t}`,s.access_token),u(l.filter(a=>a.id!==t)),P(null)}catch(a){console.error("Failed to delete bookmark",a)}},De=t=>{P(t.id),ce(t.title),ue(t.url),pe(t.group||"")},Ce=async t=>{try{const a={title:ie,url:de,group:me.trim()||null},r=await x.put(`/${t}`,a,s.access_token);u(l.map(m=>m.id===t?r:m)),P(null),a.group&&X(a.group),L()}catch(a){console.error("Failed to update bookmark",a)}},$e=async t=>{try{const a={title:`${t.title} (duplicate)`,url:t.url,group:t.group||null},r=await x.post("/",a,s.access_token);u([...l,r]),r.group&&X(r.group),P(null),L()}catch(a){console.error("Failed to duplicate bookmark",a)}},_e=t=>{v(t)},Ie=(t,a)=>{if(t.preventDefault(),y===null||y===a)return;const r=l.findIndex(h=>h.id===y),m=l.findIndex(h=>h.id===a);if(r===-1||m===-1)return;const p=[...l],[j]=p.splice(r,1);p.splice(m,0,j),p.map(h=>h.id).join(",")!==l.map(h=>h.id).join(",")&&u(p)},he=async()=>{if(!(y===null&&R===null)){v(null),F(null);try{const t={download_date:new Date().toISOString(),groups:Object.entries(l.reduce((a,r)=>{const m=r.group||"Default";return a[m]||(a[m]=[]),a[m].push({title:r.title,url:r.url,icon_url:r.icon_url}),a},{})).map(([a,r])=>({name:a,items:r}))};await x.post("/bulk",t,s.access_token),L()}catch(t){console.error("Failed to save reordered bookmarks",t),ae(),L()}}},Fe=t=>{F(t)},Ee=(t,a)=>{if(t.preventDefault(),R===null||R===a)return;const r=fe,m=r.indexOf(R),p=r.indexOf(a);if(m===-1||p===-1)return;const j=[...r],[h]=j.splice(m,1);j.splice(p,0,h);const _=l.reduce((g,Z)=>{const z=Z.group||"Default";return g[z]||(g[z]=[]),g[z].push(Z),g},{}),V=[];if(j.forEach(g=>{_[g]&&V.push(..._[g])}),V.map(g=>g.id).join(",")!==l.map(g=>g.id).join(",")){u(V);const g=j.map((Z,z)=>{const be=d.find(Te=>Te.name===Z);return be?{...be,position:z}:null}).filter(Boolean);c(g)}},ge=React.useMemo(()=>G.trim()?new Fuse(l,{keys:["title","url","group"],threshold:.4}).search(G).map(a=>a.item):l,[l,G]),q=React.useMemo(()=>{const t={Default:[]};return d.forEach(a=>{t[a.name]=[]}),ge.forEach(a=>{const r=a.group||"Default";t[r]||(t[r]=[]),t[r].push(a)}),t},[ge,d]),fe=React.useMemo(()=>Object.keys(q).sort((a,r)=>{if(a==="Default")return 1;if(r==="Default")return-1;const m=d.find(h=>h.name===a),p=d.find(h=>h.name===r);if(m&&p)return m.position-p.position;const j=h=>{const _=q[h];return _.length===0?999999:Math.min(..._.map(V=>l.findIndex(g=>g.id===V.id)))};return j(a)-j(r)}),[q,d,l]),Ue=t=>{X(W===t?null:t)},Ae=async()=>{try{const t=await x.get("/export",s.access_token),a=ut(t),r=new Blob([a],{type:"text/yaml"}),m=URL.createObjectURL(r),p=document.createElement("a");p.href=m,p.download=`bookmarks_${new Date().toISOString().split("T")[0]}.yml`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(m)}catch(t){console.error("Failed to export bookmarks",t)}},Ge=async()=>{try{await x.post("/update-icons",{},s.access_token),n("Icon update started in background.")}catch(t){console.error("Failed to update icons",t),i("Failed to start icon update.")}},Le=async t=>{const a=t.target.files?.[0];if(!a)return;const r=new FileReader;r.onload=async m=>{try{const p=m.target?.result,j=jsyaml.load(p);if(!j||!Array.isArray(j.groups))throw new Error("Invalid format: expected 'groups' array");if(confirm("This will replace ALL your current bookmarks. Continue?")){const h=await x.post("/bulk",j,s.access_token);u(h),x.post("/update-icons",{},s.access_token).catch(_=>{console.error("Failed to update icons",_)})}}catch(p){i("Failed to upload bookmarks: "+p.message)}},r.readAsText(a),t.target.value=""},Be=(t,a=!1)=>e.jsx("div",{"data-testid":`bookmark-row-${t.id}`,draggable:w===t.id&&ne!==t.id,onDragStart:()=>_e(t.id),onDragOver:r=>Ie(r,t.id),onDragEnd:()=>{he(),k(null)},className:`group flex min-h-[3rem] items-center justify-between py-0 transition-colors hover:bg-slate-800/40 px-4 ${y===t.id?"bg-blue-500/10 opacity-20":""} ${w===t.id?"select-none":""}`,children:ne===t.id?e.jsxs("div",{className:"flex flex-1 flex-col gap-2","data-testid":"edit-bookmark-form",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[e.jsx(I,{type:"text",placeholder:"Title","data-testid":"edit-bookmark-title",variant:"small",value:ie,onChange:r=>ce(r.target.value),autoFocus:!0}),e.jsxs(se,{"data-testid":"edit-bookmark-group",value:me,onChange:r=>pe(r.target.value),className:"h-[34px] px-3 py-1 text-sm",children:[e.jsx("option",{value:"",children:"Default"}),d.map(r=>e.jsx("option",{value:r.name,children:r.name},r.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("textarea",{placeholder:"URL",rows:5,"data-testid":"edit-bookmark-url",className:"min-h-[38px] flex-1 resize-none overflow-hidden rounded-lg border border-slate-700 bg-slate-950 px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:de,ref:r=>{r&&(r.style.height="auto",r.style.height=r.scrollHeight+"px")},onChange:r=>{ue(r.target.value),r.target.style.height="auto",r.target.style.height=r.target.scrollHeight+"px"},onFocus:r=>{r.target.select(),r.target.style.height="auto",r.target.style.height=r.target.scrollHeight+"px"}}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{onClick:()=>$e(t),"data-testid":"duplicate-bookmark-button",variant:"icon",title:"Duplicate",children:e.jsx(it,{className:"text-slate-400 transition-colors hover:text-blue-400"})}),e.jsx(f,{onClick:()=>Re(t.id),"data-testid":"delete-bookmark-button",variant:"icon-danger",title:"Delete",children:e.jsx(re,{})}),e.jsx(f,{onClick:()=>P(null),"data-testid":"cancel-edit-button",variant:"icon",title:"Cancel",children:e.jsx(te,{className:"h-5 w-5 text-slate-400 transition-colors hover:text-blue-400"})}),e.jsx(f,{onClick:()=>Ce(t.id),"data-testid":"save-edit-button",variant:"icon",title:"Save",children:e.jsx(at,{className:"text-green-600 transition-colors hover:text-green-500"})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-3 flex h-4 w-4 shrink-0 items-center justify-center",children:t.icon_url?e.jsx("img",{src:`${Ne}${t.icon_url}`,alt:"",className:"h-4 w-4 rounded-sm",onError:r=>{r.target.style.display="none"}}):e.jsx("div",{className:"h-1 w-1 rounded-full bg-slate-700"})}),e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",draggable:!1,"data-testid":`bookmark-link-${t.id}`,className:"mr-4 flex-1 truncate font-medium text-slate-300 transition-colors hover:text-blue-400",children:t.title}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{onClick:()=>De(t),"data-testid":`edit-bookmark-button-${t.id}`,variant:"icon",title:"Edit",children:e.jsx(st,{})}),e.jsx("div",{className:"cursor-grab touch-none p-1 text-slate-600 transition-colors hover:text-blue-400 active:cursor-grabbing",title:"Hold to move",onMouseDown:()=>k(t.id),onMouseUp:()=>k(null),onTouchStart:()=>k(t.id),onTouchEnd:()=>k(null),onTouchCancel:()=>k(null),children:e.jsx(ve,{className:"h-4 w-4"})})]})]})},t.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col items-center justify-between gap-4 border-b border-slate-800 pb-4 md:flex-row",children:e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(I,{type:"text",placeholder:"Search bookmarks...",className:"w-full bg-slate-900 pr-4 pl-9",variant:"small",value:G,onChange:t=>xe(t.target.value),"data-testid":"search-input"}),e.jsx(rt,{className:"absolute top-1/2 left-3 -translate-y-1/2 text-slate-500"}),G&&e.jsx("button",{onClick:()=>xe(""),className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-500 hover:text-white",children:e.jsx(te,{})})]})}),O&&e.jsxs("div",{className:"mb-6 rounded-xl border border-slate-600 bg-slate-900 p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-bold",children:"Manage Groups"}),e.jsx("button",{onClick:()=>le(!1),className:"text-slate-500 hover:text-white",children:e.jsx(te,{})})]}),e.jsxs("form",{onSubmit:ke,className:"flex gap-3",children:[e.jsx(I,{type:"text",placeholder:"New Group Name",required:!0,autoFocus:!0,"data-testid":"new-group-name",variant:"small",value:Y,onChange:t=>K(t.target.value)}),e.jsx(f,{type:"submit","data-testid":"save-group-button",variant:"primary",className:"px-4 py-1.5 text-sm whitespace-nowrap",children:"Add Group"})]}),$&&e.jsx("p",{className:"mt-2 text-xs text-red-400",children:$})]}),b&&e.jsxs("div",{className:"mb-6 rounded-xl border border-blue-500/50 bg-slate-900 p-4 shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-bold",children:"New Bookmark"}),e.jsx("button",{onClick:()=>A(!1),className:"text-slate-500 hover:text-white",children:e.jsx(te,{})})]}),e.jsxs("form",{onSubmit:we,className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsx(I,{type:"text",placeholder:"Title",required:!0,autoFocus:!0,"data-testid":"new-bookmark-title",variant:"small",value:E,onChange:t=>M(t.target.value)}),e.jsx(I,{type:"url",placeholder:"URL",required:!0,"data-testid":"new-bookmark-url",variant:"small",value:C,onChange:t=>H(t.target.value)}),e.jsxs(se,{"data-testid":"new-bookmark-group",value:U,onChange:t=>J(t.target.value),className:"h-[38px] py-1.5 text-sm",children:[e.jsx("option",{value:"",children:"Default"}),d.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]}),e.jsx(f,{type:"submit","data-testid":"save-bookmark-button",variant:"primary",className:"px-4 py-1.5 text-sm",children:"Save"}),$&&e.jsx("p",{className:"text-xs text-red-400 md:col-span-4",children:$})]})]}),N?e.jsx("p",{className:"text-slate-500 italic","data-testid":"loading-indicator",children:"Loading..."}):l.length===0?e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-900 p-8 text-center text-slate-500 italic","data-testid":"no-bookmarks-message",children:"No bookmarks yet."}):e.jsx("div",{className:"space-y-1",children:fe.map(t=>e.jsxs("div",{"data-testid":`group-container-${t}`,draggable:T===t,onDragStart:()=>Fe(t),onDragOver:a=>Ee(a,t),onDragEnd:()=>{he(),S(null)},className:`overflow-hidden rounded-sm border border-slate-800 bg-slate-900 shadow-xl transition-all ${R===t?"opacity-20":""}`,children:[e.jsxs("div",{"data-testid":`group-header-${t}`,onClick:()=>Ue(t),className:`flex w-full cursor-pointer items-center justify-between border-l-4 bg-slate-600 px-4 py-1 text-left transition-colors hover:bg-slate-800/60 ${W===t?"border-blue-500":"border-transparent"}`,children:[e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsx(je,{className:`transition-colors ${W===t?"text-blue-400":"text-slate-500"}`}),e.jsx("span",{className:"text-lg font-bold text-slate-100",children:t==="Default"?"Default":t}),e.jsx("span",{className:"rounded-full border border-slate-800/50 bg-slate-950/50 px-2 py-0.5 text-xs font-bold text-slate-400",children:q[t].length})]}),e.jsx("div",{className:"flex items-center gap-2",children:O&&e.jsxs(e.Fragment,{children:[t!=="Default"&&e.jsx(f,{onClick:a=>{a.stopPropagation(),Se(t)},variant:"icon-danger",title:"Delete Group",className:"p-1",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("div",{className:"cursor-grab touch-none p-1 text-slate-100 transition-colors hover:text-blue-400 active:cursor-grabbing",title:"Hold to move group",onMouseDown:()=>S(t),onMouseUp:()=>S(null),onTouchStart:()=>S(t),onTouchEnd:()=>S(null),onTouchCancel:()=>S(null),onClick:a=>a.stopPropagation(),children:e.jsx(ve,{className:"h-4 w-4"})})]})})]}),(W===t||G.trim()!=="")&&e.jsx("div",{className:"divide-y divide-slate-800/50 pl-8","data-testid":`group-content-${t}`,children:q[t].map(a=>Be(a,!0))})]},t))}),e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Ge,title:"Refresh icons",className:"rounded-lg p-2 text-slate-400 transition-colors hover:bg-slate-800 hover:text-white",children:e.jsx(ct,{})}),e.jsx("button",{onClick:Ae,title:"Backup as YAML",className:"rounded-lg p-2 text-slate-400 transition-colors hover:bg-slate-800 hover:text-white",children:e.jsx(ot,{})}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".yaml,.yml",onChange:Le,className:"absolute inset-0 cursor-pointer opacity-0",title:"Restore from YAML"}),e.jsx("button",{className:"rounded-lg p-2 text-slate-400 transition-colors hover:bg-slate-800 hover:text-white",children:e.jsx(lt,{})})]})]}),!b&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{onClick:()=>le(!O),"data-testid":"manage-groups-button",variant:"primary",className:"flex h-auto items-center gap-1.5 px-4 py-1.5 text-sm",children:[e.jsx(je,{className:"h-4 w-4"}),O?"Done Managing":"Manage Groups"]}),!O&&e.jsxs(f,{onClick:()=>A(!0),"data-testid":"add-bookmark-button",variant:"primary",className:"flex h-auto items-center gap-1.5 px-4 py-1.5 text-sm",children:[e.jsx(nt,{}),"Add"]})]})]})]})},pt=({auth:s})=>{const{warningToast:n}=ye(),[i,l]=React.useState([]),[u,d]=React.useState(!0),[c,N]=React.useState(null),[D,y]=React.useState(""),[v,w]=React.useState(""),[k,R]=React.useState(""),[F,T]=React.useState(""),[S,E]=React.useState("user"),[M,C]=React.useState(null),H=async()=>{try{const o=await x.get("/admin/users",s.access_token);l(o)}catch(o){console.error("Failed to fetch users",o)}finally{d(!1)}};React.useEffect(()=>{H()},[s]);const U=()=>{N(null),y(""),w(""),R(""),T(""),E("user"),C(null)},J=o=>{N(o),y(o.email),w(""),R(o.first_name??""),T(o.last_name??""),E(o.role),C(null)},Y=async o=>{o.preventDefault(),C(null);try{if(c){const b=await x.put(`/admin/users/${c.id}`,{email:D,password:v||void 0,role:S,first_name:k,last_name:F},s.access_token);l(i.map(A=>A.id===c.id?b:A)),U()}else{const b=await x.post("/admin/users",{email:D,password:v,role:S,first_name:k,last_name:F},s.access_token);l([...i,b]),U()}}catch(b){C(b.detail||`Failed to ${c?"update":"add"} user`)}},K=async o=>{if(o===s.user.id){n("You cannot delete yourself.");return}if(confirm("Are you sure you want to delete this user? All their bookmarks will be lost."))try{await x.delete(`/admin/users/${o}`,s.access_token),l(i.filter(b=>b.id!==o))}catch(b){console.error("Failed to delete user",b)}},$=o=>o?new Date(o).toLocaleString("en-GB",{hour12:!1}):"-";return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900 p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-xl font-bold",children:c?"Edit User":"Add New User"}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 items-end gap-4 md:grid-cols-4",children:[e.jsx(B,{label:"Email",htmlFor:"user-email",type:"email",autoComplete:"email",required:!0,"data-testid":"admin-add-user-email",value:D,onChange:o=>y(o.target.value)}),e.jsx(B,{label:"Password",htmlFor:"user-password",hint:c?"(leave blank to keep current)":"",type:"password",autoComplete:"new-password",required:!c,"data-testid":"admin-add-user-password",value:v,onChange:o=>w(o.target.value)}),e.jsx(B,{label:"First Name",htmlFor:"user-first-name",type:"text",required:!0,"data-testid":"admin-add-user-first-name",value:k,onChange:o=>R(o.target.value)}),e.jsx(B,{label:"Last Name",htmlFor:"user-last-name",type:"text",required:!0,"data-testid":"admin-add-user-last-name",value:F,onChange:o=>T(o.target.value)})]}),e.jsxs("div",{className:"flex items-end justify-end gap-4",children:[e.jsxs("div",{className:"w-1/4",children:[e.jsx("label",{htmlFor:"user-role",className:"mb-1 block text-sm text-slate-400",children:"Role"}),e.jsxs(se,{id:"user-role","data-testid":"admin-add-user-role",value:S,onChange:o=>E(o.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),c&&e.jsx(f,{type:"button",onClick:U,variant:"secondary",children:"Cancel"}),e.jsx(f,{type:"submit","data-testid":"admin-add-user-submit",variant:"primary",className:"h-[42px]",children:c?"Update User":"Create User"})]})]}),M&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:M})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold",children:"User Management"}),u?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-800 bg-slate-900",children:e.jsxs("table",{className:"w-full text-left whitespace-nowrap",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-800 bg-slate-800/50",children:[e.jsx("th",{className:"px-6 py-3 text-sm font-bold uppercase",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-sm font-bold uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-sm font-bold uppercase",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-sm font-bold uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-sm font-bold uppercase",children:"Last Login"}),e.jsx("th",{className:"px-6 py-3 text-sm font-bold uppercase",children:"Updated At"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-bold uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800",children:i.map(o=>e.jsxs("tr",{onClick:()=>J(o),className:`cursor-pointer transition-colors ${c?.id===o.id?"bg-blue-500/10 hover:bg-blue-500/20":"hover:bg-slate-800/30"}`,children:[e.jsx("td",{className:"px-6 py-4 font-mono text-sm text-slate-400",children:o.id}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-100",children:o.email}),(o.first_name||o.last_name)&&e.jsxs("span",{className:"text-xs text-slate-500",children:[o.first_name||""," ",o.last_name||""]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-black tracking-wider uppercase ${o.role==="admin"?"border border-purple-500/20 bg-purple-500/10 text-purple-400":"border border-blue-500/20 bg-blue-500/10 text-blue-400"}`,children:o.role})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`flex items-center gap-1.5 text-xs font-medium ${o.is_active?"text-emerald-400":"text-rose-400"}`,children:[e.jsx("span",{className:`h-1.5 w-1.5 rounded-full ${o.is_active?"animate-pulse bg-emerald-500":"bg-rose-500"}`}),o.is_active?"Active":"Deactivated"]})}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs text-slate-400",children:$(o.last_login_at)}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs text-slate-400",children:$(o.updated_at)}),e.jsx("td",{className:"px-6 py-4 text-right",children:o.id!==s.user.id&&e.jsx(f,{onClick:b=>{b.stopPropagation(),K(o.id)},variant:"danger",title:"Delete User",children:e.jsx(re,{})})})]},o.id))})]})})]})]})},xt=()=>{const[s,n]=React.useState("login"),[i,l]=React.useState(null);React.useEffect(()=>{const c=localStorage.getItem("bookmarks_auth");if(c)try{const N=JSON.parse(c);l(N),n("dashboard")}catch{localStorage.removeItem("bookmarks_auth")}},[]);const u=()=>{l(null),localStorage.removeItem("bookmarks_auth"),n("login")},d=c=>{l(c),localStorage.setItem("bookmarks_auth",JSON.stringify(c)),n("dashboard")};return e.jsxs("div",{className:"flex min-h-screen flex-col bg-slate-950 text-slate-100",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-slate-800 bg-slate-900/50 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto flex h-16 max-w-6xl items-center justify-between px-4",children:[e.jsx("div",{className:"flex items-center gap-6",children:e.jsxs("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>n(i?"dashboard":"login"),children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600 font-bold",children:"B"}),e.jsx("span",{className:"hidden text-xl font-bold tracking-tight md:inline",children:"Bookmarks"})]})}),e.jsx("nav",{className:"flex items-center gap-4",children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-slate-400 md:inline",children:[i.user.first_name," ",i.user.last_name]}),i.user.role==="admin"&&e.jsx("button",{onClick:()=>n(s==="admin"?"dashboard":"admin"),className:`rounded-full px-3 py-1 text-sm font-medium transition-all ${s==="admin"?"text-slate-300 hover:bg-slate-800 hover:text-white":"bg-slate-600 text-white shadow-lg shadow-slate-900/20"}`,children:s==="admin"?"My Dashboard":"Manage Users"}),e.jsx("button",{onClick:u,className:"rounded-full bg-slate-600 px-3 py-1 text-sm font-medium text-white shadow-lg shadow-slate-900/20 transition-all hover:bg-slate-500",children:"Logout"})]})})]})}),e.jsxs("main",{className:"mx-auto w-full max-w-6xl flex-1 px-4 py-8",children:[s==="login"&&e.jsx(dt,{onLogin:d}),s==="dashboard"&&i&&e.jsx(mt,{auth:i}),s==="admin"&&i&&i.user.role==="admin"&&e.jsx(pt,{auth:i})]})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Oe,{children:e.jsx(xt,{})})}));
