import"./index-BcvDAENL.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as Re}from"./api-CH_Pe6Vg.js";import{B as K}from"./button-UTh2Cu_R.js";const je="todo.jwt",ke=t=>{if(!t)return null;if(typeof t=="string"){const a=t.trim();return a||null}if(Array.isArray(t)){for(const a of t){const r=ke(a);if(r)return r}return null}if(typeof t=="object"){const a=t;if("detail"in a){const n=ke(a.detail);if(n)return n}if(typeof a.msg=="string"){const n=a.msg.trim();if(n)return n}if(typeof a.message=="string"){const n=a.message.trim();if(n)return n}const r=Object.values(a).find(n=>typeof n=="string"&&!!n.trim());return r?r.trim():null}return null},ht=()=>{const t=React.useMemo(()=>`${Re}/tasks/auth`,[]),[a,r]=React.useState(()=>typeof window>"u"?null:window.localStorage.getItem(je)),[n,g]=React.useState(null),[b,h]=React.useState(!1),[m,i]=React.useState(null),[T,_]=React.useState(!1),d=React.useCallback(p=>{r(p),!(typeof window>"u")&&(p?window.localStorage.setItem(je,p):window.localStorage.removeItem(je))},[]),N=React.useCallback(p=>{i(p||null),d(null),g(null)},[d]),L=React.useCallback(async p=>{const k=await fetch(`${t}/me`,{headers:{Authorization:`Bearer ${p}`}});if(!k.ok)throw new Error(k.status===401?"Session expired. Please log in again.":"Unable to load profile.");const j=await k.json();g({id:j.id,email:j.email}),i(null)},[t]);React.useEffect(()=>{if(!a){g(null),h(!0);return}h(!1),L(a).catch(p=>{const k=p instanceof Error?p.message:"Session expired.";N(k)}).finally(()=>{h(!0)})},[N,L,a]);const y=React.useCallback(async(p,k)=>{_(!0),i(null);try{const j=await fetch(`${t}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,password:k})});if(!j.ok){const O=await j.json().catch(()=>null),X=ke(O)??"Invalid credentials";throw new Error(X)}const D=await j.json();d(D.access_token),await L(D.access_token)}catch(j){const D=j instanceof Error?j.message:"Unable to log in.";throw N(D),new Error(D)}finally{_(!1)}},[t,N,L,d]),C=React.useCallback(()=>{N()},[N]),S=React.useCallback(async(p,k)=>{if(!a)throw new Error("Not authenticated");const j=new Headers(k?.headers);j.set("Authorization",`Bearer ${a}`);const D=await fetch(p,{...k,headers:j});if(D.status===401)throw N("Session expired. Please log in again."),new Error("Session expired. Please log in again.");return D},[N,a]),B=React.useCallback(()=>i(null),[]);return{user:n,token:a,ready:b,isAuthenticated:!!(n&&a),login:y,logout:C,authenticatedFetch:S,sessionError:m,clearSessionError:B,loginPending:T}};function ft({categoryOptions:t,categoryForm:a,categorySaving:r,categoryActionFeedback:n,handleCategoryFormChange:g,handleCategorySubmit:b,handleCategoryDelete:h,defaultCategorySlug:m}){return e.jsx("section",{className:"rounded-[28px] border border-slate-400/30 bg-[#070b1a]/80 p-5 shadow-[0_20px_50px_rgba(2,6,23,0.55)]","aria-label":"Category manager",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.15em] text-slate-400",children:"Categories"}),e.jsx("h3",{className:"mt-1 text-xl font-semibold text-slate-50",children:"Manage categories"})]}),e.jsxs("form",{className:"grid grid-cols-1 gap-3 md:grid-cols-[repeat(auto-fit,minmax(220px,1fr))] md:items-end",onSubmit:b,children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:"Category label"}),e.jsx("input",{type:"text",value:a.label,onChange:i=>g("label",i.target.value),placeholder:"can include spaces",required:!0,className:"rounded-full border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:"Category slug"}),e.jsx("input",{type:"text",value:a.slug,onChange:i=>g("slug",i.target.value),placeholder:"DESIGN",required:!0,className:"rounded-full border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsx(K,{type:"submit",className:"h-full rounded-xl bg-gradient-to-r from-indigo-400 to-indigo-500 text-slate-900 shadow-[0_10px_30px_rgba(99,102,241,0.35)] hover:brightness-110",disabled:r,children:r?"Adding…":"Add category"})]}),e.jsx("ul",{className:"flex flex-col gap-2",children:t.map(i=>e.jsxs("li",{className:"flex items-center justify-between rounded-2xl border border-slate-400/25 bg-slate-900/60 px-3 py-2 text-sm text-slate-100",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("strong",{className:"text-slate-50",children:i.label}),e.jsx("small",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:i.value})]}),e.jsx(K,{type:"button",variant:"outline",className:"rounded-lg border border-rose-400/50 bg-rose-500/15 px-3 py-2 text-xs font-semibold text-rose-100 hover:bg-rose-500/20",onClick:()=>void h(i.value),disabled:i.value===m,children:"Delete"})]},i.value))}),n?e.jsx("p",{className:"m-0 text-sm text-slate-300",children:n}):null]})})}function bt({isAuthenticated:t,userEmail:a,showCategoryManager:r,setShowCategoryManager:n,showLoginForm:g,openLoginForm:b,closeLoginForm:h,loginForm:m,handleLoginFieldChange:i,handleLoginSubmit:T,loginPending:_,loginError:d,sessionError:N,openRegisterPanel:L,registerPanelOpen:y,handleLogoutClick:C}){return e.jsxs("nav",{className:"mb-6 flex flex-col gap-4 rounded-full border border-slate-400/25 bg-[#090912]/80 px-5 py-3 text-sm font-medium text-slate-200 shadow-[0_15px_40px_rgba(2,6,23,0.55)] md:flex-row md:items-center md:justify-between","aria-label":"Primary navigation",children:[e.jsx("div",{className:"text-sm font-bold uppercase tracking-[0.12em] text-indigo-300",children:"To Do list"}),e.jsxs("ul",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("li",{children:e.jsx("button",{type:"button",className:`inline-flex items-center rounded-full border px-3 py-2 ${r?"border-transparent bg-transparent text-slate-300 hover:text-white":"border-indigo-400/40 bg-indigo-500/15 text-white"}`,"aria-pressed":!r,onClick:()=>n(!1),children:"Tasks"})}),e.jsx("li",{children:e.jsx("button",{type:"button",className:`inline-flex items-center rounded-full border px-3 py-2 ${r?"border-indigo-400/40 bg-indigo-500/15 text-white":"border-transparent bg-transparent text-slate-300 hover:text-white"}`,"aria-pressed":r,onClick:()=>n(S=>!S),children:"Manage categories"})})]}),e.jsx("div",{className:"flex flex-1 flex-col gap-2 text-sm sm:flex-row sm:items-center sm:justify-end sm:gap-3",children:t?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex flex-col leading-tight",children:e.jsx("span",{className:"text-sm font-semibold text-slate-50",children:a??""})}),e.jsx("button",{type:"button",className:"rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-2 text-xs font-semibold text-slate-50 hover:border-indigo-300/60 hover:text-indigo-200",onClick:C,children:"Logout"})]}):e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[g?e.jsxs("form",{className:"grid w-full grid-cols-1 gap-2 sm:grid-cols-[repeat(auto-fit,minmax(160px,1fr))]",onSubmit:T,children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Email"}),e.jsx("input",{type:"email",value:m.email,onChange:S=>i("email",S.target.value),autoComplete:"email",required:!0,className:"rounded-xl border border-slate-400/35 bg-slate-900/70 px-3 py-2 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Password"}),e.jsx("input",{type:"password",value:m.password,onChange:S=>i("password",S.target.value),autoComplete:"current-password",required:!0,className:"rounded-xl border border-slate-400/35 bg-slate-900/70 px-3 py-2 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 sm:col-span-2",children:[e.jsx("button",{type:"submit",className:"rounded-full border border-indigo-300/60 bg-indigo-500/30 px-3 py-2 text-xs font-semibold text-white",disabled:_,children:_?"Signing in…":"Sign in"}),e.jsx("button",{type:"button",className:"rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-2 text-xs font-semibold text-slate-100",onClick:h,children:"Cancel"})]})]}):e.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-2 text-xs font-semibold text-slate-100 hover:border-indigo-300/60 hover:text-indigo-200",onClick:b,children:"Login"}),!g&&e.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-slate-400/20 bg-slate-900/60 px-3 py-2 text-xs font-semibold text-slate-50 hover:border-indigo-300/60 hover:text-indigo-200",onClick:L,"aria-expanded":y,children:"Register"}),(d||N)&&e.jsx("p",{className:"m-0 text-xs font-semibold text-rose-300",role:"status",children:d??N})]})})]})}function yt({isOpen:t,registerForm:a,registerSubmitting:r,registerFeedback:n,registerSuccess:g,closeRegisterPanel:b,handleRegisterSubmit:h,updateRegisterField:m}){return t?e.jsx("section",{className:"fixed inset-0 z-20 flex items-center justify-center bg-[rgba(5,8,22,0.82)] px-[clamp(1rem,4vw,2.75rem)] backdrop-blur-md",role:"dialog","aria-modal":"true","aria-labelledby":"todo-register-title",children:e.jsxs("div",{className:"w-full max-w-[480px] rounded-[30px] border border-slate-400/25 bg-slate-900/95 p-[clamp(1.5rem,4vw,2.75rem)] shadow-[0_25px_60px_rgba(2,6,23,0.65)]",children:[e.jsxs("header",{className:"mb-4 flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"m-0 text-xs font-semibold uppercase tracking-[0.2em] text-indigo-300",children:"Create account"}),e.jsx("h1",{className:"m-0 text-2xl font-semibold text-slate-50",id:"todo-register-title",children:"Register"}),e.jsx("p",{className:"m-0 text-sm leading-6 text-slate-300",children:"Create a personal login to keep your to-do list private. You can log in from the to-do page once you finish."})]}),e.jsx("button",{type:"button",className:"rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-1 text-xs font-semibold text-slate-100 hover:border-indigo-300/60",onClick:b,"aria-label":"Close registration dialog",children:"Close"})]}),e.jsxs("form",{className:"flex flex-col gap-3",onSubmit:h,children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:i=>m("email",i.target.value),placeholder:"you@example.com",required:!0,autoComplete:"email",className:"rounded-full border border-slate-400/35 bg-slate-900/70 px-3 py-3 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:i=>m("password",i.target.value),placeholder:"********",required:!0,autoComplete:"new-password","data-testid":"register-password",className:"rounded-full border border-slate-400/35 bg-slate-900/70 px-3 py-3 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Confirm password"}),e.jsx("input",{type:"password",value:a.confirm,onChange:i=>m("confirm",i.target.value),placeholder:"********",required:!0,autoComplete:"new-password","data-testid":"register-confirm-password",className:"rounded-full border border-slate-400/35 bg-slate-900/70 px-3 py-3 text-slate-100 placeholder:text-slate-500"})]}),e.jsx(K,{type:"submit",className:"mt-1 rounded-xl bg-gradient-to-r from-indigo-400 to-indigo-500 px-4 py-3 font-bold text-slate-900 shadow-[0_12px_30px_rgba(99,102,241,0.35)] hover:brightness-110",disabled:r,children:r?"Creating account…":"Create account"})]}),n?e.jsx("p",{className:`mt-3 text-sm font-semibold ${g?"text-emerald-200":"text-rose-200"}`,role:"status",children:n}):null]})}):null}function jt({editingId:t,loading:a,draft:r,categoryOptions:n,categoryLabelMap:g,saveFeedback:b,saving:h,updateDraft:m,handleReset:i,handleSubmit:T,onRefresh:_}){return e.jsxs("section",{className:"rounded-[22px] border border-slate-400/30 bg-slate-900/70 p-5 shadow-[0_25px_60px_rgba(2,6,23,0.55)]","aria-labelledby":"todo-form-title",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.12em] text-indigo-300",children:t?"Edit":"Create"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-50",id:"todo-form-title",children:t?"Update task":"New task"})]}),e.jsx("div",{children:e.jsx(K,{type:"button",variant:"outline",className:"rounded-xl border-slate-400/35 bg-white/5 px-4 py-2 font-semibold text-slate-100 hover:border-indigo-300/60",onClick:_,disabled:a,children:a?"Syncing…":"Refresh"})})]}),t?e.jsxs("p",{className:"mt-1 text-sm font-semibold text-indigo-200",children:["Editing task #",t]}):null,e.jsxs("form",{className:"mt-4 grid grid-cols-1 gap-3",onSubmit:T,children:[e.jsxs("label",{className:"grid gap-1",htmlFor:"task-name",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Name"}),e.jsx("input",{id:"task-name",type:"text",value:r.name,onChange:d=>m("name",d.target.value),placeholder:"Write the task title",required:!0,className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"grid gap-1",htmlFor:"task-description",children:[e.jsxs("span",{className:"text-sm text-slate-200",children:["Description ",e.jsx("span",{className:"text-xs text-slate-400",children:"(optional)"})]}),e.jsx("textarea",{id:"task-description",value:r.description,onChange:d=>m("description",d.target.value),rows:3,className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"grid gap-1",htmlFor:"task-start",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Start date"}),e.jsx("input",{id:"task-start",type:"date",value:r.startDate,onChange:d=>m("startDate",d.target.value),className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"grid gap-1",htmlFor:"task-due",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Due date"}),e.jsx("input",{id:"task-due",type:"date",value:r.dueDate,onChange:d=>m("dueDate",d.target.value),className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]})]}),e.jsxs("label",{className:"grid gap-1",htmlFor:"task-category",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Category"}),e.jsx("select",{id:"task-category",value:r.category,onChange:d=>m("category",d.target.value),className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100",children:n.length===0?e.jsx("option",{value:r.category,children:g[r.category]??r.category}):n.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Status"}),e.jsx("p",{className:"m-0 text-xs text-slate-400",children:"Is the task complete?"})]}),e.jsx("input",{id:"task-completed",type:"checkbox",checked:r.isCompleted,onChange:d=>m("isCompleted",d.target.checked),className:"h-5 w-5 accent-indigo-400"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(K,{type:"button",variant:"outline",className:"rounded-xl border-slate-400/35 bg-white/5 px-4 py-2 font-semibold text-slate-100 hover:border-indigo-300/60",onClick:i,children:t?"Cancel edit":"Clear"}),e.jsx(K,{type:"submit",className:"rounded-xl bg-gradient-to-r from-indigo-400 to-indigo-500 px-5 py-2 font-bold text-slate-900 shadow-[0_10px_30px_rgba(99,102,241,0.35)] hover:brightness-110",disabled:h,children:h?"Saving…":t?"Save changes":"Save"})]}),b?e.jsx("p",{className:"m-0 text-sm text-slate-300",children:b}):null]})]})}function wt({showBlocked:t,showCompleted:a,setShowBlocked:r,setShowCompleted:n,stats:g,handleBulkDelete:b,bulkDeleting:h,selectedCount:m,deleteFeedback:i,loading:T,syncError:_,loadTasks:d,tasks:N,sortedTasks:L,getTaskStatus:y,getDaysUntilDue:C,isOverdue:S,editingId:B,beginEditing:p,handleRowKeyDown:k,selectedIds:j,toggleSelection:D,categoryLabelMap:O,formatDueOffsetLabel:X,formatDisplayDate:Y,lastSyncedAt:G,sortConfig:I,handleSortChange:le}){const W=u=>I.key!==u?"none":I.direction==="asc"?"ascending":"descending",$=(u,R)=>{const U=I.key===u?I.direction:null,M=U?`Sort by ${R} (${U==="asc"?"ascending":"descending"})`:`Sort by ${R}`;return e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-lg border border-transparent px-2 py-1 text-left text-slate-200 hover:border-slate-500/40",onClick:()=>le(u),"aria-label":M,children:[e.jsx("span",{children:R}),e.jsx("span",{className:"text-xs text-slate-400","aria-hidden":"true",children:U?U==="asc"?"↑":"↓":"↕"})]})},re=m;return e.jsxs("section",{className:"flex flex-col gap-4 rounded-[22px] border border-slate-400/30 bg-slate-900/70 p-5 shadow-[0_25px_60px_rgba(2,6,23,0.55)]","aria-live":"polite","aria-busy":T,children:[e.jsx("header",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:flex-wrap lg:items-start lg:gap-4",children:[e.jsxs("label",{className:"flex flex-1 min-w-[240px] items-center justify-between gap-3 rounded-2xl border border-slate-400/30 bg-white/5 px-3 py-3",htmlFor:"toggle-show-blocked",children:[e.jsxs("div",{className:"text-sm text-slate-200",children:[e.jsx("span",{className:"block font-semibold text-slate-50",children:"Show blocked tasks"}),e.jsx("p",{className:"m-0 text-xs text-slate-400",children:"Tasks that cannot be started yet"})]}),e.jsx("input",{id:"toggle-show-blocked",type:"checkbox",role:"switch","aria-checked":t,checked:t,onChange:u=>r(u.target.checked),className:"h-5 w-5 accent-indigo-400"})]}),e.jsxs("label",{className:"flex flex-1 min-w-[240px] items-center justify-between gap-3 rounded-2xl border border-slate-400/30 bg-white/5 px-3 py-3",htmlFor:"toggle-show-completed",children:[e.jsxs("div",{className:"text-sm text-slate-200",children:[e.jsx("span",{className:"block font-semibold text-slate-50",children:"Show completed tasks"}),e.jsx("p",{className:"m-0 text-xs text-slate-400",children:"Tasks done"})]}),e.jsx("input",{id:"toggle-show-completed",type:"checkbox",role:"switch","aria-checked":a,checked:a,onChange:u=>n(u.target.checked),className:"h-5 w-5 accent-indigo-400"})]}),e.jsxs("dl",{className:"grid grid-cols-3 gap-2 rounded-2xl border border-slate-400/30 bg-white/5 px-3 py-3 text-center text-sm text-slate-200 lg:w-auto lg:min-w-[280px]",children:[e.jsxs("div",{className:"rounded-xl bg-white/5 px-2 py-1",children:[e.jsx("dt",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:"Blocked"}),e.jsx("dd",{className:"m-0 text-lg font-semibold text-slate-50",children:g.blocked})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 px-2 py-1",children:[e.jsx("dt",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:"Active"}),e.jsx("dd",{className:"m-0 text-lg font-semibold text-slate-50",children:g.ready})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 px-2 py-1",children:[e.jsx("dt",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:"Overdue"}),e.jsx("dd",{className:"m-0 text-lg font-semibold text-slate-50",children:g.overdue})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(K,{type:"button",variant:"outline",className:"rounded-xl border-rose-400/50 bg-rose-500/15 px-4 py-2 text-sm font-semibold text-rose-100 hover:bg-rose-500/20",onClick:()=>void b(),disabled:h||re===0,children:h?"Deleting…":"Delete selected"}),i?e.jsx("p",{className:"m-0 text-xs font-semibold text-rose-300",role:"status",children:i}):null]})]})}),T?e.jsx("p",{className:"text-sm text-slate-300",children:"Loading tasks…"}):_?e.jsxs("div",{className:"flex flex-wrap items-center gap-3 rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-sm text-rose-100",children:[e.jsx("p",{className:"m-0",children:_}),e.jsx(K,{type:"button",size:"sm",className:"rounded-lg border border-slate-400/35 bg-white/5 px-3 py-2 text-xs font-semibold text-slate-100 hover:border-indigo-300/60",onClick:()=>void d(),children:"Try again"})]}):N.length===0?e.jsx("div",{className:"rounded-xl border border-slate-400/30 bg-white/5 px-3 py-2 text-sm text-slate-200",children:e.jsx("p",{className:"m-0",children:"No tasks yet. Save your first task on the left."})}):e.jsx("div",{className:"overflow-auto rounded-2xl border border-slate-400/30 bg-[#0b1224]/70",children:e.jsxs("table",{className:"min-w-full border-collapse text-sm text-slate-100",children:[e.jsx("thead",{className:"bg-white/5 text-left text-xs uppercase tracking-wide text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-3",children:"Select"}),e.jsx("th",{scope:"col","aria-sort":W("status"),className:"px-3 py-3",children:$("status","Status")}),e.jsx("th",{scope:"col",className:"px-3 py-3",children:"Task"}),e.jsx("th",{scope:"col","aria-sort":W("category"),className:"px-3 py-3",children:$("category","Category")}),e.jsx("th",{scope:"col",className:"px-3 py-3",children:"Days left"}),e.jsx("th",{scope:"col","aria-sort":W("start_date"),className:"px-3 py-3",children:$("start_date","Start date")}),e.jsx("th",{scope:"col","aria-sort":W("due_date"),className:"px-3 py-3",children:$("due_date","Due date")})]})}),e.jsx("tbody",{children:L.map(u=>{const R=y(u),U=R.tone==="completed"?"border-emerald-400/40 bg-emerald-500/15 text-emerald-200":R.tone==="active"?"border-indigo-400/40 bg-indigo-500/20 text-indigo-100":"border-slate-400/40 bg-slate-500/20 text-slate-100",M=C(u.due_date),oe=M<0?"bg-rose-500/20 text-rose-100":M===0?"bg-amber-400/20 text-amber-100":"bg-cyan-400/20 text-cyan-100",ee=["cursor-pointer border-b border-slate-800/80 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400/60 hover:bg-white/5"];return S(u.due_date,u.is_completed)&&ee.push("bg-rose-500/5"),B===u.id&&ee.push("bg-indigo-500/5 border-indigo-400/50"),e.jsxs("tr",{className:ee.join(" "),onClick:()=>p(u),onKeyDown:z=>k(z,u),tabIndex:0,children:[e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-indigo-400","aria-label":`Select task ${u.name}`,checked:j.has(u.id),onChange:z=>D(u.id,z.target.checked),onClick:z=>z.stopPropagation()})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:`inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold ${U}`,children:R.label})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:"font-semibold text-slate-50",children:u.name})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:"inline-flex rounded-full bg-white/10 px-3 py-1 text-xs font-semibold text-slate-100",children:(O[u.category]??u.category)||"Uncategorized"})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:`inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-semibold ${oe}`,children:X(M)})}),e.jsx("td",{className:"px-3 py-3 align-middle text-slate-100",children:Y(u.start_date)}),e.jsx("td",{className:"px-3 py-3 align-middle text-slate-100",children:e.jsx("span",{className:"font-semibold",children:Y(u.due_date)})})]},u.id)})})]})}),G?e.jsxs("p",{className:"text-xs text-slate-400",children:["Last synced ",G.toLocaleTimeString()]}):null]})}const Nt=t=>t.toISOString().split("T")[0],we=()=>{const t=Nt(new Date);return{name:"",description:"",startDate:t,dueDate:t,category:"",isCompleted:!1}},ae=t=>{const a=t.slice(0,10),[r,n,g]=a.split("-"),b=Number(r),h=Number(n),m=Number(g);if([b,h,m].some(i=>Number.isNaN(i))){const i=new Date(t);return i.setHours(0,0,0,0),i}return new Date(b,h-1,m)},Ee=()=>{const t=new Date;return t.setHours(0,0,0,0),t},vt=1440*60*1e3,St=t=>({name:t.name,description:t.description,startDate:t.start_date,dueDate:t.due_date,category:t.category,isCompleted:t.is_completed}),pe=t=>t.replace(/^value error,\s*/i,"").trim()||t,kt=t=>{if(!t)return null;if(typeof t=="string")return pe(t);if(typeof t=="object"){const a=t.detail;if(typeof a=="string")return pe(a);if(Array.isArray(a)&&a.length>0){const r=a[0];if(r&&typeof r=="object"){const n=r.msg;if(typeof n=="string")return pe(n);const g=r.ctx?.error;if(typeof g=="string")return pe(g)}}}return null},Ne=()=>({email:"",password:"",confirm:""}),V=`${Re}/tasks`,Ue="NONE",Me="todoLastLoginEmail",ve=()=>{if(typeof window>"u")return"";try{return window.localStorage.getItem(Me)??""}catch{return""}},Ct=t=>{if(typeof window>"u")return;const a=t.trim();if(a)try{window.localStorage.setItem(Me,a)}catch{}},Rt=t=>{const a=ae(t);return Number.isNaN(a.valueOf())?t:new Intl.DateTimeFormat(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(a)},Be=(t,a=!1)=>{if(a)return!1;const r=Ee(),n=ae(t);return n.setHours(0,0,0,0),n<r},Et=t=>{const a=ae(t);if(Number.isNaN(a.valueOf()))return 0;a.setHours(0,0,0,0);const r=Ee();return Math.round((a.getTime()-r.getTime())/vt)},_t=t=>t>0?`+${t}d`:`${t}d`,Ie=t=>t.trim().toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,""),Ce=t=>{const a=Ee(),r=ae(t);return r.setHours(0,0,0,0),r.getTime()<=a.getTime()},Se=t=>t.is_completed?{label:"Completed",tone:"completed"}:Ce(t.start_date)?{label:"Active",tone:"active"}:{label:"Blocked",tone:"blocked"},Dt=()=>{const[t,a]=React.useState([]),[r,n]=React.useState(we),[g,b]=React.useState(!0),[h,m]=React.useState(null),[i,T]=React.useState(!1),[_,d]=React.useState(null),[N,L]=React.useState(null),[y,C]=React.useState([]),[S,B]=React.useState(null),[p,k]=React.useState(!1),[j,D]=React.useState(!1),[O,X]=React.useState({key:"due_date",direction:"asc"}),[Y,G]=React.useState(()=>new Set),[I,le]=React.useState(!1),[W,$]=React.useState(null),[re,u]=React.useState(!1),[R,U]=React.useState({label:"",slug:""}),[M,oe]=React.useState(!1),[ee,z]=React.useState(!1),[qe,F]=React.useState(null),{user:He,ready:ne,isAuthenticated:f,login:_e,logout:De,authenticatedFetch:A,sessionError:Ke,clearSessionError:ce,loginPending:Ye}=ht(),[Ge,te]=React.useState(!1),[se,ie]=React.useState(()=>({email:ve(),password:""})),[he,de]=React.useState(null),[Te,Le]=React.useState(!1),[xe,fe]=React.useState(Ne),[Je,Ae]=React.useState(!1),[$e,q]=React.useState(null),[Fe,J]=React.useState(!1),P=React.useCallback(()=>{de(null),ce()},[ce]),Ve=React.useCallback((s,l)=>{ie(c=>({...c,[s]:l})),he&&de(null),ce()},[ce,he]),me=React.useCallback(()=>{fe(Ne()),q(null),J(!1)},[]),We=React.useCallback(()=>{me(),Le(!0)},[me]),be=React.useCallback(()=>{Le(!1),me()},[me]),Ze=(s,l)=>{fe(c=>({...c,[s]:l})),$e&&q(null),Fe&&J(!1)},Qe=async s=>{s.preventDefault();const l=xe.email.trim(),c=xe.password,x=xe.confirm;if(!l||!c){q("Email and password are required."),J(!1);return}if(c.length<8){q("Password must be at least 8 characters long."),J(!1);return}if(c!==x){q("Passwords must match."),J(!1);return}Ae(!0),q(null);try{const o=await fetch(`${Re}/tasks/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l.toLowerCase(),password:c})});if(!o.ok){const w=await o.json().catch(()=>null),v=kt(w)??"Unable to register.";throw new Error(v)}J(!0),q("Account created! You can now log in from the to-do list page."),fe(Ne())}catch(o){const w=o instanceof Error?o.message:"Registration failed.";q(w),J(!1)}finally{Ae(!1)}},Xe=React.useMemo(()=>{const s=t.filter(o=>!o.is_completed),l=s.filter(o=>Be(o.due_date,o.is_completed)).length,c=s.filter(o=>Ce(o.start_date)).length,x=s.filter(o=>!Ce(o.start_date)).length;return{overdue:l,ready:c,blocked:x,total:t.length}},[t]),Pe=React.useMemo(()=>t.filter(s=>{const l=Se(s).label;return!(!p&&l==="Blocked"||!j&&l==="Completed")}),[t,p,j]),Z=React.useCallback(async()=>{if(!f){a([]),b(!1),L(null),m("Log in to view your tasks.");return}b(!0),m(null);try{const c=(await(await A(`${V}/?limit=100`)).json()).map(x=>({...x,category:x.category??"",is_completed:!!x.is_completed}));a(c),L(new Date)}catch(s){const l=s instanceof Error?s.message:"Unable to load tasks.";m(l)}finally{b(!1)}},[A,f]);React.useEffect(()=>{ne&&Z()},[ne,Z]);const ue=React.useCallback(async()=>{if(!f){C([]);return}try{const s=await A(`${V}/categories`);if(!s.ok)throw new Error("Unable to load categories");const l=await s.json();C(l)}catch{C([])}},[A,f]);React.useEffect(()=>{ne&&ue()},[ne,ue]);const et=React.useCallback(async s=>{s.preventDefault(),P();const l=se.email.trim(),c=se.password;if(!l||!c){de("Enter email and password.");return}Ct(l);const x=l.toLowerCase();try{await _e(x,c),te(!1),ie({email:l,password:""}),m(null),Z(),ue()}catch(o){const w=o instanceof Error?o.message:"Unable to log in.";de(w)}},[ue,Z,_e,se.email,se.password,P]),tt=React.useCallback(()=>{De(),a([]),C([]),n(we()),B(null),G(new Set),m("Log in to view your tasks."),te(!1),P()},[De,P]),st=React.useCallback(()=>{P(),te(!0)},[P]),at=React.useCallback(()=>{P(),te(!1)},[P]);React.useEffect(()=>{const s=ve();s&&ie(l=>l.email?l:{...l,email:s})},[]),React.useEffect(()=>{f&&(te(!1),ie(s=>({email:s.email||ve(),password:""})),P())},[f,P]),React.useEffect(()=>{f&&be()},[f,be]),React.useEffect(()=>{f||u(!1)},[f]),React.useEffect(()=>{G(s=>{if(s.size===0)return s;const l=new Set(t.map(o=>o.id));let c=!1;const x=new Set;return s.forEach(o=>{l.has(o)?x.add(o):c=!0}),c?x:s})},[t]);const ye=React.useCallback(()=>{const s=we(),l=y[0]?.value;return l?{...s,category:l}:s},[y]);React.useEffect(()=>{y.length!==0&&n(s=>s.category&&y.some(l=>l.value===s.category)?s:{...s,category:y[0].value})},[y]);const ge=React.useMemo(()=>y.reduce((s,l)=>(s[l.value]=l.label,s),{}),[y]),lt=React.useMemo(()=>{const s=[...Pe],l=o=>{const w=ae(o).getTime();return Number.isNaN(w)?0:w},c={Blocked:0,Active:1,Completed:2},x=o=>{switch(O.key){case"start_date":return l(o.start_date);case"due_date":return l(o.due_date);case"status":return c[Se(o).label]??0;case"category":default:return(ge[o.category]??o.category??"").toLowerCase()}};return s.sort((o,w)=>{const v=x(o),E=x(w);if(typeof v=="number"&&typeof E=="number")return v===E?o.id-w.id:O.direction==="asc"?v-E:E-v;const H=v.toString(),Q=E.toString();return H===Q?o.id-w.id:O.direction==="asc"?H.localeCompare(Q,void 0,{sensitivity:"base"}):Q.localeCompare(H,void 0,{sensitivity:"base"})})},[ge,O,Pe]),rt=(s,l)=>{n(c=>({...c,[s]:l}))},ot=async s=>{s.preventDefault(),d(null);const l=r.name.trim(),c=r.description.trim();if(!l){d("Please provide a name.");return}if(!r.category){d("Select a category for this task.");return}if(r.startDate>r.dueDate){d("Start date must be on or before the due date.");return}if(!f){d("Log in to manage tasks.");return}const x=S!==null,o=x?`${V}/${S}`:`${V}/`,w=x?"PUT":"POST";T(!0);try{const v=await A(o,{method:w,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,description:c,start_date:r.startDate,due_date:r.dueDate,category:r.category,is_completed:r.isCompleted})});if(!v.ok)throw new Error("Failed to save the task");const E=await v.json();a(H=>x?H.map(Q=>Q.id===E.id?E:Q):[E,...H]),n(ye()),B(null),d(x?"Task updated":"Task saved")}catch(v){const E=v instanceof Error?v.message:"Unexpected error";d(E)}finally{T(!1)}},Oe=React.useCallback(s=>{n(St(s)),B(s.id),d(null)},[]),nt=React.useCallback(()=>{n(ye()),B(null),d(null)},[ye]),ct=s=>{X(l=>l.key===s?{key:s,direction:l.direction==="asc"?"desc":"asc"}:{key:s,direction:"asc"})},it=React.useCallback((s,l)=>{G(c=>{const x=new Set(c);return l?x.add(s):x.delete(s),x})},[]),dt=React.useCallback(async()=>{const s=Array.from(Y);if(s.length===0||I){$(s.length===0?"Select at least one task to delete.":null);return}if(!f){$("Log in to delete tasks.");return}le(!0),$(null);const l=new Set(s);try{await Promise.all(s.map(async c=>{if(!(await A(`${V}/${c}`,{method:"DELETE"})).ok)throw new Error("Unable to delete selected tasks.")})),a(c=>c.filter(x=>!l.has(x.id))),G(new Set),$(s.length===1?"Deleted 1 task.":`Deleted ${s.length} tasks.`)}catch(c){const x=c instanceof Error?c.message:"Failed to delete selected tasks.";$(x)}finally{le(!1)}},[A,I,f,Y]),xt=(s,l)=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),Oe(l))},mt=Y.size,ut=React.useCallback((s,l)=>{U(c=>s==="label"&&!M?{label:l,slug:Ie(l)}:{...c,[s]:l}),s==="slug"&&oe(!0),F(null)},[M]),gt=React.useCallback(async s=>{s.preventDefault();const l=R.label.trim(),c=R.slug||l,x=Ie(c);if(!l||!x){F("Provide both a label and a slug.");return}if(y.some(o=>o.value===x)){F("That slug already exists.");return}if(!f){F("Log in to manage categories.");return}z(!0),F(null);try{const o=await A(`${V}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:x,label:l})});if(!o.ok)throw new Error("Unable to add category.");const w=await o.json();C(v=>[...v,w].sort((E,H)=>E.label.localeCompare(H.label))),U({label:"",slug:""}),oe(!1),F("Category added.")}catch(o){const w=o instanceof Error?o.message:"Failed to add category.";F(w)}finally{z(!1)}},[A,R.label,R.slug,y,f]),pt=React.useCallback(async s=>{if(!(!s||s===Ue)){if(!f){F("Log in to manage categories.");return}try{if(!(await A(`${V}/categories/${s}`,{method:"DELETE"})).ok)throw new Error("Unable to delete category.");C(c=>c.filter(x=>x.value!==s)),F("Category removed.")}catch(l){const c=l instanceof Error?l.message:"Failed to delete category.";F(c)}}},[A,f,C]);return e.jsxs("div",{className:"flex min-h-screen w-full justify-center px-6 py-8 text-slate-100",children:[e.jsx(yt,{isOpen:Te&&!f,registerForm:xe,registerSubmitting:Je,registerFeedback:$e,registerSuccess:Fe,closeRegisterPanel:be,handleRegisterSubmit:Qe,updateRegisterField:Ze}),e.jsxs("div",{className:"flex w-full max-w-6xl flex-col",children:[e.jsx(bt,{isAuthenticated:f,userEmail:He?.email,showCategoryManager:re,setShowCategoryManager:u,showLoginForm:Ge,openLoginForm:st,closeLoginForm:at,loginForm:se,handleLoginFieldChange:Ve,handleLoginSubmit:et,loginPending:Ye,loginError:he,sessionError:Ke,openRegisterPanel:We,registerPanelOpen:Te,handleLogoutClick:tt}),f?re?e.jsx(ft,{categoryOptions:y,categoryForm:R,categorySaving:ee,categoryActionFeedback:qe,handleCategoryFormChange:ut,handleCategorySubmit:gt,handleCategoryDelete:pt,defaultCategorySlug:Ue}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.12em] text-indigo-300",children:"Personal board"}),e.jsx("h1",{className:"text-3xl font-semibold text-slate-50",children:"Organise your tasks"}),e.jsx("p",{className:"max-w-3xl text-slate-300",children:"Create tasks, group them with custom categories, and keep everything in sync with your account."})]}),e.jsxs("main",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[minmax(320px,420px),1fr]",children:[e.jsx(jt,{editingId:S,loading:g,draft:r,categoryOptions:y,categoryLabelMap:ge,saveFeedback:_,saving:i,updateDraft:rt,handleReset:nt,handleSubmit:ot,onRefresh:()=>void Z()}),e.jsx(wt,{showBlocked:p,showCompleted:j,setShowBlocked:k,setShowCompleted:D,stats:Xe,handleBulkDelete:dt,bulkDeleting:I,selectedCount:mt,deleteFeedback:W,loading:g,syncError:h,loadTasks:()=>void Z(),tasks:t,sortedTasks:lt,getTaskStatus:Se,getDaysUntilDue:Et,isOverdue:Be,editingId:S,beginEditing:Oe,handleRowKeyDown:xt,selectedIds:Y,toggleSelection:it,categoryLabelMap:ge,formatDueOffsetLabel:_t,formatDisplayDate:Rt,lastSyncedAt:N,sortConfig:O,handleSortChange:ct})]})]}):e.jsxs("section",{className:"rounded-3xl border border-slate-400/30 bg-slate-900/70 px-5 py-8 text-slate-200 shadow-[0_25px_60px_rgba(2,6,23,0.55)]","aria-live":"polite",children:[e.jsx("h3",{className:"text-2xl font-semibold text-slate-50",children:"Welcome"}),e.jsx("p",{className:"mt-2 max-w-2xl text-slate-300",children:"Use the Login button above to access and manage your personal task board."})]})]})]})},ze=document.getElementById("root");if(!ze)throw new Error("Root element #root not found");document.body.classList.add("todo-page");ReactDOM.createRoot(ze).render(e.jsx(React.StrictMode,{children:e.jsx(Dt,{})}));
