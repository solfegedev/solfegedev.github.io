import"./index-BFRsRy6X.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as W}from"./api-CH_Pe6Vg.js";import{c as Oe,f as pe}from"./utils-Bp7-rn4K.js";import{X as ye}from"./x-BS-d4QNZ.js";import{T as ve}from"./trash-2-DQbJ9aIh.js";import{c as U}from"./createLucideIcon-DtX1aPOG.js";import{C as pt,M as Ne,a as je,L as ut}from"./map-GO46_Xp-.js";import{b as Ue,c as ht,d as xt,e as Be,f as ke,L as mt,g as ft,T as de,M as gt,a as Pe,P as bt,u as he,h as yt}from"./TileLayer-DwRFwdKq.js";import{P as Ie,D as vt,U as jt,G as wt}from"./upload-FXP4Asuw.js";import{P as ze}from"./plus-DDkdk0pc.js";import{L as _t,U as Nt}from"./users-DXQZEc7K.js";import{C as kt}from"./copy-CzC7y2Qs.js";import"./clsx-B-dksMZM.js";const Ct=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],St=U("activity",Ct);const $t=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Rt=U("arrow-up-down",$t);const Mt=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],Et=U("bed",Mt);const Tt=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Lt=U("camera",Tt);const Pt=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],zt=U("chevron-up",Pt);const Dt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Ft=U("circle-plus",Dt);const At=[["path",{d:"m14 15-5 5-5-5",key:"1eia93"}],["path",{d:"M20 4h-7a4 4 0 0 0-4 4v12",key:"nbpdq2"}]],Ot=U("corner-left-down",At);const Ut=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M4 20v-7a4 4 0 0 1 4-4h12",key:"1lu4f8"}]],Bt=U("corner-up-right",Ut);const It=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],Ht=U("crosshair",It);const Vt=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],Gt=U("landmark",Vt);const Zt=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],qt=U("log-out",Zt);const Wt=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],Jt=U("plane",Wt);const Yt=[["path",{d:"M8 3.1V7a4 4 0 0 0 8 0V3.1",key:"1v71zp"}],["path",{d:"m9 15-1-1",key:"1yrq24"}],["path",{d:"m15 15 1-1",key:"1t0d6s"}],["path",{d:"M9 19c-2.8 0-5-2.2-5-5v-4a8 8 0 0 1 16 0v4c0 2.8-2.2 5-5 5Z",key:"1p0hjs"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m16 19 2 3",key:"xo31yx"}]],Xt=U("train-front",Yt);const Kt=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Qt=U("utensils",Kt);function es(n){return function(i){const p=Ue(),o=n(i,p),{instance:g}=o.current,d=React.useRef(i.position),{position:x}=i;return React.useEffect(function(){return g.addTo(p.map),function(){g.remove()}},[p.map,g]),React.useEffect(function(){x!=null&&x!==d.current&&(g.setPosition(x),d.current=x)},[g,x]),o}}const ts=xt(function({children:l,...i},p){const o=new L.Control.Layers(void 0,void 0,i);return Be(o,ke(p,{layersControl:o}))},function(l,i,p){i.collapsed!==p.collapsed&&(i.collapsed===!0?l.collapse():l.expand())}),ss=es(ts),q=ht(ss);function He(n){return function(i){const p=Ue(),o=React.useRef(i),[g,d]=React.useState(null),{layersControl:x,map:v}=p,j=React.useCallback(N=>{x!=null&&(o.current.checked&&v.addLayer(N),n(x,N,o.current.name),d(N))},[n,x,v]),_=React.useCallback(N=>{x?.removeLayer(N),d(null)},[x]),y=React.useMemo(()=>ke(p,{layerContainer:{addLayer:j,removeLayer:_}}),[p,j,_]);return React.useEffect(()=>{g!==null&&o.current!==i&&(i.checked===!0&&(o.current.checked==null||o.current.checked===!1)?v.addLayer(g):o.current.checked===!0&&(i.checked==null||i.checked===!1)&&v.removeLayer(g),o.current=i)}),i.children?React.createElement(mt,{value:y},i.children):null}}q.BaseLayer=He(function(l,i,p){l.addBaseLayer(i,p)});q.Overlay=He(function(l,i,p){l.addOverlay(i,p)});const De=ft(function({positions:l,...i},p){const o=new L.Polyline(l,i);return Be(o,ke(p,{overlayContainer:o}))},function(l,i,p){i.positions!==p.positions&&l.setLatLngs(i.positions)}),as=({auth:n,onClose:l})=>{const[i,p]=React.useState([]),[o,g]=React.useState(!0),[d,x]=React.useState(""),[v,j]=React.useState(""),[_,y]=React.useState(""),[N,k]=React.useState(""),[z,O]=React.useState("user"),[r,S]=React.useState(null),R=async()=>{try{const w=await fetch(`${W}/travel/admin/users`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!w.ok)throw new Error("Failed to fetch users");const C=await w.json();p(C)}catch(w){console.error("Failed to fetch users",w)}finally{g(!1)}};React.useEffect(()=>{R()},[n]);const M=async w=>{w.preventDefault(),S(null);try{const C=await fetch(`${W}/travel/admin/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({email:d,password:v,role:z,first_name:_,last_name:N})}),B=await C.json();if(!C.ok)throw new Error(B.detail||"Failed to create user");p([...i,B]),x(""),j(""),y(""),k("")}catch(C){S(C.message)}},H=async w=>{if(w===n.user.id){alert("You cannot delete yourself.");return}if(confirm("Are you sure? All their trips will be lost."))try{if(!(await fetch(`${W}/travel/admin/users/${w}`,{method:"DELETE",headers:{Authorization:`Bearer ${n.access_token}`}})).ok)throw new Error("Failed to delete user");p(i.filter(B=>B.id!==w))}catch(C){console.error("Failed to delete user",C)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-4xl flex-col overflow-hidden rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"User Management"}),e.jsx("button",{onClick:l,className:"text-slate-400 hover:text-slate-600",children:e.jsx(ye,{size:24})})]}),e.jsxs("div",{className:"flex-1 space-y-8 overflow-y-auto p-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"mb-4 text-lg font-bold text-slate-800",children:"Add New User"}),e.jsxs("form",{onSubmit:M,className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx("input",{type:"email",placeholder:"Email",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:d,onChange:w=>x(w.target.value)}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:v,onChange:w=>j(w.target.value)}),e.jsx("input",{type:"text",placeholder:"First Name",className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:_,onChange:w=>y(w.target.value)}),e.jsx("input",{type:"text",placeholder:"Last Name",className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:N,onChange:w=>k(w.target.value)}),e.jsxs("select",{className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:z,onChange:w=>O(w.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 py-2 font-bold text-white hover:bg-indigo-700",children:"Create User"})]}),r&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:r})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-4 text-lg font-bold text-slate-800",children:"Existing Users"}),o?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-100",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b border-slate-100 bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-bold text-slate-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:i.map(w=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-slate-900",children:w.email}),e.jsxs("div",{className:"text-xs text-slate-500",children:[w.first_name," ",w.last_name]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-bold uppercase ${w.role==="admin"?"bg-indigo-100 text-indigo-700":"bg-blue-100 text-blue-700"}`,children:w.role})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`flex items-center gap-1.5 text-xs ${w.is_active?"text-amber-600":"text-red-600"}`,children:[e.jsx("span",{className:`h-1.5 w-1.5 rounded-full ${w.is_active?"bg-amber-500":"bg-red-500"}`}),w.is_active?"Active":"Inactive"]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:w.id!==n.user.id&&e.jsx("button",{onClick:()=>H(w.id),className:"text-slate-400 hover:text-red-500",children:e.jsx(ve,{size:18})})})]},w.id))})]})})]})]})]})})},ns=({onLogin:n})=>{const[l,i]=React.useState(""),[p,o]=React.useState(""),[g,d]=React.useState(null),[x,v]=React.useState(!1),j=async _=>{_.preventDefault(),v(!0),d(null);try{const y=await fetch(`${W}/travel/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,password:p})}),N=await y.json();if(!y.ok)throw new Error(N.detail||"Login failed");n(N)}catch(y){d(y.message||"Login failed")}finally{v(!1)}};return e.jsxs("div",{className:"mx-auto mt-20 max-w-md rounded-2xl border border-slate-100 bg-white p-8 shadow-xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("img",{src:"/favicon_travel.png",alt:"Travel Planner",className:"mb-4 h-16 w-16 rounded-2xl shadow-lg shadow-indigo-200"}),e.jsx("h2",{className:"text-center text-3xl font-bold text-slate-900",children:"Travel Planner"}),e.jsx("p",{className:"mt-2 text-slate-500",children:"Sign in to manage your trips"})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,"data-testid":"login-email",className:"w-full rounded-xl border border-slate-200 px-4 py-3 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",placeholder:"you@example.com",value:l,onChange:_=>i(_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Password"}),e.jsx("input",{type:"password",required:!0,"data-testid":"login-password",className:"w-full rounded-xl border border-slate-200 px-4 py-3 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",placeholder:"••••••••",value:p,onChange:_=>o(_.target.value)})]}),g&&e.jsx("div",{className:"rounded-lg border border-red-100 bg-red-50 p-3 text-sm font-medium text-red-600",children:g}),e.jsx("button",{type:"submit",disabled:x,className:"w-full rounded-xl bg-indigo-600 py-4 text-lg font-bold text-white shadow-lg shadow-indigo-100 transition-all hover:bg-indigo-700 active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-70",children:x?"Signing in...":"Sign In"})]})]})},we=({text:n,className:l,textClassName:i,maxLines:p=3,badge:o})=>{const[g,d]=React.useState(!1),[x,v]=React.useState(!1),j=React.useRef(null);return React.useEffect(()=>{const _=()=>{if(j.current){const y=j.current.cloneNode(!0);y.style.webkitLineClamp="unset",y.style.display="block",y.style.visibility="hidden",y.style.position="absolute",y.style.width=`${j.current.clientWidth}px`,document.body.appendChild(y);const N=y.scrollHeight,k=j.current.cloneNode(!0);k.style.webkitLineClamp=p.toString(),k.style.display="-webkit-box",k.style.webkitBoxOrient="vertical",k.style.visibility="hidden",k.style.position="absolute",k.style.width=`${j.current.clientWidth}px`,document.body.appendChild(k);const z=k.clientHeight;document.body.removeChild(y),document.body.removeChild(k),v(N>z)}};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[n,p]),n?e.jsxs("div",{className:l,children:[e.jsxs("div",{className:"flex items-start gap-1.5",children:[o,e.jsx("div",{ref:j,className:Oe("whitespace-pre-line",!g&&"overflow-hidden",i),style:g?{display:"block"}:{display:"-webkit-box",WebkitLineClamp:p,WebkitBoxOrient:"vertical"},children:n})]}),x&&e.jsx("button",{onClick:_=>{_.stopPropagation(),d(!g)},className:"mt-0.5 flex items-center gap-1 text-[10px] font-bold text-slate-400 uppercase hover:text-slate-500",children:g?e.jsxs(e.Fragment,{children:[e.jsx(zt,{size:12}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(pt,{size:12}),"Show More"]})})]}):null},_e=12,Ve=[51.477,0],Ge=2,Z=`${W}/travel/trips`,ae=[{id:"hotel",label:"Hotel",icon:Et},{id:"restaurant",label:"Restaurant",icon:Qt},{id:"museum",label:"Museum",icon:Gt},{id:"airport",label:"Airport",icon:Jt},{id:"station",label:"Station",icon:Xt},{id:"sightseeing",label:"Sightseeing",icon:Lt},{id:"activity",label:"Activity",icon:St},{id:"other",label:"Other",icon:Ne}],Ze=(n,l,i)=>{if(!n||!n.includes("booking.com"))return n;try{const p=new URL(n);return p.searchParams.set("group_adults","1"),p.searchParams.set("no_rooms","1"),l&&p.searchParams.set("checkin",l),i&&p.searchParams.set("checkout",i),p.toString()}catch{return n}},rs=n=>{const l=n.filter(d=>!d.parent_id),i=n.reduce((d,x)=>(x.parent_id&&(d[x.parent_id]||(d[x.parent_id]=[]),d[x.parent_id].push(x)),d),{}),p=(d,x)=>d.date!==x.date?d.date?x.date?d.date.localeCompare(x.date):-1:1:d.time!==x.time?d.time?x.time?d.time.localeCompare(x.time):-1:1:0,o=[],g=d=>{[...d].sort(p).forEach(v=>{o.push(v);const j=i[v.id]||[];j.length>0&&g(j)})};return g(l),o},os=({polylinePoints:n,spokeLines:l})=>e.jsxs(q,{position:"topright",children:[e.jsx(q.BaseLayer,{checked:!0,name:"Map",children:e.jsx(de,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:19})}),e.jsx(q.BaseLayer,{name:"3D Terrain",children:e.jsx(de,{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20})}),e.jsx(q.BaseLayer,{name:"3D topography",children:e.jsx(de,{attribution:'Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: © <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",maxZoom:17})}),e.jsx(q.BaseLayer,{name:"Satellite",children:e.jsx(de,{attribution:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),n.length>1&&e.jsx(q.Overlay,{checked:!0,name:"Show Route",children:e.jsx(De,{positions:n,color:"var(--color-red-600)",weight:5,opacity:.8,dashArray:"10, 10"})}),l.length>0&&e.jsx(q.Overlay,{checked:!0,name:"Show Activities",children:e.jsx(De,{positions:l,color:"var(--color-green-600)",weight:3,opacity:.8,dashArray:"5, 5"})})]}),be=ae.reduce((n,l)=>({...n,[l.id]:l.icon}),{}),ls=ae.reduce((n,l)=>({...n,[l.id]:l.label}),{}),ce={hotel:'<path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/>',restaurant:'<path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>',museum:'<line x1="3" y1="22" x2="21" y2="22"/><line x1="6" y1="18" x2="6" y2="11"/><line x1="10" y1="18" x2="10" y2="11"/><line x1="14" y1="18" x2="14" y2="11"/><line x1="18" y1="18" x2="18" y2="11"/><polyline points="12 2 20 7 4 7 12 2"/>',airport:'<path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/>',station:'<path d="M4 3h16a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"/><path d="M6 8h12"/><path d="m16.8 22-1.5-3"/><path d="m7.2 22 1.5-3"/><path d="M2 13h20"/><circle cx="12" cy="16" r="2"/>',sightseeing:'<path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/>',activity:'<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>',other:'<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>'},ue={duration:0},Fe=(n,l,i,p)=>{const o=i&&ce[i]?ce[i]:ce.other,g=i&&ce[i]?i:"map-pin",d=String(n),x=p?1.2:1,v=(d.length>2?50:42)*x,j=32*x,_=v,y=j,N=14*x,k=(d.length>3?10:12)*x,z=`<svg width="${N}" height="${N}" viewBox="0 0 24 24" fill="none" stroke="${l}" stroke-width="${p?3:2.5}" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-${g}">${o}</svg>`,O=`
    <div style="position: relative; width: ${_}px; height: ${y}px;">
      <svg width="${_}" height="${y}" viewBox="0 0 ${v} ${j}" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
        <!-- Horizontal Oval/Pill shape with a bottom point -->
        <path d="M ${v/2} ${j} L ${v/2-6} ${j-6} H 12 A 12 12 0 0 1 12 2 H ${v-12} A 12 12 0 0 1 ${v-12} 26 H ${v/2+6} Z" fill="${l}"/>
        <!-- Inner white pill -->
        <rect x="3" y="3" width="${v-6}" height="${j-12}" rx="9" fill="white"/>
      </svg>
      <div style="position: absolute; top: ${y/2-3}px; left: ${_/2}px; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; gap: 4px; width: ${_-10}px;">
        <div style="display: flex; align-items: center; justify-content: center; height: ${N}px;">${z}</div>
        <div style="font-size: ${k}px; font-weight: 900; color: ${l}; line-height: 1;">
          ${n}
        </div>
      </div>
    </div>
  `;return L.divIcon({html:O,className:"custom-div-icon",iconSize:[_,y],iconAnchor:[_/2,y],popupAnchor:[0,-y]})},J=n=>typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng),is=({items:n,onClearSelection:l})=>{const i=he();return React.useEffect(()=>{const p=new L.Control({position:"topleft"});return p.onAdd=()=>{const o=L.DomUtil.create("div","leaflet-bar leaflet-control"),g=L.DomUtil.create("a","leaflet-control-reset",o);return g.innerHTML='<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display: block; margin: 0 auto;"><path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8M3 16.2V21m0 0h4.8M3 21l6-6M21 7.8V3m0 0h-4.8M21 3l-6 6M3 7.8V3m0 0h4.8M3 3l6 6"/></svg>',g.href="#",g.title="Reset View",g.style.backgroundColor="white",g.style.cursor="pointer",L.DomEvent.on(g,"click",d=>{L.DomEvent.stop(d),l();const x=n.filter(v=>J(v)&&!v.hide_from_map);if(x.length>0){const v=L.latLngBounds(x.map(j=>[j.lat,j.lng]));i.flyToBounds(v,{...ue,padding:[50,50],maxZoom:_e})}else i.flyTo(Ve,Ge,ue)}),o},i.addControl(p),()=>{i.removeControl(p)}},[i,n,l]),null},ds=({isCollapsed:n})=>{const l=he();return React.useEffect(()=>{if(!n){const i=setTimeout(()=>{l.invalidateSize()},100);return()=>clearTimeout(i)}},[n,l]),null},cs=({tripId:n,items:l,selectedItem:i,isCollapsed:p})=>{const o=he(),g=React.useRef(void 0),d=React.useRef(void 0),x=React.useRef(p),v=React.useRef(void 0);return React.useEffect(()=>{if(p){x.current=p;return}const j=o.getContainer();if(j.clientWidth===0||j.clientHeight===0)return;const _=i?.id??null,y=d.current!==n,N=g.current!==_,k=x.current===!0&&p===!1,z=l.length>0&&v.current!==n;if(y||N||k||z){const r=setTimeout(()=>{if(i&&l.some(R=>R.id===i.id)&&i&&J(i))try{const R=o.getZoom(),M=Math.max(R,_e);o.flyTo([i.lat,i.lng],M,ue),(z||k)&&(v.current=n)}catch(R){console.error("Failed to fly to selected item",R)}else if(y||k||z||N&&!i){const R=l.filter(M=>J(M)&&!M.hide_from_map);if(R.length>0)try{const M=L.latLngBounds(R.map(H=>[H.lat,H.lng]));o.flyToBounds(M,{...ue,padding:[50,50],maxZoom:_e}),v.current=n}catch(M){console.error("Failed to fly to bounds",M)}}g.current=_,d.current=n,x.current=p},k?150:0);return()=>clearTimeout(r)}},[l,i,n,o,p]),null},ps=({isSelecting:n})=>{const l=he();return React.useEffect(()=>{n?l.getContainer().style.cursor="crosshair":l.getContainer().style.cursor=""},[n,l]),null},us=({onLocationSelect:n})=>(yt({click(l){n(l.latlng.lat,l.latlng.lng)}}),null);function hs({tripId:n,items:l,selectedItem:i,editingItemId:p,editingItemLocation:o,onSelectItem:g,onEdit:d,onLocationSelect:x,onCancelLocationSelect:v,isSelectingLocation:j,isCollapsed:_}){const y=React.useMemo(()=>l.filter(r=>!r.parent_id),[l]),N=React.useMemo(()=>y.filter(r=>r.is_connected),[y]),k=N.length,z=React.useMemo(()=>N.filter(r=>J(r)&&!r.hide_from_map).map(r=>[r.lat,r.lng]),[N]),O=React.useMemo(()=>{const r=[];return l.forEach(S=>{if(S.parent_id&&J(S)&&!S.hide_from_map){const R=l.find(M=>M.id===S.parent_id);R&&J(R)&&!R.hide_from_map&&r.push([[R.lat,R.lng],[S.lat,S.lng]])}}),r},[l]);return e.jsxs("div",{className:"relative z-0 h-full w-full overflow-hidden rounded-lg border border-slate-200",children:[e.jsxs(gt,{center:Ve,zoom:Ge,zoomSnap:0,zoomDelta:.1,wheelPxPerZoomLevel:120,scrollWheelZoom:!0,className:"h-full w-full",attributionControl:!1,children:[e.jsx(ds,{isCollapsed:_}),e.jsx(os,{polylinePoints:z,spokeLines:O}),e.jsx(cs,{tripId:n,items:l,selectedItem:i,isCollapsed:_}),e.jsx(ps,{isSelecting:!!j}),e.jsx(is,{items:l,onClearSelection:()=>g(null)}),l.map(r=>{let S=r.lat,R=r.lng,M=r.category;const H=r.id===p;if(H&&o){if(o.hide_from_map)return null;S=o.lat,R=o.lng,M=o.category||r.category}else if(r.hide_from_map)return null;if(!J({lat:S,lng:R}))return null;const w=r.id===i?.id||H,C=!!r.parent_id,B=w?"var(--color-red-600)":C?"var(--color-green-600)":r.is_connected?"var(--color-indigo-500)":"var(--color-amber-500)";let ne="•";if(C){const F=l.find(V=>V.id===r.parent_id);if(F){const V=y.findIndex(K=>K.id===F.id);if(V!==-1){const K=F.is_connected?V+1:String.fromCharCode(65+(V-k)),re=l.filter(Q=>Q.parent_id===r.parent_id).findIndex(Q=>Q.id===r.id);re!==-1&&(ne=`${K}.${re+1}`)}}}else{const F=y.findIndex(V=>V.id===r.id);F!==-1&&(ne=r.is_connected?F+1:String.fromCharCode(65+(F-k)))}return e.jsx(Pe,{position:[S,R],icon:Fe(ne,B,M,w),eventHandlers:{click:()=>g(r)},children:e.jsx(bt,{maxWidth:2e3,children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-2",children:[M&&be[M]&&e.jsx("div",{className:C?"text-green-600":r.is_connected?"text-indigo-500":"text-amber-500",children:(()=>{const F=be[M];return e.jsx(F,{size:14})})()}),e.jsx("h3",{className:"font-bold",children:r.location}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[r.is_tba&&e.jsx("span",{className:"shrink-0 rounded border border-green-200 bg-green-100 px-1 py-0.5 text-[10px] font-bold tracking-wider text-green-700 uppercase",children:"TBA"}),d&&e.jsx("button",{onClick:F=>{F.stopPropagation(),d(r)},className:"p-1 text-slate-400 transition-colors hover:text-indigo-600",title:"Edit",children:e.jsx(Ie,{size:14})})]})]}),(r.date||r.time||r.date_departure||r.time_departure)&&e.jsxs("div",{className:"text-[11px] font-bold tracking-wider text-slate-500 uppercase",children:[[r.date?pe(r.date,!0):null,r.time?r.time.substring(0,5):null].filter(Boolean).join(" @ "),(r.date_departure||r.time_departure)&&e.jsxs(e.Fragment,{children:[" → ",[r.date_departure?pe(r.date_departure):null,r.time_departure?r.time_departure.substring(0,5):null].filter(Boolean).join(" @ ")]})]}),r.description&&e.jsx(we,{text:r.description,className:"mt-1",textClassName:"text-sm text-slate-600"}),(r.url_booking||r.url_map)&&e.jsxs("div",{className:"mt-2 flex gap-2",children:[r.url_booking&&e.jsx("a",{href:Ze(r.url_booking,r.date,r.date_departure),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded border border-blue-500 bg-blue-50 px-2 py-0.5 text-[10px] font-bold !text-blue-800 uppercase transition-colors hover:!text-blue-900",children:(()=>{const F=r.category&&be[r.category]||Ne,V=r.category&&ls[r.category]||"Other";return e.jsxs(e.Fragment,{children:[e.jsx(F,{size:10}),V]})})()}),r.url_map&&e.jsxs("a",{href:r.url_map,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded border border-amber-500 bg-amber-50 px-2 py-0.5 text-[10px] font-bold !text-amber-600 uppercase transition-colors hover:!text-amber-800",children:[e.jsx(je,{size:10}),"Google Map"]})]})]})})},r.id)}),!p&&o&&!o.hide_from_map&&J(o)&&e.jsx(Pe,{position:[o.lat,o.lng],icon:Fe(String.fromCharCode(65+(y.length-k)),"var(--color-amber-500)",o.category,!0)}),j&&x&&e.jsx(us,{onLocationSelect:x})]}),j&&e.jsxs("div",{className:"absolute top-4 left-1/2 z-[1000] flex -translate-x-1/2 flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full border border-indigo-200 bg-white px-4 py-2 text-sm font-bold text-indigo-600 shadow-lg",children:"Select new location on map"}),v&&e.jsx("button",{onClick:r=>{r.stopPropagation(),v()},className:"rounded-full border border-slate-200 bg-white px-4 py-1.5 text-xs font-bold text-slate-500 shadow-md transition-all hover:bg-slate-50",children:"Cancel"})]})]})}const xs=({auth:n,trip:l,onUpdate:i,onClose:p})=>{const[o,g]=React.useState(""),[d,x]=React.useState(l.collaborator_emails||[]),[v,j]=React.useState(!1),[_,y]=React.useState(null),N=r=>{if(r.preventDefault(),!!o.trim()){if(d.includes(o.trim())){y("User already added");return}x([...d,o.trim()]),g(""),y(null)}},k=r=>{x(d.filter(S=>S!==r))},z=async()=>{j(!0),y(null);try{const r=await fetch(`${W}/travel/trips/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({collaborator_emails:d})}),S=await r.json();if(!r.ok)throw new Error(S.detail||"Failed to update collaborators");i(S),p()}catch(r){y(r.message)}finally{j(!1)}},O=`${window.location.origin}${window.location.pathname}?share_token=${l.share_token}`;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex w-full max-w-md flex-col overflow-hidden rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Share Trip"}),e.jsx("button",{onClick:p,className:"text-slate-400 hover:text-slate-600",children:e.jsx(ye,{size:24})})]}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("section",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Public Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,className:"flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500 outline-none",value:O}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(O)},className:"rounded-lg bg-slate-100 px-3 py-2 text-sm font-bold text-slate-600 hover:bg-slate-200",children:"Copy"})]}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-400",children:"Anyone with this link can view the trip (read-only)."})]}),e.jsxs("section",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Collaborators"}),e.jsx("p",{className:"mb-3 text-xs text-slate-500",children:"Add other users to give them editing rights."}),e.jsxs("form",{onSubmit:N,className:"mb-4 flex gap-2",children:[e.jsx("input",{type:"email",placeholder:"user@example.com",className:"flex-1 rounded-lg border border-slate-200 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500",value:o,onChange:r=>g(r.target.value)}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-bold text-white hover:bg-indigo-700",children:"Add"})]}),e.jsxs("div",{className:"max-h-40 space-y-2 overflow-y-auto pr-2",children:[d.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No collaborators yet."}),d.map(r=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2",children:[e.jsx("span",{className:"truncate text-sm text-slate-700",children:r}),e.jsx("button",{onClick:()=>k(r),className:"text-slate-400 hover:text-red-500",children:e.jsx(ye,{size:16})})]},r))]})]}),_&&e.jsx("p",{className:"text-sm text-red-500",children:_})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-slate-100 bg-slate-50 p-6",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm font-bold text-slate-600 hover:text-slate-800",children:"Cancel"}),e.jsx("button",{onClick:z,disabled:v,className:"rounded-lg bg-indigo-600 px-6 py-2 text-sm font-bold text-white hover:bg-indigo-700 disabled:opacity-50",children:v?"Saving...":"Save Changes"})]})]})})},le=({className:n,variant:l="slate",children:i,...p})=>{const o={slate:"bg-slate-100 text-slate-600 hover:bg-slate-200",indigo:"bg-indigo-600 text-white hover:bg-indigo-700","indigo-light":"bg-indigo-50 text-indigo-700 hover:bg-indigo-100"};return e.jsx("button",{className:Oe("flex items-center gap-2 rounded-lg px-4 py-2.5 text-sm font-semibold transition-all",o[l],n),...p,children:i})},ms=()=>{const[n,l]=React.useState(null),[i,p]=React.useState([]),[o,g]=React.useState(()=>{const t=localStorage.getItem("travel_selected_trip_id");return t?Number(t):null});React.useEffect(()=>{o!==null?localStorage.setItem("travel_selected_trip_id",String(o)):localStorage.removeItem("travel_selected_trip_id")},[o]);const[d,x]=React.useState([]),[v,j]=React.useState(!0),[_,y]=React.useState(null),[N,k]=React.useState(null),[z,O]=React.useState(!1),[r,S]=React.useState(!1),[R,M]=React.useState(!1),[H,w]=React.useState(""),[C,B]=React.useState(null),[ne,F]=React.useState(!1),[V,K]=React.useState(!1),[G,re]=React.useState(null),[Q,ee]=React.useState(null),[P,Ce]=React.useState(!1),[qe,Y]=React.useState(""),te=React.useRef(null),oe=React.useRef(null),ie=React.useRef(null);React.useEffect(()=>{let t;return G!==null&&(t=window.setInterval(()=>{if(!oe.current||!ie.current)return;const a=oe.current.getBoundingClientRect(),c=ie.current.y-a.top,u=a.height*.2;if(c<u&&c>=-50){const m=Math.max(2,(1-c/u)*12);oe.current.scrollTop-=m}else if(c>a.height-u&&c<=a.height+50){const m=c-(a.height-u),h=Math.max(2,m/u*12);oe.current.scrollTop+=h}},16)),()=>{t&&clearInterval(t)}},[G]),React.useEffect(()=>{if(N){const t=document.getElementById(`travel-item-${N.id}`);t&&t.scrollIntoView({block:"nearest"})}},[N]);const[f,E]=React.useState({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_booking:"",url_map:"",hide_from_map:!1,is_connected:!1,parent_id:null}),xe=new URLSearchParams(window.location.search).get("share_token"),D=!!xe;React.useEffect(()=>{const t=localStorage.getItem("travel_auth");if(t)try{l(JSON.parse(t))}catch{localStorage.removeItem("travel_auth")}},[]);const We=t=>{l(t),localStorage.setItem("travel_auth",JSON.stringify(t))},me=()=>{l(null),localStorage.removeItem("travel_auth"),p([]),x([])},I=React.useCallback(async(t,a={})=>{const c={...a.headers||{},...n?{Authorization:`Bearer ${n.access_token}`}:{}};return fetch(t,{...a,headers:c})},[n]),Se=React.useCallback(async()=>{if(!(D||!n))try{const t=await I(Z);if(t.status===401){me();return}if(!t.ok)throw new Error("Failed to fetch trips");const a=await t.json();p(a),a.length>0?(o===null||!a.some(c=>c.id===o))&&g(a[0].id):g(null)}catch(t){console.error(t)}},[o,D,n,I]),$e=React.useCallback(async()=>{if(D){j(!0);try{const t=await fetch(`${W}/travel/shared/${xe}`);if(!t.ok)throw new Error("Failed to fetch shared trip");const a=await t.json();p([a.trip]),g(a.trip.id);const c=a.items.map((u,m)=>({...u,is_connected:m<a.trip.active_count}));x(c),y(null)}catch(t){y("Failed to load shared itinerary. It may have been deleted or the link is invalid."),console.error(t)}finally{j(!1)}return}if(!n||o===null){x([]),j(!1);return}j(!0);try{const t=await I(`${Z}/${o}/items`);if(t.status===401){me();return}if(!t.ok)throw new Error("Failed to fetch itinerary items");const a=await t.json(),c=a.items.map((u,m)=>({...u,is_connected:m<a.active_count}));x(c),y(null)}catch(t){y("Failed to load itinerary. Please try again."),console.error(t)}finally{j(!1)}},[o,D,xe,n,I]);React.useEffect(()=>{Se()},[Se]),React.useEffect(()=>{$e(),D||(k(null),B(null),O(!1),E({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_booking:"",url_map:"",hide_from_map:!1,is_connected:!1,parent_id:null}))},[$e,D]);const X=React.useMemo(()=>i.find(t=>t.id===o),[i,o]),Re=React.useMemo(()=>n&&X&&n.user.id===X.user_id,[n,X]),Je=()=>{if(Re)K(!0);else if(X){const t=`${window.location.origin}${window.location.pathname}?share_token=${X.share_token}`;navigator.clipboard.writeText(t)}},Ye=async()=>{if(o!==null)try{const t=await I(`${Z}/${o}/export`);if(!t.ok)throw new Error("Failed to export trip");const a=await t.blob(),c=t.headers.get("Content-Disposition");let u="trip_backup.yml";if(c){const s=c.match(/filename="?([^"]+)"?/);s&&(u=s[1])}const m=URL.createObjectURL(a),h=document.createElement("a");h.href=m,h.download=u,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(m)}catch(t){alert("Failed to export trip"),console.error(t)}},Xe=async t=>{const a=t.target.files?.[0];if(a){if(!confirm("This will import the trip as a new trip. Continue?")){te.current&&(te.current.value="");return}try{const c=await a.text(),u=await I(`${Z}/import`,{method:"POST",headers:{"Content-Type":"text/yaml"},body:c});if(!u.ok){const h=await u.json();throw new Error(h.detail||"Failed to import trip")}const m=await u.json();p(h=>[...h,m]),g(m.id),alert("Successfully imported trip!")}catch(c){alert(`Failed to import: ${c instanceof Error?c.message:String(c)}`),console.error(c)}finally{te.current&&(te.current.value="")}}},Ke=async t=>{if(t.preventDefault(),!!H.trim())try{const a=await I(Z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:H})});if(!a.ok)throw new Error("Failed to create trip");const c=await a.json();p(u=>[...u,c]),g(c.id),w(""),M(!1)}catch(a){alert("Failed to create trip"),console.error(a)}},Qe=async t=>{if(confirm("Are you sure you want to delete this trip and all its items?"))try{if(!(await I(`${Z}/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete trip");p(c=>c.filter(u=>u.id!==t)),o===t&&g(i.find(c=>c.id!==t)?.id||null)}catch(a){alert("Failed to delete trip"),console.error(a)}},Me=(t=null)=>{B(null),E({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_booking:"",url_map:"",hide_from_map:!1,is_connected:!0,parent_id:t}),Y(""),O(!0)},se=async t=>{if(o===null)return;const a=[...t].sort((u,m)=>u.is_connected!==m.is_connected?u.is_connected?-1:1:0),c=a.filter(u=>u.is_connected).length;try{const u=await I(`${Z}/${o}/items`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:a,connections:[],active_count:c})});if(!u.ok)throw new Error("Failed to sync trip items");const m=await u.json(),h=m.items.map((s,b)=>({...s,is_connected:b<m.active_count}));x(h)}catch(u){throw console.error("Sync error:",u),u}},et=async()=>{if(!confirm("Are you sure you want to sort all items by date?"))return;const t=rs(d);try{await se(t)}catch(a){alert("Failed to reorder items"),console.error(a)}},tt=async(t,a)=>{try{const c=d.filter(T=>T.parent_id===a.id),u=c.length>0?c[c.length-1]:null,m=d.filter(T=>T.id!==t.id),h=m.findIndex(T=>T.id===a.id),s=u?m.findIndex(T=>T.id===u.id)+1:h+1,b=[...m];b.splice(s,0,{...t,parent_id:a.id}),await se(b)}catch(c){alert("Failed to indent item"),console.error(c)}},st=async t=>{try{const a=d.findIndex(h=>h.id===t.parent_id),u=[...d.filter(h=>h.id!==t.id)],m={...t,parent_id:null,is_connected:!0};if(a!==-1){const h=u.findIndex(s=>s.id===t.parent_id);u.splice(h+1,0,m)}else u.push(m);await se(u)}catch(a){alert("Failed to outdent item"),console.error(a)}},Ee=t=>{B(t.id),E({date:t.date,time:t.time,location:t.location,description:t.description,description_private:t.description_private,category:t.category||"other",lat:t.lat,lng:t.lng,date_departure:t.date_departure,time_departure:t.time_departure,is_tba:t.is_tba,url_booking:t.url_booking||"",url_map:t.url_map||"",hide_from_map:t.hide_from_map,is_connected:t.is_connected,parent_id:t.parent_id}),Y(t.lat&&t.lng?`${t.lat}, ${t.lng}`:""),O(!0)},at=async t=>{if(t.preventDefault(),o!==null)try{const a=C?`${W}/travel/items/${C}`:`${Z}/${o}/items`,u=await I(a,{method:C?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:f.date,time:f.time,location:f.location,description:f.description,description_private:f.description_private,category:f.category,lat:f.lat,lng:f.lng,date_departure:f.date_departure,time_departure:f.time_departure,is_tba:f.is_tba,url_booking:f.url_booking,url_map:f.url_map,hide_from_map:f.hide_from_map,parent_id:f.parent_id})});if(!u.ok)throw new Error("Failed to save item");const m=await u.json();let h;C?h=d.map(s=>s.id===C?{...s,...m,is_connected:f.is_connected}:s):h=[...d,{...m,is_connected:f.is_connected}],await se(h),O(!1),B(null),E({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_booking:"",url_map:"",hide_from_map:!1,is_connected:!1,parent_id:null})}catch(a){alert("Failed to save item"),console.error(a)}},nt=async t=>{if(confirm("Are you sure you want to delete this item?"))try{if(!(await I(`${W}/travel/items/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");const c=d.filter(h=>h.parent_id===t),m=[...d.filter(h=>h.id!==t&&h.parent_id!==t),...c.map(h=>({...h,parent_id:null,is_connected:!1}))];await se(m),N?.id===t&&k(null)}catch(a){alert("Failed to delete item"),console.error(a)}},rt=async t=>{if(confirm("Are you sure you want to duplicate this item?"))try{const a=await I(`${Z}/${o}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t.date,time:t.time,location:t.location,description:`**DUPLICATED**
${t.description}`,description_private:t.description_private,category:t.category,lat:t.lat,lng:t.lng,date_departure:t.date_departure,time_departure:t.time_departure,is_tba:!0,url_booking:t.url_booking,url_map:t.url_map,parent_id:t.parent_id})});if(!a.ok)throw new Error("Failed to duplicate item");const c=await a.json();x(u=>[...u,{...c,is_connected:!1}])}catch(a){alert("Failed to duplicate item"),console.error(a)}},ot=t=>{re(t)},lt=(t,a)=>{if(t.preventDefault(),G===null||G===a)return;const c=d.findIndex(A=>A.id===G),u=d.findIndex(A=>A.id===a);if(c===-1||u===-1)return;const m=[...d],[h]=m.splice(c,1),s=d.filter(A=>A.is_connected).length;h.is_connected=u<s,m.splice(u,0,h);const b=d.map(A=>`${A.id}-${A.is_connected}`).join(","),T=m.map(A=>`${A.id}-${A.is_connected}`).join(",");b!==T&&x(m)},it=async()=>{if(!(G===null||o===null)){re(null),ee(null),ie.current=null;try{await se(d)}catch(t){alert("Failed to save reordered items"),console.error(t)}}},dt=t=>{if(t.preventDefault(),G===null)return;const a=d.findIndex(b=>b.id===G);if(a===-1)return;const c=[...d],[u]=c.splice(a,1),m=d.filter(b=>b.id!==G&&b.is_connected).length;u.is_connected=!1,c.splice(m,0,u);const h=d.map(b=>`${b.id}-${b.is_connected}`).join(","),s=c.map(b=>`${b.id}-${b.is_connected}`).join(",");h!==s&&x(c)};React.useMemo(()=>d.filter(t=>!t.hide_from_map),[d]);const Te=React.useMemo(()=>d.filter(t=>t.is_connected).length,[d]);return!n&&!D?e.jsx(ns,{onLogin:We}):e.jsxs("div",{className:"flex h-full flex-col overflow-hidden border bg-slate-50 font-sans text-slate-900 md:rounded-2xl md:border-slate-200/50 md:shadow-2xl",children:[e.jsxs("header",{className:"z-10 flex flex-wrap items-center justify-between gap-4 border-b border-slate-200 bg-white px-6 py-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/favicon_travel.png",alt:"Travel Planner",className:"h-10 w-10 shrink-0 rounded-xl shadow-lg shadow-indigo-200"}),e.jsx("h1",{className:"hidden text-2xl font-bold tracking-tight text-slate-900 md:block",children:"Travel Planner"})]}),e.jsx("div",{className:"flex max-w-md flex-1 items-center gap-3",children:R?e.jsxs("form",{onSubmit:Ke,className:"flex w-full gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text","data-testid":"trip-name-input",placeholder:"Trip name...",className:"flex-1 rounded-lg border border-slate-200 px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-indigo-500",value:H,onChange:t=>w(t.target.value)}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-3 py-1.5 text-xs font-bold text-white hover:bg-indigo-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>M(!1),className:"rounded-lg bg-slate-100 px-3 py-1.5 text-xs font-bold text-slate-600 hover:bg-slate-200",children:"Cancel"})]}):e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500 disabled:cursor-default disabled:opacity-70",value:o||"",onChange:t=>g(Number(t.target.value)),disabled:D,children:[i.length===0&&e.jsx("option",{value:"",children:"No trips created"}),i.map(t=>e.jsxs("option",{value:t.id,children:[t.name,n&&t.user_id!==n.user.id?" (Shared)":""]},t.id))]}),!D&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(!0),className:"shrink-0 rounded-lg bg-slate-100 p-2 text-slate-600 transition-colors hover:bg-slate-200",title:"Create New Trip","data-testid":"create-trip-button",children:e.jsx(ze,{size:20})}),o&&Re&&e.jsx("button",{onClick:()=>Qe(o),className:"shrink-0 rounded-lg bg-slate-100 p-2 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-500",title:"Delete Current Trip",children:e.jsx(ve,{size:20})})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[o&&e.jsxs("div",{className:"flex items-center gap-2",children:[!D&&e.jsxs(le,{onClick:Je,title:"Share Trip",children:[e.jsx(_t,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Share"})]}),!D&&e.jsxs(e.Fragment,{children:[e.jsxs(le,{onClick:Ye,title:"Export to YAML",children:[e.jsx(vt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Export"})]}),e.jsxs(le,{onClick:()=>te.current?.click(),title:"Import from YAML",children:[e.jsx(jt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Import"})]}),e.jsx("input",{type:"file",ref:te,onChange:Xe,accept:".yaml,.yml",className:"hidden"})]})]}),e.jsxs(le,{variant:"indigo",onClick:()=>Ce(!P),title:P?"Show Map":"List View",children:[P?e.jsx(je,{size:18}):e.jsx(ut,{size:18}),e.jsx("span",{className:"hidden md:inline",children:P?"Show Map":"List View"})]}),!D&&e.jsxs(e.Fragment,{children:[n?.user.role==="admin"&&e.jsxs(le,{variant:"indigo-light",onClick:()=>F(!0),title:"Manage Users",children:[e.jsx(Nt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Users"})]}),e.jsx("button",{onClick:me,className:"p-2 text-slate-500 transition-colors hover:text-red-500",title:"Logout",children:e.jsx(qt,{size:20})})]})]})]}),e.jsxs("main",{className:"relative flex flex-1 overflow-hidden",children:[e.jsx("div",{className:`${P||z&&!r?"flex w-full":"hidden md:flex md:w-1/3"} z-20 flex-col overflow-hidden border-r border-slate-200 bg-white shadow-xl`,children:z?e.jsxs("div",{className:"overflow-y-auto p-6",children:[e.jsx("h2",{className:"mb-6 text-xl font-bold text-slate-800",children:C?"Edit Destination":"Add New Destination"}),e.jsxs("form",{onSubmit:at,className:"space-y-5",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{O(!1),B(null)},className:"flex-1 rounded-lg bg-slate-100 py-3 font-bold text-slate-600 transition-all hover:bg-slate-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-[2] rounded-lg bg-indigo-600 py-3 font-bold text-white shadow-lg shadow-indigo-100 transition-all hover:bg-indigo-700",children:C?"Save Changes":"Save to Itinerary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[" ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-date",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Date"}),e.jsx("input",{id:"travel-date","data-testid":"travel-date",type:"date",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.date||"",onChange:t=>E({...f,date:t.target.value||null})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-time",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Time"}),e.jsx("input",{id:"travel-time","data-testid":"travel-time",type:"time",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.time||"",onChange:t=>E({...f,time:t.target.value||null})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-departure-date",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Departure Date"}),e.jsx("input",{id:"travel-departure-date","data-testid":"travel-departure-date",type:"date",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.date_departure||"",onChange:t=>E({...f,date_departure:t.target.value||null}),onFocus:()=>{!f.date_departure&&f.date&&E({...f,date_departure:f.date})}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-departure-time",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Departure Time"}),e.jsx("input",{id:"travel-departure-time","data-testid":"travel-departure-time",type:"time",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.time_departure||"",onChange:t=>E({...f,time_departure:t.target.value||null})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Category"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:ae.map(t=>{const a=t.icon,c=f.category===t.id;return e.jsxs("button",{type:"button",onClick:()=>E({...f,category:t.id}),className:`flex flex-col items-center gap-1.5 rounded-lg border p-2 transition-all ${c?"border-indigo-200 bg-indigo-50 text-indigo-600 shadow-sm":"border-slate-100 bg-white text-slate-400 hover:border-slate-200 hover:bg-slate-50"}`,children:[e.jsx(a,{size:18}),e.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase",children:t.label})]},t.id)})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500",checked:f.is_tba,onChange:t=>E({...f,is_tba:t.target.checked})}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"TBA (To Be Amended)"})]}),e.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500",checked:f.hide_from_map,onChange:t=>E({...f,hide_from_map:t.target.checked})}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"Hide from map"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:["Location Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,"data-testid":"location-input",placeholder:"e.g. Paris, France",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.location,onChange:t=>E({...f,location:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Description"}),e.jsx("textarea",{rows:6,"data-testid":"description-input",placeholder:"What are you planning to do there?",className:"w-full resize-y rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.description,onChange:t=>E({...f,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Private Note (hidden on shared links)"}),e.jsx("textarea",{rows:6,placeholder:"Personal notes, booking references, etc.",className:"w-full resize-y rounded-lg border border-slate-200 bg-green-50/30 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.description_private,onChange:t=>E({...f,description_private:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Coordinates"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text","data-testid":"gps-input",placeholder:"GPS 'lat, lng' or Google Maps link https://www.google.com/maps/place/...",className:"flex-1 rounded-lg border border-slate-200 px-4 py-2 text-sm transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:qe,onChange:t=>{const a=t.target.value;if(Y(a),a.startsWith("http")){const c=a.match(/!3d(-?\d+(?:\.\d+)?)/),u=a.match(/!4d(-?\d+(?:\.\d+)?)/);if(c&&u){const m=parseFloat(c[1]),h=parseFloat(u[1]);!isNaN(m)&&!isNaN(h)&&(E({...f,lat:m,lng:h}),Y(`${m}, ${h}`))}else{const m=a.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);if(m){const h=parseFloat(m[1]),s=parseFloat(m[2]);!isNaN(h)&&!isNaN(s)&&(E({...f,lat:h,lng:s}),Y(`${h}, ${s}`))}}}else{const c=a.split(/[\s,]+/);if(c.length>=2){const u=parseFloat(c[0]),m=parseFloat(c[1]);!isNaN(u)&&!isNaN(m)&&E({...f,lat:u,lng:m})}}}}),e.jsx("button",{type:"button",onClick:()=>{S(!0),Ce(!1)},className:"flex shrink-0 items-center justify-center rounded-lg border border-indigo-200 bg-indigo-50 px-3 py-2 font-bold text-indigo-700 shadow-sm transition-all hover:bg-indigo-100",title:"Pick location on map","data-testid":"select-on-map-button",children:e.jsx(Ht,{size:20})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:["Google Map URL (or"," ",e.jsx("a",{href:"https://developers.google.com/maps/documentation/javascript/examples/places-placeid-finder",target:"_blank",rel:"noopener noreferrer",className:"font-normal text-indigo-600 hover:underline",onClick:t=>t.stopPropagation(),children:"Google Place ID"}),")"]}),e.jsx("input",{type:"url","data-testid":"map-url-input",placeholder:"e.g. https://google.com/maps/... or ChIJ3S-JXmauEmsRUcIaWtf4MzE",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.url_map,onChange:t=>{let a=t.target.value;a&&!a.startsWith("http")&&(a=`https://www.google.com/maps/search/?api=1&query_place_id=${a}&query=a`);const c=a.match(/!3d(-?\d+(?:\.\d+)?)/),u=a.match(/!4d(-?\d+(?:\.\d+)?)/);let m=null,h=null;if(c&&u)m=parseFloat(c[1]),h=parseFloat(u[1]);else{const s=a.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);s&&(m=parseFloat(s[1]),h=parseFloat(s[2]))}m!==null&&h!==null&&!isNaN(m)&&!isNaN(h)?(E({...f,url_map:a,lat:m,lng:h}),Y(`${m}, ${h}`)):E({...f,url_map:a})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Place URL"}),e.jsx("input",{type:"url",placeholder:"e.g. https://booking.com/... or https://www.tripadvisor.co.uk/...",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:f.url_booking,onChange:t=>{let a=t.target.value;a.startsWith("https://www.booking.com/")&&(a=a.split("?")[0]),E({...f,url_booking:a})}})]})]})]})]}):e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-slate-100 p-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Itinerary"}),(()=>{const t=d.find(s=>s.date);if(!t||!t.date)return null;const a=new Date,m=(new Date(`${t.date}T${t.time||"12:00"}`).getTime()-a.getTime())/(1e3*60*60*24),h=Math.round(m*10)/10;return h>0?e.jsxs("span",{className:"text-md inline-flex items-center rounded-full px-2.5 py-0.5 font-semibold text-red-700",children:["starting in ",h.toFixed(1)," day",h!==1&&"s"]}):null})()]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:[Te," stops and ",d.length-Te," unconnected points"]})]}),!D&&e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{disabled:o===null,onClick:()=>et(),className:"rounded-lg bg-indigo-600 p-2 text-white shadow-sm transition-all hover:bg-indigo-700 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50",title:"Sort by Date",children:e.jsx(Rt,{size:20})})})]}),e.jsx("div",{ref:oe,className:"scrollbar-thin scrollbar-thumb-slate-200 flex-1 overflow-y-auto p-6",onDragOver:t=>{t.preventDefault(),ie.current={y:t.clientY}},children:v?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-indigo-600"})}):_?e.jsx("div",{className:"px-4 py-12 text-center font-medium text-red-500",children:_}):d.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 text-slate-400",children:e.jsx(Ft,{size:32})}),e.jsx("p",{className:"font-medium text-slate-500",children:"No stops added yet."}),!D&&e.jsx("button",{disabled:o===null,onClick:()=>Me(),className:"mt-2 text-sm font-bold text-indigo-600 hover:underline disabled:opacity-50",children:o===null?"Create a trip first":"Start planning now"})]}):e.jsx("div",{className:"relative flex flex-col space-y-2",children:(()=>{const t=d.filter(s=>!s.parent_id),a=d.reduce((s,b)=>(b.parent_id&&(s[b.parent_id]||(s[b.parent_id]=[]),s[b.parent_id].push(b)),s),{}),c=t.filter(s=>s.is_connected).length,u=s=>e.jsxs("div",{className:`relative ${P?"py-2":"py-6"}`,onDragOver:dt,children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-dashed border-slate-200"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-white px-4 text-[10px] font-bold tracking-[0.2em] text-slate-400 uppercase",children:"Extra Locations"})})]},s),m=(s,b,T,A)=>{const Le=t[T].is_connected?T+1:String.fromCharCode(65+(T-c)),ct=b?`${Le}.${A+1}`:Le;return e.jsxs("div",{id:`travel-item-${s.id}`,className:`relative ${b?"py-0 pr-0 pl-16":"py-1 pl-10"} ${G===s.id?"opacity-20":""} ${Q===s.id?"select-none":""}`,onClick:()=>k(s),"data-testid":"travel-item",draggable:!D&&Q===s.id&&C!==s.id,onDragStart:()=>ot(s.id),onDragOver:$=>lt($,s.id),onDragEnd:it,children:[T<c&&e.jsxs(e.Fragment,{children:[(T<c-1||T===c-1&&b)&&e.jsx("div",{className:"absolute top-0 bottom-0 left-4 z-0 w-[3px] -translate-x-1/2 bg-indigo-200"}),T===c-1&&!b&&e.jsx("div",{className:"absolute top-0 left-4 z-0 h-4 w-[3px] -translate-x-1/2 bg-indigo-200"}),(T>0||b)&&e.jsx("div",{className:`absolute left-4 ${P?"-top-2 h-2":"-top-4 h-4"} z-0 w-[3px] -translate-x-1/2 bg-indigo-200`})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 bottom-1/2 left-10 z-0 h-full w-4 w-[2px] -translate-x-1/2 rounded-bl-lg border-b-2 border-l-2 border-slate-200 bg-slate-200"}),A>0&&e.jsx("div",{className:`absolute left-10 ${P?"-top-2 h-2":"-top-4 h-4"} z-0 w-[2px] -translate-x-1/2 bg-slate-200`})]}),e.jsx("div",{className:`absolute ${b?"left-6 mt-1.5 h-7 w-7":"top-1.5 left-0 h-8 w-8"} z-20 flex items-center justify-center rounded-full border-[3px] shadow-sm transition-colors ${N?.id===s.id||C===s.id?"border-slate-300 bg-red-400 text-white":b?"border-indigo-200 bg-green-50 text-slate-500":s.is_connected?"border-indigo-200 bg-slate-200 text-slate-500":"border-indigo-200 bg-amber-500 text-white"}`,children:e.jsx("span",{className:"text-[0.8rem] font-bold",children:ct})}),!D&&N?.id===s.id&&e.jsx("button",{onClick:$=>{$.stopPropagation(),Me(b?s.parent_id:s.id)},className:`absolute ${b?"left-[30px] h-5 w-5":"left-1 h-6 w-6"} bottom-1.5 z-20 flex items-center justify-center rounded-full border-2 border-indigo-100 bg-white text-indigo-300 shadow-sm transition-colors hover:border-indigo-200 hover:text-indigo-400`,title:"Add item after this",children:e.jsx(ze,{size:b?10:12})}),e.jsxs("div",{className:`${P?"p-2":"p-4"} group/item relative z-10 flex flex-col rounded-xl border shadow-sm ${s.hide_from_map?"bg-white":b?"bg-green-50":s.is_connected?"bg-indigo-50":"bg-amber-50"} ${N?.id===s.id?"border-indigo-200":b?"border-green-200 hover:border-green-300":s.is_connected?"border-indigo-200 hover:border-indigo-300":"border-amber-200 hover:border-amber-300"}`,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[(s.date||s.time||s.date_departure||s.time_departure)&&e.jsx("div",{className:"mb-1 flex items-start justify-between",children:e.jsxs("span",{className:`text-xs font-bold tracking-wider uppercase ${b?"text-green-600":s.is_connected?"text-indigo-600":"text-amber-600"}`,children:[[s.date?pe(s.date,!0):null,s.time?s.time.substring(0,5):null].filter(Boolean).join(" @ "),(s.date_departure||s.time_departure)&&e.jsxs(e.Fragment,{children:[" → ",[s.date_departure?pe(s.date_departure):null,s.time_departure?s.time_departure.substring(0,5):null].filter(Boolean).join(" @ ")]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.category&&e.jsx("div",{className:`shrink-0 ${b?"text-green-400":s.is_connected?"text-indigo-400":"text-amber-400"}`,children:(()=>{const $=ae.find(ge=>ge.id===s.category),fe=$?$.icon:Ne;return e.jsx(fe,{size:16})})()}),e.jsx("h3",{className:`${P?"text-sm":"text-base"} truncate font-bold text-slate-900`,children:s.location}),s.is_tba&&e.jsx("span",{className:"shrink-0 rounded border border-pink-200 bg-pink-100 px-1.5 py-0.5 text-[10px] font-bold tracking-wider text-pink-700 uppercase",children:"TBA"})]}),(s.url_booking||s.url_map)&&e.jsxs("div",{className:"mt-1 flex gap-2",children:[s.url_booking&&e.jsx("a",{href:Ze(s.url_booking,s.date,s.date_departure),target:"_blank",rel:"noopener noreferrer",onClick:$=>$.stopPropagation(),className:"inline-flex items-center gap-1 rounded border border-blue-500 bg-blue-50 px-2 py-0.5 text-[10px] font-bold text-blue-800 uppercase transition-colors hover:text-blue-900",children:(()=>{const $=ae.find(ge=>ge.id===s.category)||ae[7],fe=$.icon;return e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:10}),$.label]})})()}),s.url_map&&e.jsxs("a",{href:s.url_map,target:"_blank",rel:"noopener noreferrer",onClick:$=>$.stopPropagation(),className:"inline-flex items-center gap-1 rounded border border-amber-500 bg-amber-50 px-2 py-0.5 text-[10px] font-bold text-amber-600 uppercase transition-colors hover:text-amber-800",children:[e.jsx(je,{size:10}),"Google Map"]})]}),!P&&e.jsxs(e.Fragment,{children:[s.description&&e.jsx(we,{text:s.description,className:"mt-1",textClassName:"text-sm text-slate-600"}),!D&&s.description_private&&e.jsx(we,{text:s.description_private,className:"mt-1.5 rounded-md border border-slate-100/50 bg-slate-50/50 p-1.5",textClassName:"text-sm text-slate-700/80",badge:e.jsx("span",{className:"mt-0.5 shrink-0 rounded bg-slate-200 px-1 text-[10px] font-bold text-slate-800 uppercase",children:"Private"})})]})]}),!D&&N?.id===s.id&&e.jsxs("div",{className:"ml-auto flex shrink-0 items-center gap-3","data-testid":"list-control-icons",children:[e.jsxs("div",{className:"flex gap-1",children:[!b&&T>0&&e.jsx("button",{onClick:$=>{$.stopPropagation(),tt(s,t[T-1])},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Make Child of Previous Item",children:e.jsx(Bt,{size:P?14:16})}),b&&e.jsx("button",{onClick:$=>{$.stopPropagation(),st(s)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Make it a Parent Item",children:e.jsx(Ot,{size:P?14:16})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),Ee(s)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Edit",children:e.jsx(Ie,{size:P?14:16})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),rt(s)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Duplicate",children:e.jsx(kt,{size:P?14:16})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),nt(s.id)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-red-50 hover:text-red-600",title:"Delete",children:e.jsx(ve,{size:P?14:16})})]}),e.jsx("div",{className:"cursor-grab touch-none p-1 text-slate-400 transition-all hover:text-slate-600 active:cursor-grabbing",onMouseDown:()=>ee(s.id),onMouseUp:()=>ee(null),onTouchStart:()=>ee(s.id),onTouchEnd:()=>ee(null),onTouchCancel:()=>ee(null),children:e.jsx(wt,{size:P?16:20})})]})]})]},s.id)},h=[];return t.forEach((s,b)=>{b===c&&h.push(u(`marker-${b}`)),h.push(m(s,!1,b,0)),a[s.id]?.forEach((T,A)=>h.push(m(T,!0,b,A)))}),c===t.length&&t.length>0&&h.push(u("marker-end")),h})()})})]})}),e.jsx("div",{className:`${P||z&&!r?"hidden md:block":"block"} ${P?"md:hidden":""} h-full flex-1`,children:e.jsx(hs,{tripId:o,items:d,selectedItem:N,editingItemId:C,editingItemLocation:z?{lat:f.lat,lng:f.lng,category:f.category,is_connected:f.is_connected,hide_from_map:f.hide_from_map}:null,onSelectItem:k,onEdit:Ee,onLocationSelect:(t,a)=>{E({...f,lat:t,lng:a}),Y(`${t.toFixed(6)}, ${a.toFixed(6)}`),S(!1)},onCancelLocationSelect:()=>S(!1),isSelectingLocation:r,isCollapsed:P})})]}),ne&&n&&e.jsx(as,{auth:n,onClose:()=>F(!1)}),V&&n&&X&&e.jsx(xs,{auth:n,trip:X,onClose:()=>K(!1),onUpdate:t=>{p(a=>a.map(c=>c.id===t.id?t:c))}})]})},Ae=document.getElementById("root");Ae&&(document.body.classList.add("travel-page"),ReactDOM.createRoot(Ae).render(e.jsx(React.StrictMode,{children:e.jsx(ms,{})})));
