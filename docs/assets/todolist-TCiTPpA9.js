import"./modulepreload-polyfill-B5Qt9EMX.js";import{r,j as e,R as L,a as M}from"./client-BsyqJ1xH.js";import{B as x}from"./button-BZSrPANe.js";const $=a=>a.toISOString().split("T")[0],j=()=>{const a=$(new Date);return{name:"",description:"",startDate:a,dueDate:a,category:"",isCompleted:!1}},B=()=>"https://api8016.solfegeai.com",H=()=>B().replace(/\/+$/,""),f=`${H()}/items`,g=a=>{const d=new Date(a);return Number.isNaN(d.valueOf())?a:new Intl.DateTimeFormat(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(d)},F=a=>{const d=new Date;d.setHours(0,0,0,0);const s=new Date(a);return s.setHours(0,0,0,0),s<d},O=a=>{const d=new Date,s=new Date(a);return d.toDateString()===s.toDateString()},P=a=>{const d=new Date;d.setHours(0,0,0,0);const s=new Date(a);return s.setHours(0,0,0,0),s<=d},z=()=>{const[a,d]=r.useState([]),[s,m]=r.useState(j),[p,v]=r.useState(!0),[b,N]=r.useState(null),[k,D]=r.useState(!1),[S,u]=r.useState(null),[w,R]=r.useState(null),[c,C]=r.useState([]),_=r.useMemo(()=>{const t=a.filter(l=>!l.is_completed),o=t.filter(l=>F(l.due_date)).length,i=t.filter(l=>O(l.due_date)).length,n=t.filter(l=>P(l.start_date)).length;return{overdue:o,today:i,ready:n,total:a.length}},[a]),y=r.useCallback(async()=>{v(!0),N(null);try{const t=await fetch(`${f}/?limit=100`);if(!t.ok)throw new Error("Unable to load tasks");const i=(await t.json()).map(n=>({...n,category:n.category??"",is_completed:!!n.is_completed}));d(i),R(new Date)}catch(t){const o=t instanceof Error?t.message:"Unknown error";N(o)}finally{v(!1)}},[]);r.useEffect(()=>{y()},[y]);const E=r.useCallback(async()=>{try{const t=await fetch(`${f}/categories`);if(!t.ok)throw new Error("Unable to load categories");const o=await t.json();C(o)}catch{C([])}},[]);r.useEffect(()=>{E()},[E]),r.useEffect(()=>{c.length!==0&&m(t=>t.category&&c.some(o=>o.value===t.category)?t:{...t,category:c[0].value})},[c]);const T=r.useMemo(()=>c.reduce((t,o)=>(t[o.value]=o.label,t),{}),[c]),h=(t,o)=>{m(i=>({...i,[t]:o}))},U=async t=>{t.preventDefault(),u(null);const o=s.name.trim(),i=s.description.trim();if(!o||!i){u("Please provide both a name and a description.");return}if(!s.category){u("Select a category for this task.");return}if(s.startDate>s.dueDate){u("Start date must be on or before the due date.");return}D(!0);try{const n=await fetch(`${f}/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,description:i,start_date:s.startDate,due_date:s.dueDate,category:s.category,is_completed:s.isCompleted})});if(!n.ok)throw new Error("Failed to save the task");const l=await n.json();d(A=>[l,...A]),m(j()),u("Task saved")}catch(n){const l=n instanceof Error?n.message:"Unexpected error";u(l)}finally{D(!1)}};return e.jsxs("div",{className:"todo-app",children:[e.jsxs("header",{className:"todo-app__hero",children:[e.jsx("p",{className:"todo-app__eyebrow",children:"Task Planner"}),e.jsx("h1",{children:"Todo list"}),e.jsx("p",{children:"Drop in tasks with start date, so you can display Ready tasks"})]}),e.jsxs("main",{className:"todo-app__layout",children:[e.jsxs("section",{className:"todo-form","aria-labelledby":"todo-form-title",children:[e.jsxs("div",{className:"todo-form__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"todo-form__eyebrow",children:"Create"}),e.jsx("h2",{id:"todo-form-title",children:"New task"})]}),e.jsx(x,{variant:"outline",type:"button",className:"todo-button todo-button--outline",onClick:()=>m(j()),children:"Reset"})]}),e.jsxs("form",{className:"todo-form__body",onSubmit:U,children:[e.jsxs("label",{className:"todo-form__field",htmlFor:"task-name",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{id:"task-name",type:"text",value:s.name,onChange:t=>h("name",t.target.value),placeholder:"Write the task title",required:!0})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-description",children:[e.jsx("span",{children:"Description"}),e.jsx("textarea",{id:"task-description",value:s.description,onChange:t=>h("description",t.target.value),placeholder:"Why does this task matter?",rows:3,required:!0})]}),e.jsxs("div",{className:"todo-form__grid",children:[e.jsxs("label",{className:"todo-form__field",htmlFor:"task-start",children:[e.jsx("span",{children:"Start date"}),e.jsx("input",{id:"task-start",type:"date",value:s.startDate,onChange:t=>h("startDate",t.target.value)})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-due",children:[e.jsx("span",{children:"Due date"}),e.jsx("input",{id:"task-due",type:"date",value:s.dueDate,onChange:t=>h("dueDate",t.target.value)})]})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-category",children:[e.jsx("span",{children:"Category"}),e.jsx("select",{id:"task-category",value:s.category,onChange:t=>h("category",t.target.value),children:c.length===0?e.jsx("option",{value:s.category,children:T[s.category]??s.category}):c.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"todo-form__field todo-form__field--inline",htmlFor:"task-completed",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Status"}),e.jsx("p",{children:"Mark complete before saving if the work is done."})]}),e.jsx("input",{id:"task-completed",type:"checkbox",checked:s.isCompleted,onChange:t=>h("isCompleted",t.target.checked)})]}),e.jsxs("div",{className:"todo-form__actions",children:[e.jsx(x,{type:"submit",className:"todo-button todo-button--primary",disabled:k,children:k?"Saving…":"Save"}),e.jsx(x,{type:"button",variant:"outline",className:"todo-button todo-button--outline",onClick:()=>void y(),disabled:p,children:p?"Syncing…":"Refresh"})]}),S?e.jsx("p",{className:"todo-form__feedback",children:S}):null]})]}),e.jsxs("section",{className:"todo-list","aria-live":"polite","aria-busy":p,children:[e.jsxs("header",{className:"todo-list__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"todo-list__eyebrow",children:"Your tasks"}),e.jsxs("h2",{children:["Latest ",_.total," todos"]})]}),e.jsxs("dl",{className:"todo-list__stats",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Due today"}),e.jsx("dd",{children:_.today})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Overdue"}),e.jsx("dd",{children:_.overdue})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Active"}),e.jsx("dd",{children:_.ready})]})]})]}),p?e.jsx("p",{className:"todo-list__status",children:"Loading tasks…"}):b?e.jsxs("div",{className:"todo-list__status todo-list__status--error",children:[e.jsx("p",{children:b}),e.jsx(x,{type:"button",size:"sm",className:"todo-button todo-button--outline todo-button--compact",onClick:()=>void y(),children:"Try again"})]}):a.length===0?e.jsx("div",{className:"todo-list__status",children:e.jsx("p",{children:"No tasks yet. Save your first item on the left."})}):e.jsx("ul",{className:"todo-list__items",children:a.map(t=>e.jsxs("li",{className:`todo-card${F(t.due_date)?" todo-card--overdue":""}`,children:[e.jsxs("div",{className:"todo-card__dates",children:[e.jsxs("p",{children:["Start ",g(t.start_date)]}),e.jsxs("p",{children:["Due ",g(t.due_date),O(t.due_date)?e.jsx("span",{className:"todo-card__badge",children:"Today"}):null]})]}),e.jsx("h3",{className:"todo-card__title",children:t.name}),e.jsx("p",{className:"todo-card__description",children:t.description}),e.jsxs("div",{className:"todo-card__meta",children:[e.jsx("span",{className:"todo-card__chip",children:T[t.category]??(t.category||"Uncategorized")}),e.jsx("span",{className:`todo-card__status${t.is_completed?" todo-card__status--done":""}`,children:t.is_completed?"Completed":"Active"}),e.jsxs("span",{className:"todo-card__timestamp",children:["Updated ",g(t.updated_date)]})]})]},t.id))}),w?e.jsxs("p",{className:"todo-list__synced",children:["Last synced ",w.toLocaleTimeString()]}):null]})]})]})},I=document.getElementById("root");if(!I)throw new Error("Root element #root not found");L.createRoot(I).render(e.jsx(M.StrictMode,{children:e.jsx(z,{})}));
