import"./index-pErSQAtW.js";import{j as t}from"./jsx-runtime-u17CrQMm.js";import{B as m,c as f,f as q}from"./button-D6DGr86I.js";import{A as h}from"./api-CH_Pe6Vg.js";import{R as J}from"./refresh-cw-pTx9cW3g.js";import{c as K}from"./createLucideIcon-DtX1aPOG.js";import{S as Q}from"./save-rN7CZjMN.js";import"./clsx-B-dksMZM.js";const X=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Y=K("arrow-left-right",X),Z=()=>{const[x,P]=React.useState([]),[g,p]=React.useState({}),[c,V]=React.useState({}),[b,v]=React.useState(null),[ee,j]=React.useState(!1),[y,w]=React.useState(!1),[S,l]=React.useState(null),[,$]=React.useState(0),[n,N]=React.useState(()=>localStorage.getItem("defaultFromCurrency")||"USD"),[i,R]=React.useState(()=>localStorage.getItem("defaultToCurrency")||"GBP"),[o,C]=React.useState(()=>{const e=localStorage.getItem("defaultAmountMode");return e==="thousands"||e==="millions"?e:localStorage.getItem("defaultThousandsMode")==="true"?"thousands":"normal"}),[d,u]=React.useState("1"),[k,E]=React.useState(!1),F=React.useRef(null),z=React.useCallback((e,s)=>{const a=e.replace(/,/g,""),r=parseFloat(a)||0;return s==="millions"?r*1e6:s==="thousands"?r*1e3:r},[]),A=React.useCallback((e,s)=>s==="millions"?(e/1e6).toString():s==="thousands"?(e/1e3).toString():e.toString(),[]),I=e=>{if(!e)return"";const[s,a]=e.split("."),r=s.replace(/\B(?=(\d{3})+(?!\d))/g,",");return e.includes(".")?`${r}.${a}`:r},O=()=>{localStorage.setItem("defaultFromCurrency",n),localStorage.setItem("defaultToCurrency",i),localStorage.setItem("defaultAmountMode",o),E(!0),setTimeout(()=>E(!1),2e3)},M=React.useCallback(async()=>{try{const e=await fetch(`${h}/currency/list`);if(!e.ok)throw new Error("Failed to fetch currencies");const s=await e.json();P(s.currencies);const a={};return s.currencies.forEach(r=>{a[r.code]=r.default_amount}),V(a),s.currencies}catch(e){return l(e instanceof Error?e.message:"An error occurred"),[]}},[]),D=React.useCallback(async()=>{j(!0),l(null);try{const e=await fetch(`${h}/currency/`);if(!e.ok)throw new Error("Failed to fetch rates");const s=await e.json(),a={};s.rates.forEach(r=>{a[r.target_currency]=r.rate}),p(a),v(s.last_updated),s.rates.length===0&&await T()}catch(e){l(e instanceof Error?e.message:"An error occurred")}finally{j(!1)}},[]),T=async()=>{w(!0),l(null);try{const e=await fetch(`${h}/currency/update`,{method:"POST"});if(!e.ok)throw new Error("Failed to update rates");const s=await e.json(),a={};if(s.rates.forEach(r=>{a[r.target_currency]=r.rate}),p(a),v(s.last_updated),c[n]){const r=c[n];u(A(r,o))}}catch(e){l(e instanceof Error?e.message:"An error occurred during update")}finally{w(!1)}};React.useEffect(()=>{M().then(()=>{D()})},[M,D]),React.useEffect(()=>{const e=setInterval(()=>{$(s=>s+1)},6e4);return()=>clearInterval(e)},[]),React.useEffect(()=>{if(c[n]){const e=c[n];u(A(e,o))}},[n,c]);const G=(e,s,a)=>{const r=parseFloat(e);if(isNaN(r))return"0";if(s===a)return e;const _=s==="USD"?r:r/(g[s]||1),L=a==="USD"?_:_*(g[a]||1);return a==="VND"?Math.round(L).toLocaleString():L.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},H=()=>{N(i),R(n)},U=z(d,o),W=G(U.toString(),n,i);return t.jsx("div",{className:"min-h-screen md:px-4 md:px-8 md:py-8",children:t.jsxs("div",{className:"mx-auto max-w-4xl overflow-hidden rounded-xl bg-white/80 p-6 shadow-xl backdrop-blur-sm","data-testid":"currency-container",children:[t.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs(m,{variant:"outline",size:"default",onClick:T,disabled:y,className:"flex items-center gap-2 bg-indigo-600 text-white hover:bg-indigo-700","data-testid":"update-button",children:[t.jsx(J,{className:f("h-4 w-4",y&&"animate-spin")}),"Update Rates"]}),b&&t.jsxs("p",{className:"text-sm text-slate-500","data-testid":"last-updated",children:["Updated: ",q(b)]})]})}),S&&t.jsx("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-600","data-testid":"error-message",children:S}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(m,{variant:"outline",size:"default",onClick:()=>{u(""),F.current?.focus()},disabled:!d,className:"bg-indigo-600 text-white hover:bg-indigo-700","data-testid":"clear-button",children:"Clear"}),t.jsx("div",{className:f("flex flex-1 items-center rounded-lg border border-slate-300 px-3 transition-all focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-500",o!=="normal"?"bg-slate-50":"bg-white"),children:t.jsx("input",{ref:F,type:"text",id:"amount-input",value:d===""?"":o==="normal"?I(d):d,onChange:e=>{const a=e.target.value.replace(/,/g,"");if(a===""){u("");return}/^\d*\.?\d*$/.test(a)&&u(a)},className:"flex-1 bg-transparent py-3 text-right outline-none",placeholder:"Enter amount","data-testid":"amount-input"})})]}),t.jsxs("div",{className:"mt-2 flex items-center justify-end gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"thousands-mode",checked:o==="thousands",onChange:e=>{C(e.target.checked?"thousands":"normal")},className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500","data-testid":"thousands-checkbox"}),t.jsx("label",{htmlFor:"thousands-mode",className:"cursor-pointer text-sm font-medium text-slate-700",children:"Thousands"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",id:"millions-mode",checked:o==="millions",onChange:e=>{C(e.target.checked?"millions":"normal")},className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500","data-testid":"millions-checkbox"}),t.jsx("label",{htmlFor:"millions-mode",className:"cursor-pointer text-sm font-medium text-slate-700",children:"Million"})]})]})]}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"from-currency-select",className:"mb-1 block text-sm font-medium text-slate-700",children:"From"}),t.jsx("select",{id:"from-currency-select",value:n,onChange:e=>N(e.target.value),className:"w-full rounded-lg border border-slate-300 p-3 outline-none","data-testid":"from-currency-select",children:x.map(e=>t.jsxs("option",{value:e.code,children:[e.code," - ",e.name]},e.code))})]}),t.jsx("button",{onClick:H,className:"mb-0.5 rounded-lg bg-slate-100 p-3 transition-colors hover:bg-slate-200",title:"Swap Currencies","data-testid":"swap-button",children:t.jsx(Y,{className:"h-5 w-5 text-slate-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"to-currency-select",className:"mb-1 block text-sm font-medium text-slate-700",children:"To"}),t.jsx("select",{id:"to-currency-select",value:i,onChange:e=>R(e.target.value),className:"w-full rounded-lg border border-slate-300 p-3 outline-none","data-testid":"to-currency-select",children:x.map(e=>t.jsxs("option",{value:e.code,children:[e.code," - ",e.name]},e.code))})]})]}),t.jsxs("div",{className:"mt-4 rounded-xl bg-blue-50 p-4 text-center",children:[t.jsxs("p",{className:"mb-1 text-xl font-medium text-blue-600",children:[I(U.toString())," ",n," ="]}),t.jsxs("p",{className:"text-3xl font-bold text-blue-900","data-testid":"converted-value",children:[W," ",i]})]}),t.jsx("div",{className:"mt-4 flex justify-center border-t border-slate-100",children:t.jsxs(m,{variant:"outline",size:"default",onClick:O,className:f("flex items-center gap-2",k?"border-green-600 text-green-600":"bg-indigo-600 text-white"),"data-testid":"save-default-button",children:[t.jsx(Q,{className:"h-4 w-4"}),k?"Saved!":"Save as default currencies"]})})]})]})})},B=document.getElementById("root");if(!B)throw new Error("Root element not found");document.body.classList.add("currency");ReactDOM.createRoot(B).render(t.jsx(React.StrictMode,{children:t.jsx(Z,{})}));
