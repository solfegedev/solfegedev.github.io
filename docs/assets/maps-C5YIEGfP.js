import"./index-CoYRNWoz.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{P as pe,A as Ae}from"./Auth-Dw3S9KC1.js";import{A as ve}from"./api-CH_Pe6Vg.js";import{D as Fe,U as ze,G as we}from"./upload-CK6mc6ZD.js";import{C as Ne,M as he}from"./map-afHLg9l6.js";import{P as ye}from"./pencil-DHu_drsE.js";import{T as ge}from"./trash-2-DQbJ9aIh.js";import{f as Ue,u as Se,T as me,M as Be,a as Ve,P as Je}from"./TileLayer-B6Dhyqsh.js";import{L as ie}from"./LayersControl-CYkV3pbI.js";import{u as qe,T as Ze}from"./Toast-DyY2cq3X.js";import{X as He}from"./x-BS-d4QNZ.js";import{C as We}from"./copy-CzC7y2Qs.js";import{c as Ke}from"./createLucideIcon-DtX1aPOG.js";import{S as Xe}from"./settings-G074OJw9.js";import{L as Ye}from"./log-out-B0TqtotO.js";import{L as Qe}from"./list-BhDG0LsZ.js";/* empty css                */import"./button-3erh_Qe6.js";import"./clsx-B-dksMZM.js";import"./eye-Jn_UhOO1.js";const et=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],tt=Ke("share-2",et),st=Ue(function(s){return new L.Control.Zoom(s)}),f=`${ve}/maps`,j=()=>{const t=localStorage.getItem("map_token")||sessionStorage.getItem("map_token");return{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}}},x={login:async(t,s,n=!0)=>{const l=await fetch(`${f}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:s,remember:n})});if(!l.ok){const i=await l.json().catch(()=>({detail:"Login failed"}));throw new Error(i.detail||"Login failed")}const c=await l.json();return n?localStorage.setItem("map_token",c.access_token):sessionStorage.setItem("map_token",c.access_token),c},getMe:async()=>{const t=await fetch(`${f}/auth/me`,{headers:j(),credentials:"include"});if(!t.ok)throw new Error("Not authenticated");return t.json()},getLists:async()=>{const t=await fetch(`${f}/lists`,{headers:j(),credentials:"include"});if(!t.ok)throw new Error("Failed to fetch lists");return t.json()},createList:async t=>{const s=await fetch(`${f}/lists`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({name:t})});if(!s.ok)throw new Error("Failed to create list");return s.json()},reorderLists:async t=>{const s=await fetch(`${f}/lists/reorder`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to reorder lists");return s.json()},deleteList:async t=>{const s=await fetch(`${f}/lists/${t}`,{method:"DELETE",headers:j(),credentials:"include"});if(!s.ok)throw new Error("Failed to delete list");return s.json()},getGroups:async t=>{const s=t?`${f}/groups?list_id=${t}`:`${f}/groups`,n=await fetch(s,{headers:j(),credentials:"include"});if(!n.ok)throw new Error("Failed to fetch groups");return n.json()},createGroup:async(t,s,n,l)=>{const c=await fetch(`${f}/groups`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({name:t,color:s,list_id:n,note:l})});if(!c.ok)throw new Error("Failed to create group");return c.json()},updateGroup:async(t,s)=>{const n=await fetch(`${f}/groups/${t}`,{method:"PUT",headers:j(),credentials:"include",body:JSON.stringify(s)});if(!n.ok)throw new Error("Failed to update group");return n.json()},deleteGroup:async t=>{const s=await fetch(`${f}/groups/${t}`,{method:"DELETE",headers:j(),credentials:"include"});if(!s.ok)throw new Error("Failed to delete group");return s.json()},getItems:async t=>{const s=t?`${f}/items?list_id=${t}`:`${f}/items`,n=await fetch(s,{headers:j(),credentials:"include"});if(!n.ok)throw new Error("Failed to fetch items");return n.json()},createItem:async(t,s,n,l,c)=>{const i=await fetch(`${f}/items`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify({group_id:t,name:s,latitude:n,longitude:l,note:c})});if(!i.ok)throw new Error("Failed to create item");return i.json()},updateItem:async(t,s)=>{const n=await fetch(`${f}/items/${t}`,{method:"PUT",headers:j(),credentials:"include",body:JSON.stringify(s)});if(!n.ok)throw new Error("Failed to update item");return n.json()},deleteItem:async t=>{const s=await fetch(`${f}/items/${t}`,{method:"DELETE",headers:j(),credentials:"include"});if(!s.ok)throw new Error("Failed to delete item");return s.json()},reorderGroups:async t=>{const s=await fetch(`${f}/groups/reorder`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to reorder groups");return s.json()},reorderItems:async t=>{const s=await fetch(`${f}/items/reorder`,{method:"POST",headers:j(),credentials:"include",body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to reorder items");return s.json()},exportData:async()=>{const t=await fetch(`${f}/export`,{headers:j(),credentials:"include"});if(!t.ok)throw new Error("Export failed");const s=await t.blob(),n=window.URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download="map_data.yaml",l.click(),window.URL.revokeObjectURL(n)},importData:async t=>{const s=await fetch(`${f}/import`,{method:"POST",headers:{...j(),"Content-Type":"text/plain"},credentials:"include",body:t});if(!s.ok){const n=await s.json().catch(()=>({detail:"Import failed"}));throw new Error(n.detail||"Import failed")}return s.json()},logout:async()=>{try{await fetch(`${ve}/bookmarks/logout`,{method:"POST",credentials:"include"})}catch(t){console.error("Logout API call failed",t)}localStorage.removeItem("map_token"),sessionStorage.removeItem("map_token")},getSharedData:async t=>{const s=await fetch(`${f}/shared/${t}`);if(!s.ok)throw new Error("Failed to fetch shared list");return s.json()}},Ie=React.createContext(void 0),at=({children:t})=>{const[s,n]=React.useState(null),[l,c]=React.useState([]),[i,h]=React.useState(null),[v,b]=React.useState([]),[C,w]=React.useState([]),[E,m]=React.useState(null),[D,P]=React.useState(!1),[K,G]=React.useState(!0),[F,T]=React.useState(!1),[z,U]=React.useState(null),[X,M]=React.useState(null),[Y,B]=React.useState("map"),Q=(o,d,p)=>{p?localStorage.setItem("map_token",o):sessionStorage.setItem("map_token",o),n(d),g()},V=(o,d=!0)=>{m(o),P(d)},$=o=>{F||(h(o),b([]),w([]),o?localStorage.setItem("map_current_list_id",String(o.id)):localStorage.removeItem("map_current_list_id"))},g=async()=>{if(F&&z){try{const o=await x.getSharedData(z);c([o.list]),h(o.list),b(o.groups),w(o.items)}catch(o){console.error(o),M("Failed to load shared list")}return}try{const o=await x.getLists();c(o);let d=i;if(!d&&o.length>0){const p=localStorage.getItem("map_current_list_id");p?d=o.find(_=>_.id===Number(p))||o[0]:d=o[0],h(d)}if(d){const[p,_]=await Promise.all([x.getGroups(d.id),x.getItems(d.id)]);b(p),w(_)}else b([]),w([])}catch(o){console.error(o)}};React.useEffect(()=>{g()},[i?.id,F,z]),React.useEffect(()=>{(async()=>{const p=new URLSearchParams(window.location.search).get("share_token");if(p){T(!0),U(p),G(!1);return}const _=localStorage.getItem("map_token")||sessionStorage.getItem("map_token");try{const O=await x.getMe();n(O)}catch{_&&(localStorage.removeItem("map_token"),sessionStorage.removeItem("map_token"))}G(!1)})()},[]);const ee=async(o,d)=>{M(null);try{await x.login(o,d);const p=await x.getMe();n(p),await g()}catch(p){throw M(p.message||"Login failed"),p}},J=async()=>{await x.logout(),n(null),c([]),h(null),b([]),w([])},te=async o=>{await x.createList(o),await g()},q=async o=>{await x.reorderLists(o),await g()},oe=async o=>{await x.deleteList(o),i?.id===o&&(h(null),localStorage.removeItem("map_current_list_id")),await g()},Z=async(o,d,p)=>{await x.createGroup(o,d,i?.id||void 0,p),await g()},se=async(o,d)=>{await x.updateGroup(o,d),await g()},ne=async o=>{await x.deleteGroup(o),await g()},H=async(o,d,p,_,O)=>{await x.createItem(o,d,p,_,O),await g()},ae=async(o,d)=>{await x.updateItem(o,d),await g()},R=async o=>{await x.deleteItem(o),await g()},le=async o=>{await x.reorderGroups(o),await g()},ce=async o=>{await x.reorderItems(o),await g()},re=async()=>{await x.exportData()},S=async o=>{await x.importData(o),await g()};return React.useEffect(()=>{(async()=>{const d=localStorage.getItem("map_token")||sessionStorage.getItem("map_token");try{const p=await x.getMe();n(p)}catch{d&&(localStorage.removeItem("map_token"),sessionStorage.removeItem("map_token"))}G(!1)})()},[]),e.jsx(Ie.Provider,{value:{user:s,lists:l,currentList:i,setCurrentList:$,groups:v,items:C,selectedItem:E,setSelectedItem:V,shouldFocusItem:D,isLoading:K,isReadOnly:F,shareToken:z,error:X,login:ee,logout:J,refreshData:g,createList:te,reorderLists:q,deleteList:oe,createGroup:Z,updateGroup:se,deleteGroup:ne,createItem:H,updateItem:ae,deleteItem:R,reorderGroups:le,reorderItems:ce,exportData:re,importData:S,mobileView:Y,setMobileView:B,handleAuthSuccess:Q},children:t})},A=()=>{const t=React.useContext(Ie);if(t===void 0)throw new Error("useMap must be used within a MapProvider");return t},ke={"red-500":"#ef4444","orange-500":"#f97316","amber-500":"#f59e0b","yellow-500":"#eab308","lime-500":"#84cc16","green-500":"#22c55e","emerald-500":"#10b981","teal-500":"#14b8a6","cyan-500":"#06b6d4","sky-500":"#0ea5e9","blue-500":"#3b82f6","indigo-500":"#6366f1","violet-500":"#8b5cf6","purple-500":"#a855f7","fuchsia-500":"#d946ef","pink-500":"#ec4899","rose-500":"#f43f5e","slate-500":"#64748b","gray-500":"#6b7280","zinc-500":"#71717a","neutral-500":"#737373","stone-500":"#78716c","red-600":"#dc2626","orange-600":"#ea580c","amber-600":"#d97706","yellow-600":"#ca8a04","lime-600":"#65a30d","green-600":"#16a34a","emerald-600":"#059669","teal-600":"#0d9488","cyan-600":"#0891b2","sky-600":"#0284c7","blue-600":"#2563eb","indigo-600":"#4f46e5","violet-600":"#7c3aed","purple-600":"#9333ea","fuchsia-600":"#c026d3","pink-600":"#db2777","rose-600":"#e11d48","slate-600":"#475569","gray-600":"#4b5563","zinc-600":"#52525b","neutral-600":"#525252","stone-600":"#57534e","red-400":"#f87171","orange-400":"#fb923c","amber-400":"#fbbf24","yellow-400":"#facc15","lime-400":"#a3e635","green-400":"#4ade80","emerald-400":"#34d399","teal-400":"#2dd4bf","cyan-400":"#22d3ee","sky-400":"#38bdf8","blue-400":"#60a5fa","indigo-400":"#818cf8","violet-400":"#a78bfa","purple-400":"#c084fc","fuchsia-400":"#e879f9","pink-400":"#f472b6","rose-400":"#fb7185","slate-400":"#94a3b8","gray-400":"#9ca3af","zinc-400":"#a1a1aa","neutral-400":"#a3a3a3","stone-400":"#a8a29e"},Ce=t=>ke[t]||t,rt=()=>{const{groups:t,items:s,currentList:n,selectedItem:l,setSelectedItem:c,createGroup:i,updateGroup:h,deleteGroup:v,createItem:b,updateItem:C,deleteItem:w,reorderGroups:E,reorderItems:m,exportData:D,importData:P,logout:K,isReadOnly:G}=A(),[F,T]=React.useState(!1),[z,U]=React.useState(!1),[X,M]=React.useState(""),[Y,B]=React.useState("blue-500"),[Q,V]=React.useState(""),[$,g]=React.useState(null),[ee,J]=React.useState(""),[te,q]=React.useState(""),[oe,Z]=React.useState(""),[se,ne]=React.useState(""),[H,ae]=React.useState(null),[R,le]=React.useState(null),[ce,re]=React.useState(null),[S,o]=React.useState(s),[d,p]=React.useState(null),[_,O]=React.useState(null),[W,fe]=React.useState(t),[de,Le]=React.useState(new Set);React.useEffect(()=>{o(s)},[s]),React.useEffect(()=>{fe(t)},[t]);const Ee=a=>{const r=new Set(de);r.has(a)?r.delete(a):r.add(a),Le(r)},Ge=a=>{le(a)},Re=(a,r)=>{if(a.preventDefault(),R===null||R===r)return;const u=S.findIndex(ue=>ue.id===R),N=S.findIndex(ue=>ue.id===r);if(u===-1||N===-1)return;const y={...S[u]},k=S[N];y.group_id!==k.group_id&&(y.group_id=k.group_id);const I=[...S];I.splice(u,1),I.splice(N,0,y),o(I)},be=async()=>{R!==null&&(le(null),re(null),await m(S.map(a=>({id:a.id,group_id:a.group_id}))))},_e=a=>{p(a)},De=(a,r)=>{if(a.preventDefault(),d===null||d===r)return;const u=W.findIndex(I=>I.id===d),N=W.findIndex(I=>I.id===r);if(u===-1||N===-1)return;const y=[...W],[k]=y.splice(u,1);y.splice(N,0,k),fe(y)},Me=async()=>{d!==null&&(p(null),O(null),await E(W.map(a=>a.id)))},$e=async a=>{a.preventDefault(),$?await h($.id,{name:X,color:Y,note:Q}):await i(X,Y,Q),M(""),B("blue-500"),V(""),g(null),T(!1)},Oe=a=>{const r=a.trim();if(r.startsWith("http")){const u=r.match(/!3d(-?\d+(?:\.\d+)?)/),N=r.match(/!4d(-?\d+(?:\.\d+)?)/);if(u&&N){const k=parseFloat(u[1]),I=parseFloat(N[1]);if(!isNaN(k)&&!isNaN(I))return{lat:k,lng:I}}const y=r.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);if(y){const k=parseFloat(y[1]),I=parseFloat(y[2]);if(!isNaN(k)&&!isNaN(I))return{lat:k,lng:I}}}else{const u=r.split(/[\s,]+/);if(u.length>=2){const N=parseFloat(u[0]),y=parseFloat(u[1]);if(!isNaN(N)&&!isNaN(y))return{lat:N,lng:y}}}return null},Pe=async a=>{a.preventDefault();const r=Oe(oe);if(!r){alert("Invalid coordinates format. Please use 'lat, lng' or a Google Maps link.");return}H?await C(H.id,{group_id:Number(se),name:ee,latitude:r.lat,longitude:r.lng,note:te}):await b(Number(se),ee,r.lat,r.lng,te),J(""),q(""),Z(""),ae(null),U(!1)},Te=async a=>{const r=a.target.files?.[0];if(r){const u=await r.text();await P(u)}};return e.jsxs("div",{className:"flex h-full flex-col overflow-y-auto bg-white p-4",children:[!G&&e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("button",{"data-testid":"add-group-button",onClick:()=>{g(null),M(""),B("blue-500"),V(""),T(!0)},className:"flex flex-col items-center justify-center gap-1 rounded-lg border border-blue-100 bg-blue-50/50 py-2 text-[10px] font-bold text-blue-700 transition-colors hover:bg-blue-50",title:"Add Group",children:[e.jsx(pe,{size:14}),"Group"]}),e.jsxs("button",{"data-testid":"add-location-button",onClick:()=>{q(""),U(!0)},className:"flex flex-col items-center justify-center gap-1 rounded-lg border border-green-100 bg-green-50/50 py-2 text-[10px] font-bold text-green-700 transition-colors hover:bg-green-50",title:"Add Location",children:[e.jsx(pe,{size:14}),"Location"]}),e.jsxs("button",{onClick:D,className:"flex flex-col items-center justify-center gap-1 rounded-lg border border-gray-100 bg-gray-50 py-2 text-[10px] font-bold text-gray-600 transition-colors hover:bg-gray-100",title:"Export Data",children:[e.jsx(Fe,{size:14}),"Export"]}),e.jsxs("label",{className:"flex cursor-pointer flex-col items-center justify-center gap-1 rounded-lg border border-gray-100 bg-gray-50 py-2 text-[10px] font-bold text-gray-600 transition-colors hover:bg-gray-100",title:"Import Data",children:[e.jsx(ze,{size:14}),"Import",e.jsx("input",{type:"file",className:"hidden",accept:".yaml,.yml",onChange:Te})]})]})}),e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-bold",children:"Locations"})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[W.length===0&&e.jsxs("div",{className:"py-10 text-center text-gray-500",children:[e.jsx("p",{children:"No groups yet."}),e.jsx("p",{className:"text-sm",children:"Create a group to start adding locations."})]}),W.map(a=>e.jsxs("div",{"data-testid":`group-container-${a.id}`,draggable:!G&&_===a.id,onDragStart:()=>_e(a.id),onDragOver:r=>{d!==null&&De(r,a.id)},onDragEnd:Me,className:`rounded-lg border border-gray-100 bg-gray-50/30 p-4 shadow-sm transition-all hover:shadow-md ${d===a.id?"opacity-30":""}`,children:[e.jsxs("div",{className:"mb-3 flex cursor-pointer items-center justify-between",onClick:()=>Ee(a.id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{size:18,className:`mr-2 text-gray-400 transition-transform ${de.has(a.id)?"-rotate-90":""}`}),e.jsx("div",{className:"mr-3 h-3 w-3 rounded-full shadow-sm ring-2 ring-white",style:{backgroundColor:Ce(a.color)}}),e.jsx("h3",{className:"font-bold text-gray-800",children:a.name})]}),e.jsxs("div",{className:"ml-4 flex flex-1 items-center justify-between gap-2",children:[e.jsxs("span",{className:"rounded-full border bg-white px-2 py-0.5 text-xs font-medium text-gray-400",children:[S.filter(r=>r.group_id===a.id).length," items"]}),!G&&e.jsxs("div",{className:"flex items-center gap-1",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),M(a.name),B(a.color),V(a.note||""),g(a),T(!0)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Edit Group",children:e.jsx(ye,{size:14})}),e.jsx("div",{"data-testid":`group-grip-${a.id}`,className:"cursor-grab p-0.5 text-gray-400 transition-colors hover:text-gray-600 active:cursor-grabbing",onMouseDown:()=>O(a.id),onMouseUp:()=>O(null),children:e.jsx(we,{size:14})})]})]})]}),!de.has(a.id)&&e.jsxs(e.Fragment,{children:[a.note&&e.jsx("div",{className:"mb-3 line-clamp-2 pl-6 text-xs whitespace-pre-wrap text-gray-500 italic transition-all hover:line-clamp-none",children:a.note}),e.jsx("ul",{"data-testid":`group-items-${a.id}`,className:"min-h-[20px] space-y-2 pl-6",onDragOver:r=>{r.preventDefault()},onDrop:r=>{if(r.preventDefault(),R===null)return;const u=S.findIndex(k=>k.id===R);if(u===-1)return;const N=S[u];if(N.group_id===a.id)return;const y=[...S];y[u]={...N,group_id:a.id},o(y),be()},children:S.filter(r=>r.group_id===a.id).map(r=>e.jsxs("li",{"data-testid":`item-${r.id}`,onClick:()=>c(r),draggable:!G&&ce===r.id,onDragStart:u=>{u.stopPropagation(),Ge(r.id)},onDragOver:u=>{u.stopPropagation(),Re(u,r.id)},onDragEnd:be,className:`group/item flex cursor-pointer items-center justify-between rounded-md p-1.5 text-sm transition-colors hover:bg-white/50 ${l?.id===r.id?"bg-blue-50 shadow-sm ring-1 ring-blue-200":"text-gray-600"} ${R===r.id?"opacity-30":""}`,children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[e.jsx("div",{className:`truncate font-medium ${l?.id===r.id?"text-blue-600":""}`,children:r.name}),l?.id===r.id&&r.note&&e.jsx("div",{className:"mt-1 text-xs whitespace-pre-wrap text-gray-500 italic",children:r.note})]}),!G&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:u=>{u.stopPropagation(),c(r),J(r.name),q(r.note||""),ne(String(r.group_id)),Z(`${r.latitude}, ${r.longitude}`),ae(r),U(!0)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Edit",children:e.jsx(ye,{size:14})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),w(r.id)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-red-50 hover:text-red-500",children:e.jsx(ge,{size:14})}),e.jsx("div",{"data-testid":`item-grip-${r.id}`,className:"cursor-grab p-0.5 text-gray-400 transition-colors hover:text-gray-600 active:cursor-grabbing",onMouseDown:()=>re(r.id),onMouseUp:()=>re(null),children:e.jsx(we,{size:14})})]})]},r.id))})]})]},a.id))]}),F&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-sm rounded-lg bg-white p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:$?"Edit Group":"Add Group"}),$&&e.jsx("button",{onClick:async()=>{confirm("Delete this group and all its items?")&&(await v($.id),T(!1),g(null))},className:"rounded-lg p-1 text-gray-400 hover:bg-red-50 hover:text-red-500",title:"Delete Group",children:e.jsx(ge,{size:18})})]}),e.jsxs("form",{onSubmit:$e,children:[e.jsx("input",{className:"mb-4 w-full rounded border p-2",placeholder:"Group Name",value:X,onChange:a=>M(a.target.value),required:!0}),e.jsx("textarea",{className:"mb-4 w-full rounded border p-2 text-sm",placeholder:"Note (optional)",value:Q,onChange:a=>V(a.target.value),rows:3}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:"Select Color"}),e.jsx("div",{className:"grid max-h-48 grid-cols-6 gap-2 overflow-y-auto rounded border p-2",children:Object.entries(ke).map(([a,r])=>e.jsx("button",{type:"button",title:a,onClick:()=>B(a),className:`h-8 w-8 rounded-full border-2 transition-all ${Y===a?"scale-110 border-black shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:r}},a))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{T(!1),g(null)},className:"flex-1 rounded border p-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 rounded bg-blue-600 p-2 text-white",children:$?"Save":"Add"})]})]})]})}),z&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-sm rounded-lg bg-white p-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-bold",children:H?"Edit Location":"Add Location"}),e.jsxs("form",{onSubmit:Pe,children:[e.jsx("label",{htmlFor:"group-select",className:"mb-1 block text-xs font-medium text-gray-500",children:"Group"}),e.jsxs("select",{id:"group-select",className:"mb-4 w-full rounded border p-2",value:se,onChange:a=>ne(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Group"}),t.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx("input",{className:"mb-4 w-full rounded border p-2",placeholder:"Location Name",value:ee,onChange:a=>J(a.target.value),required:!0}),e.jsx("textarea",{className:"mb-4 w-full rounded border p-2 text-sm",placeholder:"Note (optional)",value:te,onChange:a=>q(a.target.value),rows:3}),e.jsx("input",{type:"text",className:"mb-4 w-full rounded border p-2",placeholder:"Coordinates (lat, lng) or Google Maps URL",value:oe,onChange:a=>Z(a.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{U(!1),ae(null),J(""),Z("")},className:"flex-1 rounded border p-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 rounded bg-blue-600 p-2 text-white",children:H?"Save":"Add"})]})]})]})})]})},xe=13,ot=[51.505,-.09],nt=3,je={duration:.5},lt=()=>{const t=Se(),{items:s,setSelectedItem:n}=A();return React.useEffect(()=>{const l=new L.Control({position:"topleft"});return l.onAdd=()=>{const c=L.DomUtil.create("div","leaflet-bar leaflet-control"),i=L.DomUtil.create("a","leaflet-control-reset",c);return i.innerHTML='<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display: block;"><path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8M3 16.2V21m0 0h4.8M3 21l6-6M21 7.8V3m0 0h-4.8M21 3l-6 6M3 7.8V3m0 0h4.8M3 3l6 6"/></svg>',i.href="#",i.title="Reset View",i.style.backgroundColor="white",i.style.cursor="pointer",i.style.width="30px",i.style.height="30px",i.style.lineHeight="30px",L.DomEvent.on(i,"click",h=>{if(L.DomEvent.stop(h),n(null),s.length>0){const v=L.latLngBounds(s.map(b=>[b.latitude,b.longitude]));t.flyToBounds(v,{padding:[50,50],maxZoom:xe})}else t.flyTo(ot,nt)}),c},t.addControl(l),()=>{t.removeControl(l)}},[t,s,n]),null},it=()=>{const t=Se(),{items:s,selectedItem:n,shouldFocusItem:l,currentList:c}=A(),i=React.useRef(null),h=React.useRef(null),v=React.useRef(!1);return React.useEffect(()=>{const b=t.getContainer();if(b.clientWidth===0||b.clientHeight===0)return;const C=n?.id??null,w=c?.id??null;h.current!==w&&(v.current=!1,h.current=w);const m=i.current!==C;if(s.length>0&&(!v.current||m)){if(n&&(l||!v.current))t.flyTo([n.latitude,n.longitude],xe,je);else if(s.length>0&&!n){const P=L.latLngBounds(s.map(K=>[K.latitude,K.longitude]));t.flyToBounds(P,{padding:[50,50],maxZoom:xe,...je})}i.current=C,v.current=!0}},[s,n,l,c,t]),null},ct=()=>e.jsxs(ie,{position:"topright",children:[e.jsx(ie.BaseLayer,{checked:!0,name:"Map",children:e.jsx(me,{attribution:"Esri, HERE, Garmin, Intermap, increment P Corp., GEBCO, USGS, FAO, NPS, NRCAN, GeoBase, IGN, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), (c) OpenStreetMap contributors, and the GIS User Community",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",maxZoom:19})}),e.jsx(ie.BaseLayer,{name:"3D Terrain",children:e.jsx(me,{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20})}),e.jsx(ie.BaseLayer,{name:"Satellite",children:e.jsx(me,{attribution:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})})]}),dt=(t,s,n)=>{const l=Ce(s),c=n?"bg-blue-600 text-white border-white":"bg-white text-gray-900",i=n?"bg-blue-600 border-white":"bg-white",h=n?"white":l;return new L.DivIcon({className:"custom-div-icon",html:`
      <div class="flex items-center justify-center transition-all duration-300 ${n?"scale-125 z-50":"hover:scale-110"}">
        <div class="px-2 py-1 rounded-lg font-black text-xs shadow-lg border-2 whitespace-nowrap ${c}" style="border-color: ${h}">
          ${t}
        </div>
        <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45 border-r-2 border-b-2 ${i}" style="border-color: ${h}"></div>
      </div>
    `,iconSize:[100,30],iconAnchor:[50,30]})},ut=()=>{const{items:t,selectedItem:s,setSelectedItem:n}=A();return e.jsx("div",{className:"h-full w-full",children:e.jsxs(Be,{center:[51.505,-.09],zoom:3,style:{height:"100%",width:"100%"},className:"z-0",zoomControl:!1,attributionControl:!1,zoomSnap:0,children:[e.jsx(ct,{}),e.jsx(st,{position:"topleft"}),e.jsx(lt,{}),e.jsx(it,{}),t.map(l=>{const c=s?.id===l.id;return e.jsx(Ve,{position:[l.latitude,l.longitude],icon:dt(l.name,l.group_color||"#3b82f6",c),zIndexOffset:c?1e3:0,eventHandlers:{click:()=>n(l,!1)},children:e.jsx(Je,{children:e.jsxs("div",{className:"min-w-[150px] text-center",children:[e.jsx("div",{className:"mb-1 border-b pb-1 font-bold",children:l.name}),l.note&&e.jsx("div",{className:"mb-2 text-xs whitespace-pre-wrap text-gray-600 italic",children:l.note}),e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center text-blue-600 transition-colors hover:text-blue-800",title:"Open in Google Maps",children:e.jsx(he,{className:"size-4"})})]})})},l.id)})]})})},mt=({onClose:t})=>{const{lists:s,createList:n,deleteList:l}=A(),{successToast:c}=qe(),[i,h]=React.useState(""),[v,b]=React.useState(null),C=async m=>{m.preventDefault(),i.trim()&&(await n(i),h(""))},w=async(m,D)=>{window.confirm(`Are you sure you want to delete "${D}" and all its groups/points?`)&&await l(m)},E=(m,D)=>{const P=`${window.location.origin}${window.location.pathname}?share_token=${m}`;navigator.clipboard.writeText(P),b(D),c("Share link copied to clipboard!"),setTimeout(()=>b(null),2e3)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex max-h-full w-full max-w-md flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Manage Lists"}),e.jsx("button",{onClick:t,className:"rounded-lg p-1 hover:bg-gray-100",children:e.jsx(He,{className:"h-5 w-5 text-gray-500"})})]}),e.jsxs("div",{"data-testid":"list-manager-content",className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("form",{onSubmit:C,className:"mb-6 flex gap-2",children:[e.jsx("input",{autoFocus:!0,className:"flex-1 rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:outline-none",placeholder:"New list name...",value:i,onChange:m=>h(m.target.value)}),e.jsx("button",{type:"submit",className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200 transition-all hover:bg-blue-700",children:e.jsx(pe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Your Lists"}),s.length===0&&e.jsx("p",{className:"py-4 text-center text-sm text-gray-500",children:"No lists created yet."}),s.map(m=>e.jsxs("div",{className:"group flex items-center justify-between rounded-xl border border-gray-100 bg-gray-50 p-3 transition-all hover:border-gray-200 hover:bg-white hover:shadow-sm",children:[e.jsx("span",{className:"font-bold text-gray-700",children:m.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>E(m.share_token,m.id),className:`rounded-lg p-1.5 transition-all ${v===m.id?"bg-green-100 text-green-600":"text-gray-400 hover:bg-blue-50 hover:text-blue-600"}`,title:"Copy Share Link",children:v===m.id?e.jsx(We,{className:"h-4 w-4"}):e.jsx(tt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>w(m.id,m.name),className:"rounded-lg p-1.5 text-gray-400 hover:bg-red-50 hover:text-red-500",children:e.jsx(ge,{className:"h-4 w-4"})})]})]},m.id))]})]}),e.jsx("div",{className:"border-t p-4",children:e.jsx("button",{onClick:t,className:"w-full rounded-xl bg-gray-100 py-2.5 text-sm font-bold text-gray-600 transition-all hover:bg-gray-200",children:"Done"})})]})})},pt=()=>{const{user:t,lists:s,currentList:n,setCurrentList:l,logout:c,isReadOnly:i,mobileView:h,setMobileView:v}=A(),[b,C]=React.useState(!1);return e.jsxs("header",{className:"z-30 flex flex-col justify-between gap-4 border-b border-gray-200 bg-white px-4 py-3 shadow-sm md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg",children:e.jsx(he,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-extrabold tracking-tight text-gray-900",children:"Maps"}),e.jsx("p",{className:"text-xs font-medium tracking-wider text-gray-500 uppercase",children:n?.name||"No list selected"})]})]}),e.jsxs("div",{className:"flex flex-1 items-center justify-between gap-2",children:[i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"rounded-full bg-blue-50 px-3 py-1 text-xs font-bold text-blue-600 uppercase",children:"Shared List"}),e.jsx("button",{onClick:()=>{window.location.href=window.location.pathname},className:"text-sm font-bold text-gray-500 hover:text-blue-600 hover:underline",children:"Back to My Maps"})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"list-select",className:"ml-2 hidden text-xs font-black tracking-tight text-gray-400 uppercase md:block",children:"List"}),e.jsxs("div",{className:"group relative",children:[e.jsxs("select",{id:"list-select",value:n?.id||"",onChange:w=>{const E=s.find(m=>m.id===Number(w.target.value));E&&l(E)},className:"relative cursor-pointer appearance-none rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 pr-10 text-sm font-bold text-blue-600 transition-all focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:[s.length===0&&e.jsx("option",{value:"",children:"No lists"}),s.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]}),e.jsx("div",{className:"pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-blue-600",children:e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsxs("button",{onClick:()=>C(!0),className:"flex h-9 items-center justify-center gap-2 rounded-xl bg-gray-100 px-2 text-gray-600 transition-all hover:bg-gray-200 md:px-3",title:"Manage Lists",children:[e.jsx(Xe,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden text-sm font-semibold md:block",children:"Settings"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsx("span",{className:"hidden text-sm font-semibold text-gray-600 md:block",children:t?.first_name}),e.jsx("button",{onClick:c,className:"flex h-9 w-9 items-center justify-center rounded-xl text-gray-500 transition-colors hover:bg-red-50 hover:text-red-500",title:"Logout",children:e.jsx(Ye,{className:"h-5 w-5"})})]})]}),e.jsx("button",{onClick:()=>v(h==="map"?"list":"map"),className:"flex h-9 items-center justify-center gap-2 rounded-xl bg-blue-600 px-3 text-white transition-all hover:bg-blue-700 md:hidden",title:h==="map"?"Show List":"Show Map",children:h==="map"?e.jsx(Qe,{className:"h-5 w-5"}):e.jsx(he,{className:"h-5 w-5"})})]}),b&&e.jsx(mt,{onClose:()=>C(!1)})]})},ht=()=>{const{user:t,isLoading:s,mobileView:n,handleAuthSuccess:l}=A();return s?e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Loading..."}):t?e.jsxs("div",{className:"flex h-screen w-full flex-col overflow-hidden bg-gray-50",children:[e.jsx(pt,{}),e.jsxs("main",{className:"relative flex flex-1 flex-col overflow-hidden md:flex-row",children:[e.jsx("div",{className:`h-full border-r border-gray-200 bg-white md:w-1/3 ${n==="list"?"block":"hidden md:block"}`,children:e.jsx(rt,{})}),e.jsx("div",{className:`relative h-full overflow-hidden md:w-2/3 ${n==="map"?"block":"hidden md:block"}`,children:e.jsx(ut,{})})]})]}):e.jsx(Ae,{appName:"Maps",loginEndpoint:"/maps/auth/login",registerEndpoint:"/maps/auth/register",onSuccess:(c,i)=>l(c.access_token,c.user,i)})};function gt(){return e.jsx(Ze,{children:e.jsx(at,{children:e.jsx(ht,{})})})}ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(gt,{})}));
