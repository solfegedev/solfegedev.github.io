import"./index-DEHygn5w.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as B}from"./api-CH_Pe6Vg.js";import{f as re}from"./utils-Bp4xmdaH.js";import{X as ce}from"./x-BS-d4QNZ.js";import{T as pe}from"./trash-2-DQbJ9aIh.js";import{l as Te,L as J}from"./leaflet-src-DBNPRDgh.js";import{b as Le,c as ht,d as xt,e as Fe,f as xe,L as mt,g as gt,T as ne,M as ft,a as ke,P as bt,u as oe,h as yt}from"./TileLayer-BDBp5nAp.js";import{M as me,a as ue,L as vt}from"./map-21CgSxyq.js";import{c as O}from"./createLucideIcon-DtX1aPOG.js";import{P as ze,D as jt,U as wt,G as Nt}from"./upload-FXP4Asuw.js";import{P as Ce}from"./plus-DDkdk0pc.js";import{L as _t,U as kt}from"./users-DXQZEc7K.js";import{C as Ct}from"./copy-CzC7y2Qs.js";import"./clsx-B-dksMZM.js";const St=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Pe=O("activity",St);const $t=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],Ae=O("bed",$t);const Rt=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],De=O("camera",Rt);const Mt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Et=O("circle-plus",Mt);const Tt=[["path",{d:"m14 15-5 5-5-5",key:"1eia93"}],["path",{d:"M20 4h-7a4 4 0 0 0-4 4v12",key:"nbpdq2"}]],Lt=O("corner-left-down",Tt);const Ft=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M4 20v-7a4 4 0 0 1 4-4h12",key:"1lu4f8"}]],zt=O("corner-up-right",Ft);const Pt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],At=O("crosshair",Pt);const Dt=[["path",{d:"M10 22v-6.57",key:"1wmca3"}],["path",{d:"M12 11h.01",key:"z322tv"}],["path",{d:"M12 7h.01",key:"1ivr5q"}],["path",{d:"M14 15.43V22",key:"1q2vjd"}],["path",{d:"M15 16a5 5 0 0 0-6 0",key:"o9wqvi"}],["path",{d:"M16 11h.01",key:"xkw8gn"}],["path",{d:"M16 7h.01",key:"1kdx03"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 7h.01",key:"1vti4s"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],Oe=O("hotel",Dt);const Ot=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],Ue=O("landmark",Ot);const Ut=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Bt=O("log-out",Ut);const It=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],Be=O("plane",It);const Ht=[["path",{d:"M8 3.1V7a4 4 0 0 0 8 0V3.1",key:"1v71zp"}],["path",{d:"m9 15-1-1",key:"1yrq24"}],["path",{d:"m15 15 1-1",key:"1t0d6s"}],["path",{d:"M9 19c-2.8 0-5-2.2-5-5v-4a8 8 0 0 1 16 0v4c0 2.8-2.2 5-5 5Z",key:"1p0hjs"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m16 19 2 3",key:"xo31yx"}]],Ie=O("train-front",Ht);const Vt=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],He=O("utensils",Vt);function Gt(a){return function(u){const n=Le(),l=a(u,n),{instance:b}=l.current,h=React.useRef(u.position),{position:m}=u;return React.useEffect(function(){return b.addTo(n.map),function(){b.remove()}},[n.map,b]),React.useEffect(function(){m!=null&&m!==h.current&&(b.setPosition(m),h.current=m)},[b,m]),l}}const qt=xt(function({children:p,...u},n){const l=new Te.Control.Layers(void 0,void 0,u);return Fe(l,xe(n,{layersControl:l}))},function(p,u,n){u.collapsed!==n.collapsed&&(u.collapsed===!0?p.collapse():p.expand())}),Jt=Gt(qt),V=ht(Jt);function Ve(a){return function(u){const n=Le(),l=React.useRef(u),[b,h]=React.useState(null),{layersControl:m,map:y}=n,N=React.useCallback(v=>{m!=null&&(l.current.checked&&y.addLayer(v),a(m,v,l.current.name),h(v))},[a,m,y]),k=React.useCallback(v=>{m?.removeLayer(v),h(null)},[m]),w=React.useMemo(()=>xe(n,{layerContainer:{addLayer:N,removeLayer:k}}),[n,N,k]);return React.useEffect(()=>{b!==null&&l.current!==u&&(u.checked===!0&&(l.current.checked==null||l.current.checked===!1)?y.addLayer(b):l.current.checked===!0&&(u.checked==null||u.checked===!1)&&y.removeLayer(b),l.current=u)}),u.children?React.createElement(mt,{value:w},u.children):null}}V.BaseLayer=Ve(function(p,u,n){p.addBaseLayer(u,n)});V.Overlay=Ve(function(p,u,n){p.addOverlay(u,n)});const Se=gt(function({positions:p,...u},n){const l=new Te.Polyline(p,u);return Fe(l,xe(n,{overlayContainer:l}))},function(p,u,n){u.positions!==n.positions&&p.setLatLngs(u.positions)}),Zt=({auth:a,onClose:p})=>{const[u,n]=React.useState([]),[l,b]=React.useState(!0),[h,m]=React.useState(""),[y,N]=React.useState(""),[k,w]=React.useState(""),[v,F]=React.useState(""),[A,r]=React.useState("user"),[j,R]=React.useState(null),U=async()=>{try{const f=await fetch(`${B}/travel/admin/users`,{headers:{Authorization:`Bearer ${a.access_token}`}});if(!f.ok)throw new Error("Failed to fetch users");const C=await f.json();n(C)}catch(f){console.error("Failed to fetch users",f)}finally{b(!1)}};React.useEffect(()=>{U()},[a]);const G=async f=>{f.preventDefault(),R(null);try{const C=await fetch(`${B}/travel/admin/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({email:h,password:y,role:A,first_name:k,last_name:v})}),z=await C.json();if(!C.ok)throw new Error(z.detail||"Failed to create user");n([...u,z]),m(""),N(""),w(""),F("")}catch(C){R(C.message)}},W=async f=>{if(f===a.user.id){alert("You cannot delete yourself.");return}if(confirm("Are you sure? All their trips will be lost."))try{if(!(await fetch(`${B}/travel/admin/users/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.access_token}`}})).ok)throw new Error("Failed to delete user");n(u.filter(z=>z.id!==f))}catch(C){console.error("Failed to delete user",C)}};return e.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"User Management"}),e.jsx("button",{onClick:p,className:"text-slate-400 hover:text-slate-600",children:e.jsx(ce,{size:24})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Add New User"}),e.jsxs("form",{onSubmit:G,className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"email",placeholder:"Email",required:!0,className:"px-4 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500",value:h,onChange:f=>m(f.target.value)}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,className:"px-4 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500",value:y,onChange:f=>N(f.target.value)}),e.jsx("input",{type:"text",placeholder:"First Name",className:"px-4 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500",value:k,onChange:f=>w(f.target.value)}),e.jsx("input",{type:"text",placeholder:"Last Name",className:"px-4 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500",value:v,onChange:f=>F(f.target.value)}),e.jsxs("select",{className:"px-4 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-indigo-500",value:A,onChange:f=>r(f.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white font-bold py-2 rounded-lg hover:bg-indigo-700",children:"Create User"})]}),j&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:j})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Existing Users"}),l?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"border border-slate-100 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:u.map(f=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-slate-900",children:f.email}),e.jsxs("div",{className:"text-xs text-slate-500",children:[f.first_name," ",f.last_name]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-[10px] font-bold uppercase px-2 py-0.5 rounded ${f.role==="admin"?"bg-indigo-100 text-indigo-700":"bg-blue-100 text-blue-700"}`,children:f.role})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`flex items-center gap-1.5 text-xs ${f.is_active?"text-amber-600":"text-red-600"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${f.is_active?"bg-amber-500":"bg-red-500"}`}),f.is_active?"Active":"Inactive"]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:f.id!==a.user.id&&e.jsx("button",{onClick:()=>W(f.id),className:"text-slate-400 hover:text-red-500",children:e.jsx(pe,{size:18})})})]},f.id))})]})})]})]})]})})},Wt=({onLogin:a})=>{const[p,u]=React.useState(""),[n,l]=React.useState(""),[b,h]=React.useState(null),[m,y]=React.useState(!1),N=async k=>{k.preventDefault(),y(!0),h(null);try{const w=await fetch(`${B}/travel/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,password:n})}),v=await w.json();if(!w.ok)throw new Error(v.detail||"Login failed");a(v)}catch(w){h(w.message||"Login failed")}finally{y(!1)}};return e.jsxs("div",{className:"max-w-md mx-auto mt-20 p-8 bg-white rounded-2xl shadow-xl border border-slate-100",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("img",{src:"/favicon_travel.png",alt:"Travel Planner",className:"w-16 h-16 rounded-2xl shadow-indigo-200 shadow-lg mb-4"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900 text-center",children:"Travel Planner"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Sign in to manage your trips"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,"data-testid":"login-email",className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",placeholder:"you@example.com",value:p,onChange:k=>u(k.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Password"}),e.jsx("input",{type:"password",required:!0,"data-testid":"login-password",className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",placeholder:"••••••••",value:n,onChange:k=>l(k.target.value)})]}),b&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-100 rounded-lg text-red-600 text-sm font-medium",children:b}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-indigo-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100 active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed",children:m?"Signing in...":"Sign In"})]})]})},he=12,Ge=[51.477,0],qe=2,H=`${B}/travel/trips`,Yt=({polylinePoints:a,spokeLines:p})=>e.jsxs(V,{position:"topright",children:[e.jsx(V.BaseLayer,{checked:!0,name:"Map",children:e.jsx(ne,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:19})}),e.jsx(V.BaseLayer,{name:"3D Terrain",children:e.jsx(ne,{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20})}),e.jsx(V.BaseLayer,{name:"3D topography",children:e.jsx(ne,{attribution:'Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: © <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",maxZoom:17})}),e.jsx(V.BaseLayer,{name:"Satellite",children:e.jsx(ne,{attribution:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),a.length>1&&e.jsx(V.Overlay,{checked:!0,name:"Show Route",children:e.jsx(Se,{positions:a,color:"var(--color-red-600)",weight:5,opacity:.8,dashArray:"10, 10"})}),p.length>0&&e.jsx(V.Overlay,{checked:!0,name:"Show Activities",children:e.jsx(Se,{positions:p,color:"var(--color-green-600)",weight:3,opacity:.8,dashArray:"5, 5"})})]}),$e={hotel:Ae,restaurant:He,museum:Ue,airport:Be,train_station:Ie,sightseeing:De,activity:Pe,other:me},Re=(a,p,u,n)=>{const h=n?1.3:1,m=30*h,y=42*h,N=n?16:12,w=String(a).length>2?N-3:N,v=24*h,F=`<svg width="${14*h}" height="${14*h}" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="${n?3:2.5}" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`,A=`
    <div style="position: relative; width: ${m}px; height: ${y}px;">
      <svg width="${m}" height="${y}" viewBox="0 0 30 42" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
        <path d="M15 0C6.716 0 0 6.716 0 15C0 26.25 15 42 15 42C15 42 30 26.25 30 15C30 6.716 23.284 0 15 0Z" fill="${p}"/>
        <circle cx="15" cy="15" r="11" fill="white"/>
      </svg>
      <div style="position: absolute; top: ${15*h}px; left: ${15*h}px; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; font-size: ${w}px; font-weight: 900; color: ${p}; text-align: center; width: ${20*h}px;">
        ${a}
      </div>
      <div style="position: absolute; top: ${-8*h}px; right: ${-12*h}px; background: ${p}; border: 2px solid white; border-radius: 50%; width: ${v}px; height: ${v}px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;">
        ${F}
      </div>
    </div>
  `;return J.divIcon({html:A,className:"custom-div-icon",iconSize:[m,y],iconAnchor:[m/2,y],popupAnchor:[0,-y]})},Z=a=>typeof a.lat=="number"&&Number.isFinite(a.lat)&&typeof a.lng=="number"&&Number.isFinite(a.lng),Xt=({items:a,onClearSelection:p})=>{const u=oe();return React.useEffect(()=>{const n=new J.Control({position:"topleft"});return n.onAdd=()=>{const l=J.DomUtil.create("div","leaflet-bar leaflet-control"),b=J.DomUtil.create("a","leaflet-control-reset",l);return b.innerHTML='<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display: block; margin: 0 auto;"><path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8M3 16.2V21m0 0h4.8M3 21l6-6M21 7.8V3m0 0h-4.8M21 3l-6 6M3 7.8V3m0 0h4.8M3 3l6 6"/></svg>',b.href="#",b.title="Reset View",b.style.backgroundColor="white",b.style.cursor="pointer",J.DomEvent.on(b,"click",h=>{J.DomEvent.stop(h),p();const m=a.filter(Z);if(m.length>0){const y=J.latLngBounds(m.map(N=>[N.lat,N.lng]));u.flyToBounds(y,{padding:[50,50],duration:1.5,maxZoom:he})}else u.flyTo(Ge,qe,{duration:1.5})}),l},u.addControl(n),()=>{u.removeControl(n)}},[u,a,p]),null},Kt=({isCollapsed:a})=>{const p=oe();return React.useEffect(()=>{if(!a){const u=setTimeout(()=>{p.invalidateSize()},100);return()=>clearTimeout(u)}},[a,p]),null},Qt=({items:a,selectedItem:p,isCollapsed:u})=>{const n=oe(),l=React.useRef(void 0),b=React.useRef(0);return React.useEffect(()=>{const h=n.getContainer();if(h.clientWidth===0||h.clientHeight===0)return;const m=p?.id??null,y=a.length,N=l.current!==m,k=b.current===0&&y>0;if(N||k){if(p&&Z(p))try{n.flyTo([p.lat,p.lng],he,{duration:1.5,easeLinearity:.25})}catch(w){console.error("Failed to fly to selected item",w)}else if(!p){const w=a.filter(Z);if(w.length>0)try{const v=J.latLngBounds(w.map(F=>[F.lat,F.lng]));n.flyToBounds(v,{padding:[50,50],duration:1.5,maxZoom:he})}catch(v){console.error("Failed to fly to bounds",v)}}l.current=m,b.current=y}},[a,p,n,u]),null},es=({isSelecting:a})=>{const p=oe();return React.useEffect(()=>{a?p.getContainer().style.cursor="crosshair":p.getContainer().style.cursor=""},[a,p]),null},ts=({onLocationSelect:a})=>(yt({click(p){a(p.latlng.lat,p.latlng.lng)}}),null);function ss({items:a,selectedItem:p,editingItemId:u,editingItemLocation:n,onSelectItem:l,onEdit:b,onLocationSelect:h,onCancelLocationSelect:m,isSelectingLocation:y,isCollapsed:N}){const k=React.useMemo(()=>a.filter(r=>!r.parent_id),[a]),w=React.useMemo(()=>k.filter(r=>r.is_connected),[k]),v=w.length,F=React.useMemo(()=>w.filter(Z).map(r=>[r.lat,r.lng]),[w]),A=React.useMemo(()=>{const r=[];return a.forEach(j=>{if(j.parent_id&&Z(j)){const R=a.find(U=>U.id===j.parent_id);R&&Z(R)&&r.push([[R.lat,R.lng],[j.lat,j.lng]])}}),r},[a]);return e.jsxs("div",{className:"h-full w-full relative z-0 rounded-lg overflow-hidden border border-slate-200",children:[e.jsxs(ft,{center:Ge,zoom:qe,zoomSnap:0,scrollWheelZoom:!0,className:"h-full w-full",attributionControl:!1,children:[e.jsx(Kt,{isCollapsed:N}),e.jsx(Yt,{polylinePoints:F,spokeLines:A}),e.jsx(Qt,{items:a,selectedItem:p,isCollapsed:N}),e.jsx(es,{isSelecting:!!y}),e.jsx(Xt,{items:a,onClearSelection:()=>l(null)}),a.map(r=>{let j=r.lat,R=r.lng,U=r.category;const G=r.id===u;if(G&&n&&(j=n.lat,R=n.lng,U=n.category||r.category),!Z({lat:j,lng:R}))return null;const W=r.id===p?.id||G,f=!!r.parent_id,C=f?"var(--color-green-500)":r.is_connected?"var(--color-indigo-500)":"var(--color-amber-500)";let z="•";if(f){const D=a.find(I=>I.id===r.parent_id);if(D){const I=k.findIndex(te=>te.id===D.id);if(I!==-1){const te=D.is_connected?I+1:String.fromCharCode(65+(I-v)),q=a.filter(K=>K.parent_id===r.parent_id).findIndex(K=>K.id===r.id);q!==-1&&(z=`${te}.${q+1}`)}}}else{const D=k.findIndex(I=>I.id===r.id);D!==-1&&(z=r.is_connected?D+1:String.fromCharCode(65+(D-v)))}return e.jsx(ke,{position:[j,R],icon:Re(z,C,U,W),eventHandlers:{click:()=>l(r)},children:e.jsx(bt,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[U&&$e[U]&&e.jsx("div",{className:f?"text-green-600":r.is_connected?"text-indigo-500":"text-amber-500",children:(()=>{const D=$e[U];return e.jsx(D,{size:14})})()}),e.jsx("h3",{className:"font-bold",children:r.location}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[r.is_tba&&e.jsx("span",{className:"shrink-0 bg-green-100 text-green-700 text-[10px] font-bold px-1 py-0.5 rounded uppercase tracking-wider border border-green-200",children:"TBA"}),b&&e.jsx("button",{onClick:D=>{D.stopPropagation(),b(r)},className:"p-1 text-slate-400 hover:text-indigo-600 transition-colors",title:"Edit",children:e.jsx(ze,{size:14})})]})]}),e.jsxs("div",{className:"text-[11px] font-bold uppercase tracking-wider text-slate-500",children:[[r.date?re(r.date):null,r.time?r.time.substring(0,5):null].filter(Boolean).join(" @ "),(r.date_departure||r.time_departure)&&e.jsxs(e.Fragment,{children:[" → ",[r.date_departure?re(r.date_departure):null,r.time_departure?r.time_departure.substring(0,5):null].filter(Boolean).join(" @ ")]}),!r.date&&!r.time&&"Flexible Timing"]}),e.jsx("p",{className:"mt-1",children:r.description}),(r.url_property||r.url_map)&&e.jsxs("div",{className:"flex gap-2 mt-2",children:[r.url_property&&e.jsxs("a",{href:r.url_property,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[10px] font-bold !text-blue-800 hover:!text-blue-900 bg-blue-50 px-2 py-0.5 rounded border border-blue-100 transition-colors uppercase",children:[e.jsx(Oe,{size:10}),"Hotel"]}),r.url_map&&e.jsxs("a",{href:r.url_map,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[10px] font-bold !text-amber-600 hover:!text-amber-800 bg-amber-50 px-2 py-0.5 rounded border border-amber-100 transition-colors uppercase",children:[e.jsx(ue,{size:10}),"Google Map"]})]})]})})},r.id)}),!u&&n&&Z(n)&&e.jsx(ke,{position:[n.lat,n.lng],icon:Re(String.fromCharCode(65+(k.length-v)),"var(--color-amber-500)",n.category,!0)}),y&&h&&e.jsx(ts,{onLocationSelect:h})]}),y&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] flex flex-col items-center gap-2",children:[e.jsx("div",{className:"bg-white px-4 py-2 rounded-full shadow-lg border border-indigo-200 text-indigo-600 font-bold text-sm",children:"Select new location on map"}),m&&e.jsx("button",{onClick:r=>{r.stopPropagation(),m()},className:"bg-white px-4 py-1.5 rounded-full shadow-md border border-slate-200 text-slate-500 font-bold text-xs hover:bg-slate-50 transition-all",children:"Cancel"})]})]})}const as=({auth:a,trip:p,onUpdate:u,onClose:n})=>{const[l,b]=React.useState(""),[h,m]=React.useState(p.collaborator_emails||[]),[y,N]=React.useState(!1),[k,w]=React.useState(null),v=j=>{if(j.preventDefault(),!!l.trim()){if(h.includes(l.trim())){w("User already added");return}m([...h,l.trim()]),b(""),w(null)}},F=j=>{m(h.filter(R=>R!==j))},A=async()=>{N(!0),w(null);try{const j=await fetch(`${B}/travel/trips/${p.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({collaborator_emails:h})}),R=await j.json();if(!j.ok)throw new Error(R.detail||"Failed to update collaborators");u(R),n()}catch(j){w(j.message)}finally{N(!1)}},r=`${window.location.origin}${window.location.pathname}?share_token=${p.share_token}`;return e.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Share Trip"}),e.jsx("button",{onClick:n,className:"text-slate-400 hover:text-slate-600",children:e.jsx(ce,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("section",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Public Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,className:"flex-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm text-slate-500 outline-none",value:r}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r)},className:"bg-slate-100 text-slate-600 px-3 py-2 rounded-lg text-sm font-bold hover:bg-slate-200",children:"Copy"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"Anyone with this link can view the trip (read-only)."})]}),e.jsxs("section",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:"Collaborators"}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:"Add other users to give them editing rights."}),e.jsxs("form",{onSubmit:v,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"email",placeholder:"user@example.com",className:"flex-1 px-3 py-2 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-indigo-500",value:l,onChange:j=>b(j.target.value)}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-700",children:"Add"})]}),e.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:[h.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No collaborators yet."}),h.map(j=>e.jsxs("div",{className:"flex items-center justify-between bg-slate-50 px-3 py-2 rounded-lg",children:[e.jsx("span",{className:"text-sm text-slate-700 truncate",children:j}),e.jsx("button",{onClick:()=>F(j),className:"text-slate-400 hover:text-red-500",children:e.jsx(ce,{size:16})})]},j))]})]}),k&&e.jsx("p",{className:"text-red-500 text-sm",children:k})]}),e.jsxs("div",{className:"p-6 bg-slate-50 border-t border-slate-100 flex justify-end gap-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 text-sm font-bold text-slate-600 hover:text-slate-800",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:y,className:"bg-indigo-600 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-indigo-700 disabled:opacity-50",children:y?"Saving...":"Save Changes"})]})]})})},Me=[{id:"hotel",label:"Hotel",icon:Ae},{id:"restaurant",label:"Restaurant",icon:He},{id:"museum",label:"Museum",icon:Ue},{id:"airport",label:"Airport",icon:Be},{id:"train_station",label:"Train Station",icon:Ie},{id:"sightseeing",label:"Sightseeing",icon:De},{id:"activity",label:"Activity",icon:Pe},{id:"other",label:"Other",icon:me}],ns=()=>{const[a,p]=React.useState(null),[u,n]=React.useState([]),[l,b]=React.useState(null),[h,m]=React.useState([]),[y,N]=React.useState(!0),[k,w]=React.useState(null),[v,F]=React.useState(null),[A,r]=React.useState(!1),[j,R]=React.useState(!1),[U,G]=React.useState(!1),[W,f]=React.useState(""),[C,z]=React.useState(null),[D,I]=React.useState(!1),[te,le]=React.useState(!1),[q,K]=React.useState(null),[ge,Q]=React.useState(null),[M,fe]=React.useState(!1),[Je,Y]=React.useState(""),ee=React.useRef(null),Ze=React.useRef(null);React.useEffect(()=>{if(v){const t=document.getElementById(`travel-item-${v.id}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}},[v]);const[x,$]=React.useState({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",is_connected:!1,parent_id:null}),ie=new URLSearchParams(window.location.search).get("share_token"),L=!!ie;React.useEffect(()=>{const t=localStorage.getItem("travel_auth");if(t)try{p(JSON.parse(t))}catch{localStorage.removeItem("travel_auth")}},[]);const We=t=>{p(t),localStorage.setItem("travel_auth",JSON.stringify(t))},de=()=>{p(null),localStorage.removeItem("travel_auth"),n([]),m([])},P=React.useCallback(async(t,s={})=>{const i={...s.headers||{},...a?{Authorization:`Bearer ${a.access_token}`}:{}};return fetch(t,{...s,headers:i})},[a]),be=React.useCallback(async()=>{if(!(L||!a))try{const t=await P(H);if(t.status===401){de();return}if(!t.ok)throw new Error("Failed to fetch trips");const s=await t.json();n(s),s.length>0&&l===null&&b(s[0].id)}catch(t){console.error(t)}},[l,L,a,P]),ye=React.useCallback(async()=>{if(L){N(!0);try{const t=await fetch(`${B}/travel/shared/${ie}`);if(!t.ok)throw new Error("Failed to fetch shared trip");const s=await t.json();n([s.trip]),b(s.trip.id);const i=s.items.map((o,d)=>({...o,is_connected:d<s.trip.active_count}));m(i),w(null)}catch(t){w("Failed to load shared itinerary. It may have been deleted or the link is invalid."),console.error(t)}finally{N(!1)}return}if(!a||l===null){m([]),N(!1);return}N(!0);try{const t=await P(`${H}/${l}/items`);if(t.status===401){de();return}if(!t.ok)throw new Error("Failed to fetch itinerary items");const s=await t.json(),i=s.items.map((o,d)=>({...o,is_connected:d<s.active_count}));m(i),w(null)}catch(t){w("Failed to load itinerary. Please try again."),console.error(t)}finally{N(!1)}},[l,L,ie,a,P]);React.useEffect(()=>{be()},[be]),React.useEffect(()=>{ye(),L||(F(null),z(null),r(!1),$({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",is_connected:!1,parent_id:null}))},[ye,L]);const X=React.useMemo(()=>u.find(t=>t.id===l),[u,l]),ve=React.useMemo(()=>a&&X&&a.user.id===X.user_id,[a,X]),Ye=()=>{if(ve)le(!0);else if(X){const t=`${window.location.origin}${window.location.pathname}?share_token=${X.share_token}`;navigator.clipboard.writeText(t)}},Xe=async()=>{if(l!==null)try{const t=await P(`${H}/${l}/export`);if(!t.ok)throw new Error("Failed to export trip");const s=await t.blob(),i=t.headers.get("Content-Disposition");let o="trip_backup.yaml";if(i){const _=i.match(/filename="?([^"]+)"?/);_&&(o=_[1])}const d=URL.createObjectURL(s),g=document.createElement("a");g.href=d,g.download=o,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d)}catch(t){alert("Failed to export trip"),console.error(t)}},Ke=async t=>{const s=t.target.files?.[0];if(s){if(!confirm("This will import the trip as a new trip. Continue?")){ee.current&&(ee.current.value="");return}try{const i=await s.text(),o=await P(`${H}/import`,{method:"POST",headers:{"Content-Type":"text/yaml"},body:i});if(!o.ok){const g=await o.json();throw new Error(g.detail||"Failed to import trip")}const d=await o.json();n(g=>[...g,d]),b(d.id),alert("Successfully imported trip!")}catch(i){alert(`Failed to import: ${i instanceof Error?i.message:String(i)}`),console.error(i)}finally{ee.current&&(ee.current.value="")}}},Qe=async t=>{if(t.preventDefault(),!!W.trim())try{const s=await P(H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:W})});if(!s.ok)throw new Error("Failed to create trip");const i=await s.json();n(o=>[...o,i]),b(i.id),f(""),G(!1)}catch(s){alert("Failed to create trip"),console.error(s)}},et=async t=>{if(confirm("Are you sure you want to delete this trip and all its items?"))try{if(!(await P(`${H}/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete trip");n(i=>i.filter(o=>o.id!==t)),l===t&&b(u.find(i=>i.id!==t)?.id||null)}catch(s){alert("Failed to delete trip"),console.error(s)}},je=(t=null)=>{z(null),$({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",is_connected:!1,parent_id:t}),Y(""),r(!0)},se=async t=>{if(l===null)return;const s=[...t].sort((o,d)=>o.is_connected!==d.is_connected?o.is_connected?-1:1:0),i=s.filter(o=>o.is_connected).length;try{const o=await P(`${H}/${l}/items`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:s,connections:[],active_count:i})});if(!o.ok)throw new Error("Failed to sync trip items");const d=await o.json(),g=d.items.map((_,c)=>({..._,is_connected:c<d.active_count}));m(g)}catch(o){throw console.error("Sync error:",o),o}},tt=async(t,s)=>{try{if(!(await P(`${B}/travel/items/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,parent_id:s.id})})).ok)throw new Error("Failed to indent item");const d=[...h.filter(g=>g.id!==t.id),{...t,parent_id:s.id,is_connected:!1}];await se(d)}catch(i){alert("Failed to indent item"),console.error(i)}},st=async t=>{try{if(!(await P(`${B}/travel/items/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,parent_id:null})})).ok)throw new Error("Failed to outdent item");const i=h.findIndex(_=>_.id===t.parent_id),d=[...h.filter(_=>_.id!==t.id)],g={...t,parent_id:null,is_connected:!0};if(i!==-1){const _=d.findIndex(c=>c.id===t.parent_id);d.splice(_+1,0,g)}else d.push(g);await se(d)}catch(s){alert("Failed to outdent item"),console.error(s)}},we=t=>{z(t.id),$({date:t.date,time:t.time,location:t.location,description:t.description,description_private:t.description_private,category:t.category||"other",lat:t.lat,lng:t.lng,date_departure:t.date_departure,time_departure:t.time_departure,is_tba:t.is_tba,url_property:t.url_property||"",url_map:t.url_map||"",is_connected:t.is_connected,parent_id:t.parent_id}),Y(t.lat&&t.lng?`${t.lat}, ${t.lng}`:""),r(!0)},at=async t=>{if(t.preventDefault(),l!==null)try{const s=C?`${B}/travel/items/${C}`:`${H}/${l}/items`,o=await P(s,{method:C?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:x.date,time:x.time,location:x.location,description:x.description,description_private:x.description_private,category:x.category,lat:x.lat,lng:x.lng,date_departure:x.date_departure,time_departure:x.time_departure,is_tba:x.is_tba,url_property:x.url_property,url_map:x.url_map,parent_id:x.parent_id})});if(!o.ok)throw new Error("Failed to save item");const d=await o.json();let g;C?g=h.map(_=>_.id===C?{..._,...d,is_connected:x.is_connected}:_):g=[...h,{...d,is_connected:x.is_connected}],await se(g),r(!1),z(null),$({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",is_connected:!1,parent_id:null})}catch(s){alert("Failed to save item"),console.error(s)}},nt=async t=>{if(confirm("Are you sure you want to delete this item?"))try{if(!(await P(`${B}/travel/items/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");m(i=>i.filter(o=>o.id!==t)),v?.id===t&&F(null)}catch(s){alert("Failed to delete item"),console.error(s)}},rt=async t=>{if(confirm("Are you sure you want to duplicate this item?"))try{const s=await P(`${H}/${l}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t.date,time:t.time,location:t.location,description:`**DUPLICATED**
${t.description}`,description_private:t.description_private,category:t.category,lat:t.lat,lng:t.lng,date_departure:t.date_departure,time_departure:t.time_departure,is_tba:!0,url_property:t.url_property,url_map:t.url_map,parent_id:t.parent_id})});if(!s.ok)throw new Error("Failed to duplicate item");const i=await s.json();m(o=>[...o,{...i,is_connected:!1}])}catch(s){alert("Failed to duplicate item"),console.error(s)}},ot=t=>{K(t)},lt=(t,s)=>{if(t.preventDefault(),q===null||q===s)return;const i=h.findIndex(S=>S.id===q),o=h.findIndex(S=>S.id===s);if(i===-1||o===-1)return;const d=[...h],[g]=d.splice(i,1),_=h.filter(S=>S.is_connected).length;g.is_connected=o<_,d.splice(o,0,g);const c=h.map(S=>`${S.id}-${S.is_connected}`).join(","),E=d.map(S=>`${S.id}-${S.is_connected}`).join(",");c!==E&&m(d)},it=async()=>{if(!(q===null||l===null)){K(null),Q(null);try{await se(h)}catch(t){alert("Failed to save reordered items"),console.error(t)}}},ae=React.useMemo(()=>h,[h]),Ne=React.useMemo(()=>h.filter(t=>t.is_connected).length,[h]);return!a&&!L?e.jsx(Wt,{onLogin:We}):e.jsxs("div",{className:"flex flex-col h-full md:rounded-2xl md:shadow-2xl overflow-hidden bg-slate-50 font-sans text-slate-900 border md:border-slate-200/50",children:[e.jsxs("header",{className:"bg-white border-b border-slate-200 px-6 py-4 flex flex-wrap justify-between items-center shadow-sm z-10 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/favicon_travel.png",alt:"Travel Planner",className:"w-10 h-10 rounded-xl shadow-indigo-200 shadow-lg shrink-0"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-slate-900 hidden md:block",children:"Travel Planner"})]}),e.jsx("div",{className:"flex items-center gap-3 flex-1 max-w-md",children:U?e.jsxs("form",{onSubmit:Qe,className:"flex gap-2 w-full",children:[e.jsx("input",{autoFocus:!0,type:"text","data-testid":"trip-name-input",placeholder:"Trip name...",className:"flex-1 px-3 py-1.5 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-indigo-500",value:W,onChange:t=>f(t.target.value)}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-indigo-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>G(!1),className:"bg-slate-100 text-slate-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-slate-200",children:"Cancel"})]}):e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsxs("select",{className:"flex-1 bg-slate-50 border border-slate-200 px-3 py-2 rounded-lg text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-70 disabled:cursor-default",value:l||"",onChange:t=>b(Number(t.target.value)),disabled:L,children:[u.length===0&&e.jsx("option",{value:"",children:"No trips created"}),u.map(t=>e.jsxs("option",{value:t.id,children:[t.name,a&&t.user_id!==a.user.id?" (Shared)":""]},t.id))]}),!L&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>G(!0),className:"bg-slate-100 text-slate-600 p-2 rounded-lg hover:bg-slate-200 transition-colors shrink-0",title:"Create New Trip","data-testid":"create-trip-button",children:e.jsx(Ce,{size:20})}),l&&ve&&e.jsx("button",{onClick:()=>et(l),className:"bg-slate-100 text-slate-400 p-2 rounded-lg hover:bg-red-50 hover:text-red-500 transition-colors shrink-0",title:"Delete Current Trip",children:e.jsx(pe,{size:20})})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[l&&e.jsxs("div",{className:"flex items-center gap-2",children:[!L&&e.jsxs("button",{onClick:Ye,className:"bg-slate-100 text-slate-600 px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-200 transition-all flex items-center gap-2",title:"Share Trip",children:[e.jsx(_t,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Share"})]}),!L&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Xe,className:"bg-slate-100 text-slate-600 px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-200 transition-all flex items-center gap-2",title:"Export to YAML",children:[e.jsx(jt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Export"})]}),e.jsxs("button",{onClick:()=>ee.current?.click(),className:"bg-slate-100 text-slate-600 px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-200 transition-all flex items-center gap-2",title:"Import from YAML",children:[e.jsx(wt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Import"})]}),e.jsx("input",{type:"file",ref:ee,onChange:Ke,accept:".yaml,.yml",className:"hidden"})]})]}),e.jsxs("button",{onClick:()=>fe(!M),className:"bg-slate-100 text-slate-600 px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-200 transition-all flex items-center gap-2",title:M?"Show Map":"List View",children:[M?e.jsx(ue,{size:18}):e.jsx(vt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:M?"Show Map":"List View"})]}),!L&&e.jsxs(e.Fragment,{children:[a?.user.role==="admin"&&e.jsxs("button",{onClick:()=>I(!0),className:"bg-indigo-50 text-indigo-700 px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-indigo-100 transition-all flex items-center gap-2",title:"Manage Users",children:[e.jsx(kt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Users"})]}),e.jsx("button",{onClick:de,className:"text-slate-500 hover:text-red-500 transition-colors p-2",title:"Logout",children:e.jsx(Bt,{size:20})})]})]})]}),e.jsxs("main",{className:"flex flex-1 overflow-hidden relative",children:[e.jsx("div",{className:`${M||A&&!j?"flex w-full":"hidden md:flex md:w-1/3"} flex-col border-r border-slate-200 bg-white overflow-hidden shadow-xl z-20 transition-all duration-300`,children:A?e.jsxs("div",{className:"p-6 overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-slate-800",children:C?"Edit Destination":"Add New Destination"}),e.jsxs("form",{onSubmit:at,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-date",className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Date"}),e.jsx("input",{id:"travel-date","data-testid":"travel-date",type:"date",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",value:x.date||"",onChange:t=>$({...x,date:t.target.value||null})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-time",className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Time"}),e.jsx("input",{id:"travel-time","data-testid":"travel-time",type:"time",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",value:x.time||"",onChange:t=>$({...x,time:t.target.value||null})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-departure-date",className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Departure Date"}),e.jsx("input",{id:"travel-departure-date","data-testid":"travel-departure-date",type:"date",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",value:x.date_departure||"",onChange:t=>$({...x,date_departure:t.target.value||null}),onFocus:()=>{!x.date_departure&&x.date&&$({...x,date_departure:x.date})}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-departure-time",className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Departure Time"}),e.jsx("input",{id:"travel-departure-time","data-testid":"travel-departure-time",type:"time",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",value:x.time_departure||"",onChange:t=>$({...x,time_departure:t.target.value||null})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Category"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Me.map(t=>{const s=t.icon,i=x.category===t.id;return e.jsxs("button",{type:"button",onClick:()=>$({...x,category:t.id}),className:`flex flex-col items-center gap-1.5 p-2 rounded-lg border transition-all ${i?"bg-indigo-50 border-indigo-200 text-indigo-600 shadow-sm":"bg-white border-slate-100 text-slate-400 hover:border-slate-200 hover:bg-slate-50"}`,children:[e.jsx(s,{size:18}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider",children:t.label})]},t.id)})})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer mb-1.5",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500",checked:x.is_tba,onChange:t=>$({...x,is_tba:t.target.checked})}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"TBA (To Be Amended)"})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Location Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,"data-testid":"location-input",placeholder:"e.g. Paris, France",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all",value:x.location,onChange:t=>$({...x,location:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Description"}),e.jsx("textarea",{rows:3,"data-testid":"description-input",placeholder:"What are you planning to do there?",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all resize-none",value:x.description,onChange:t=>$({...x,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Private Note (hidden on shared links)"}),e.jsx("textarea",{rows:2,placeholder:"Personal notes, booking references, etc.",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all resize-none bg-green-50/30",value:x.description_private,onChange:t=>$({...x,description_private:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Coordinates"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text","data-testid":"gps-input",placeholder:"GPS 'lat, lng' or Google Maps link https://www.google.com/maps/place/...",className:"flex-1 px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all text-sm",value:Je,onChange:t=>{const s=t.target.value;if(Y(s),s.startsWith("http")){const i=s.match(/!3d(-?\d+(?:\.\d+)?)/),o=s.match(/!4d(-?\d+(?:\.\d+)?)/);if(i&&o){const d=parseFloat(i[1]),g=parseFloat(o[1]);!isNaN(d)&&!isNaN(g)&&($({...x,lat:d,lng:g}),Y(`${d}, ${g}`))}else{const d=s.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);if(d){const g=parseFloat(d[1]),_=parseFloat(d[2]);!isNaN(g)&&!isNaN(_)&&($({...x,lat:g,lng:_}),Y(`${g}, ${_}`))}}}else{const i=s.split(/[\s,]+/);if(i.length>=2){const o=parseFloat(i[0]),d=parseFloat(i[1]);!isNaN(o)&&!isNaN(d)&&$({...x,lat:o,lng:d})}}}}),e.jsx("button",{type:"button",onClick:()=>{R(!0),fe(!1)},className:"px-3 py-2 rounded-lg border border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-all font-bold shadow-sm flex items-center justify-center shrink-0",title:"Pick location on map","data-testid":"select-on-map-button",children:e.jsx(At,{size:20})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:["Google Map URL (or"," ",e.jsx("a",{href:"https://developers.google.com/maps/documentation/javascript/examples/places-placeid-finder",target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:underline font-normal",onClick:t=>t.stopPropagation(),children:"Google Place ID"}),")"]}),e.jsx("input",{type:"url","data-testid":"map-url-input",placeholder:"e.g. https://google.com/maps/... or ChIJ3S-JXmauEmsRUcIaWtf4MzE",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all text-sm",value:x.url_map,onChange:t=>{let s=t.target.value;s&&!s.startsWith("http")&&(s=`https://www.google.com/maps/search/?api=1&query_place_id=${s}&query=a`);const i=s.match(/!3d(-?\d+(?:\.\d+)?)/),o=s.match(/!4d(-?\d+(?:\.\d+)?)/);let d=null,g=null;if(i&&o)d=parseFloat(i[1]),g=parseFloat(o[1]);else{const _=s.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);_&&(d=parseFloat(_[1]),g=parseFloat(_[2]))}d!==null&&g!==null&&!isNaN(d)&&!isNaN(g)?($({...x,url_map:s,lat:d,lng:g}),Y(`${d}, ${g}`)):$({...x,url_map:s})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 mb-1.5",children:"Hotel URL"}),e.jsx("input",{type:"url",placeholder:"e.g. https://booking.com/...",className:"w-full px-4 py-2.5 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all text-sm",value:x.url_property,onChange:t=>{let s=t.target.value;s.startsWith("https://www.booking.com/")&&(s=s.split("?")[0]),$({...x,url_property:s})}})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{r(!1),z(null)},className:"flex-1 bg-slate-100 text-slate-600 py-3 rounded-lg font-bold hover:bg-slate-200 transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-[2] bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100",children:C?"Save Changes":"Save to Itinerary"})]})]})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Itinerary"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-1",children:[Ne," stops and ",h.length-Ne," ","unconnected points"]})]}),!L&&e.jsx("button",{disabled:l===null,onClick:()=>je(),className:"bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 transition-all shadow-md active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",title:"Add Stop",children:e.jsx(Ce,{size:20})})]}),e.jsx("div",{ref:Ze,className:"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-thumb-slate-200",children:y?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):k?e.jsx("div",{className:"text-center py-12 text-red-500 font-medium px-4",children:k}):ae.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-slate-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400",children:e.jsx(Et,{size:32})}),e.jsx("p",{className:"text-slate-500 font-medium",children:"No stops added yet."}),!L&&e.jsx("button",{disabled:l===null,onClick:()=>je(),className:"text-indigo-600 text-sm font-bold mt-2 hover:underline disabled:opacity-50",children:l===null?"Create a trip first":"Start planning now"})]}):e.jsx("div",{className:"relative flex flex-col space-y-2",children:(()=>{const t=ae.filter(o=>!o.parent_id),s=ae.reduce((o,d)=>(d.parent_id&&(o[d.parent_id]||(o[d.parent_id]=[]),o[d.parent_id].push(d)),o),{}),i=t.filter(o=>o.is_connected).length;return t.map((o,d)=>{const g=d>0&&!o.is_connected&&t[d-1].is_connected,_=(c,E,S,dt)=>{const _e=t[S].is_connected?S+1:String.fromCharCode(65+(S-i)),ct=E?`${_e}.${dt+1}`:_e;return e.jsxs("div",{id:`travel-item-${c.id}`,className:`relative ${E?"pl-16 pr-0 py-0":"pl-10 py-1"} transition-all ${q===c.id?"opacity-20":""} ${ge===c.id?"select-none":""}`,onClick:()=>F(c),"data-testid":"travel-item",draggable:!L&&ge===c.id&&C!==c.id,onDragStart:()=>ot(c.id),onDragOver:T=>lt(T,c.id),onDragEnd:it,children:[S<i&&e.jsxs(e.Fragment,{children:[(S<i-1||S===i-1&&E)&&e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-[3px] bg-indigo-200 -translate-x-1/2 z-0"}),S===i-1&&!E&&e.jsx("div",{className:"absolute left-4 top-0 h-4 w-[3px] bg-indigo-200 -translate-x-1/2 z-0"}),(S>0||E)&&e.jsx("div",{className:`absolute left-4 ${M?"-top-2 h-2":"-top-4 h-4"} w-[3px] bg-indigo-200 -translate-x-1/2 z-0`})]}),E&&e.jsx("div",{className:"absolute left-10 top-0 bottom-1/2 w-[2px] bg-slate-200 -translate-x-1/2 z-0 rounded-bl-lg border-b-2 border-l-2 border-slate-200 h-full w-4"}),e.jsx("div",{className:`absolute ${E?"left-6 w-7 h-7 mt-1.5":"left-0 top-1.5 w-8 h-8"} rounded-full border-[3px] shadow-sm flex items-center justify-center transition-colors z-20 ${v?.id===c.id||C===c.id?"bg-white text-red-500 border-red-500":c.is_connected?"bg-slate-200 text-slate-500 border-white":E?"bg-green-500 text-white border-white":"bg-amber-500 text-white border-white"}`,children:e.jsx("span",{className:"text-[0.8rem] font-bold",children:ct})}),e.jsxs("div",{className:`${M?"p-2":"p-4"} rounded-xl border transition-all relative z-10 flex flex-col group/item ${E?"bg-green-50":c.is_connected?"bg-white":"bg-amber-50"} ${v?.id===c.id?"border-indigo-200 shadow-sm":E?"border-green-200 shadow-sm hover:border-green-300":c.is_connected?"border-slate-100 hover:border-slate-200":"border-amber-200 shadow-sm hover:border-amber-300"}`,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex justify-between items-start mb-1",children:e.jsxs("span",{className:`text-xs font-bold uppercase tracking-wider ${E?"text-green-600":c.is_connected?"text-indigo-600":"text-amber-600"}`,children:[[c.date?re(c.date):null,c.time?c.time.substring(0,5):null].filter(Boolean).join(" @ "),(c.date_departure||c.time_departure)&&e.jsxs(e.Fragment,{children:[" → ",[c.date_departure?re(c.date_departure):null,c.time_departure?c.time_departure.substring(0,5):null].filter(Boolean).join(" @ ")]}),!c.date&&!c.time&&"Flexible Timing"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[c.category&&e.jsx("div",{className:`shrink-0 ${E?"text-green-400":c.is_connected?"text-indigo-400":"text-amber-400"}`,children:(()=>{const T=Me.find(ut=>ut.id===c.category),pt=T?T.icon:me;return e.jsx(pt,{size:16})})()}),e.jsx("h3",{className:`${M?"text-sm":"text-base"} font-bold text-slate-900 truncate`,children:c.location}),c.is_tba&&e.jsx("span",{className:"shrink-0 bg-pink-100 text-pink-700 text-[10px] font-bold px-1.5 py-0.5 rounded uppercase tracking-wider border border-pink-200",children:"TBA"})]}),(c.url_property||c.url_map)&&e.jsxs("div",{className:"flex gap-2 mt-1",children:[c.url_property&&e.jsxs("a",{href:c.url_property,target:"_blank",rel:"noopener noreferrer",onClick:T=>T.stopPropagation(),className:"inline-flex items-center gap-1 text-[10px] font-bold text-blue-800 hover:text-blue-900 bg-blue-50 px-2 py-0.5 rounded border border-blue-100 transition-colors uppercase",children:[e.jsx(Oe,{size:10}),"Hotel"]}),c.url_map&&e.jsxs("a",{href:c.url_map,target:"_blank",rel:"noopener noreferrer",onClick:T=>T.stopPropagation(),className:"inline-flex items-center gap-1 text-[10px] font-bold text-amber-600 hover:text-amber-800 bg-amber-50 px-2 py-0.5 rounded border border-amber-100 transition-colors uppercase",children:[e.jsx(ue,{size:10}),"Google Map"]})]}),!M&&e.jsxs(e.Fragment,{children:[c.description&&e.jsx("p",{className:"text-sm text-slate-600 mt-1 line-clamp-2",children:c.description}),!L&&c.description_private&&e.jsxs("p",{className:"text-sm text-slate-700/80 mt-1.5 flex items-center gap-1.5 bg-slate-50/50 p-1.5 rounded-md border border-slate-100/50",children:[e.jsx("span",{className:"shrink-0 bg-slate-200 text-slate-800 text-[10px] font-bold px-1 rounded uppercase",children:"Private"}),e.jsx("span",{children:c.description_private})]})]})]}),!L&&e.jsxs("div",{className:"flex items-center gap-3 ml-auto shrink-0","data-testid":"list-control-icons",children:[e.jsxs("div",{className:"flex gap-1",children:[!E&&S>0&&e.jsx("button",{onClick:T=>{T.stopPropagation(),tt(c,t[S-1])},className:"p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all",title:"Make Child of Previous Item",children:e.jsx(zt,{size:M?14:16})}),E&&e.jsx("button",{onClick:T=>{T.stopPropagation(),st(c)},className:"p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all",title:"Make it a Parent Item",children:e.jsx(Lt,{size:M?14:16})}),e.jsx("button",{onClick:T=>{T.stopPropagation(),we(c)},className:"p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all",title:"Edit",children:e.jsx(ze,{size:M?14:16})}),e.jsx("button",{onClick:T=>{T.stopPropagation(),rt(c)},className:"p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-all",title:"Duplicate",children:e.jsx(Ct,{size:M?14:16})}),e.jsx("button",{onClick:T=>{T.stopPropagation(),nt(c.id)},className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-all",title:"Delete",children:e.jsx(pe,{size:M?14:16})})]}),e.jsx("div",{className:"cursor-grab active:cursor-grabbing text-slate-400 hover:text-slate-600 transition-all p-1 touch-none",onMouseDown:()=>Q(c.id),onMouseUp:()=>Q(null),onTouchStart:()=>Q(c.id),onTouchEnd:()=>Q(null),onTouchCancel:()=>Q(null),children:e.jsx(Nt,{size:M?16:20})})]})]})]},c.id)};return e.jsxs(React.Fragment,{children:[g&&e.jsxs("div",{className:`relative ${M?"py-2":"py-6"}`,children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-slate-200 border-dashed"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-white px-4 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]",children:"Extra Locations"})})]}),_(o,!1,d,0),s[o.id]?.map((c,E)=>_(c,!0,d,E))]},o.id)})})()})})]})}),e.jsx("div",{className:`${M||A&&!j?"hidden md:block":"block"} ${M?"md:hidden":""} flex-1 h-full`,children:e.jsx(ss,{items:ae,selectedItem:v,editingItemId:C,editingItemLocation:A?{lat:x.lat,lng:x.lng,category:x.category,is_connected:x.is_connected}:null,onSelectItem:F,onEdit:we,onLocationSelect:(t,s)=>{$({...x,lat:t,lng:s}),Y(`${t.toFixed(6)}, ${s.toFixed(6)}`),R(!1)},onCancelLocationSelect:()=>R(!1),isSelectingLocation:j,isCollapsed:M})})]}),D&&a&&e.jsx(Zt,{auth:a,onClose:()=>I(!1)}),te&&a&&X&&e.jsx(as,{auth:a,trip:X,onClose:()=>le(!1),onUpdate:t=>{n(s=>s.map(i=>i.id===t.id?t:i))}})]})},Ee=document.getElementById("root");Ee&&(document.body.classList.add("travel-page"),ReactDOM.createRoot(Ee).render(e.jsx(React.StrictMode,{children:e.jsx(ns,{})})));
