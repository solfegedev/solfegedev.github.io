import"./index-CTMTiFxB.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as Re}from"./api-CH_Pe6Vg.js";import{P as ge}from"./pencil-DHu_drsE.js";import{G as xe,D as Ge,U as Me}from"./upload-CK6mc6ZD.js";import{T as de}from"./trash-2-DQbJ9aIh.js";import{P as ue,u as De,T as $e}from"./Toast-DP-6vaks.js";import{f as _e,u as be,T as ce,M as Oe,a as Pe,P as Te}from"./TileLayer-B6Dhyqsh.js";import{L as ne}from"./LayersControl-CYkV3pbI.js";import{M as me,C as Ae}from"./map-afHLg9l6.js";import{X as Fe}from"./x-BS-d4QNZ.js";import{C as ze}from"./copy-CzC7y2Qs.js";import{c as Ue}from"./createLucideIcon-DtX1aPOG.js";import{S as Be}from"./settings-G074OJw9.js";import{L as Ve}from"./log-out-B0TqtotO.js";import{L as qe}from"./list-BhDG0LsZ.js";/* empty css                */import"./utils-CN4411gJ.js";import"./clsx-B-dksMZM.js";const Je=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ze=Ue("share-2",Je),He=_e(function(s){return new L.Control.Zoom(s)}),x=`${Re}/maps`,N=()=>{const t=localStorage.getItem("map_token");return{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}}},g={login:async(t,s)=>{const r=await fetch(`${x}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:s})});if(!r.ok){const c=await r.json().catch(()=>({detail:"Login failed"}));throw new Error(c.detail||"Login failed")}const l=await r.json();return localStorage.setItem("map_token",l.access_token),l},getMe:async()=>{const t=await fetch(`${x}/auth/me`,{headers:N()});if(!t.ok)throw new Error("Not authenticated");return t.json()},getLists:async()=>{const t=await fetch(`${x}/lists`,{headers:N()});if(!t.ok)throw new Error("Failed to fetch lists");return t.json()},createList:async t=>{const s=await fetch(`${x}/lists`,{method:"POST",headers:N(),body:JSON.stringify({name:t})});if(!s.ok)throw new Error("Failed to create list");return s.json()},reorderLists:async t=>{const s=await fetch(`${x}/lists/reorder`,{method:"POST",headers:N(),body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to reorder lists");return s.json()},deleteList:async t=>{const s=await fetch(`${x}/lists/${t}`,{method:"DELETE",headers:N()});if(!s.ok)throw new Error("Failed to delete list");return s.json()},getGroups:async t=>{const s=t?`${x}/groups?list_id=${t}`:`${x}/groups`,r=await fetch(s,{headers:N()});if(!r.ok)throw new Error("Failed to fetch groups");return r.json()},createGroup:async(t,s,r)=>{const l=await fetch(`${x}/groups`,{method:"POST",headers:N(),body:JSON.stringify({name:t,color:s,list_id:r})});if(!l.ok)throw new Error("Failed to create group");return l.json()},updateGroup:async(t,s)=>{const r=await fetch(`${x}/groups/${t}`,{method:"PUT",headers:N(),body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update group");return r.json()},deleteGroup:async t=>{const s=await fetch(`${x}/groups/${t}`,{method:"DELETE",headers:N()});if(!s.ok)throw new Error("Failed to delete group");return s.json()},getItems:async t=>{const s=t?`${x}/items?list_id=${t}`:`${x}/items`,r=await fetch(s,{headers:N()});if(!r.ok)throw new Error("Failed to fetch items");return r.json()},createItem:async(t,s,r,l)=>{const c=await fetch(`${x}/items`,{method:"POST",headers:N(),body:JSON.stringify({group_id:t,name:s,latitude:r,longitude:l})});if(!c.ok)throw new Error("Failed to create item");return c.json()},updateItem:async(t,s)=>{const r=await fetch(`${x}/items/${t}`,{method:"PUT",headers:N(),body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to update item");return r.json()},deleteItem:async t=>{const s=await fetch(`${x}/items/${t}`,{method:"DELETE",headers:N()});if(!s.ok)throw new Error("Failed to delete item");return s.json()},reorderGroups:async t=>{const s=await fetch(`${x}/groups/reorder`,{method:"POST",headers:N(),body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to reorder groups");return s.json()},reorderItems:async t=>{const s=await fetch(`${x}/items/reorder`,{method:"POST",headers:N(),body:JSON.stringify(t)});if(!s.ok)throw new Error("Failed to reorder items");return s.json()},exportData:async()=>{const t=await fetch(`${x}/export`,{headers:N()});if(!t.ok)throw new Error("Export failed");const s=await t.blob(),r=window.URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download="map_data.yaml",l.click(),window.URL.revokeObjectURL(r)},importData:async t=>{const s=await fetch(`${x}/import`,{method:"POST",headers:{...N(),"Content-Type":"text/plain"},body:t});if(!s.ok){const r=await s.json().catch(()=>({detail:"Import failed"}));throw new Error(r.detail||"Import failed")}return s.json()},logout:()=>{localStorage.removeItem("map_token")},getSharedData:async t=>{const s=await fetch(`${x}/shared/${t}`);if(!s.ok)throw new Error("Failed to fetch shared list");return s.json()}},we=React.createContext(void 0),We=({children:t})=>{const[s,r]=React.useState(null),[l,c]=React.useState([]),[i,u]=React.useState(null),[y,f]=React.useState([]),[j,b]=React.useState([]),[E,h]=React.useState(null),[D,T]=React.useState(!1),[H,R]=React.useState(!0),[z,A]=React.useState(!1),[U,B]=React.useState(null),[W,$]=React.useState(null),[K,V]=React.useState("map"),_=(n,m=!0)=>{h(n),T(m)},F=n=>{z||(u(n),f([]),b([]),n?localStorage.setItem("map_current_list_id",String(n.id)):localStorage.removeItem("map_current_list_id"))},w=async()=>{if(z&&U){try{const n=await g.getSharedData(U);c([n.list]),u(n.list),f(n.groups),b(n.items)}catch(n){console.error(n),$("Failed to load shared list")}return}try{const n=await g.getLists();c(n);let m=i;if(!m&&n.length>0){const p=localStorage.getItem("map_current_list_id");p?m=n.find(M=>M.id===Number(p))||n[0]:m=n[0],u(m)}if(m){const[p,M]=await Promise.all([g.getGroups(m.id),g.getItems(m.id)]);f(p),b(M)}else f([]),b([])}catch(n){console.error(n)}};React.useEffect(()=>{w()},[i?.id,z,U]),React.useEffect(()=>{(async()=>{const p=new URLSearchParams(window.location.search).get("share_token");if(p){A(!0),B(p),R(!1);return}if(localStorage.getItem("map_token"))try{const oe=await g.getMe();r(oe)}catch{localStorage.removeItem("map_token")}R(!1)})()},[]);const q=async(n,m)=>{$(null);try{await g.login(n,m);const p=await g.getMe();r(p),await w()}catch(p){throw $(p.message||"Login failed"),p}},te=()=>{g.logout(),r(null),c([]),u(null),f([]),b([])},J=async n=>{await g.createList(n),await w()},X=async n=>{await g.reorderLists(n),await w()},se=async n=>{await g.deleteList(n),i?.id===n&&(u(null),localStorage.removeItem("map_current_list_id")),await w()},Z=async(n,m)=>{await g.createGroup(n,m,i?.id||void 0),await w()},Y=async(n,m)=>{await g.updateGroup(n,m),await w()},G=async n=>{await g.deleteGroup(n),await w()},re=async(n,m,p,M)=>{await g.createItem(n,m,p,M),await w()},le=async(n,m)=>{await g.updateItem(n,m),await w()},Q=async n=>{await g.deleteItem(n),await w()},I=async n=>{await g.reorderGroups(n),await w()},ee=async n=>{await g.reorderItems(n),await w()},O=async()=>{await g.exportData()},ae=async n=>{await g.importData(n),await w()};return React.useEffect(()=>{(async()=>{if(localStorage.getItem("map_token"))try{const p=await g.getMe();r(p)}catch{localStorage.removeItem("map_token")}R(!1)})()},[]),e.jsx(we.Provider,{value:{user:s,lists:l,currentList:i,setCurrentList:F,groups:y,items:j,selectedItem:E,setSelectedItem:_,shouldFocusItem:D,isLoading:H,isReadOnly:z,shareToken:U,error:W,login:q,logout:te,refreshData:w,createList:J,reorderLists:X,deleteList:se,createGroup:Z,updateGroup:Y,deleteGroup:G,createItem:re,updateItem:le,deleteItem:Q,reorderGroups:I,reorderItems:ee,exportData:O,importData:ae,mobileView:K,setMobileView:V},children:t})},P=()=>{const t=React.useContext(we);if(t===void 0)throw new Error("useMap must be used within a MapProvider");return t},Ke=()=>{const{login:t,error:s}=P(),[r,l]=React.useState(""),[c,i]=React.useState(""),[u,y]=React.useState(!1),f=async j=>{j.preventDefault(),y(!0);try{await t(r,c)}catch{}finally{y(!1)}};return e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 shadow-md",children:[e.jsx("h2",{className:"mb-6 text-center text-2xl font-bold",children:"Maps Login"}),s&&e.jsx("div",{className:"mb-4 text-center text-sm text-red-500",children:s}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email","data-testid":"login-email",autoComplete:"email",className:"w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:outline-none",value:r,onChange:j=>l(j.target.value),required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Password"}),e.jsx("input",{type:"password",placeholder:"Password","data-testid":"login-password",autoComplete:"current-password",className:"w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:outline-none",value:c,onChange:j=>i(j.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full rounded-md bg-blue-600 p-2 text-white hover:bg-blue-700 disabled:bg-blue-300",children:u?"Logging in...":"Login"})]})]})})},ye={"red-500":"#ef4444","orange-500":"#f97316","amber-500":"#f59e0b","yellow-500":"#eab308","lime-500":"#84cc16","green-500":"#22c55e","emerald-500":"#10b981","teal-500":"#14b8a6","cyan-500":"#06b6d4","sky-500":"#0ea5e9","blue-500":"#3b82f6","indigo-500":"#6366f1","violet-500":"#8b5cf6","purple-500":"#a855f7","fuchsia-500":"#d946ef","pink-500":"#ec4899","rose-500":"#f43f5e","slate-500":"#64748b","gray-500":"#6b7280","zinc-500":"#71717a","neutral-500":"#737373","stone-500":"#78716c","red-600":"#dc2626","orange-600":"#ea580c","amber-600":"#d97706","yellow-600":"#ca8a04","lime-600":"#65a30d","green-600":"#16a34a","emerald-600":"#059669","teal-600":"#0d9488","cyan-600":"#0891b2","sky-600":"#0284c7","blue-600":"#2563eb","indigo-600":"#4f46e5","violet-600":"#7c3aed","purple-600":"#9333ea","fuchsia-600":"#c026d3","pink-600":"#db2777","rose-600":"#e11d48","slate-600":"#475569","gray-600":"#4b5563","zinc-600":"#52525b","neutral-600":"#525252","stone-600":"#57534e","red-400":"#f87171","orange-400":"#fb923c","amber-400":"#fbbf24","yellow-400":"#facc15","lime-400":"#a3e635","green-400":"#4ade80","emerald-400":"#34d399","teal-400":"#2dd4bf","cyan-400":"#22d3ee","sky-400":"#38bdf8","blue-400":"#60a5fa","indigo-400":"#818cf8","violet-400":"#a78bfa","purple-400":"#c084fc","fuchsia-400":"#e879f9","pink-400":"#f472b6","rose-400":"#fb7185","slate-400":"#94a3b8","gray-400":"#9ca3af","zinc-400":"#a1a1aa","neutral-400":"#a3a3a3","stone-400":"#a8a29e"},je=t=>ye[t]||t,Xe=()=>{const{groups:t,items:s,currentList:r,selectedItem:l,setSelectedItem:c,createGroup:i,updateGroup:u,deleteGroup:y,createItem:f,updateItem:j,deleteItem:b,reorderGroups:E,reorderItems:h,exportData:D,importData:T,logout:H,isReadOnly:R}=P(),[z,A]=React.useState(!1),[U,B]=React.useState(!1),[W,$]=React.useState(""),[K,V]=React.useState("blue-500"),[_,F]=React.useState(null),[w,q]=React.useState(""),[te,J]=React.useState(""),[X,se]=React.useState(""),[Z,Y]=React.useState(null),[G,re]=React.useState(null),[le,Q]=React.useState(null),[I,ee]=React.useState(s),[O,ae]=React.useState(null),[n,m]=React.useState(null),[p,M]=React.useState(t);React.useEffect(()=>{ee(s)},[s]),React.useEffect(()=>{M(t)},[t]);const oe=a=>{re(a)},ve=(a,o)=>{if(a.preventDefault(),G===null||G===o)return;const d=I.findIndex(ie=>ie.id===G),S=I.findIndex(ie=>ie.id===o);if(d===-1||S===-1)return;const v={...I[d]},C=I[S];v.group_id!==C.group_id&&(v.group_id=C.group_id);const k=[...I];k.splice(d,1),k.splice(S,0,v),ee(k)},pe=async()=>{G!==null&&(re(null),Q(null),await h(I.map(a=>({id:a.id,group_id:a.group_id}))))},Ne=a=>{ae(a)},Se=(a,o)=>{if(a.preventDefault(),O===null||O===o)return;const d=p.findIndex(k=>k.id===O),S=p.findIndex(k=>k.id===o);if(d===-1||S===-1)return;const v=[...p],[C]=v.splice(d,1);v.splice(S,0,C),M(v)},Ie=async()=>{O!==null&&(ae(null),m(null),await E(p.map(a=>a.id)))},ke=async a=>{a.preventDefault(),_?await u(_.id,{name:W,color:K}):await i(W,K),$(""),V("blue-500"),F(null),A(!1)},Ce=a=>{const o=a.trim();if(o.startsWith("http")){const d=o.match(/!3d(-?\d+(?:\.\d+)?)/),S=o.match(/!4d(-?\d+(?:\.\d+)?)/);if(d&&S){const C=parseFloat(d[1]),k=parseFloat(S[1]);if(!isNaN(C)&&!isNaN(k))return{lat:C,lng:k}}const v=o.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);if(v){const C=parseFloat(v[1]),k=parseFloat(v[2]);if(!isNaN(C)&&!isNaN(k))return{lat:C,lng:k}}}else{const d=o.split(/[\s,]+/);if(d.length>=2){const S=parseFloat(d[0]),v=parseFloat(d[1]);if(!isNaN(S)&&!isNaN(v))return{lat:S,lng:v}}}return null},Le=async a=>{a.preventDefault();const o=Ce(te);if(!o){alert("Invalid coordinates format. Please use 'lat, lng' or a Google Maps link.");return}Z?await j(Z.id,{group_id:Number(X),name:w,latitude:o.lat,longitude:o.lng}):await f(Number(X),w,o.lat,o.lng),q(""),J(""),Y(null),B(!1)},Ee=async a=>{const o=a.target.files?.[0];if(o){const d=await o.text();await T(d)}};return e.jsxs("div",{className:"flex h-full flex-col overflow-y-auto bg-white p-4",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-bold",children:"Locations"})}),e.jsxs("div",{className:"mb-8 flex-1 space-y-4",children:[p.length===0&&e.jsxs("div",{className:"py-10 text-center text-gray-500",children:[e.jsx("p",{children:"No groups yet."}),e.jsx("p",{className:"text-sm",children:"Create a group to start adding points."})]}),p.map(a=>e.jsxs("div",{"data-testid":`group-container-${a.id}`,draggable:!R&&n===a.id,onDragStart:()=>Ne(a.id),onDragOver:o=>{O!==null&&Se(o,a.id)},onDragEnd:Ie,className:`rounded-lg border border-gray-100 bg-gray-50/30 p-4 shadow-sm transition-all hover:shadow-md ${O===a.id?"opacity-30":""}`,children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-3 h-3 w-3 rounded-full shadow-sm ring-2 ring-white",style:{backgroundColor:je(a.color)}}),e.jsx("h3",{className:"font-bold text-gray-800",children:a.name})]}),e.jsxs("div",{className:"ml-4 flex flex-1 items-center justify-between gap-2",children:[e.jsxs("span",{className:"rounded-full border bg-white px-2 py-0.5 text-xs font-medium text-gray-400",children:[I.filter(o=>o.group_id===a.id).length," items"]}),!R&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),$(a.name),V(a.color),F(a),A(!0)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Edit Group",children:e.jsx(ge,{size:14})}),e.jsx("div",{"data-testid":`group-grip-${a.id}`,className:"cursor-grab p-0.5 text-gray-400 transition-colors hover:text-gray-600 active:cursor-grabbing",onMouseDown:()=>m(a.id),onMouseUp:()=>m(null),children:e.jsx(xe,{size:14})})]})]})]}),e.jsx("ul",{"data-testid":`group-items-${a.id}`,className:"min-h-[20px] space-y-2 pl-6",onDragOver:o=>{o.preventDefault()},onDrop:o=>{if(o.preventDefault(),G===null)return;const d=I.findIndex(C=>C.id===G);if(d===-1)return;const S=I[d];if(S.group_id===a.id)return;const v=[...I];v[d]={...S,group_id:a.id},ee(v),pe()},children:I.filter(o=>o.group_id===a.id).map(o=>e.jsxs("li",{"data-testid":`item-${o.id}`,onClick:()=>c(o),draggable:!R&&le===o.id,onDragStart:d=>{d.stopPropagation(),oe(o.id)},onDragOver:d=>{d.stopPropagation(),ve(d,o.id)},onDragEnd:pe,className:`group/item flex cursor-pointer items-center justify-between rounded-md p-1.5 text-sm transition-colors hover:bg-white/50 ${l?.id===o.id?"bg-blue-50 shadow-sm ring-1 ring-blue-200":"text-gray-600"} ${G===o.id?"opacity-30":""}`,children:[e.jsx("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:e.jsx("div",{className:`truncate font-medium ${l?.id===o.id?"text-blue-600":""}`,children:o.name})}),!R&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),c(o),q(o.name),se(String(o.group_id)),J(`${o.latitude}, ${o.longitude}`),Y(o),B(!0)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Edit",children:e.jsx(ge,{size:14})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),b(o.id)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-red-50 hover:text-red-500",children:e.jsx(de,{size:14})}),e.jsx("div",{"data-testid":`item-grip-${o.id}`,className:"cursor-grab p-0.5 text-gray-400 transition-colors hover:text-gray-600 active:cursor-grabbing",onMouseDown:()=>Q(o.id),onMouseUp:()=>Q(null),children:e.jsx(xe,{size:14})})]})]},o.id))})]},a.id))]}),!R&&e.jsxs("div",{className:"mt-auto space-y-3 border-t pt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{"data-testid":"add-group-button",onClick:()=>{F(null),$(""),V("blue-500"),A(!0)},className:"flex items-center justify-center gap-2 rounded-lg border border-blue-100 bg-blue-50/50 p-2.5 text-sm font-semibold text-blue-700 transition-colors hover:bg-blue-50",children:[e.jsx(ue,{size:16}),"Group"]}),e.jsxs("button",{"data-testid":"add-point-button",onClick:()=>B(!0),className:"flex items-center justify-center gap-2 rounded-lg border border-green-100 bg-green-50/50 p-2.5 text-sm font-semibold text-green-700 transition-colors hover:bg-green-50",children:[e.jsx(ue,{size:16}),"Point"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:D,className:"flex flex-1 items-center justify-center gap-1.5 rounded-lg border border-gray-100 bg-gray-50 p-2 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100",children:[e.jsx(Ge,{size:14}),"Export"]}),e.jsxs("label",{className:"flex flex-1 cursor-pointer items-center justify-center gap-1.5 rounded-lg border border-gray-100 bg-gray-50 p-2 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100",children:[e.jsx(Me,{size:14}),"Import",e.jsx("input",{type:"file",className:"hidden",accept:".yaml,.yml",onChange:Ee})]})]})]}),z&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-sm rounded-lg bg-white p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:_?"Edit Group":"Add Group"}),_&&e.jsx("button",{onClick:async()=>{confirm("Delete this group and all its items?")&&(await y(_.id),A(!1),F(null))},className:"rounded-lg p-1 text-gray-400 hover:bg-red-50 hover:text-red-500",title:"Delete Group",children:e.jsx(de,{size:18})})]}),e.jsxs("form",{onSubmit:ke,children:[e.jsx("input",{className:"mb-4 w-full rounded border p-2",placeholder:"Group Name",value:W,onChange:a=>$(a.target.value),required:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:"Select Color"}),e.jsx("div",{className:"grid max-h-48 grid-cols-6 gap-2 overflow-y-auto rounded border p-2",children:Object.entries(ye).map(([a,o])=>e.jsx("button",{type:"button",title:a,onClick:()=>V(a),className:`h-8 w-8 rounded-full border-2 transition-all ${K===a?"scale-110 border-black shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:o}},a))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{A(!1),F(null)},className:"flex-1 rounded border p-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 rounded bg-blue-600 p-2 text-white",children:_?"Save":"Add"})]})]})]})}),U&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-sm rounded-lg bg-white p-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-bold",children:Z?"Edit Item":"Add Item"}),e.jsxs("form",{onSubmit:Le,children:[e.jsx("label",{htmlFor:"group-select",className:"mb-1 block text-xs font-medium text-gray-500",children:"Group"}),e.jsxs("select",{id:"group-select",className:"mb-4 w-full rounded border p-2",value:X,onChange:a=>se(a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Group"}),t.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx("input",{className:"mb-4 w-full rounded border p-2",placeholder:"Item Name",value:w,onChange:a=>q(a.target.value),required:!0}),e.jsx("input",{type:"text",className:"mb-4 w-full rounded border p-2",placeholder:"Coordinates (lat, lng) or Google Maps URL",value:te,onChange:a=>J(a.target.value),required:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{B(!1),Y(null),q(""),J("")},className:"flex-1 rounded border p-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 rounded bg-blue-600 p-2 text-white",children:Z?"Save":"Add"})]})]})]})})]})},he=13,Ye=[51.505,-.09],Qe=3,fe={duration:.5},et=()=>{const t=be(),{items:s,setSelectedItem:r}=P();return React.useEffect(()=>{const l=new L.Control({position:"topleft"});return l.onAdd=()=>{const c=L.DomUtil.create("div","leaflet-bar leaflet-control"),i=L.DomUtil.create("a","leaflet-control-reset",c);return i.innerHTML='<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display: block;"><path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8M3 16.2V21m0 0h4.8M3 21l6-6M21 7.8V3m0 0h-4.8M21 3l-6 6M3 7.8V3m0 0h4.8M3 3l6 6"/></svg>',i.href="#",i.title="Reset View",i.style.backgroundColor="white",i.style.cursor="pointer",i.style.width="30px",i.style.height="30px",i.style.lineHeight="30px",L.DomEvent.on(i,"click",u=>{if(L.DomEvent.stop(u),r(null),s.length>0){const y=L.latLngBounds(s.map(f=>[f.latitude,f.longitude]));t.flyToBounds(y,{padding:[50,50],maxZoom:he})}else t.flyTo(Ye,Qe)}),c},t.addControl(l),()=>{t.removeControl(l)}},[t,s,r]),null},tt=()=>{const t=be(),{items:s,selectedItem:r,shouldFocusItem:l,currentList:c}=P(),i=React.useRef(null),u=React.useRef(null),y=React.useRef(!1);return React.useEffect(()=>{const f=t.getContainer();if(f.clientWidth===0||f.clientHeight===0)return;const j=r?.id??null,b=c?.id??null;u.current!==b&&(y.current=!1,u.current=b);const h=i.current!==j;if(s.length>0&&(!y.current||h)){if(r&&(l||!y.current))t.flyTo([r.latitude,r.longitude],he,fe);else if(s.length>0&&!r){const T=L.latLngBounds(s.map(H=>[H.latitude,H.longitude]));t.flyToBounds(T,{padding:[50,50],maxZoom:he,...fe})}i.current=j,y.current=!0}},[s,r,l,c,t]),null},st=()=>e.jsxs(ne,{position:"topright",children:[e.jsx(ne.BaseLayer,{checked:!0,name:"Map",children:e.jsx(ce,{attribution:"Esri, HERE, Garmin, Intermap, increment P Corp., GEBCO, USGS, FAO, NPS, NRCAN, GeoBase, IGN, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), (c) OpenStreetMap contributors, and the GIS User Community",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",maxZoom:19})}),e.jsx(ne.BaseLayer,{name:"3D Terrain",children:e.jsx(ce,{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20})}),e.jsx(ne.BaseLayer,{name:"Satellite",children:e.jsx(ce,{attribution:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})})]}),rt=(t,s,r)=>{const l=je(s),c=r?"bg-blue-600 text-white border-white":"bg-white text-gray-900",i=r?"bg-blue-600 border-white":"bg-white",u=r?"white":l;return new L.DivIcon({className:"custom-div-icon",html:`
      <div class="flex items-center justify-center transition-all duration-300 ${r?"scale-125 z-50":"hover:scale-110"}">
        <div class="px-2 py-1 rounded-lg font-black text-xs shadow-lg border-2 whitespace-nowrap ${c}" style="border-color: ${u}">
          ${t}
        </div>
        <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45 border-r-2 border-b-2 ${i}" style="border-color: ${u}"></div>
      </div>
    `,iconSize:[100,30],iconAnchor:[50,30]})},at=()=>{const{items:t,selectedItem:s,setSelectedItem:r}=P();return e.jsx("div",{className:"h-full w-full",children:e.jsxs(Oe,{center:[51.505,-.09],zoom:3,style:{height:"100%",width:"100%"},className:"z-0",zoomControl:!1,attributionControl:!1,zoomSnap:0,children:[e.jsx(st,{}),e.jsx(He,{position:"topleft"}),e.jsx(et,{}),e.jsx(tt,{}),t.map(l=>{const c=s?.id===l.id;return e.jsx(Pe,{position:[l.latitude,l.longitude],icon:rt(l.name,l.group_color||"#3b82f6",c),zIndexOffset:c?1e3:0,eventHandlers:{click:()=>r(l,!1)},children:e.jsx(Te,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:l.name}),e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center text-blue-600 hover:text-blue-800 transition-colors",title:"Open in Google Maps",children:e.jsx(me,{className:"size-4"})})]})})},l.id)})]})})},ot=({onClose:t})=>{const{lists:s,createList:r,deleteList:l}=P(),{successToast:c}=De(),[i,u]=React.useState(""),[y,f]=React.useState(null),j=async h=>{h.preventDefault(),i.trim()&&(await r(i),u(""))},b=async(h,D)=>{window.confirm(`Are you sure you want to delete "${D}" and all its groups/points?`)&&await l(h)},E=(h,D)=>{const T=`${window.location.origin}${window.location.pathname}?share_token=${h}`;navigator.clipboard.writeText(T),f(D),c("Share link copied to clipboard!"),setTimeout(()=>f(null),2e3)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex w-full max-w-md flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Manage Lists"}),e.jsx("button",{onClick:t,className:"rounded-lg p-1 hover:bg-gray-100",children:e.jsx(Fe,{className:"h-5 w-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("form",{onSubmit:j,className:"mb-6 flex gap-2",children:[e.jsx("input",{autoFocus:!0,className:"flex-1 rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:outline-none",placeholder:"New list name...",value:i,onChange:h=>u(h.target.value)}),e.jsx("button",{type:"submit",className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200 transition-all hover:bg-blue-700",children:e.jsx(ue,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Your Lists"}),s.length===0&&e.jsx("p",{className:"py-4 text-center text-sm text-gray-500",children:"No lists created yet."}),s.map(h=>e.jsxs("div",{className:"group flex items-center justify-between rounded-xl border border-gray-100 bg-gray-50 p-3 transition-all hover:border-gray-200 hover:bg-white hover:shadow-sm",children:[e.jsx("span",{className:"font-bold text-gray-700",children:h.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>E(h.share_token,h.id),className:`rounded-lg p-1.5 transition-all ${y===h.id?"bg-green-100 text-green-600":"text-gray-400 hover:bg-blue-50 hover:text-blue-600"}`,title:"Copy Share Link",children:y===h.id?e.jsx(ze,{className:"h-4 w-4"}):e.jsx(Ze,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>b(h.id,h.name),className:"rounded-lg p-1.5 text-gray-400 hover:bg-red-50 hover:text-red-500",children:e.jsx(de,{className:"h-4 w-4"})})]})]},h.id))]})]}),e.jsx("div",{className:"border-t p-4",children:e.jsx("button",{onClick:t,className:"w-full rounded-xl bg-gray-100 py-2.5 text-sm font-bold text-gray-600 transition-all hover:bg-gray-200",children:"Done"})})]})})},nt=()=>{const{user:t,lists:s,currentList:r,setCurrentList:l,logout:c,isReadOnly:i,mobileView:u,setMobileView:y}=P(),[f,j]=React.useState(!1);return e.jsxs("header",{className:"z-30 flex flex-col justify-between gap-4 border-b border-gray-200 bg-white px-4 py-3 shadow-sm md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg",children:e.jsx(me,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-extrabold tracking-tight text-gray-900",children:"Maps"}),e.jsx("p",{className:"text-xs font-medium tracking-wider text-gray-500 uppercase",children:r?.name||"No list selected"})]})]}),e.jsxs("div",{className:"flex flex-1 items-center justify-between gap-2",children:[i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"rounded-full bg-blue-50 px-3 py-1 text-xs font-bold text-blue-600 uppercase",children:"Shared List"}),e.jsx("button",{onClick:()=>{window.location.href=window.location.pathname},className:"text-sm font-bold text-gray-500 hover:text-blue-600 hover:underline",children:"Back to My Maps"})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"list-select",className:"ml-2 hidden text-xs font-black tracking-tight text-gray-400 uppercase md:block",children:"List"}),e.jsxs("div",{className:"group relative",children:[e.jsxs("select",{id:"list-select",value:r?.id||"",onChange:b=>{const E=s.find(h=>h.id===Number(b.target.value));E&&l(E)},className:"relative cursor-pointer appearance-none rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 pr-10 text-sm font-bold text-blue-600 transition-all focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:[s.length===0&&e.jsx("option",{value:"",children:"No lists"}),s.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]}),e.jsx("div",{className:"pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-blue-600",children:e.jsx(Ae,{className:"h-4 w-4"})})]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex h-9 items-center justify-center gap-2 rounded-xl bg-gray-100 px-2 text-gray-600 transition-all hover:bg-gray-200 md:px-3",title:"Manage Lists",children:[e.jsx(Be,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden text-sm font-semibold md:block",children:"Settings"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsx("span",{className:"hidden text-sm font-semibold text-gray-600 md:block",children:t?.first_name}),e.jsx("button",{onClick:c,className:"flex h-9 w-9 items-center justify-center rounded-xl text-gray-500 transition-colors hover:bg-red-50 hover:text-red-500",title:"Logout",children:e.jsx(Ve,{className:"h-5 w-5"})})]})]}),e.jsx("button",{onClick:()=>y(u==="map"?"list":"map"),className:"flex h-9 items-center justify-center gap-2 rounded-xl bg-blue-600 px-3 text-white transition-all hover:bg-blue-700 md:hidden",title:u==="map"?"Show List":"Show Map",children:u==="map"?e.jsx(qe,{className:"h-5 w-5"}):e.jsx(me,{className:"h-5 w-5"})})]}),f&&e.jsx(ot,{onClose:()=>j(!1)})]})},lt=()=>{const{user:t,isLoading:s,mobileView:r}=P();return s?e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Loading..."}):t?e.jsxs("div",{className:"flex h-screen w-full flex-col overflow-hidden bg-gray-50",children:[e.jsx(nt,{}),e.jsxs("main",{className:"relative flex flex-1 flex-col overflow-hidden md:flex-row",children:[e.jsx("div",{className:`h-full border-r border-gray-200 bg-white md:w-1/3 ${r==="list"?"block":"hidden md:block"}`,children:e.jsx(Xe,{})}),e.jsx("div",{className:`relative h-full overflow-hidden md:w-2/3 ${r==="map"?"block":"hidden md:block"}`,children:e.jsx(at,{})})]})]}):e.jsx(Ke,{})};function it(){return e.jsx($e,{children:e.jsx(We,{children:e.jsx(lt,{})})})}ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(it,{})}));
