import"./modulepreload-polyfill-B5Qt9EMX.js";import{r as l,j as e,R as Fe,a as $e}from"./client-BsyqJ1xH.js";import{B as j}from"./button-BZSrPANe.js";const Ae=a=>a.toISOString().split("T")[0],ue=()=>{const a=Ae(new Date);return{name:"",description:"",startDate:a,dueDate:a,category:"",isCompleted:!1}},$=a=>{const i=a.slice(0,10),[c,g,N]=i.split("-"),D=Number(c),E=Number(g),T=Number(N);if([D,E,T].some(x=>Number.isNaN(x))){const x=new Date(a);return x.setHours(0,0,0,0),x}return new Date(D,E-1,T)},J=()=>{const a=new Date;return a.setHours(0,0,0,0),a},Oe=1440*60*1e3,Ue=a=>({name:a.name,description:a.description,startDate:a.start_date,dueDate:a.due_date,category:a.category,isCompleted:a.is_completed}),Be=()=>"https://api8016.solfegeai.com",Le=()=>Be().replace(/\/+$/,""),v=`${Le()}/tasks`,he="NONE",me=a=>{const i=$(a);return Number.isNaN(i.valueOf())?a:new Intl.DateTimeFormat(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(i)},ge=(a,i=!1)=>{if(i)return!1;const c=J(),g=$(a);return g.setHours(0,0,0,0),g<c},Me=a=>{const i=$(a);if(Number.isNaN(i.valueOf()))return 0;i.setHours(0,0,0,0);const c=J();return Math.round((i.getTime()-c.getTime())/Oe)},Ie=a=>a>0?`+${a}d`:`${a}d`,_e=a=>a.trim().toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,""),V=a=>{const i=J(),c=$(a);return c.setHours(0,0,0,0),c.getTime()<=i.getTime()},K=a=>a.is_completed?{label:"Completed",modifier:"todo-status--completed"}:V(a.start_date)?{label:"Active",modifier:"todo-status--active"}:{label:"Blocked",modifier:"todo-status--blocked"},Pe=()=>{const[a,i]=l.useState([]),[c,g]=l.useState(ue),[N,D]=l.useState(!0),[E,T]=l.useState(null),[x,W]=l.useState(!1),[Y,p]=l.useState(null),[Z,fe]=l.useState(null),[h,F]=l.useState([]),[_,z]=l.useState(null),[A,be]=l.useState(!1),[O,ye]=l.useState(!1),[f,xe]=l.useState({key:"due_date",direction:"asc"}),[U,H]=l.useState(()=>new Set),[B,Q]=l.useState(!1),[X,L]=l.useState(null),[k,ee]=l.useState(!1),[S,te]=l.useState({label:"",slug:""}),[se,ae]=l.useState(!1),[oe,le]=l.useState(!1),[re,b]=l.useState(null),q=l.useMemo(()=>{const t=a.filter(o=>!o.is_completed),s=t.filter(o=>ge(o.due_date,o.is_completed)).length,n=t.filter(o=>V(o.start_date)).length,r=t.filter(o=>!V(o.start_date)).length;return{overdue:s,ready:n,blocked:r,total:a.length}},[a]),ne=l.useMemo(()=>a.filter(t=>{const s=K(t).label;return!(!A&&s==="Blocked"||!O&&s==="Completed")}),[a,A,O]),M=l.useCallback(async()=>{D(!0),T(null);try{const t=await fetch(`${v}/?limit=100`);if(!t.ok)throw new Error("Unable to load tasks");const n=(await t.json()).map(r=>({...r,category:r.category??"",is_completed:!!r.is_completed}));i(n),fe(new Date)}catch(t){const s=t instanceof Error?t.message:"Unknown error";T(s)}finally{D(!1)}},[]);l.useEffect(()=>{M()},[M]);const ce=l.useCallback(async()=>{try{const t=await fetch(`${v}/categories`);if(!t.ok)throw new Error("Unable to load categories");const s=await t.json();F(s)}catch{F([])}},[]);l.useEffect(()=>{ce()},[ce]),l.useEffect(()=>{H(t=>{if(t.size===0)return t;const s=new Set(a.map(o=>o.id));let n=!1;const r=new Set;return t.forEach(o=>{s.has(o)?r.add(o):n=!0}),n?r:t})},[a]);const G=l.useCallback(()=>{const t=ue(),s=h[0]?.value;return s?{...t,category:s}:t},[h]);l.useEffect(()=>{h.length!==0&&g(t=>t.category&&h.some(s=>s.value===t.category)?t:{...t,category:h[0].value})},[h]);const I=l.useMemo(()=>h.reduce((t,s)=>(t[s.value]=s.label,t),{}),[h]),je=l.useMemo(()=>{const t=[...ne],s=o=>{const u=$(o).getTime();return Number.isNaN(u)?0:u},n={Blocked:0,Active:1,Completed:2},r=o=>{switch(f.key){case"start_date":return s(o.start_date);case"due_date":return s(o.due_date);case"status":return n[K(o).label]??0;case"category":default:return(I[o.category]??o.category??"").toLowerCase()}};return t.sort((o,u)=>{const d=r(o),m=r(u);if(typeof d=="number"&&typeof m=="number")return d===m?o.id-u.id:f.direction==="asc"?d-m:m-d;const y=d.toString(),w=m.toString();return y===w?o.id-u.id:f.direction==="asc"?y.localeCompare(w,void 0,{sensitivity:"base"}):w.localeCompare(y,void 0,{sensitivity:"base"})})},[I,f,ne]),C=(t,s)=>{g(n=>({...n,[t]:s}))},ve=async t=>{t.preventDefault(),p(null);const s=c.name.trim(),n=c.description.trim();if(!s){p("Please provide a name.");return}if(!c.category){p("Select a category for this task.");return}if(c.startDate>c.dueDate){p("Start date must be on or before the due date.");return}const r=_!==null,o=r?`${v}/${_}`:`${v}/`,u=r?"PUT":"POST";W(!0);try{const d=await fetch(o,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,description:n,start_date:c.startDate,due_date:c.dueDate,category:c.category,is_completed:c.isCompleted})});if(!d.ok)throw new Error("Failed to save the task");const m=await d.json();i(y=>r?y.map(w=>w.id===m.id?m:w):[m,...y]),g(G()),z(null),p(r?"Task updated":"Task saved")}catch(d){const m=d instanceof Error?d.message:"Unexpected error";p(m)}finally{W(!1)}},de=l.useCallback(t=>{g(Ue(t)),z(t.id),p(null)},[]),Ne=l.useCallback(()=>{g(G()),z(null),p(null)},[G]),ke=t=>{xe(s=>s.key===t?{key:t,direction:s.direction==="asc"?"desc":"asc"}:{key:t,direction:"asc"})},P=t=>f.key!==t?"none":f.direction==="asc"?"ascending":"descending",R=(t,s)=>{const n=f.key===t?f.direction:null,r=n?`Sort by ${s} (${n==="asc"?"ascending":"descending"})`:`Sort by ${s}`;return e.jsxs("button",{type:"button",className:"todo-table__sort",onClick:()=>ke(t),"aria-label":r,children:[e.jsx("span",{children:s}),e.jsx("span",{className:"todo-table__sort-icon","aria-hidden":"true",children:n?n==="asc"?"↑":"↓":"↕"})]})},Se=l.useCallback((t,s)=>{H(n=>{const r=new Set(n);return s?r.add(t):r.delete(t),r})},[]),Ce=l.useCallback(async()=>{const t=Array.from(U);if(t.length===0||B){L(t.length===0?"Select at least one task to delete.":null);return}Q(!0),L(null);const s=new Set(t);try{await Promise.all(t.map(async n=>{if(!(await fetch(`${v}/${n}`,{method:"DELETE"})).ok)throw new Error("Unable to delete selected tasks.")})),i(n=>n.filter(r=>!s.has(r.id))),H(new Set),L(t.length===1?"Deleted 1 task.":`Deleted ${t.length} tasks.`)}catch(n){const r=n instanceof Error?n.message:"Failed to delete selected tasks.";L(r)}finally{Q(!1)}},[B,U]),we=(t,s)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),de(s))},De=U.size,ie=l.useCallback((t,s)=>{te(n=>t==="label"&&!se?{label:s,slug:_e(s)}:{...n,[t]:s}),t==="slug"&&ae(!0),b(null)},[se]),Ee=l.useCallback(async t=>{t.preventDefault();const s=S.label.trim(),n=S.slug||s,r=_e(n);if(!s||!r){b("Provide both a label and a slug.");return}if(h.some(o=>o.value===r)){b("That slug already exists.");return}le(!0),b(null);try{const o=await fetch(`${v}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:r,label:s})});if(!o.ok)throw new Error("Unable to add category.");const u=await o.json();F(d=>[...d,u].sort((m,y)=>m.label.localeCompare(y.label))),te({label:"",slug:""}),ae(!1),b("Category added.")}catch(o){const u=o instanceof Error?o.message:"Failed to add category.";b(u)}finally{le(!1)}},[S.label,S.slug,h]),Te=l.useCallback(async t=>{if(!(!t||t===he))try{if(!(await fetch(`${v}/categories/${t}`,{method:"DELETE"})).ok)throw new Error("Unable to delete category.");F(n=>n.filter(r=>r.value!==t)),b("Category removed.")}catch(s){const n=s instanceof Error?s.message:"Failed to delete category.";b(n)}},[F]);return e.jsxs("div",{className:"todo-app",children:[e.jsxs("nav",{className:"todo-nav","aria-label":"Primary navigation",children:[e.jsx("div",{className:"todo-nav__logo",children:"To Do list"}),e.jsxs("ul",{className:"todo-nav__menu",children:[e.jsx("li",{className:"todo-nav__item",children:e.jsx("button",{type:"button",className:`todo-nav__link todo-nav__link--button${k?"":" todo-nav__link--active"}`,"aria-pressed":!k,onClick:()=>ee(!1),children:"Tasks"})}),e.jsx("li",{className:"todo-nav__item",children:e.jsx("button",{type:"button",className:`todo-nav__link todo-nav__link--button${k?" todo-nav__link--active":""}`,"aria-pressed":k,onClick:()=>ee(t=>!t),children:"Manage categories"})})]})]}),k?e.jsx("section",{className:"todo-categories","aria-label":"Category manager",children:e.jsxs("div",{className:"todo-categories__panel",children:[e.jsx("div",{children:e.jsx("h3",{children:"Manage categories"})}),e.jsxs("form",{className:"todo-categories__form",onSubmit:Ee,children:[e.jsxs("label",{className:"todo-categories__field",children:[e.jsx("span",{children:"Category label"}),e.jsx("input",{type:"text",value:S.label,onChange:t=>ie("label",t.target.value),placeholder:"can include spaces",required:!0})]}),e.jsxs("label",{className:"todo-categories__field",children:[e.jsx("span",{children:"Category slug"}),e.jsx("input",{type:"text",value:S.slug,onChange:t=>ie("slug",t.target.value),placeholder:"DESIGN",required:!0})]}),e.jsx(j,{type:"submit",className:"todo-button todo-button--primary",disabled:oe,children:oe?"Adding…":"Add category"})]}),e.jsx("ul",{className:"todo-categories__list",children:h.map(t=>e.jsxs("li",{className:"todo-categories__item",children:[e.jsxs("span",{children:[e.jsx("strong",{children:t.label})," ",e.jsx("small",{children:t.value})]}),e.jsx(j,{type:"button",variant:"outline",className:"todo-button todo-button--danger-solid",onClick:()=>void Te(t.value),disabled:t.value===he,children:"Delete"})]},t.value))}),re?e.jsx("p",{className:"todo-categories__feedback",children:re}):null]})}):null,k?null:e.jsx(e.Fragment,{children:e.jsxs("main",{className:"todo-app__layout",children:[e.jsxs("section",{className:"todo-form","aria-labelledby":"todo-form-title",children:[e.jsxs("div",{className:"todo-form__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"todo-form__eyebrow",children:_?"Edit":"Create"}),e.jsx("h2",{id:"todo-form-title",children:_?"Update task":"New task"})]}),e.jsx("div",{className:"todo-form__header-actions",children:e.jsx(j,{type:"button",variant:"outline",className:"todo-button todo-button--outline",onClick:()=>void M(),disabled:N,children:N?"Syncing…":"Refresh"})})]}),_?e.jsxs("p",{className:"todo-form__notice",children:["Editing task #",_]}):null,e.jsxs("form",{className:"todo-form__body",onSubmit:ve,children:[e.jsxs("label",{className:"todo-form__field",htmlFor:"task-name",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{id:"task-name",type:"text",value:c.name,onChange:t=>C("name",t.target.value),placeholder:"Write the task title",required:!0})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-description",children:[e.jsxs("span",{children:["Description ",e.jsx("span",{className:"todo-form__optional",children:"(optional)"})]}),e.jsx("textarea",{id:"task-description",value:c.description,onChange:t=>C("description",t.target.value),rows:3})]}),e.jsxs("div",{className:"todo-form__grid",children:[e.jsxs("label",{className:"todo-form__field",htmlFor:"task-start",children:[e.jsx("span",{children:"Start date"}),e.jsx("input",{id:"task-start",type:"date",value:c.startDate,onChange:t=>C("startDate",t.target.value)})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-due",children:[e.jsx("span",{children:"Due date"}),e.jsx("input",{id:"task-due",type:"date",value:c.dueDate,onChange:t=>C("dueDate",t.target.value)})]})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-category",children:[e.jsx("span",{children:"Category"}),e.jsx("select",{id:"task-category",value:c.category,onChange:t=>C("category",t.target.value),children:h.length===0?e.jsx("option",{value:c.category,children:I[c.category]??c.category}):h.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"todo-form__field todo-form__field--inline",htmlFor:"task-completed",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Status"}),e.jsx("p",{children:"Is the task complete?"})]}),e.jsx("input",{id:"task-completed",type:"checkbox",checked:c.isCompleted,onChange:t=>C("isCompleted",t.target.checked)})]}),e.jsxs("div",{className:"todo-form__actions",children:[e.jsx(j,{type:"button",variant:"outline",className:"todo-button todo-button--outline",onClick:Ne,children:_?"Cancel edit":"Clear"}),e.jsx(j,{type:"submit",className:"todo-button todo-button--primary",disabled:x,children:x?"Saving…":_?"Save changes":"Save"})]}),Y?e.jsx("p",{className:"todo-form__feedback",children:Y}):null]})]}),e.jsxs("section",{className:"todo-list","aria-live":"polite","aria-busy":N,children:[e.jsx("header",{className:"todo-list__header",children:e.jsxs("div",{className:"todo-list__header-actions",children:[e.jsxs("label",{className:"todo-list__toggle",htmlFor:"toggle-show-blocked",children:[e.jsxs("div",{className:"todo-list__toggle-copy",children:[e.jsx("span",{children:"Show blocked tasks"}),e.jsx("p",{children:"Tasks that cannot be started yet"})]}),e.jsx("input",{id:"toggle-show-blocked",type:"checkbox",role:"switch","aria-checked":A,checked:A,onChange:t=>be(t.target.checked)})]}),e.jsxs("label",{className:"todo-list__toggle",htmlFor:"toggle-show-completed",children:[e.jsxs("div",{className:"todo-list__toggle-copy",children:[e.jsx("span",{children:"Show completed tasks"}),e.jsx("p",{children:"Tasks done"})]}),e.jsx("input",{id:"toggle-show-completed",type:"checkbox",role:"switch","aria-checked":O,checked:O,onChange:t=>ye(t.target.checked)})]}),e.jsxs("dl",{className:"todo-list__stats",children:[e.jsxs("div",{className:"todo-list__stats-item todo-list__stats-item--blocked",children:[e.jsx("dt",{children:"Blocked"}),e.jsx("dd",{children:q.blocked})]}),e.jsxs("div",{className:"todo-list__stats-item todo-list__stats-item--active",children:[e.jsx("dt",{children:"Active"}),e.jsx("dd",{children:q.ready})]}),e.jsxs("div",{className:"todo-list__stats-item todo-list__stats-item--overdue",children:[e.jsx("dt",{children:"Overdue"}),e.jsx("dd",{children:q.overdue})]})]}),e.jsx(j,{type:"button",variant:"outline",className:"todo-button todo-button--danger",onClick:()=>void Ce(),disabled:B||De===0,children:B?"Deleting…":"Delete selected"}),X?e.jsx("p",{className:"todo-list__feedback",role:"status",children:X}):null]})}),N?e.jsx("p",{className:"todo-list__status",children:"Loading tasks…"}):E?e.jsxs("div",{className:"todo-list__status todo-list__status--error",children:[e.jsx("p",{children:E}),e.jsx(j,{type:"button",size:"sm",className:"todo-button todo-button--outline todo-button--compact",onClick:()=>void M(),children:"Try again"})]}):a.length===0?e.jsx("div",{className:"todo-list__status",children:e.jsx("p",{children:"No tasks yet. Save your first task on the left."})}):e.jsx("div",{className:"todo-list__table-wrapper",children:e.jsxs("table",{className:"todo-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"todo-table__select-header",children:"Select"}),e.jsx("th",{scope:"col","aria-sort":P("status"),children:R("status","Status")}),e.jsx("th",{scope:"col",children:"Task"}),e.jsx("th",{scope:"col","aria-sort":P("category"),children:R("category","Category")}),e.jsx("th",{scope:"col",children:"Days left"}),e.jsx("th",{scope:"col","aria-sort":P("start_date"),children:R("start_date","Start date")}),e.jsx("th",{scope:"col","aria-sort":P("due_date"),children:R("due_date","Due date")})]})}),e.jsx("tbody",{children:je.map(t=>{const s=K(t),n=`todo-status${s.modifier?` ${s.modifier}`:""}`,r=Me(t.due_date),o=["todo-table__due-offset"];r<0?o.push("todo-table__due-offset--overdue"):r===0?o.push("todo-table__due-offset--today"):o.push("todo-table__due-offset--upcoming");const u=["todo-table__row"];return ge(t.due_date,t.is_completed)&&u.push("todo-table__row--overdue"),_===t.id&&u.push("todo-table__row--selected"),e.jsxs("tr",{className:u.join(" "),onClick:()=>de(t),onKeyDown:d=>we(d,t),tabIndex:0,children:[e.jsx("td",{className:"todo-table__cell todo-table__cell--select",children:e.jsx("input",{type:"checkbox",className:"todo-table__select-input","aria-label":`Select task ${t.name}`,checked:U.has(t.id),onChange:d=>Se(t.id,d.target.checked),onClick:d=>d.stopPropagation()})}),e.jsx("td",{className:"todo-table__cell todo-table__cell--status",children:e.jsx("span",{className:n,children:s.label})}),e.jsx("td",{className:"todo-table__cell todo-table__task",children:e.jsx("span",{className:"todo-table__task-name",children:t.name})}),e.jsx("td",{className:"todo-table__cell",children:e.jsx("span",{className:"todo-table__chip",children:I[t.category]??(t.category||"Uncategorized")})}),e.jsx("td",{className:"todo-table__cell todo-table__cell--due-offset",children:e.jsx("span",{className:o.join(" "),children:Ie(r)})}),e.jsx("td",{className:"todo-table__cell todo-table__cell--date",children:me(t.start_date)}),e.jsx("td",{className:"todo-table__cell todo-table__cell--date",children:e.jsx("span",{className:"todo-table__date-value",children:me(t.due_date)})})]},t.id)})})]})}),Z?e.jsxs("p",{className:"todo-list__synced",children:["Last synced ",Z.toLocaleTimeString()]}):null]})]})})]})},pe=document.getElementById("root");if(!pe)throw new Error("Root element #root not found");Fe.createRoot(pe).render(e.jsx($e.StrictMode,{children:e.jsx(Pe,{})}));
