import"./index-CBYLtEE8.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as ie}from"./api-CH_Pe6Vg.js";import{B as ne}from"./button-D6DGr86I.js";import"./clsx-B-dksMZM.js";const H=1,W=["free","plus","pro"],O={free:"Free",plus:"Plus",pro:"Pro"},Te=({authMode:t,email:i,password:n,roleSelection:o,showPassword:d,loadingAuth:l,resettingPassword:f,rememberMe:p,authError:r,resetFlash:y,switchAuthMode:u,setEmail:S,setPassword:N,setRoleSelection:c,setShowPassword:h,setRememberMe:m,handleAuthSubmit:j,handlePasswordReset:g})=>e.jsxs("section",{className:"mx-auto grid w-full max-w-[520px] gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-50",children:t==="login"?"Login":"Create account"}),e.jsx("p",{className:"m-0 text-slate-300",children:t==="login"?"Use your email to manage or confirm deliveries.":"Register with your email; new accounts start on a Free membership."})]}),e.jsxs("div",{className:"inline-flex w-fit gap-2 rounded-xl bg-white/5 p-1 text-sm font-semibold",role:"tablist","aria-label":"Authentication mode",children:[e.jsx("button",{type:"button",role:"tab","aria-selected":t==="login",className:t==="login"?"rounded-lg bg-cyan-200/10 px-3 py-2 text-slate-50":"rounded-lg px-3 py-2 text-slate-300 hover:text-slate-50",onClick:()=>u("login"),children:"Login"}),e.jsx("button",{type:"button",role:"tab","aria-selected":t==="register",className:t==="register"?"rounded-lg bg-cyan-200/10 px-3 py-2 text-slate-50":"rounded-lg px-3 py-2 text-slate-300 hover:text-slate-50",onClick:()=>u("register"),children:"Register"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:j,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"email",children:"Email address"}),e.jsx("input",{id:"email",name:"email",type:"email",value:i,onChange:w=>S(w.target.value),placeholder:"you@example.com",className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative grid items-center",children:[e.jsx("input",{id:"password",name:"password",type:d?"text":"password",value:n,onChange:w=>N(w.target.value),className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",required:!0,autoComplete:t==="register"?"new-password":"current-password",minLength:t==="register"?H:void 0}),e.jsx("button",{type:"button",className:"absolute top-1/2 right-2.5 -translate-y-1/2 text-slate-400 transition hover:text-slate-100 focus:outline-none","aria-label":d?"Hide characters":"Show characters","aria-controls":"password","aria-pressed":d,onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseLeave:()=>h(!1),onBlur:()=>h(!1),onTouchStart:()=>h(!0),onTouchEnd:()=>h(!1),onTouchCancel:()=>h(!1),"aria-live":"polite",children:"ðŸ‘"})]})]}),t==="register"&&e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"role",children:"Choose your role"}),e.jsxs("div",{className:"grid gap-1.5",role:"radiogroup","aria-label":"Role",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 font-semibold text-slate-200",children:[e.jsx("input",{type:"radio",name:"role",value:"shop",checked:o==="shop",onChange:()=>c("shop")}),"Shop â€” create deliveries"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 font-semibold text-slate-200",children:[e.jsx("input",{type:"radio",name:"role",value:"driver",checked:o==="driver",onChange:()=>c("driver")}),"Driver â€” confirm deliveries"]})]}),e.jsx("p",{className:"m-0 text-sm text-slate-400",children:"All new accounts start on the Free membership."})]}),r&&e.jsx("div",{className:"dc-alert rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-rose-100","data-testid":"dc-alert",role:"status",children:r}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsx(ne,{className:"min-w-[120px] px-4 py-3",type:"submit",disabled:l,children:l?t==="login"?"Logging in...":"Creating account...":t==="login"?"Login":"Register"})}),t==="login"&&e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-semibold text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:w=>m(w.target.checked)}),"Remember me for 14 days"]}),e.jsx(ne,{variant:"outline",className:"rounded-xl border-slate-400/35 bg-white/5 px-4 py-3 font-bold text-slate-100 hover:border-slate-300/50",type:"button",onClick:g,disabled:f||l,children:f?"Requesting...":"Forgot password?"})]}),y&&e.jsx("div",{className:"dc-alert rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100","data-testid":"dc-alert",role:"status",children:y})]})]}),Oe=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),D=t=>{const i=typeof t=="string"?new Date(t):t;return Oe.format(i)},oe=t=>t==="pending"?"Pending":t==="validated"?"Complete":"Locked",$e=(t,i,n)=>t==="validated"&&i?"Code accepted â€” this delivery is now complete.":t==="locked"?"Maximum attempts reached. Delivery is locked.":i?"Attempt verified.":n===1?"Incorrect code. One attempt left.":`Incorrect code. ${n} attempts left.`,Ue=({attemptDeliveryId:t,attemptCode:i,attemptResult:n,attemptError:o,submittingAttempt:d,handleSubmitAttempt:l,onAttemptDeliveryIdChange:f,onAttemptCodeChange:p})=>e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-cyan-200/45 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_20px_45px_rgba(34,211,238,0.22)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Validate a delivery"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Enter the delivery ID and the 6-digit code provided by the shop team."})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:l,children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"deliveryId",children:"Delivery ID"}),e.jsx("input",{id:"deliveryId",name:"deliveryId",type:"text",inputMode:"numeric",pattern:"^[0-9]+$",className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",value:t,onChange:r=>f(r.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"secretCode",children:"Secret code"}),e.jsx("input",{id:"secretCode",name:"secretCode",type:"text",inputMode:"numeric",autoComplete:"one-time-code",pattern:"^[0-9]{6}$",maxLength:6,className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",value:i,onChange:r=>p(r.target.value),required:!0})]})]}),e.jsx("button",{className:"inline-flex w-fit items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:d,children:d?"Submitting...":"Submit attempt"}),o&&e.jsx("div",{className:"rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-rose-100",children:o}),n&&e.jsxs("div",{className:n.success?"grid gap-1 rounded-[14px] border border-emerald-400/40 bg-emerald-400/10 px-3 py-2 text-slate-100":"grid gap-1 rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",role:"status",children:[e.jsxs("div",{className:"dc-alert__title font-bold",children:["Attempt ",n.attempt_number," Â· Delivery ",n.delivery_id]}),e.jsx("p",{className:"dc-alert__hint m-0 text-sm text-slate-300",children:$e(n.status,n.success,n.remaining_attempts)})]})]})]}),Me=({group:t,expanded:i,onToggle:n})=>{const o=t.attempts[0],d=t.status==="validated"?"rounded-full bg-emerald-400/20 px-3 py-1 text-sm font-bold text-emerald-300":t.status==="locked"?"rounded-full bg-rose-400/15 px-3 py-1 text-sm font-bold text-rose-300":"rounded-full bg-cyan-200/20 px-3 py-1 text-sm font-bold text-cyan-200";return e.jsxs("article",{className:"grid gap-3 rounded-2xl border border-slate-400/35 bg-slate-800/70 p-4 shadow-[0_10px_30px_rgba(0,0,0,0.25)]",children:[e.jsxs("header",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold tracking-[0.08em] text-slate-400 uppercase",children:["Delivery ",t.delivery_id]}),e.jsx("h3",{className:"mt-0.5 text-lg font-semibold text-slate-50",children:t.address}),o&&e.jsxs("p",{className:"m-0 text-sm text-slate-400",children:["Last attempt #",o.attempt_number," Â· ",D(o.created_at)]})]}),e.jsx("span",{className:d,children:oe(t.status)})]}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Total attempts"}),e.jsx("dd",{className:"m-0 text-slate-100",children:t.attempts.length})]}),o&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Latest result"}),e.jsx("dd",{className:o.success?"m-0 inline-flex items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"m-0 inline-flex items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:o.success?"Verified":"Failed"})]})]}),e.jsx("footer",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",onClick:()=>n(t.delivery_id),children:i?"Hide attempts":"View attempts"})}),i&&e.jsxs("div",{className:"overflow-x-auto rounded-xl border border-slate-400/35",children:[e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr] gap-2 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-200 md:text-base",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:"When"}),e.jsx("span",{children:"Result"})]}),t.attempts.map(l=>e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr] items-center gap-2 border-t border-slate-400/35 px-3 py-2 text-sm text-slate-100 md:text-base",children:[e.jsx("span",{children:l.attempt_number}),e.jsx("span",{children:D(l.created_at)}),e.jsx("span",{className:l.success?"inline-flex w-fit items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"inline-flex w-fit items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:l.success?"Verified":"Failed"})]},`${l.delivery_id}-${l.attempt_number}`))]})]},t.delivery_id)},Pe=({driverAttemptGroups:t,expandedDriverDeliveries:i,toggleDriverDeliveryExpansion:n})=>e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Recent attempts"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Your attempts grouped by delivery"})]}),t.length===0?e.jsx("p",{className:"m-0 text-slate-400",children:"No attempts logged yet."}):e.jsx("div",{className:"grid gap-3",children:t.map(o=>e.jsx(Me,{group:o,expanded:i[o.delivery_id],onToggle:n},o.delivery_id))})]}),Be=({attemptDeliveryId:t,attemptCode:i,attemptResult:n,attemptError:o,submittingAttempt:d,attemptHistory:l,expandedDriverDeliveries:f,handleSubmitAttempt:p,onAttemptDeliveryIdChange:r,onAttemptCodeChange:y,toggleDriverDeliveryExpansion:u})=>{const S=React.useMemo(()=>{if(!l.length)return[];const N=new Map;return l.forEach(c=>{N.has(c.delivery_id)||N.set(c.delivery_id,{delivery_id:c.delivery_id,address:c.address,status:c.status,attempts:[]});const h=N.get(c.delivery_id);h&&h.attempts.push(c)}),Array.from(N.values()).map(c=>({...c,attempts:[...c.attempts].sort((h,m)=>new Date(m.created_at).getTime()-new Date(h.created_at).getTime())})).sort((c,h)=>{const m=c.attempts[0]?.created_at??0,j=h.attempts[0]?.created_at??0;return new Date(j).getTime()-new Date(m).getTime()}).map(c=>({...c,status:c.attempts[0]?.status??c.status,address:c.attempts[0]?.address??c.address}))},[l]);return e.jsxs("section",{className:"grid gap-4",children:[e.jsx(Ue,{attemptDeliveryId:t,attemptCode:i,attemptResult:n,attemptError:o,submittingAttempt:d,handleSubmitAttempt:p,onAttemptDeliveryIdChange:r,onAttemptCodeChange:y}),e.jsx(Pe,{driverAttemptGroups:S,expandedDriverDeliveries:f,toggleDriverDeliveryExpansion:u})]})},qe=({deliveries:t,selectedDeliveryAttempts:i,addressInput:n,creationFlash:o,isCreating:d,handleCreateDelivery:l,handleAddressChange:f,toggleDeliveryAttempts:p})=>e.jsxs("section",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-cyan-200/45 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_20px_45px_rgba(34,211,238,0.22)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Create delivery"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Generate a delivery ID and one-time code tied to the address."})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:l,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"address",children:"Delivery address"}),e.jsx("textarea",{id:"address",name:"address",className:"min-h-[110px] w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",value:n,onChange:r=>f(r.target.value),placeholder:"12 Finchley rd, London, NW3 5JD",rows:3,required:!0})]}),e.jsx("button",{className:"inline-flex w-fit items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:d,children:d?"Creating...":"Generate code"}),o&&e.jsxs("div",{className:"dc-alert__codes grid gap-1 rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",role:"status",children:[e.jsx("div",{className:"font-bold",children:"Delivery created"}),e.jsxs("div",{className:"flex flex-wrap items-baseline gap-3 text-sm",children:[e.jsxs("span",{children:["Delivery ID: ",o.delivery_id]}),e.jsxs("span",{className:"inline-flex items-baseline gap-2",children:[e.jsx("span",{children:"Secret code:"}),e.jsx("span",{className:"font-mono text-xl font-bold tracking-[0.18em] text-amber-100",children:o.secret_code})]})]}),e.jsx("div",{className:"m-0 text-sm text-slate-300",children:"Share these with the recipient securely."})]})]})]}),e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsx("div",{className:"grid gap-1",children:e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Your deliveries"})}),t.length===0?e.jsx("p",{className:"m-0 text-slate-400",children:"No deliveries yet."}):e.jsx("div",{className:"grid gap-3",children:t.map(r=>{const y=r.status==="validated"?"rounded-full bg-emerald-400/20 px-3 py-1 text-sm font-bold text-emerald-300":r.status==="locked"?"rounded-full bg-rose-400/15 px-3 py-1 text-sm font-bold text-rose-300":"rounded-full bg-cyan-200/20 px-3 py-1 text-sm font-bold text-cyan-200";return e.jsxs("article",{className:"grid gap-3 rounded-2xl border border-slate-400/35 bg-slate-800/70 p-4 shadow-[0_10px_30_rgba(0,0,0,0.25)]",children:[e.jsxs("header",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold tracking-[0.08em] text-slate-400 uppercase",children:["Delivery ",r.delivery_id]}),e.jsx("h3",{className:"mt-0.5 text-lg font-semibold text-slate-50",children:r.address})]}),e.jsx("span",{className:y,children:oe(r.status)})]}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Secret code"}),e.jsx("dd",{className:"m-0 inline-flex items-center rounded-lg bg-white/10 px-2.5 py-1 font-mono text-xl font-semibold tracking-[0.18em] text-slate-50",children:r.secret_code})]}),e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Created"}),e.jsx("dd",{className:"m-0 text-slate-100",children:D(r.created_at)})]}),r.validated_at&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Completed"}),e.jsx("dd",{className:"m-0 text-slate-100",children:D(r.validated_at)})]}),r.locked_at&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Locked"}),e.jsx("dd",{className:"m-0 text-slate-100",children:D(r.locked_at)})]})]}),e.jsx("footer",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",onClick:()=>p(r.delivery_id),children:i[r.delivery_id]?"Close":"View attempts"})}),i[r.delivery_id]&&e.jsxs("div",{className:"overflow-x-auto rounded-xl border border-slate-400/35",children:[e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr,120px] gap-2 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-200 md:text-base",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:"When"}),e.jsx("span",{children:"User"}),e.jsx("span",{children:"Result"})]}),i[r.delivery_id].map(u=>e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr,120px] items-center gap-2 border-t border-slate-400/35 px-3 py-2 text-sm text-slate-100 md:text-base",children:[e.jsx("span",{children:u.attempt_number}),e.jsx("span",{children:D(u.created_at)}),e.jsx("span",{children:u.delivery_person}),e.jsx("span",{className:u.success?"inline-flex w-fit items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"inline-flex w-fit items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:u.success?"Verified":"Failed"})]},u.attempt_number)),i[r.delivery_id].length===0&&e.jsx("div",{className:"border-t border-slate-400/35 px-3 py-2 text-sm text-slate-400 md:text-base",children:"No attempts yet."})]})]},r.delivery_id)})})]})]}),Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}),Je=({currentMembership:t,isAuthenticated:i,onUpgrade:n})=>{const[o,d]=React.useState(!1),[l,f]=React.useState(null),[p,r]=React.useState([]);React.useEffect(()=>{fetch(`${ie}/weather/tiers`).then(m=>m.json()).then(m=>{const j=m.filter(g=>["free","plus","pro"].includes(g.id)).map(g=>({id:g.id,headline:g.headline||g.name,blurb:g.blurb||g.description,price:g.price_val??0}));r(j)}).catch(m=>console.error("Failed to load tiers",m))},[]);const y=t??"free",u=React.useMemo(()=>W.indexOf(y),[y]),S=()=>{d(m=>!m),f(null)},N=m=>{const j=n(m);f(j.message),j.ok&&d(!1)},c=t?`${O[t]} plan`:"Guest Â· Free start",h=t==="pro"?"Manage membership":"Upgrade";return e.jsxs("div",{className:"relative inline-flex justify-end",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-amber-300 via-orange-400 to-pink-500 px-4 py-2.5 font-bold text-slate-900 shadow-[0_10px_30px_rgba(251,191,36,0.25)] transition-transform hover:-translate-y-0.5 focus:ring-2 focus:ring-amber-300/60 focus:outline-none",onClick:S,"aria-expanded":o,"aria-haspopup":"dialog",children:[e.jsx("span",{children:h}),e.jsx("span",{"aria-hidden":"true",children:"â†—"})]}),o&&e.jsxs("div",{className:"absolute right-0 z-20 mt-2 w-[min(380px,calc(100vw-2rem))] rounded-2xl border border-slate-400/35 bg-slate-950/95 p-4 text-left shadow-[0_20px_45px_rgba(0,0,0,0.45)] backdrop-blur",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-sm font-semibold tracking-[0.08em] text-amber-200/90 uppercase",children:"Memberships"}),e.jsx("h3",{className:"mt-1 text-lg font-semibold text-slate-50",children:"Pick your plan"}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:"Upgrade to unlock more delivery confirmations."})]}),e.jsx("span",{className:"rounded-full border border-slate-400/45 bg-white/5 px-3 py-1 text-xs font-semibold text-slate-100",children:c})]}),e.jsx("div",{className:"mt-3 grid gap-2",children:p.map(m=>{const j=W.indexOf(m.id),g=m.id===y,w=j<u,I=g?"Current plan":w?"Downgrade not available":`Upgrade to ${O[m.id]}`,L=g||w;return e.jsxs("button",{type:"button",className:L?"grid gap-1 rounded-xl border border-slate-500/40 bg-slate-800/50 px-3 py-2 text-left text-slate-300 opacity-70":"grid gap-1 rounded-xl border border-amber-300/35 bg-amber-300/10 px-3 py-2 text-left text-slate-100 hover:border-amber-200/80 hover:bg-amber-200/20",onClick:()=>N(m.id),disabled:L,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:m.headline}),e.jsx("span",{className:"text-xs font-bold tracking-[0.08em] text-amber-200 uppercase",children:I})]}),e.jsxs("div",{className:"flex items-baseline justify-between text-sm",children:[e.jsx("span",{className:"font-semibold text-amber-100",children:Ge.format(m.price)}),e.jsx("span",{className:"text-xs text-slate-300",children:"per month"})]}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:m.blurb}),!i&&!g&&!w&&e.jsx("p",{className:"m-0 text-xs font-semibold text-amber-200/90",children:"Sign in to finish upgrade"})]},m.id)})}),l&&e.jsx("div",{className:"mt-3 rounded-xl border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-sm text-slate-100",children:l})]})]})},R=`${ie}/delivery_confirmation`,C="delivery_confirmation_auth",Ve=336*60*60*1e3,V="delivery_confirmation_last_email",E=t=>({Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),T=async(t,i)=>{try{if((t.headers.get("content-type")??"").includes("application/json")){const d=await t.json();if(typeof d=="string")return d;if(Array.isArray(d)){const l=d[0];if(typeof l=="string")return l;if(l&&typeof l=="object"){const f=l.message;if(typeof f=="string")return f}}if(d&&typeof d=="object"){const l=d,f=["detail","message","error"];for(const p of f){const r=l[p];if(typeof r=="string")return r}}}return(await t.text()).trim()||i}catch(n){return console.error("Failed to parse error response",n),i}},He=()=>{const[t,i]=React.useState(null),[n,o]=React.useState(""),[d,l]=React.useState(""),[f,p]=React.useState(null),[r,y]=React.useState(!1),[u,S]=React.useState("login"),[N,c]=React.useState(!1),[h,m]=React.useState("driver"),[j,g]=React.useState(!1),[w,I]=React.useState(!1),[L,k]=React.useState(null),[F,$]=React.useState(null),[ce,U]=React.useState([]),[Y,M]=React.useState({}),[P,B]=React.useState(""),[me,q]=React.useState(null),[xe,z]=React.useState(!1),[K,Q]=React.useState(""),[X,Z]=React.useState(""),[pe,G]=React.useState(null),[ue,A]=React.useState(null),[he,ee]=React.useState([]),[fe,te]=React.useState(!1),[ge,se]=React.useState({}),ae=t?.role==="shop",be=t?.role==="driver",re=s=>W.indexOf(s);React.useEffect(()=>{t?.role==="shop"&&ye(),t?.role==="driver"&&le()},[t?.role]),React.useEffect(()=>{if(!F)return;const s=window.setTimeout(()=>$(null),5e3);return()=>window.clearTimeout(s)},[F]),React.useEffect(()=>{try{const s=localStorage.getItem(C);if(!s)return;const a=JSON.parse(s);if(!a?.auth||!a.expiresAt)return;if(a.expiresAt<Date.now()){localStorage.removeItem(C);return}i(a.auth),c(!0)}catch(s){console.warn("Failed to restore session",s),localStorage.removeItem(C)}},[]),React.useEffect(()=>{const s=localStorage.getItem(V);s&&o(s)},[]),React.useEffect(()=>{const s=n.trim();s?localStorage.setItem(V,s):localStorage.removeItem(V)},[n]);const ye=async()=>{if(!t)return;const s=await fetch(`${R}/deliveries`,{headers:E(t.token)});if(!s.ok)return;const a=await s.json(),x=Array.isArray(a)?a:[];U(x)},je=async s=>{if(!t)return;const a=await fetch(`${R}/deliveries/${s}/attempts`,{headers:E(t.token)});if(!a.ok)return;const x=await a.json(),b=Array.isArray(x?.attempts)?x.attempts:[];M(v=>({...v,[s]:b}))},le=async()=>{if(!t)return;const s=await fetch(`${R}/attempts`,{headers:E(t.token)});if(!s.ok)return;const a=await s.json(),x=Array.isArray(a)?a:[];ee(x)},ve=s=>{const a=s.replace(/\D/g,"").slice(0,6);Z(a)},Ne=s=>{const a=s.replace(/\D/g,"");Q(a)},we=s=>{B(s)},_e=s=>{if(Y[s]){M(a=>{const x={...a};return delete x[s],x});return}je(s)},Se=s=>{se(a=>({...a,[s]:!a[s]}))},Re=()=>{i(null),U([]),M({}),ee([]),G(null),A(null),se({}),Q(""),Z(""),q(null),B(""),k(null),l(""),S("login"),c(!1),$(null),localStorage.removeItem(C)},Ce=s=>{if(!t)return{ok:!1,message:"Sign in to choose a membership."};const a=re(t.membership),x=re(s);if(x<=a)return{ok:!1,message:x===a?"You're already on that membership.":"Downgrades are not available from this view."};i(v=>v&&{...v,membership:s});const b=`Upgraded to ${O[s]} membership.`;return $(b),{ok:!0,message:b}},De=s=>{S(s),p(null),k(null)},ke=async s=>{s.preventDefault();const a=n.trim().toLowerCase();if(p(null),k(null),!a){p("Email is required.");return}if(!d.trim()){p("Password is required.");return}if(u==="register"&&d.length<H){p(`Password must be at least ${H} characters.`);return}y(!0);try{const x=u==="login"?"login":"register",b={email:a,password:d};u==="register"&&(b.role=h);const v=await fetch(`${R}/${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!v.ok){const J=await T(v,u==="login"?"Unable to log in":"Unable to register");throw new Error(J)}const _=await v.json();if(i({token:_.access_token,email:_.username,role:_.role,membership:_.membership}),N){const J=Date.now()+Ve;localStorage.setItem(C,JSON.stringify({auth:{token:_.access_token,email:_.username,role:_.role,membership:_.membership},expiresAt:J}))}else localStorage.removeItem(C);l("")}catch(x){p(x instanceof Error?x.message:u==="login"?"Login failed":"Registration failed")}finally{y(!1)}},Ae=async()=>{const s=n.trim().toLowerCase();if(k(null),p(null),!s){p("Email is required to reset password.");return}I(!0);try{const a=await fetch(`${R}/password_reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!a.ok)throw new Error(await T(a,"Unable to request password reset"));const x=await a.json();k(x.message)}catch(a){p(a instanceof Error?a.message:"Reset failed")}finally{I(!1)}},Ee=async s=>{if(s.preventDefault(),!(!t||!P.trim())){z(!0);try{const a=await fetch(`${R}/deliveries`,{method:"POST",headers:E(t.token),body:JSON.stringify({address:P.trim()})});if(!a.ok)throw new Error(await T(a,"Unable to create delivery"));const x=await a.json();U(b=>[x,...b]),q(x),B("")}catch(a){q(null),p(a instanceof Error?a.message:"Unable to create delivery")}finally{z(!1)}}},Ie=async s=>{if(s.preventDefault(),!t)return;const a=K.trim(),x=X.trim();if(!a){A("Delivery ID is required.");return}if(!/^\d{6}$/.test(x)){A("Code must be exactly 6 digits.");return}A(null),te(!0);try{const b=await fetch(`${R}/attempts`,{method:"POST",headers:E(t.token),body:JSON.stringify({delivery_id:Number(a),code:x})});if(!b.ok){const _=await T(b,"Attempt rejected");throw new Error(_)}const v=await b.json();G(v),await le()}catch(b){G(null),A(b instanceof Error?b.message:"Attempt failed")}finally{te(!1)}},Le=React.useMemo(()=>t?t.role==="shop"?"Create deliveries, hand off the one-time code, and check delivery confirmations.":"Confirm deliveries.":"Generate and validate single-use delivery codes.",[t]),Fe=React.useMemo(()=>t?t.role==="shop"?"Shop":"Driver":null,[t]);return e.jsx("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_20%,rgba(34,211,238,0.18),transparent_45%),radial-gradient(circle_at_80%_10%,rgba(56,189,248,0.15),transparent_40%),#0b1021] px-[clamp(1.25rem,3vw,2rem)] py-[clamp(1.25rem,3vw,2rem)] font-['Space_Grotesk','Inter',system-ui,-apple-system,sans-serif] text-slate-100",children:e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-5",children:[e.jsxs("header",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("span",{className:"text-sm font-bold tracking-[0.08em] text-cyan-300 uppercase",children:"Delivery Confirmation"}),e.jsx("h1",{className:"m-0 text-3xl font-semibold text-slate-50",children:"One-time codes"}),e.jsx("p",{className:"m-0 max-w-3xl text-slate-300",children:Le})]}),e.jsxs("div",{className:"grid justify-end gap-2 text-right",children:[ae&&t&&e.jsx(Je,{currentMembership:t.membership,isAuthenticated:!0,onUpgrade:Ce}),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dc-status__role text-sm font-bold tracking-[0.01em] text-lime-200 uppercase","data-testid":"dc-status-role",children:Fe}),e.jsxs("div",{className:"text-sm text-slate-300",children:["Signed in as ",t.email," Â· ",O[t.membership]," member"]}),e.jsx("button",{className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",type:"button",onClick:Re,children:"Log out"})]}):e.jsx("div",{className:"text-sm text-slate-300",children:"Start on Free and upgrade to Plus or Pro whenever you are ready."})]})]}),F&&e.jsx("div",{className:"rounded-xl border border-emerald-400/40 bg-emerald-400/10 px-4 py-3 text-sm text-emerald-50 shadow-[0_12px_30px_rgba(16,185,129,0.25)]",children:F}),!t&&e.jsx(Te,{authMode:u,email:n,password:d,roleSelection:h,showPassword:j,loadingAuth:r,resettingPassword:w,authError:f,resetFlash:L,rememberMe:N,switchAuthMode:De,setEmail:o,setPassword:l,setRoleSelection:m,setShowPassword:g,setRememberMe:c,handleAuthSubmit:ke,handlePasswordReset:Ae}),ae&&e.jsx(qe,{deliveries:ce,selectedDeliveryAttempts:Y,addressInput:P,creationFlash:me,isCreating:xe,handleCreateDelivery:Ee,handleAddressChange:we,toggleDeliveryAttempts:_e}),be&&e.jsx(Be,{attemptDeliveryId:K,attemptCode:X,attemptResult:pe,attemptError:ue,submittingAttempt:fe,attemptHistory:he,expandedDriverDeliveries:ge,handleSubmitAttempt:Ie,onAttemptDeliveryIdChange:Ne,onAttemptCodeChange:ve,toggleDriverDeliveryExpansion:Se})]})})},de=document.getElementById("root");if(!de)throw new Error("Root element #root not found");document.body.classList.add("delivery-page");ReactDOM.createRoot(de).render(e.jsx(React.StrictMode,{children:e.jsx(He,{})}));
