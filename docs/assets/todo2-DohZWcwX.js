import"./index-pErSQAtW.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import"./polyfills-BumHK8My.js";import{A as O}from"./api-CH_Pe6Vg.js";import{X as E}from"./x-BS-d4QNZ.js";import{P as F,A as Q}from"./Auth-uEj7rJlD.js";import{C as Z}from"./check-CWX8rMms.js";import{T as M}from"./trash-2-DQbJ9aIh.js";import{P}from"./pen-vQk8amFZ.js";import{D as ee,U as te}from"./upload--Rbr-3Yq.js";import{C as se}from"./circle-check-F4iM422t.js";import{c as A}from"./createLucideIcon-DtX1aPOG.js";import{F as ae}from"./file-text-RVtngrx3.js";import{S as re}from"./search-Cfl0sis-.js";import{L as q}from"./log-out-B0TqtotO.js";import{F as le}from"./funnel-BDdIBe_Y.js";import{S as ne}from"./settings-G074OJw9.js";import"./button-D6DGr86I.js";import"./clsx-B-dksMZM.js";import"./eye-Jn_UhOO1.js";const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],H=A("circle",oe);const ie=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],de=A("menu",ie);const ce=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],ue=A("repeat",ce);const xe=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],me=A("square-check-big",xe),z="todo2_token",c={getToken:()=>localStorage.getItem(z),setToken:t=>localStorage.setItem(z,t),removeToken:()=>localStorage.removeItem(z),async request(t,s={}){const a=this.getToken(),r=new Headers(s.headers);a&&r.set("Authorization",`Bearer ${a}`),!(s.body instanceof FormData)&&!r.has("Content-Type")&&r.set("Content-Type","application/json");const l=await fetch(`${O}/todo2${t}`,{...s,headers:r});if(l.status===204)return{};if(!l.ok){l.status===401&&this.removeToken();const o=await l.json().catch(()=>({detail:"Unknown error"}));throw new Error(o.detail||"Request failed")}return l.json()},auth:{login:t=>c.request("/auth/login",{method:"POST",body:JSON.stringify(t)}).then(s=>(c.setToken(s.access_token),s)),logout:()=>(c.removeToken(),Promise.resolve()),me:()=>c.request("/auth/me")},categories:{list:()=>c.request("/categories"),create:(t,s)=>c.request("/categories",{method:"POST",body:JSON.stringify({name:t,color:s})}),update:(t,s,a)=>c.request(`/categories/${t}`,{method:"PUT",body:JSON.stringify({name:s,color:a})}),delete:t=>c.request(`/categories/${t}`,{method:"DELETE"})},tasks:{list:(t,s)=>{const a=new URLSearchParams;t&&a.set("category_id",t.toString()),s&&a.set("sort_by",s);const r=a.toString();return c.request(`/tasks${r?`?${r}`:""}`)},create:t=>c.request("/tasks",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>c.request(`/tasks/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>c.request(`/tasks/${t}`,{method:"DELETE"})},data:{export:async()=>{const t=c.getToken(),s=await fetch(`${O}/todo2/export`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Export failed");return s.blob()},import:t=>c.request("/import",{method:"POST",body:t,headers:{"Content-Type":"application/x-yaml"}})}},ge=["all","upcoming","in_progress","overdue","completed"],B={in_progress:{label:"In Progress",className:"bg-green-100 text-green-700 ring-green-600/20"},completed:{label:"Completed",className:"bg-gray-100 text-gray-700 ring-gray-600/10"},upcoming:{label:"Upcoming",className:"bg-orange-100 text-orange-700 ring-orange-600/10"},overdue:{label:"Overdue",className:"bg-red-100 text-red-700 ring-red-600/10"}},he={all:"All",...Object.fromEntries(Object.entries(B).map(([t,s])=>[t,s.label]))},pe={"blue-500":"#3b82f6","red-500":"#ef4444","emerald-500":"#10b981","amber-500":"#f59e0b","violet-500":"#8b5cf6","pink-500":"#ec4899","indigo-500":"#6366f1","teal-500":"#14b8a6","orange-500":"#f97316","cyan-500":"#06b6d4"},I=t=>pe[t]||t,U=["blue-500","red-500","emerald-500","amber-500","violet-500","pink-500","indigo-500","teal-500","orange-500","cyan-500"],be=({categories:t,onClose:s,onCreate:a,onUpdate:r,onDelete:l})=>{const[o,u]=React.useState(""),[g,j]=React.useState(U[0]),[f,h]=React.useState(null),[y,w]=React.useState(""),[x,v]=React.useState(""),m=n=>{n.preventDefault(),o.trim()&&(a(o.trim(),g),u(""))},b=n=>{n.preventDefault(),f&&y.trim()&&(r(f,y.trim(),x),h(null))},k=n=>{h(n.id),w(n.name),v(n.color)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-0 backdrop-blur-sm md:items-center md:p-4",children:e.jsxs("div",{className:"flex h-[80vh] w-full flex-col overflow-hidden rounded-t-2xl bg-white shadow-2xl md:h-auto md:max-w-md md:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-5",children:[e.jsx("h2",{className:"text-xl font-extrabold text-gray-900",children:"Categories"}),e.jsx("button",{onClick:s,className:"rounded-xl p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600",children:e.jsx(E,{size:24})})]}),e.jsxs("div",{className:"flex-1 space-y-8 overflow-y-auto p-6","data-testid":"category-manager",children:[e.jsxs("form",{onSubmit:m,className:"space-y-4 border-b border-gray-100 pb-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Add New Category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,"data-testid":"new-category-input",className:"flex-1 rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",placeholder:"Work, Personal, etc...",value:o,onChange:n=>u(n.target.value)}),e.jsx("button",{type:"submit","data-testid":"add-category-button",disabled:!o.trim(),className:"flex items-center justify-center rounded-xl bg-blue-600 px-5 text-white shadow-lg shadow-blue-200 transition-all hover:bg-blue-700 active:scale-95 disabled:opacity-50 disabled:shadow-none",children:e.jsx(F,{size:20})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Select Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:U.map(n=>e.jsx("button",{type:"button","data-testid":`color-preset-${n}`,onClick:()=>j(n),className:`h-8 w-8 rounded-full border-2 transition-all ${g===n?"scale-110 border-gray-900 shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:I(n)}},n))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Current Categories"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2","data-testid":"category-list",children:[[...t].sort((n,N)=>n.name.localeCompare(N.name)).map(n=>e.jsx("div",{"data-testid":`category-item-${n.id}`,className:"space-y-2",children:f===n.id?e.jsxs("form",{onSubmit:b,className:"space-y-4 rounded-xl border border-blue-200 bg-blue-50/30 p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,className:"flex-1 rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20",value:y,onChange:N=>w(N.target.value)}),e.jsx("button",{type:"submit",disabled:!y.trim(),className:"rounded-lg bg-blue-600 p-2 text-white shadow-sm hover:bg-blue-700 disabled:opacity-50",children:e.jsx(Z,{size:18})}),e.jsx("button",{type:"button",onClick:()=>h(null),className:"rounded-lg bg-gray-200 p-2 text-gray-600 hover:bg-gray-300",children:e.jsx(E,{size:18})})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:U.map(N=>e.jsx("button",{type:"button",onClick:()=>v(N),className:`h-6 w-6 rounded-full border-2 transition-all ${x===N?"scale-110 border-gray-900 shadow-sm":"border-transparent"}`,style:{backgroundColor:I(N)}},N))}),e.jsx("div",{className:"flex justify-end border-t border-blue-100 pt-2",children:e.jsxs("button",{type:"button","data-testid":"delete-category-button-in-edit",onClick:()=>{confirm(`Delete category "${n.name}" and all its tasks?`)&&(l(n.id),h(null))},className:"flex items-center gap-1.5 text-[10px] font-black tracking-wider text-red-500 uppercase transition-colors hover:text-red-600",children:[e.jsx(M,{size:12}),"Delete Category"]})})]}):e.jsxs("div",{className:"group flex items-center justify-between rounded-xl border border-gray-100 bg-gray-50/50 p-4 transition-all hover:border-blue-100 hover:bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:I(n.color)}}),e.jsx("span",{className:"font-bold text-gray-700","data-testid":"category-name",children:n.name})]}),e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:()=>k(n),"data-testid":"edit-category-button",className:"rounded-xl p-2.5 text-gray-400 transition-colors hover:bg-blue-50 hover:text-blue-600 active:scale-90",children:e.jsx(P,{size:18})})})]})},n.id)),t.length===0&&e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-sm font-medium text-gray-400",children:"No custom categories yet."})})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 bg-gray-50 p-6 pb-8 md:pb-6",children:e.jsx("button",{onClick:s,"data-testid":"category-manager-done",className:"w-full rounded-xl border border-gray-200 bg-white px-4 py-4 text-sm font-bold text-gray-700 shadow-sm transition-all active:scale-95 active:bg-gray-50",children:"Done"})})]})})},fe=({onExport:t,onImport:s})=>{const a=React.useRef(null),r=l=>{const o=l.target.files?.[0];if(o){const u=new FileReader;u.onload=g=>{const j=g.target?.result;s(j),a.current&&(a.current.value="")},u.readAsText(o)}};return e.jsxs("div",{className:"space-y-2 border-t border-gray-200 p-4 text-gray-600","data-testid":"data-control",children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wider text-gray-500 uppercase",children:"Data Management"}),e.jsxs("button",{onClick:t,"data-testid":"export-button",className:"flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-50",children:[e.jsx(ee,{size:16}),"Export YAML"]}),e.jsxs("button",{onClick:()=>a.current?.click(),"data-testid":"import-button",className:"flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-50",children:[e.jsx(te,{size:16}),"Import YAML"]}),e.jsx("input",{type:"file",ref:a,"data-testid":"import-input",className:"hidden",accept:".yml,.yaml",onChange:r})]})},ye=({onSuccess:t})=>e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-4",children:e.jsx(Q,{appName:"Todo2",loginEndpoint:"/todo2/auth/login",onSuccess:(s,a)=>t(s,a),className:"w-full max-w-md"})}),je=({task:t,categories:s,categoryId:a,onSave:r,onClose:l})=>{const[o,u]=React.useState(t?.title||""),[g,j]=React.useState(t?.description||""),[f,h]=React.useState(t?.category_id||a||s[0]?.id),[y,w]=React.useState(t?.start_date?t.start_date.split("T")[0]:""),[x,v]=React.useState(t?.due_date?t.due_date.split("T")[0]:""),[m,b]=React.useState(t?.recurrence_interval||""),[k,n]=React.useState(t?.recurrence_base||"due_date"),[N,T]=React.useState(t?.is_completed||!1),R=d=>{d.preventDefault(),r({title:o,description:g||null,category_id:f,is_completed:N,start_date:y?new Date(y).toISOString():null,due_date:x?new Date(x).toISOString():null,recurrence_interval:m||null,recurrence_base:m?k:null})};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-0 backdrop-blur-sm md:items-center md:p-4",children:e.jsxs("div",{className:"flex h-[92vh] w-full flex-col overflow-hidden rounded-t-2xl bg-white shadow-2xl md:h-auto md:max-w-md md:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-5",children:[e.jsx("h2",{className:"text-xl font-extrabold text-gray-900",children:t?"Edit Task":"New Task"}),e.jsx("button",{onClick:l,className:"rounded-xl p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600",children:e.jsx(E,{size:24})})]}),e.jsx("form",{onSubmit:R,className:"flex-1 space-y-6 overflow-y-auto p-6","data-testid":"task-form",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Title"}),e.jsx("input",{autoFocus:!0,required:!0,"data-testid":"task-title-input",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:o,onChange:d=>u(d.target.value),placeholder:"What needs to be done?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Description"}),e.jsx("textarea",{"data-testid":"task-description-input",className:"min-h-[120px] w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:g,onChange:d=>j(d.target.value),placeholder:"Add some details..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Category"}),e.jsx("select",{"data-testid":"task-category-select",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:f,onChange:d=>h(Number(d.target.value)),children:s.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Start Date"}),e.jsx("input",{type:"date","data-testid":"task-start-date-input",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:y,onChange:d=>w(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Due Date"}),e.jsx("input",{type:"date","data-testid":"task-due-date-input",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:x,onChange:d=>v(d.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Recurrence"}),e.jsxs("select",{"data-testid":"task-recurrence-interval-select",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:m,onChange:d=>b(d.target.value),children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"From"}),e.jsxs("select",{disabled:!m,"data-testid":"task-recurrence-base-select",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50 disabled:opacity-50",value:k,onChange:d=>n(d.target.value),children:[e.jsx("option",{value:"due_date",children:"Due Date"}),e.jsx("option",{value:"completion_date",children:"Completion Date"})]})]})]}),t&&e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-gray-100 bg-gray-50 p-4 transition-colors active:bg-blue-50",onClick:()=>T(!N),"data-testid":"task-completed-toggle",children:[e.jsx("input",{type:"checkbox",id:"isCompleted","data-testid":"task-completed-checkbox",className:"h-5 w-5 rounded-md border-gray-300 text-blue-600 focus:ring-blue-500",checked:N,onChange:d=>T(d.target.checked),onClick:d=>d.stopPropagation()}),e.jsx("label",{htmlFor:"isCompleted",className:"text-sm font-bold text-gray-700 select-none",children:"Mark as completed"})]})]})}),e.jsxs("div",{className:"flex gap-3 border-t border-gray-100 bg-gray-50 p-6 pb-8 md:pb-6",children:[e.jsx("button",{type:"button",onClick:l,"data-testid":"task-form-cancel",className:"flex-1 rounded-xl border border-gray-200 bg-white px-4 py-4 text-sm font-bold text-gray-700 shadow-sm transition-all active:scale-95 active:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit","data-testid":"task-form-submit",onClick:d=>{d.preventDefault(),R(d)},className:"flex-1 rounded-xl bg-blue-600 px-4 py-4 text-sm font-bold text-white shadow-xl shadow-blue-200 transition-all active:scale-95 active:bg-blue-700",children:t?"Update Task":"Create Task"})]})]})})},S=({label:t,field:s,currentSort:a,onSort:r})=>e.jsx("th",{onClick:()=>r(s),"data-testid":`task-header-${s}`,className:"cursor-pointer bg-gray-50 p-1 text-left text-xs font-medium tracking-wider text-gray-500 uppercase transition-colors hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center gap-1",children:[t,a===s&&e.jsx("span",{className:"animate-in fade-in zoom-in text-[10px] text-blue-500 duration-200",children:"â–¼"})]})}),ve=({name:t,color:s})=>{const a=I(s);return e.jsx("span",{"data-testid":"task-category-badge",className:"inline-flex rounded-full px-1 py-0.5 text-[10px] font-bold ring-1 ring-inset",style:{backgroundColor:`${a}15`,color:a,borderColor:`${a}30`},children:t})},Ne=({status:t})=>{const s=B[t];return e.jsx("span",{"data-testid":"task-status-badge",className:`inline-flex items-center rounded-md px-1 py-0.5 text-[10px] font-medium ring-1 ring-inset ${s.className}`,children:s.label})},we=({task:t,category:s,isExpanded:a,onToggleNote:r,onToggleStatus:l,onEdit:o,onDelete:u})=>{const g=m=>m?new Date(m).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"-",j=m=>{if(!m)return!1;const b=new Date;return b.setHours(0,0,0,0),new Date(m)<b},f=m=>{if(!m)return!1;const b=new Date;return b.setHours(0,0,0,0),new Date(m)>b},h=m=>{if(!m)return null;const b=new Date;b.setHours(0,0,0,0);const k=new Date(m);k.setHours(0,0,0,0);const n=k.getTime()-b.getTime();return Math.ceil(n/864e5)},y=()=>t.is_completed?"completed":j(t.due_date)?"overdue":f(t.start_date)?"upcoming":"in_progress",w=h(t.due_date),x=y(),v="whitespace-nowrap p-1 align-top";return e.jsxs("tr",{"data-testid":`task-row-${t.id}`,className:`group transition-colors hover:bg-gray-50 ${t.is_completed?"bg-gray-50/50":""}`,children:[e.jsx("td",{className:v,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>l(t),"data-testid":"toggle-status-button",className:`cursor-pointer transition-colors ${t.is_completed?"text-gray-400":"text-gray-300 hover:text-blue-500"}`,children:t.is_completed?e.jsx(se,{size:20}):e.jsx(H,{size:20})}),t.recurrence_interval&&e.jsx(ue,{size:12,className:"shrink-0 text-blue-500",title:`Recurring: ${t.recurrence_interval}`})]})}),e.jsx("td",{className:v,children:e.jsx(Ne,{status:x})}),e.jsxs("td",{"data-testid":"task-title-cell",className:`p-1 align-top text-sm font-medium ${t.is_completed?"font-normal text-gray-400 line-through":"text-gray-900"}`,children:[e.jsx("div",{className:"max-w-[150px] truncate md:max-w-xs",children:t.title}),a&&t.description&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-1 mt-2 max-w-[150px] text-xs font-normal whitespace-pre-wrap text-gray-500 duration-200 md:max-w-xs",children:t.description})]}),e.jsx("td",{className:`${v} text-sm text-gray-500`,"data-testid":"task-start-date",children:g(t.start_date)}),e.jsx("td",{className:`${v} text-sm text-gray-500`,"data-testid":"task-due-date",children:e.jsx("span",{className:!t.is_completed&&j(t.due_date)?"font-semibold text-red-500":"",children:g(t.due_date)})}),e.jsx("td",{className:`${v} text-sm text-gray-500`,"data-testid":"task-days-due",children:w!==null&&e.jsx("span",{className:!t.is_completed&&w<0?"font-bold text-red-500":"",children:w})}),e.jsx("td",{className:`${v} text-sm`,"data-testid":"task-category",children:s&&e.jsx(ve,{name:s.name,color:s.color})}),e.jsx("td",{className:`${v} text-right text-sm font-medium`,children:e.jsxs("div",{className:"flex justify-end gap-3 text-gray-400",children:[t.description&&e.jsx("button",{onClick:()=>r(t.id),"data-testid":"toggle-note-button",className:`cursor-pointer transition-colors hover:text-blue-600 ${a?"text-blue-600":""}`,title:"Show note",children:e.jsx(ae,{size:18})}),e.jsx("button",{onClick:()=>o(t),"data-testid":"edit-task-button",className:"cursor-pointer transition-colors hover:text-blue-600",children:e.jsx(P,{size:18})}),e.jsx("button",{onClick:()=>{confirm("Delete task?")&&u(t.id)},"data-testid":"delete-task-button",className:"cursor-pointer transition-colors hover:text-red-600",children:e.jsx(M,{size:18})})]})})]})},ke=({tasks:t,categories:s,sortBy:a,onSort:r,onToggleStatus:l,onEdit:o,onDelete:u})=>{const[g,j]=React.useState(null),f=h=>{j(g===h?null:h)};return e.jsx("div",{className:"flex-1 overflow-x-auto bg-gray-50/50",children:e.jsxs("div",{className:"inline-block min-w-full align-middle",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200","data-testid":"task-list-table",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-gray-50 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"bg-gray-50 p-1 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Completed"}),e.jsx(S,{label:"Status",field:"status",currentSort:a,onSort:r}),e.jsx(S,{label:"Title",field:"title",currentSort:a,onSort:r}),e.jsx(S,{label:"Start Date",field:"start_date",currentSort:a,onSort:r}),e.jsx(S,{label:"Due Date",field:"due_date",currentSort:a,onSort:r}),e.jsx(S,{label:"Due In",field:"due_date",currentSort:a,onSort:r}),e.jsx(S,{label:"Category",field:"category",currentSort:a,onSort:r}),e.jsx("th",{className:"bg-gray-50 p-1 text-right text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white","data-testid":"task-list-body",children:t.map(h=>e.jsx(we,{task:h,category:s.find(y=>y.id===h.category_id),isExpanded:g===h.id,onToggleNote:f,onToggleStatus:l,onEdit:o,onDelete:u},h.id))})]}),t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center px-6 py-20 text-center text-gray-500","data-testid":"task-list-empty",children:[e.jsx("div",{className:"mb-4 rounded-full bg-gray-100 p-4",children:e.jsx(H,{size:48,className:"opacity-20"})}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:"No tasks found"}),e.jsx("p",{className:"mt-1 text-sm",children:'Tap the "Add Task" button to get started.'})]})]})})},Ce=({filters:t,categories:s,onChange:a})=>{const r=l=>{const{name:o,value:u,type:g}=l.target,j=g==="checkbox"?l.target.checked:o==="categoryId"?u?Number(u):void 0:u;a({...t,[o]:j})};return e.jsx("div",{className:"z-10 border-b border-gray-200 bg-white p-4 shadow-sm","data-testid":"filter-bar",children:e.jsxs("div",{className:"mx-auto flex max-w-6xl flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative min-w-[200px] flex-1",children:[e.jsx("input",{type:"text",name:"search","data-testid":"search-input",value:t.search,onChange:r,placeholder:"Search tasks...",className:"w-full rounded-xl border border-gray-200 bg-gray-50 py-2 pr-4 pl-10 text-sm font-medium transition-all focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"}),e.jsx(re,{className:"absolute top-2.5 left-3 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Category"}),e.jsxs("select",{name:"categoryId","data-testid":"category-filter-select-in-bar",value:t.categoryId||"",onChange:r,className:"rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-bold text-gray-700 focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Categories"}),[...s].sort((l,o)=>l.name.localeCompare(o.name)).map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx("input",{type:"checkbox",name:"excludeCompletedAndUpcoming",id:"excludeCompletedAndUpcoming","data-testid":"exclude-completed-upcoming-checkbox",checked:t.excludeCompletedAndUpcoming,onChange:r,className:"h-4 w-4 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-blue-500/20"}),e.jsx("label",{htmlFor:"excludeCompletedAndUpcoming",className:"cursor-pointer text-sm font-bold text-gray-700",children:"Exclude Completed & Upcoming"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Status"}),e.jsx("select",{name:"status","data-testid":"status-filter-select",value:t.status,onChange:r,className:"rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-bold text-gray-700 focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:ge.map(l=>e.jsx("option",{value:l,children:he[l]},l))})]})]})})},Se=({user:t,onLogout:s,navbar:a,sidebar:r,children:l})=>{const[o,u]=React.useState(!1);return e.jsxs("div",{className:"flex h-screen flex-col overflow-hidden bg-gray-50",children:[e.jsxs("header",{className:"z-30 flex min-h-[4rem] shrink-0 items-center justify-between border-b border-gray-200 bg-white px-4 py-2 shadow-sm md:h-16 md:px-6 md:py-0",children:[e.jsx("div",{className:"mx-auto flex max-w-6xl flex-1 items-center justify-between",children:a}),r&&e.jsx("button",{onClick:()=>u(!0),className:"ml-4 rounded-xl p-2 text-gray-500 transition-colors hover:bg-gray-100 md:hidden",children:e.jsx(de,{size:24})})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("main",{className:"mx-auto flex max-w-6xl flex-1 flex-col overflow-hidden",children:l}),r&&e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm md:hidden",onClick:()=>u(!1)}),e.jsxs("aside",{className:`fixed inset-y-0 right-0 z-50 flex w-72 flex-col border-l border-gray-200 bg-white transition-transform duration-300 md:static md:flex md:w-64 md:translate-x-0 ${o?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Settings"}),e.jsx("button",{onClick:()=>u(!1),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 md:hidden",children:e.jsx(E,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",onClick:()=>u(!1),children:r}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex min-w-0 flex-col",children:[e.jsx("span",{className:"truncate text-sm font-semibold text-gray-900",children:t.name}),e.jsx("span",{className:"truncate text-xs text-gray-500",children:t.email})]}),e.jsx("button",{onClick:s,className:"flex-shrink-0 rounded-lg p-2 text-gray-400 transition-colors hover:bg-red-50 hover:text-red-600",title:"Logout",children:e.jsx(q,{size:20})})]})})]})]})]})]})},Te=()=>{const[t,s]=React.useState(null),[a,r]=React.useState(!0);return React.useEffect(()=>{c.auth.me().then(s).catch(()=>s(null)).finally(()=>r(!1))},[]),{user:t,setUser:s,loading:a}},_e=t=>{const[s,a]=React.useState([]),[r,l]=React.useState(!1),o=()=>{t&&(l(!0),c.categories.list().then(a).catch(()=>a([])).finally(()=>l(!1)))};return React.useEffect(()=>{o()},[t]),{categories:s,loading:r,refetch:o}},De=(t,s,a)=>{const[r,l]=React.useState([]),[o,u]=React.useState(!1),g=()=>{t&&(u(!0),c.tasks.list(s,a).then(l).catch(()=>l([])).finally(()=>u(!1)))};return React.useEffect(()=>{g()},[t,s,a]),{tasks:r,loading:o,refetch:g}},Re=()=>{const{user:t,setUser:s,loading:a}=Te(),[r,l]=React.useState("created_at"),[o,u]=React.useState(!1),[g,j]=React.useState(!1),[f,h]=React.useState(null),[y,w]=React.useState(!1),[x,v]=React.useState({search:"",status:"all",categoryId:void 0,excludeCompletedAndUpcoming:!1}),{categories:m,refetch:b}=_e(t),{tasks:k,refetch:n}=De(t,x.categoryId,r),N=React.useMemo(()=>{const i=new Date;return i.setHours(0,0,0,0),k.filter(p=>{const C=!x.search||p.title.toLowerCase().includes(x.search.toLowerCase())||p.description&&p.description.toLowerCase().includes(x.search.toLowerCase()),_=p.is_completed,L=!_&&!!p.due_date&&new Date(p.due_date)<i,$=!_&&!L&&!!p.start_date&&new Date(p.start_date)>i,V=!_&&!L&&!$;let D=!0;x.status==="completed"?D=_:x.status==="in_progress"?D=V:x.status==="upcoming"?D=$:x.status==="overdue"&&(D=L);const G=!x.excludeCompletedAndUpcoming||!_&&!$,X=!x.categoryId||p.category_id===x.categoryId;return C&&D&&G&&X})},[k,x]);if(a)return e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50 px-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-blue-600 border-t-transparent shadow-lg shadow-blue-100"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Loading your tasks..."})]})});if(!t)return e.jsx(ye,{onSuccess:i=>{c.setToken(i.access_token),s(i.user)}});const T=()=>{c.auth.logout().then(()=>s(null))},R=i=>{c.tasks.create(i).then(()=>{n(),u(!1)})},d=i=>{f&&c.tasks.update(f.id,i).then(()=>{n(),h(null)})},J=i=>{c.tasks.update(i.id,{is_completed:!i.is_completed}).then(n)},Y=async()=>{try{const i=await c.data.export(),p=window.URL.createObjectURL(i),C=document.createElement("a");C.href=p,C.download="todo2_export.yml",document.body.appendChild(C),C.click(),window.URL.revokeObjectURL(p),document.body.removeChild(C)}catch{alert("Failed to export data")}},K=i=>{c.data.import(i).then(()=>{b(),n()}).catch(p=>alert("Import failed: "+p.message))},W=(x.categoryId?m.find(i=>i.id===x.categoryId):null)?.name||"All Tasks";return e.jsxs(Se,{user:t,onLogout:T,navbar:e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-between gap-y-3 md:flex-nowrap md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200",children:e.jsx(me,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-lg font-extrabold tracking-tight text-gray-900 md:text-xl",children:"Todo2"}),e.jsx("span",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:W})]})]}),e.jsxs("div",{className:"flex w-full items-center justify-between gap-2 md:w-auto md:flex-1 md:justify-end md:gap-4",children:[e.jsxs("button",{onClick:()=>w(!y),"data-testid":"toggle-filters-button",className:`flex h-10 w-10 items-center justify-center rounded-xl transition-all md:w-auto md:gap-2 md:px-4 ${y?"bg-blue-600 text-white shadow-lg shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:"Toggle Filters",children:[e.jsx(le,{size:20}),e.jsx("span",{className:"hidden text-sm font-bold md:block",children:"Filters"})]}),e.jsxs("button",{onClick:()=>j(!0),"data-testid":"settings-button",className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gray-100 text-gray-600 transition-all hover:bg-gray-200 md:w-auto md:gap-2 md:px-4",title:"Manage Categories",children:[e.jsx(ne,{size:20}),e.jsx("span",{className:"hidden text-sm font-bold md:block",children:"Settings"})]}),e.jsxs("div",{className:"hidden h-10 items-center gap-3 border-l border-gray-200 pl-4 md:flex",children:[e.jsxs("div",{className:"flex flex-col text-right",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900","data-testid":"user-first-name",children:t.first_name}),e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"Pro User"})]}),e.jsx("button",{onClick:T,"data-testid":"logout-button",className:"flex h-10 w-10 items-center justify-center rounded-xl text-gray-400 transition-colors hover:bg-red-50 hover:text-red-500",title:"Logout",children:e.jsx(q,{size:20})})]})]})]}),sidebar:e.jsx("div",{className:"flex flex-col gap-6 p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"px-2 text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Data Management"}),e.jsx(fe,{onExport:Y,onImport:K})]})}),children:[e.jsxs("div",{className:"relative flex h-full flex-col overflow-hidden",children:[y&&e.jsx(Ce,{filters:x,categories:m,onChange:v}),e.jsx(ke,{tasks:N,categories:m,sortBy:r,onSort:l,onToggleStatus:J,onEdit:h,onDelete:i=>c.tasks.delete(i).then(n)}),e.jsx("div",{className:"absolute right-8 bottom-8 z-30",children:e.jsx("button",{onClick:()=>u(!0),"data-testid":"add-task-button",className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-blue-600 text-white shadow-2xl shadow-blue-300 transition-all hover:scale-105 hover:bg-blue-700 active:scale-95",children:e.jsx(F,{size:28})})})]}),(o||f)&&e.jsx(je,{task:f,categories:m,categoryId:x.categoryId,onSave:f?d:R,onClose:()=>{u(!1),h(null)}}),g&&e.jsx(be,{categories:m,onClose:()=>j(!1),onCreate:(i,p)=>c.categories.create(i,p).then(b),onUpdate:(i,p,C)=>c.categories.update(i,p,C).then(()=>{b(),n()}),onDelete:i=>c.categories.delete(i).then(()=>{b(),x.categoryId===i&&v(p=>({...p,categoryId:void 0}))})})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Re,{})}));
