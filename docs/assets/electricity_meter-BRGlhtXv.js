import"./index-BJcHZe8P.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as C}from"./button-D6DGr86I.js";import{A as y}from"./api-CH_Pe6Vg.js";import{B as O}from"./index-BehiXGmn.js";import{T as W}from"./trash-2-DQbJ9aIh.js";import"./clsx-B-dksMZM.js";import"./createLucideIcon-DtX1aPOG.js";Chart.Chart.register(Chart.CategoryScale,Chart.LinearScale,Chart.BarElement,Chart.Title,Chart.Tooltip,Chart.Legend);const B={id:"varWidth",beforeDatasetsDraw(s){const{scales:{x:m}}=s,n=s.getDatasetMeta(0),x=s.getDatasetMeta(1);[n,x].forEach(i=>{i.type==="bar"&&i.data.forEach((l,u)=>{const o=s.data.datasets[i.index].data[u];if(o&&o.start!==void 0&&o.end!==void 0){const c=m.getPixelForValue(o.start),g=m.getPixelForValue(o.end);l.x=(c+g)/2,l.width=Math.max(1,g-c-1)}})})}},v=s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),P=()=>{const[s,m]=React.useState([]),[n,x]=React.useState(null),[i,l]=React.useState(""),[u,o]=React.useState(""),[c,g]=React.useState(new Date().toISOString().slice(0,16)),[F,D]=React.useState(!1),[S,j]=React.useState(null),f=React.useCallback(async()=>{D(!0);try{const t=await fetch(`${y}/electricity_meter/`);if(!t.ok)throw new Error("Failed to fetch readings");const a=await t.json();m(a)}catch(t){j(t instanceof Error?t.message:"An error occurred")}finally{D(!1)}},[]);React.useEffect(()=>{f()},[f]);const E=async t=>{if(t.preventDefault(),!i||!u||!c)return;const a={reading_day:parseFloat(i),reading_night:parseFloat(u),date:new Date(c).toISOString()};try{const r=n?`${y}/electricity_meter/${n}`:`${y}/electricity_meter/`;if(!(await fetch(r,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw new Error(`Failed to ${n?"update":"add"} reading`);l(""),o(""),x(null),f()}catch(r){j(r instanceof Error?r.message:"An error occurred")}},_=t=>{x(t.id),l(t.reading_day.toString()),o(t.reading_night.toString()),g(new Date(t.date).toISOString().slice(0,16))},T=()=>{x(null),l(""),o(""),g(new Date().toISOString().slice(0,16))},A=async t=>{try{if(!(await fetch(`${y}/electricity_meter/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete reading");f()}catch(a){j(a instanceof Error?a.message:"An error occurred")}},R=React.useMemo(()=>{if(s.length<2)return null;const t=[...s].sort((d,h)=>new Date(d.date).getTime()-new Date(h.date).getTime()),a=[],r=[];for(let d=0;d<t.length-1;d++){const h=t[d],w=t[d+1],p=new Date(h.date).getTime(),b=new Date(w.date).getTime(),N=(b-p)/(1e3*60*60*24);if(N>0){const $=(w.reading_day-h.reading_day)/N,I=(w.reading_night-h.reading_night)/N;a.push({x:(p+b)/2,y:$,start:p,end:b}),r.push({x:(p+b)/2,y:I,start:p,end:b})}}return{datasets:[{label:"Day Tariff (kWh/day)",data:a,backgroundColor:"rgba(251, 191, 36, 0.6)",borderColor:"rgba(251, 191, 36, 1)",borderWidth:1},{label:"Night Tariff (kWh/day)",data:r,backgroundColor:"rgba(79, 70, 229, 0.6)",borderColor:"rgba(79, 70, 229, 1)",borderWidth:1}]}},[s]);return e.jsx("div",{className:"flex items-center justify-center px-4 py-8 font-sans md:px-6 md:py-10",children:e.jsxs("div",{className:"w-full max-w-5xl rounded-[32px] border border-slate-400/20 bg-slate-900/70 p-6 shadow-[0_25px_60px_rgba(2,6,23,0.8)] backdrop-blur-[18px] md:p-14",children:[e.jsx("h1",{className:"mb-8 bg-gradient-to-r from-indigo-400 to-amber-400 bg-clip-text text-center text-4xl font-bold text-transparent",children:"Electricity Meter"}),S&&e.jsx("div",{className:"mb-6 rounded-xl border border-red-500/50 bg-red-500/20 p-4 text-red-200",children:S}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-700 bg-slate-800/50 p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold",children:n?"Edit Reading":"Add New Reading"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-amber-400/80",children:"Day Reading (kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:i,onChange:t=>l(t.target.value),className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-4 py-2 transition-all outline-none focus:border-transparent focus:ring-2 focus:ring-amber-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-indigo-400/80",children:"Night Reading (kWh)"}),e.jsx("input",{type:"number",step:"0.1",value:u,onChange:t=>o(t.target.value),className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-4 py-2 transition-all outline-none focus:border-transparent focus:ring-2 focus:ring-indigo-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Date & Time"}),e.jsx("input",{type:"datetime-local",value:c,onChange:t=>g(t.target.value),className:"w-full rounded-lg border border-slate-700 bg-slate-900 px-4 py-2 transition-all outline-none focus:border-transparent focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(C,{type:"submit",className:"flex-grow",children:n?"Update Reading":"Save Reading"}),n&&e.jsx(C,{type:"button",variant:"outline",onClick:T,className:"px-4",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-700 bg-slate-800/50 p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"History"}),e.jsx("div",{className:"max-height-[300px] custom-scrollbar space-y-2 overflow-y-auto pr-2",children:s.length===0?e.jsx("p",{className:"py-4 text-center text-slate-500",children:"No readings yet."}):s.sort((t,a)=>new Date(a.date).getTime()-new Date(t.date).getTime()).map(t=>e.jsxs("div",{className:`flex cursor-pointer items-center justify-between rounded-lg border p-3 transition-all ${n===t.id?"border-indigo-500 bg-indigo-600/20 shadow-[0_0_15px_rgba(99,102,241,0.2)]":"border-slate-700/50 bg-slate-900/50 hover:border-slate-500"}`,onClick:()=>_(t),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-3 font-mono text-sm",children:[e.jsxs("span",{className:"text-amber-400",children:["D: ",t.reading_day]}),e.jsxs("span",{className:"text-indigo-400",children:["N: ",t.reading_night]})]}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:new Date(t.date).toLocaleString("en-GB",{hour12:!1})})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),A(t.id)},className:"p-2 text-slate-600 transition-colors hover:text-red-400",children:e.jsx(W,{size:18})})]},t.id))})]})]}),e.jsxs("section",{className:"flex flex-col rounded-2xl border border-slate-700 bg-slate-800/50 p-6",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"Average Consumption"}),e.jsx("div",{className:"flex flex-grow items-center justify-center",children:R?e.jsx("div",{className:"h-[400px] w-full",children:e.jsx(O,{data:R,plugins:[B],options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{color:"#94a3b8"}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.9)",titleColor:"#94a3b8",bodyColor:"#f1f5f9",borderColor:"rgba(71, 85, 105, 0.5)",borderWidth:1,callbacks:{title:t=>{const r=t[0].raw;return`${v(new Date(r.start).toISOString())} - ${v(new Date(r.end).toISOString())}`},label:t=>{const a=t.dataset.label||"",r=t.parsed.y;return`${a}: ${r!==null?r.toFixed(2):"0.00"} kWh/day`}}}},scales:{y:{stacked:!0,beginAtZero:!0,grid:{color:"rgba(71, 85, 105, 0.2)"},ticks:{color:"#94a3b8"}},x:{type:"linear",stacked:!0,grid:{display:!1},ticks:{color:"#94a3b8",maxRotation:45,minRotation:45,callback:t=>v(new Date(t).toISOString())}}}}})}):e.jsx("div",{className:"text-center text-slate-500",children:e.jsx("p",{children:"Add at least two readings to see the graph."})})})]})]})]})})},k=document.getElementById("root");k&&ReactDOM.createRoot(k).render(e.jsx(React.StrictMode,{children:e.jsx(P,{})}));
