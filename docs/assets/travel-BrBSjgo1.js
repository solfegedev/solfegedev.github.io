import"./index-D28JGqfm.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as G}from"./api-CH_Pe6Vg.js";import{c as Pe,f as ce}from"./utils-Bp7-rn4K.js";import{X as me}from"./x-BS-d4QNZ.js";import{T as ge}from"./trash-2-DQbJ9aIh.js";import{c as P}from"./createLucideIcon-DtX1aPOG.js";import{C as bt,M as ye,a as fe,L as yt}from"./map-GO46_Xp-.js";import{l as Ae,L as q}from"./leaflet-src-DBNPRDgh.js";import{b as Oe,c as vt,d as jt,e as Ue,f as ve,L as wt,g as _t,T as le,M as Nt,a as Re,P as kt,u as pe,h as Ct}from"./TileLayer-BDBp5nAp.js";import{P as Be,D as St,U as Mt,G as $t}from"./upload-FXP4Asuw.js";import{P as Ee}from"./plus-DDkdk0pc.js";import{L as Rt,U as Et}from"./users-DXQZEc7K.js";import{C as Tt}from"./copy-CzC7y2Qs.js";import"./clsx-B-dksMZM.js";const Lt=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ie=P("activity",Lt);const zt=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],He=P("bed",zt);const Dt=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ve=P("camera",Dt);const Ft=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Pt=P("chevron-up",Ft);const At=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Ot=P("circle-plus",At);const Ut=[["path",{d:"m14 15-5 5-5-5",key:"1eia93"}],["path",{d:"M20 4h-7a4 4 0 0 0-4 4v12",key:"nbpdq2"}]],Bt=P("corner-left-down",Ut);const It=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M4 20v-7a4 4 0 0 1 4-4h12",key:"1lu4f8"}]],Ht=P("corner-up-right",It);const Vt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],Gt=P("crosshair",Vt);const Zt=[["path",{d:"M10 22v-6.57",key:"1wmca3"}],["path",{d:"M12 11h.01",key:"z322tv"}],["path",{d:"M12 7h.01",key:"1ivr5q"}],["path",{d:"M14 15.43V22",key:"1q2vjd"}],["path",{d:"M15 16a5 5 0 0 0-6 0",key:"o9wqvi"}],["path",{d:"M16 11h.01",key:"xkw8gn"}],["path",{d:"M16 7h.01",key:"1kdx03"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 7h.01",key:"1vti4s"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],Ge=P("hotel",Zt);const qt=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],Ze=P("landmark",qt);const Wt=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Jt=P("log-out",Wt);const Yt=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],qe=P("plane",Yt);const Xt=[["path",{d:"M8 3.1V7a4 4 0 0 0 8 0V3.1",key:"1v71zp"}],["path",{d:"m9 15-1-1",key:"1yrq24"}],["path",{d:"m15 15 1-1",key:"1t0d6s"}],["path",{d:"M9 19c-2.8 0-5-2.2-5-5v-4a8 8 0 0 1 16 0v4c0 2.8-2.2 5-5 5Z",key:"1p0hjs"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m16 19 2 3",key:"xo31yx"}]],We=P("train-front",Xt);const Kt=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Je=P("utensils",Kt);function Qt(n){return function(i){const o=Oe(),d=n(i,o),{instance:g}=d.current,m=React.useRef(i.position),{position:b}=i;return React.useEffect(function(){return g.addTo(o.map),function(){g.remove()}},[o.map,g]),React.useEffect(function(){b!=null&&b!==m.current&&(g.setPosition(b),m.current=b)},[g,b]),d}}const es=jt(function({children:p,...i},o){const d=new Ae.Control.Layers(void 0,void 0,i);return Ue(d,ve(o,{layersControl:d}))},function(p,i,o){i.collapsed!==o.collapsed&&(i.collapsed===!0?p.collapse():p.expand())}),ts=Qt(es),V=vt(ts);function Ye(n){return function(i){const o=Oe(),d=React.useRef(i),[g,m]=React.useState(null),{layersControl:b,map:y}=o,w=React.useCallback(j=>{b!=null&&(d.current.checked&&y.addLayer(j),n(b,j,d.current.name),m(j))},[n,b,y]),_=React.useCallback(j=>{b?.removeLayer(j),m(null)},[b]),N=React.useMemo(()=>ve(o,{layerContainer:{addLayer:w,removeLayer:_}}),[o,w,_]);return React.useEffect(()=>{g!==null&&d.current!==i&&(i.checked===!0&&(d.current.checked==null||d.current.checked===!1)?y.addLayer(g):d.current.checked===!0&&(i.checked==null||i.checked===!1)&&y.removeLayer(g),d.current=i)}),i.children?React.createElement(wt,{value:N},i.children):null}}V.BaseLayer=Ye(function(p,i,o){p.addBaseLayer(i,o)});V.Overlay=Ye(function(p,i,o){p.addOverlay(i,o)});const Te=_t(function({positions:p,...i},o){const d=new Ae.Polyline(p,i);return Ue(d,ve(o,{overlayContainer:d}))},function(p,i,o){i.positions!==o.positions&&p.setLatLngs(i.positions)}),ss=({auth:n,onClose:p})=>{const[i,o]=React.useState([]),[d,g]=React.useState(!0),[m,b]=React.useState(""),[y,w]=React.useState(""),[_,N]=React.useState(""),[j,C]=React.useState(""),[E,c]=React.useState("user"),[k,R]=React.useState(null),B=async()=>{try{const v=await fetch(`${G}/travel/admin/users`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!v.ok)throw new Error("Failed to fetch users");const S=await v.json();o(S)}catch(v){console.error("Failed to fetch users",v)}finally{g(!1)}};React.useEffect(()=>{B()},[n]);const Z=async v=>{v.preventDefault(),R(null);try{const S=await fetch(`${G}/travel/admin/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({email:m,password:y,role:E,first_name:_,last_name:j})}),F=await S.json();if(!S.ok)throw new Error(F.detail||"Failed to create user");o([...i,F]),b(""),w(""),N(""),C("")}catch(S){R(S.message)}},J=async v=>{if(v===n.user.id){alert("You cannot delete yourself.");return}if(confirm("Are you sure? All their trips will be lost."))try{if(!(await fetch(`${G}/travel/admin/users/${v}`,{method:"DELETE",headers:{Authorization:`Bearer ${n.access_token}`}})).ok)throw new Error("Failed to delete user");o(i.filter(F=>F.id!==v))}catch(S){console.error("Failed to delete user",S)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex max-h-[90vh] w-full max-w-4xl flex-col overflow-hidden rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"User Management"}),e.jsx("button",{onClick:p,className:"text-slate-400 hover:text-slate-600",children:e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"flex-1 space-y-8 overflow-y-auto p-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"mb-4 text-lg font-bold text-slate-800",children:"Add New User"}),e.jsxs("form",{onSubmit:Z,className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx("input",{type:"email",placeholder:"Email",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:m,onChange:v=>b(v.target.value)}),e.jsx("input",{type:"password",placeholder:"Password",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:y,onChange:v=>w(v.target.value)}),e.jsx("input",{type:"text",placeholder:"First Name",className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:_,onChange:v=>N(v.target.value)}),e.jsx("input",{type:"text",placeholder:"Last Name",className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:j,onChange:v=>C(v.target.value)}),e.jsxs("select",{className:"rounded-lg border border-slate-200 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500",value:E,onChange:v=>c(v.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 py-2 font-bold text-white hover:bg-indigo-700",children:"Create User"})]}),k&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:k})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-4 text-lg font-bold text-slate-800",children:"Existing Users"}),d?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-100",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b border-slate-100 bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-sm font-bold text-slate-600",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-bold text-slate-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:i.map(v=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium text-slate-900",children:v.email}),e.jsxs("div",{className:"text-xs text-slate-500",children:[v.first_name," ",v.last_name]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`rounded px-2 py-0.5 text-[10px] font-bold uppercase ${v.role==="admin"?"bg-indigo-100 text-indigo-700":"bg-blue-100 text-blue-700"}`,children:v.role})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`flex items-center gap-1.5 text-xs ${v.is_active?"text-amber-600":"text-red-600"}`,children:[e.jsx("span",{className:`h-1.5 w-1.5 rounded-full ${v.is_active?"bg-amber-500":"bg-red-500"}`}),v.is_active?"Active":"Inactive"]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:v.id!==n.user.id&&e.jsx("button",{onClick:()=>J(v.id),className:"text-slate-400 hover:text-red-500",children:e.jsx(ge,{size:18})})})]},v.id))})]})})]})]})]})})},as=({onLogin:n})=>{const[p,i]=React.useState(""),[o,d]=React.useState(""),[g,m]=React.useState(null),[b,y]=React.useState(!1),w=async _=>{_.preventDefault(),y(!0),m(null);try{const N=await fetch(`${G}/travel/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,password:o})}),j=await N.json();if(!N.ok)throw new Error(j.detail||"Login failed");n(j)}catch(N){m(N.message||"Login failed")}finally{y(!1)}};return e.jsxs("div",{className:"mx-auto mt-20 max-w-md rounded-2xl border border-slate-100 bg-white p-8 shadow-xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("img",{src:"/favicon_travel.png",alt:"Travel Planner",className:"mb-4 h-16 w-16 rounded-2xl shadow-lg shadow-indigo-200"}),e.jsx("h2",{className:"text-center text-3xl font-bold text-slate-900",children:"Travel Planner"}),e.jsx("p",{className:"mt-2 text-slate-500",children:"Sign in to manage your trips"})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,"data-testid":"login-email",className:"w-full rounded-xl border border-slate-200 px-4 py-3 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",placeholder:"you@example.com",value:p,onChange:_=>i(_.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Password"}),e.jsx("input",{type:"password",required:!0,"data-testid":"login-password",className:"w-full rounded-xl border border-slate-200 px-4 py-3 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",placeholder:"••••••••",value:o,onChange:_=>d(_.target.value)})]}),g&&e.jsx("div",{className:"rounded-lg border border-red-100 bg-red-50 p-3 text-sm font-medium text-red-600",children:g}),e.jsx("button",{type:"submit",disabled:b,className:"w-full rounded-xl bg-indigo-600 py-4 text-lg font-bold text-white shadow-lg shadow-indigo-100 transition-all hover:bg-indigo-700 active:scale-[0.98] disabled:cursor-not-allowed disabled:opacity-70",children:b?"Signing in...":"Sign In"})]})]})},be=({text:n,className:p,textClassName:i,maxLines:o=3,badge:d})=>{const[g,m]=React.useState(!1),[b,y]=React.useState(!1),w=React.useRef(null);return React.useEffect(()=>{const _=()=>{if(w.current){const N=w.current.cloneNode(!0);N.style.webkitLineClamp="unset",N.style.display="block",N.style.visibility="hidden",N.style.position="absolute",N.style.width=`${w.current.clientWidth}px`,document.body.appendChild(N);const j=N.scrollHeight,C=w.current.cloneNode(!0);C.style.webkitLineClamp=o.toString(),C.style.display="-webkit-box",C.style.webkitBoxOrient="vertical",C.style.visibility="hidden",C.style.position="absolute",C.style.width=`${w.current.clientWidth}px`,document.body.appendChild(C);const E=C.clientHeight;document.body.removeChild(N),document.body.removeChild(C),y(j>E)}};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[n,o]),n?e.jsxs("div",{className:p,children:[e.jsxs("div",{className:"flex items-start gap-1.5",children:[d,e.jsx("div",{ref:w,className:Pe("whitespace-pre-line transition-all duration-200",!g&&"overflow-hidden",i),style:g?{display:"block"}:{display:"-webkit-box",WebkitLineClamp:o,WebkitBoxOrient:"vertical"},children:n})]}),b&&e.jsx("button",{onClick:_=>{_.stopPropagation(),m(!g)},className:"mt-0.5 flex items-center gap-1 text-[10px] font-bold text-slate-400 uppercase hover:text-slate-500",children:g?e.jsxs(e.Fragment,{children:[e.jsx(Pt,{size:12}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{size:12}),"Show More"]})})]}):null},de=12,Xe=[51.477,0],Ke=2,H=`${G}/travel/trips`,ns=({polylinePoints:n,spokeLines:p})=>e.jsxs(V,{position:"topright",children:[e.jsx(V.BaseLayer,{checked:!0,name:"Map",children:e.jsx(le,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:19})}),e.jsx(V.BaseLayer,{name:"3D Terrain",children:e.jsx(le,{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20})}),e.jsx(V.BaseLayer,{name:"3D topography",children:e.jsx(le,{attribution:'Map data: © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: © <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",maxZoom:17})}),e.jsx(V.BaseLayer,{name:"Satellite",children:e.jsx(le,{attribution:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),n.length>1&&e.jsx(V.Overlay,{checked:!0,name:"Show Route",children:e.jsx(Te,{positions:n,color:"var(--color-red-600)",weight:5,opacity:.8,dashArray:"10, 10"})}),p.length>0&&e.jsx(V.Overlay,{checked:!0,name:"Show Activities",children:e.jsx(Te,{positions:p,color:"var(--color-green-600)",weight:3,opacity:.8,dashArray:"5, 5"})})]}),Le={hotel:He,restaurant:Je,museum:Ze,airport:qe,train_station:We,sightseeing:Ve,activity:Ie,other:ye},ie={hotel:'<path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/>',restaurant:'<path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>',museum:'<line x1="3" y1="22" x2="21" y2="22"/><line x1="6" y1="18" x2="6" y2="11"/><line x1="10" y1="18" x2="10" y2="11"/><line x1="14" y1="18" x2="14" y2="11"/><line x1="18" y1="18" x2="18" y2="11"/><polyline points="12 2 20 7 4 7 12 2"/>',airport:'<path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/>',train_station:'<path d="M4 3h16a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"/><path d="M6 8h12"/><path d="m16.8 22-1.5-3"/><path d="m7.2 22 1.5-3"/><path d="M2 13h20"/><circle cx="12" cy="16" r="2"/>',sightseeing:'<path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/>',activity:'<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>',other:'<path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/>'},ze=(n,p,i,o)=>{const d=i&&ie[i]?ie[i]:ie.other,g=i&&ie[i]?i:"map-pin",m=30,b=42,y=o?1.3:1,w=m*y,_=b*y,N=o?16:12,C=String(n).length>2?N-3:N,E=24*y,c=`<svg width="${14*y}" height="${14*y}" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="${o?3:2.5}" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-${g}">${d}</svg>`,k=`
    <div style="position: relative; width: ${w}px; height: ${_}px;">
      <svg width="${w}" height="${_}" viewBox="0 0 30 42" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
        <path d="M15 0C6.716 0 0 6.716 0 15C0 26.25 15 42 15 42C15 42 30 26.25 30 15C30 6.716 23.284 0 15 0Z" fill="${p}"/>
        <circle cx="15" cy="15" r="11" fill="white"/>
      </svg>
      <div style="position: absolute; top: ${15*y}px; left: ${15*y}px; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; font-size: ${C}px; font-weight: 900; color: ${p}; text-align: center; width: ${20*y}px;">
        ${n}
      </div>
      <div style="position: absolute; top: ${-8*y}px; right: ${-12*y}px; background: ${p}; border: 2px solid white; border-radius: 50%; width: ${E}px; height: ${E}px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;">
        ${c}
      </div>
    </div>
  `;return q.divIcon({html:k,className:"custom-div-icon",iconSize:[w,_],iconAnchor:[w/2,_],popupAnchor:[0,-_]})},W=n=>typeof n.lat=="number"&&Number.isFinite(n.lat)&&typeof n.lng=="number"&&Number.isFinite(n.lng),rs=({items:n,onClearSelection:p})=>{const i=pe();return React.useEffect(()=>{const o=new q.Control({position:"topleft"});return o.onAdd=()=>{const d=q.DomUtil.create("div","leaflet-bar leaflet-control"),g=q.DomUtil.create("a","leaflet-control-reset",d);return g.innerHTML='<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display: block; margin: 0 auto;"><path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8M3 16.2V21m0 0h4.8M3 21l6-6M21 7.8V3m0 0h-4.8M21 3l-6 6M3 7.8V3m0 0h4.8M3 3l6 6"/></svg>',g.href="#",g.title="Reset View",g.style.backgroundColor="white",g.style.cursor="pointer",q.DomEvent.on(g,"click",m=>{q.DomEvent.stop(m),p();const b=n.filter(W);if(b.length>0){const y=q.latLngBounds(b.map(w=>[w.lat,w.lng]));i.flyToBounds(y,{padding:[50,50],duration:1.5,maxZoom:de})}else i.flyTo(Xe,Ke,{duration:1.5})}),d},i.addControl(o),()=>{i.removeControl(o)}},[i,n,p]),null},os=({isCollapsed:n})=>{const p=pe();return React.useEffect(()=>{if(!n){const i=setTimeout(()=>{p.invalidateSize()},100);return()=>clearTimeout(i)}},[n,p]),null},ls=({items:n,selectedItem:p,isCollapsed:i})=>{const o=pe(),d=React.useRef(void 0),g=React.useRef(0);return React.useEffect(()=>{const m=o.getContainer();if(m.clientWidth===0||m.clientHeight===0)return;const b=p?.id??null,y=n.length,w=d.current!==b,_=g.current===0&&y>0;if(w||_){if(p&&n.some(j=>j.id===p.id)&&p&&W(p))try{const j=o.getZoom(),C=j>de?j:de;o.flyTo([p.lat,p.lng],C,{duration:1.5,easeLinearity:.25})}catch(j){console.error("Failed to fly to selected item",j)}else if(!p){const j=n.filter(W);if(j.length>0)try{const C=q.latLngBounds(j.map(E=>[E.lat,E.lng]));o.flyToBounds(C,{padding:[50,50],duration:1.5,maxZoom:de})}catch(C){console.error("Failed to fly to bounds",C)}}d.current=b,g.current=y}},[n,p,o,i]),null},is=({isSelecting:n})=>{const p=pe();return React.useEffect(()=>{n?p.getContainer().style.cursor="crosshair":p.getContainer().style.cursor=""},[n,p]),null},ds=({onLocationSelect:n})=>(Ct({click(p){n(p.latlng.lat,p.latlng.lng)}}),null);function cs({items:n,selectedItem:p,editingItemId:i,editingItemLocation:o,onSelectItem:d,onEdit:g,onLocationSelect:m,onCancelLocationSelect:b,isSelectingLocation:y,isCollapsed:w}){const _=React.useMemo(()=>n.filter(c=>!c.parent_id),[n]),N=React.useMemo(()=>_.filter(c=>c.is_connected),[_]),j=N.length,C=React.useMemo(()=>N.filter(W).map(c=>[c.lat,c.lng]),[N]),E=React.useMemo(()=>{const c=[];return n.forEach(k=>{if(k.parent_id&&W(k)){const R=n.find(B=>B.id===k.parent_id);R&&W(R)&&c.push([[R.lat,R.lng],[k.lat,k.lng]])}}),c},[n]);return e.jsxs("div",{className:"relative z-0 h-full w-full overflow-hidden rounded-lg border border-slate-200",children:[e.jsxs(Nt,{center:Xe,zoom:Ke,zoomSnap:0,zoomDelta:.1,wheelPxPerZoomLevel:120,scrollWheelZoom:!0,className:"h-full w-full",attributionControl:!1,children:[e.jsx(os,{isCollapsed:w}),e.jsx(ns,{polylinePoints:C,spokeLines:E}),e.jsx(ls,{items:n,selectedItem:p,isCollapsed:w}),e.jsx(is,{isSelecting:!!y}),e.jsx(rs,{items:n,onClearSelection:()=>d(null)}),n.map(c=>{let k=c.lat,R=c.lng,B=c.category;const Z=c.id===i;if(Z&&o){if(o.hide_from_map)return null;k=o.lat,R=o.lng,B=o.category||c.category}if(!W({lat:k,lng:R}))return null;const J=c.id===p?.id||Z,v=!!c.parent_id,S=v?"var(--color-green-500)":c.is_connected?"var(--color-indigo-500)":"var(--color-amber-500)";let F="•";if(v){const A=n.find(I=>I.id===c.parent_id);if(A){const I=_.findIndex(te=>te.id===A.id);if(I!==-1){const te=A.is_connected?I+1:String.fromCharCode(65+(I-j)),O=n.filter(K=>K.parent_id===c.parent_id).findIndex(K=>K.id===c.id);O!==-1&&(F=`${te}.${O+1}`)}}}else{const A=_.findIndex(I=>I.id===c.id);A!==-1&&(F=c.is_connected?A+1:String.fromCharCode(65+(A-j)))}return e.jsx(Re,{position:[k,R],icon:ze(F,S,B,J),eventHandlers:{click:()=>d(c)},children:e.jsx(kt,{maxWidth:2e3,children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-2",children:[B&&Le[B]&&e.jsx("div",{className:v?"text-green-600":c.is_connected?"text-indigo-500":"text-amber-500",children:(()=>{const A=Le[B];return e.jsx(A,{size:14})})()}),e.jsx("h3",{className:"font-bold",children:c.location}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[c.is_tba&&e.jsx("span",{className:"shrink-0 rounded border border-green-200 bg-green-100 px-1 py-0.5 text-[10px] font-bold tracking-wider text-green-700 uppercase",children:"TBA"}),g&&e.jsx("button",{onClick:A=>{A.stopPropagation(),g(c)},className:"p-1 text-slate-400 transition-colors hover:text-indigo-600",title:"Edit",children:e.jsx(Be,{size:14})})]})]}),e.jsxs("div",{className:"text-[11px] font-bold tracking-wider text-slate-500 uppercase",children:[[c.date?ce(c.date,!0):null,c.time?c.time.substring(0,5):null].filter(Boolean).join(" @ "),(c.date_departure||c.time_departure)&&e.jsxs(e.Fragment,{children:[" → ",[c.date_departure?ce(c.date_departure):null,c.time_departure?c.time_departure.substring(0,5):null].filter(Boolean).join(" @ ")]}),!c.date&&!c.time&&"Flexible Timing"]}),c.description&&e.jsx(be,{text:c.description,className:"mt-1",textClassName:"text-sm text-slate-600"}),(c.url_property||c.url_map)&&e.jsxs("div",{className:"mt-2 flex gap-2",children:[c.url_property&&e.jsxs("a",{href:c.url_property,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded border border-blue-500 bg-blue-50 px-2 py-0.5 text-[10px] font-bold !text-blue-800 uppercase transition-colors hover:!text-blue-900",children:[e.jsx(Ge,{size:10}),"Hotel"]}),c.url_map&&e.jsxs("a",{href:c.url_map,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded border border-amber-500 bg-amber-50 px-2 py-0.5 text-[10px] font-bold !text-amber-600 uppercase transition-colors hover:!text-amber-800",children:[e.jsx(fe,{size:10}),"Google Map"]})]})]})})},c.id)}),!i&&o&&!o.hide_from_map&&W(o)&&e.jsx(Re,{position:[o.lat,o.lng],icon:ze(String.fromCharCode(65+(_.length-j)),"var(--color-amber-500)",o.category,!0)}),y&&m&&e.jsx(ds,{onLocationSelect:m})]}),y&&e.jsxs("div",{className:"absolute top-4 left-1/2 z-[1000] flex -translate-x-1/2 flex-col items-center gap-2",children:[e.jsx("div",{className:"rounded-full border border-indigo-200 bg-white px-4 py-2 text-sm font-bold text-indigo-600 shadow-lg",children:"Select new location on map"}),b&&e.jsx("button",{onClick:c=>{c.stopPropagation(),b()},className:"rounded-full border border-slate-200 bg-white px-4 py-1.5 text-xs font-bold text-slate-500 shadow-md transition-all hover:bg-slate-50",children:"Cancel"})]})]})}const ps=({auth:n,trip:p,onUpdate:i,onClose:o})=>{const[d,g]=React.useState(""),[m,b]=React.useState(p.collaborator_emails||[]),[y,w]=React.useState(!1),[_,N]=React.useState(null),j=k=>{if(k.preventDefault(),!!d.trim()){if(m.includes(d.trim())){N("User already added");return}b([...m,d.trim()]),g(""),N(null)}},C=k=>{b(m.filter(R=>R!==k))},E=async()=>{w(!0),N(null);try{const k=await fetch(`${G}/travel/trips/${p.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify({collaborator_emails:m})}),R=await k.json();if(!k.ok)throw new Error(R.detail||"Failed to update collaborators");i(R),o()}catch(k){N(k.message)}finally{w(!1)}},c=`${window.location.origin}${window.location.pathname}?share_token=${p.share_token}`;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex w-full max-w-md flex-col overflow-hidden rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Share Trip"}),e.jsx("button",{onClick:o,className:"text-slate-400 hover:text-slate-600",children:e.jsx(me,{size:24})})]}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("section",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Public Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{readOnly:!0,className:"flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500 outline-none",value:c}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(c)},className:"rounded-lg bg-slate-100 px-3 py-2 text-sm font-bold text-slate-600 hover:bg-slate-200",children:"Copy"})]}),e.jsx("p",{className:"mt-1 text-[10px] text-slate-400",children:"Anyone with this link can view the trip (read-only)."})]}),e.jsxs("section",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:"Collaborators"}),e.jsx("p",{className:"mb-3 text-xs text-slate-500",children:"Add other users to give them editing rights."}),e.jsxs("form",{onSubmit:j,className:"mb-4 flex gap-2",children:[e.jsx("input",{type:"email",placeholder:"user@example.com",className:"flex-1 rounded-lg border border-slate-200 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500",value:d,onChange:k=>g(k.target.value)}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-bold text-white hover:bg-indigo-700",children:"Add"})]}),e.jsxs("div",{className:"max-h-40 space-y-2 overflow-y-auto pr-2",children:[m.length===0&&e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No collaborators yet."}),m.map(k=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2",children:[e.jsx("span",{className:"truncate text-sm text-slate-700",children:k}),e.jsx("button",{onClick:()=>C(k),className:"text-slate-400 hover:text-red-500",children:e.jsx(me,{size:16})})]},k))]})]}),_&&e.jsx("p",{className:"text-sm text-red-500",children:_})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t border-slate-100 bg-slate-50 p-6",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-bold text-slate-600 hover:text-slate-800",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:y,className:"rounded-lg bg-indigo-600 px-6 py-2 text-sm font-bold text-white hover:bg-indigo-700 disabled:opacity-50",children:y?"Saving...":"Save Changes"})]})]})})},De=[{id:"hotel",label:"Hotel",icon:He},{id:"restaurant",label:"Restaurant",icon:Je},{id:"museum",label:"Museum",icon:Ze},{id:"airport",label:"Airport",icon:qe},{id:"train_station",label:"Train Station",icon:We},{id:"sightseeing",label:"Sightseeing",icon:Ve},{id:"activity",label:"Activity",icon:Ie},{id:"other",label:"Other",icon:ye}],re=({className:n,variant:p="slate",children:i,...o})=>{const d={slate:"bg-slate-100 text-slate-600 hover:bg-slate-200",indigo:"bg-indigo-600 text-white hover:bg-indigo-700","indigo-light":"bg-indigo-50 text-indigo-700 hover:bg-indigo-100"};return e.jsx("button",{className:Pe("flex items-center gap-2 rounded-lg px-4 py-2.5 text-sm font-semibold transition-all",d[p],n),...o,children:i})},us=()=>{const[n,p]=React.useState(null),[i,o]=React.useState([]),[d,g]=React.useState(null),[m,b]=React.useState([]),[y,w]=React.useState(!0),[_,N]=React.useState(null),[j,C]=React.useState(null),[E,c]=React.useState(!1),[k,R]=React.useState(!1),[B,Z]=React.useState(!1),[J,v]=React.useState(""),[S,F]=React.useState(null),[A,I]=React.useState(!1),[te,ue]=React.useState(!1),[O,K]=React.useState(null),[je,Q]=React.useState(null),[T,we]=React.useState(!1),[Qe,Y]=React.useState(""),ee=React.useRef(null),se=React.useRef(null),oe=React.useRef(null);React.useEffect(()=>{let t;return O!==null&&(t=window.setInterval(()=>{if(!se.current||!oe.current)return;const s=se.current.getBoundingClientRect(),r=oe.current.y-s.top,l=s.height*.2;if(r<l&&r>=-50){const h=Math.max(2,(1-r/l)*12);se.current.scrollTop-=h}else if(r>s.height-l&&r<=s.height+50){const h=r-(s.height-l),u=Math.max(2,h/l*12);se.current.scrollTop+=u}},16)),()=>{t&&clearInterval(t)}},[O]),React.useEffect(()=>{if(j){const t=document.getElementById(`travel-item-${j.id}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}},[j]);const[x,M]=React.useState({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",hide_from_map:!1,is_connected:!1,parent_id:null}),he=new URLSearchParams(window.location.search).get("share_token"),z=!!he;React.useEffect(()=>{const t=localStorage.getItem("travel_auth");if(t)try{p(JSON.parse(t))}catch{localStorage.removeItem("travel_auth")}},[]);const et=t=>{p(t),localStorage.setItem("travel_auth",JSON.stringify(t))},xe=()=>{p(null),localStorage.removeItem("travel_auth"),o([]),b([])},U=React.useCallback(async(t,s={})=>{const r={...s.headers||{},...n?{Authorization:`Bearer ${n.access_token}`}:{}};return fetch(t,{...s,headers:r})},[n]),_e=React.useCallback(async()=>{if(!(z||!n))try{const t=await U(H);if(t.status===401){xe();return}if(!t.ok)throw new Error("Failed to fetch trips");const s=await t.json();o(s),s.length>0&&d===null&&g(s[0].id)}catch(t){console.error(t)}},[d,z,n,U]),Ne=React.useCallback(async()=>{if(z){w(!0);try{const t=await fetch(`${G}/travel/shared/${he}`);if(!t.ok)throw new Error("Failed to fetch shared trip");const s=await t.json();o([s.trip]),g(s.trip.id);const r=s.items.map((l,h)=>({...l,is_connected:h<s.trip.active_count}));b(r),N(null)}catch(t){N("Failed to load shared itinerary. It may have been deleted or the link is invalid."),console.error(t)}finally{w(!1)}return}if(!n||d===null){b([]),w(!1);return}w(!0);try{const t=await U(`${H}/${d}/items`);if(t.status===401){xe();return}if(!t.ok)throw new Error("Failed to fetch itinerary items");const s=await t.json(),r=s.items.map((l,h)=>({...l,is_connected:h<s.active_count}));b(r),N(null)}catch(t){N("Failed to load itinerary. Please try again."),console.error(t)}finally{w(!1)}},[d,z,he,n,U]);React.useEffect(()=>{_e()},[_e]),React.useEffect(()=>{Ne(),z||(C(null),F(null),c(!1),M({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",hide_from_map:!1,is_connected:!1,parent_id:null}))},[Ne,z]);const X=React.useMemo(()=>i.find(t=>t.id===d),[i,d]),ke=React.useMemo(()=>n&&X&&n.user.id===X.user_id,[n,X]),tt=()=>{if(ke)ue(!0);else if(X){const t=`${window.location.origin}${window.location.pathname}?share_token=${X.share_token}`;navigator.clipboard.writeText(t)}},st=async()=>{if(d!==null)try{const t=await U(`${H}/${d}/export`);if(!t.ok)throw new Error("Failed to export trip");const s=await t.blob(),r=t.headers.get("Content-Disposition");let l="trip_backup.yml";if(r){const a=r.match(/filename="?([^"]+)"?/);a&&(l=a[1])}const h=URL.createObjectURL(s),u=document.createElement("a");u.href=h,u.download=l,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h)}catch(t){alert("Failed to export trip"),console.error(t)}},at=async t=>{const s=t.target.files?.[0];if(s){if(!confirm("This will import the trip as a new trip. Continue?")){ee.current&&(ee.current.value="");return}try{const r=await s.text(),l=await U(`${H}/import`,{method:"POST",headers:{"Content-Type":"text/yaml"},body:r});if(!l.ok){const u=await l.json();throw new Error(u.detail||"Failed to import trip")}const h=await l.json();o(u=>[...u,h]),g(h.id),alert("Successfully imported trip!")}catch(r){alert(`Failed to import: ${r instanceof Error?r.message:String(r)}`),console.error(r)}finally{ee.current&&(ee.current.value="")}}},nt=async t=>{if(t.preventDefault(),!!J.trim())try{const s=await U(H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:J})});if(!s.ok)throw new Error("Failed to create trip");const r=await s.json();o(l=>[...l,r]),g(r.id),v(""),Z(!1)}catch(s){alert("Failed to create trip"),console.error(s)}},rt=async t=>{if(confirm("Are you sure you want to delete this trip and all its items?"))try{if(!(await U(`${H}/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete trip");o(r=>r.filter(l=>l.id!==t)),d===t&&g(i.find(r=>r.id!==t)?.id||null)}catch(s){alert("Failed to delete trip"),console.error(s)}},Ce=(t=null)=>{F(null),M({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",hide_from_map:!1,is_connected:!0,parent_id:t}),Y(""),c(!0)},ae=async t=>{if(d===null)return;const s=[...t].sort((l,h)=>l.is_connected!==h.is_connected?l.is_connected?-1:1:0),r=s.filter(l=>l.is_connected).length;try{const l=await U(`${H}/${d}/items`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:s,connections:[],active_count:r})});if(!l.ok)throw new Error("Failed to sync trip items");const h=await l.json(),u=h.items.map((a,f)=>({...a,is_connected:f<h.active_count}));b(u)}catch(l){throw console.error("Sync error:",l),l}},ot=async(t,s)=>{try{const r=m.filter($=>$.parent_id===s.id),l=r.length>0?r[r.length-1]:null,h=m.filter($=>$.id!==t.id),u=h.findIndex($=>$.id===s.id),a=l?h.findIndex($=>$.id===l.id)+1:u+1,f=[...h];f.splice(a,0,{...t,parent_id:s.id}),await ae(f)}catch(r){alert("Failed to indent item"),console.error(r)}},lt=async t=>{try{const s=m.findIndex(u=>u.id===t.parent_id),l=[...m.filter(u=>u.id!==t.id)],h={...t,parent_id:null,is_connected:!0};if(s!==-1){const u=l.findIndex(a=>a.id===t.parent_id);l.splice(u+1,0,h)}else l.push(h);await ae(l)}catch(s){alert("Failed to outdent item"),console.error(s)}},Se=t=>{F(t.id),M({date:t.date,time:t.time,location:t.location,description:t.description,description_private:t.description_private,category:t.category||"other",lat:t.lat,lng:t.lng,date_departure:t.date_departure,time_departure:t.time_departure,is_tba:t.is_tba,url_property:t.url_property||"",url_map:t.url_map||"",hide_from_map:t.hide_from_map,is_connected:t.is_connected,parent_id:t.parent_id}),Y(t.lat&&t.lng?`${t.lat}, ${t.lng}`:""),c(!0)},it=async t=>{if(t.preventDefault(),d!==null)try{const s=S?`${G}/travel/items/${S}`:`${H}/${d}/items`,l=await U(s,{method:S?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:x.date,time:x.time,location:x.location,description:x.description,description_private:x.description_private,category:x.category,lat:x.lat,lng:x.lng,date_departure:x.date_departure,time_departure:x.time_departure,is_tba:x.is_tba,url_property:x.url_property,url_map:x.url_map,hide_from_map:x.hide_from_map,parent_id:x.parent_id})});if(!l.ok)throw new Error("Failed to save item");const h=await l.json();let u;S?u=m.map(a=>a.id===S?{...a,...h,is_connected:x.is_connected}:a):u=[...m,{...h,is_connected:x.is_connected}],await ae(u),c(!1),F(null),M({date:new Date().toISOString().split("T")[0],time:null,location:"",description:"",description_private:"",category:"other",lat:null,lng:null,date_departure:null,time_departure:null,is_tba:!1,url_property:"",url_map:"",hide_from_map:!1,is_connected:!1,parent_id:null})}catch(s){alert("Failed to save item"),console.error(s)}},dt=async t=>{if(confirm("Are you sure you want to delete this item?"))try{if(!(await U(`${G}/travel/items/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");const r=m.filter(u=>u.parent_id===t),h=[...m.filter(u=>u.id!==t&&u.parent_id!==t),...r.map(u=>({...u,parent_id:null,is_connected:!1}))];await ae(h),j?.id===t&&C(null)}catch(s){alert("Failed to delete item"),console.error(s)}},ct=async t=>{if(confirm("Are you sure you want to duplicate this item?"))try{const s=await U(`${H}/${d}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:t.date,time:t.time,location:t.location,description:`**DUPLICATED**
${t.description}`,description_private:t.description_private,category:t.category,lat:t.lat,lng:t.lng,date_departure:t.date_departure,time_departure:t.time_departure,is_tba:!0,url_property:t.url_property,url_map:t.url_map,parent_id:t.parent_id})});if(!s.ok)throw new Error("Failed to duplicate item");const r=await s.json();b(l=>[...l,{...r,is_connected:!1}])}catch(s){alert("Failed to duplicate item"),console.error(s)}},pt=t=>{K(t)},ut=(t,s)=>{if(t.preventDefault(),O===null||O===s)return;const r=m.findIndex(D=>D.id===O),l=m.findIndex(D=>D.id===s);if(r===-1||l===-1)return;const h=[...m],[u]=h.splice(r,1),a=m.filter(D=>D.is_connected).length;u.is_connected=l<a,h.splice(l,0,u);const f=m.map(D=>`${D.id}-${D.is_connected}`).join(","),$=h.map(D=>`${D.id}-${D.is_connected}`).join(",");f!==$&&b(h)},ht=async()=>{if(!(O===null||d===null)){K(null),Q(null),oe.current=null;try{await ae(m)}catch(t){alert("Failed to save reordered items"),console.error(t)}}},xt=t=>{if(t.preventDefault(),O===null)return;const s=m.findIndex(f=>f.id===O);if(s===-1)return;const r=[...m],[l]=r.splice(s,1),h=m.filter(f=>f.id!==O&&f.is_connected).length;l.is_connected=!1,r.splice(h,0,l);const u=m.map(f=>`${f.id}-${f.is_connected}`).join(","),a=r.map(f=>`${f.id}-${f.is_connected}`).join(",");u!==a&&b(r)},ne=React.useMemo(()=>m,[m]),Me=React.useMemo(()=>m.filter(t=>t.is_connected).length,[m]);return!n&&!z?e.jsx(as,{onLogin:et}):e.jsxs("div",{className:"flex h-full flex-col overflow-hidden border bg-slate-50 font-sans text-slate-900 md:rounded-2xl md:border-slate-200/50 md:shadow-2xl",children:[e.jsxs("header",{className:"z-10 flex flex-wrap items-center justify-between gap-4 border-b border-slate-200 bg-white px-6 py-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/favicon_travel.png",alt:"Travel Planner",className:"h-10 w-10 shrink-0 rounded-xl shadow-lg shadow-indigo-200"}),e.jsx("h1",{className:"hidden text-2xl font-bold tracking-tight text-slate-900 md:block",children:"Travel Planner"})]}),e.jsx("div",{className:"flex max-w-md flex-1 items-center gap-3",children:B?e.jsxs("form",{onSubmit:nt,className:"flex w-full gap-2",children:[e.jsx("input",{autoFocus:!0,type:"text","data-testid":"trip-name-input",placeholder:"Trip name...",className:"flex-1 rounded-lg border border-slate-200 px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-indigo-500",value:J,onChange:t=>v(t.target.value)}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-3 py-1.5 text-xs font-bold text-white hover:bg-indigo-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"rounded-lg bg-slate-100 px-3 py-1.5 text-xs font-bold text-slate-600 hover:bg-slate-200",children:"Cancel"})]}):e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsxs("select",{className:"flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-500 disabled:cursor-default disabled:opacity-70",value:d||"",onChange:t=>g(Number(t.target.value)),disabled:z,children:[i.length===0&&e.jsx("option",{value:"",children:"No trips created"}),i.map(t=>e.jsxs("option",{value:t.id,children:[t.name,n&&t.user_id!==n.user.id?" (Shared)":""]},t.id))]}),!z&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Z(!0),className:"shrink-0 rounded-lg bg-slate-100 p-2 text-slate-600 transition-colors hover:bg-slate-200",title:"Create New Trip","data-testid":"create-trip-button",children:e.jsx(Ee,{size:20})}),d&&ke&&e.jsx("button",{onClick:()=>rt(d),className:"shrink-0 rounded-lg bg-slate-100 p-2 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-500",title:"Delete Current Trip",children:e.jsx(ge,{size:20})})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[d&&e.jsxs("div",{className:"flex items-center gap-2",children:[!z&&e.jsxs(re,{onClick:tt,title:"Share Trip",children:[e.jsx(Rt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Share"})]}),!z&&e.jsxs(e.Fragment,{children:[e.jsxs(re,{onClick:st,title:"Export to YAML",children:[e.jsx(St,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Export"})]}),e.jsxs(re,{onClick:()=>ee.current?.click(),title:"Import from YAML",children:[e.jsx(Mt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Import"})]}),e.jsx("input",{type:"file",ref:ee,onChange:at,accept:".yaml,.yml",className:"hidden"})]})]}),e.jsxs(re,{variant:"indigo",onClick:()=>we(!T),title:T?"Show Map":"List View",children:[T?e.jsx(fe,{size:18}):e.jsx(yt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:T?"Show Map":"List View"})]}),!z&&e.jsxs(e.Fragment,{children:[n?.user.role==="admin"&&e.jsxs(re,{variant:"indigo-light",onClick:()=>I(!0),title:"Manage Users",children:[e.jsx(Et,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Users"})]}),e.jsx("button",{onClick:xe,className:"p-2 text-slate-500 transition-colors hover:text-red-500",title:"Logout",children:e.jsx(Jt,{size:20})})]})]})]}),e.jsxs("main",{className:"relative flex flex-1 overflow-hidden",children:[e.jsx("div",{className:`${T||E&&!k?"flex w-full":"hidden md:flex md:w-1/3"} z-20 flex-col overflow-hidden border-r border-slate-200 bg-white shadow-xl transition-all duration-300`,children:E?e.jsxs("div",{className:"overflow-y-auto p-6",children:[e.jsx("h2",{className:"mb-6 text-xl font-bold text-slate-800",children:S?"Edit Destination":"Add New Destination"}),e.jsxs("form",{onSubmit:it,className:"space-y-5",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),F(null)},className:"flex-1 rounded-lg bg-slate-100 py-3 font-bold text-slate-600 transition-all hover:bg-slate-200",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-[2] rounded-lg bg-indigo-600 py-3 font-bold text-white shadow-lg shadow-indigo-100 transition-all hover:bg-indigo-700",children:S?"Save Changes":"Save to Itinerary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[" ",e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-date",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Date"}),e.jsx("input",{id:"travel-date","data-testid":"travel-date",type:"date",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.date||"",onChange:t=>M({...x,date:t.target.value||null})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-time",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Time"}),e.jsx("input",{id:"travel-time","data-testid":"travel-time",type:"time",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.time||"",onChange:t=>M({...x,time:t.target.value||null})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-departure-date",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Departure Date"}),e.jsx("input",{id:"travel-departure-date","data-testid":"travel-departure-date",type:"date",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.date_departure||"",onChange:t=>M({...x,date_departure:t.target.value||null}),onFocus:()=>{!x.date_departure&&x.date&&M({...x,date_departure:x.date})}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"travel-departure-time",className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Departure Time"}),e.jsx("input",{id:"travel-departure-time","data-testid":"travel-departure-time",type:"time",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.time_departure||"",onChange:t=>M({...x,time_departure:t.target.value||null})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Category"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:De.map(t=>{const s=t.icon,r=x.category===t.id;return e.jsxs("button",{type:"button",onClick:()=>M({...x,category:t.id}),className:`flex flex-col items-center gap-1.5 rounded-lg border p-2 transition-all ${r?"border-indigo-200 bg-indigo-50 text-indigo-600 shadow-sm":"border-slate-100 bg-white text-slate-400 hover:border-slate-200 hover:bg-slate-50"}`,children:[e.jsx(s,{size:18}),e.jsx("span",{className:"text-[10px] font-bold tracking-wider uppercase",children:t.label})]},t.id)})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500",checked:x.is_tba,onChange:t=>M({...x,is_tba:t.target.checked})}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"TBA (To Be Amended)"})]}),e.jsxs("label",{className:"flex cursor-pointer items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500",checked:x.hide_from_map,onChange:t=>M({...x,hide_from_map:t.target.checked})}),e.jsx("span",{className:"text-sm font-semibold text-slate-700",children:"Hide from map"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:["Location Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,"data-testid":"location-input",placeholder:"e.g. Paris, France",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.location,onChange:t=>M({...x,location:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Description"}),e.jsx("textarea",{rows:6,"data-testid":"description-input",placeholder:"What are you planning to do there?",className:"w-full resize-y rounded-lg border border-slate-200 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.description,onChange:t=>M({...x,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Private Note (hidden on shared links)"}),e.jsx("textarea",{rows:6,placeholder:"Personal notes, booking references, etc.",className:"w-full resize-y rounded-lg border border-slate-200 bg-green-50/30 px-4 py-2.5 transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.description_private,onChange:t=>M({...x,description_private:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Coordinates"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text","data-testid":"gps-input",placeholder:"GPS 'lat, lng' or Google Maps link https://www.google.com/maps/place/...",className:"flex-1 rounded-lg border border-slate-200 px-4 py-2 text-sm transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:Qe,onChange:t=>{const s=t.target.value;if(Y(s),s.startsWith("http")){const r=s.match(/!3d(-?\d+(?:\.\d+)?)/),l=s.match(/!4d(-?\d+(?:\.\d+)?)/);if(r&&l){const h=parseFloat(r[1]),u=parseFloat(l[1]);!isNaN(h)&&!isNaN(u)&&(M({...x,lat:h,lng:u}),Y(`${h}, ${u}`))}else{const h=s.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);if(h){const u=parseFloat(h[1]),a=parseFloat(h[2]);!isNaN(u)&&!isNaN(a)&&(M({...x,lat:u,lng:a}),Y(`${u}, ${a}`))}}}else{const r=s.split(/[\s,]+/);if(r.length>=2){const l=parseFloat(r[0]),h=parseFloat(r[1]);!isNaN(l)&&!isNaN(h)&&M({...x,lat:l,lng:h})}}}}),e.jsx("button",{type:"button",onClick:()=>{R(!0),we(!1)},className:"flex shrink-0 items-center justify-center rounded-lg border border-indigo-200 bg-indigo-50 px-3 py-2 font-bold text-indigo-700 shadow-sm transition-all hover:bg-indigo-100",title:"Pick location on map","data-testid":"select-on-map-button",children:e.jsx(Gt,{size:20})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:["Google Map URL (or"," ",e.jsx("a",{href:"https://developers.google.com/maps/documentation/javascript/examples/places-placeid-finder",target:"_blank",rel:"noopener noreferrer",className:"font-normal text-indigo-600 hover:underline",onClick:t=>t.stopPropagation(),children:"Google Place ID"}),")"]}),e.jsx("input",{type:"url","data-testid":"map-url-input",placeholder:"e.g. https://google.com/maps/... or ChIJ3S-JXmauEmsRUcIaWtf4MzE",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.url_map,onChange:t=>{let s=t.target.value;s&&!s.startsWith("http")&&(s=`https://www.google.com/maps/search/?api=1&query_place_id=${s}&query=a`);const r=s.match(/!3d(-?\d+(?:\.\d+)?)/),l=s.match(/!4d(-?\d+(?:\.\d+)?)/);let h=null,u=null;if(r&&l)h=parseFloat(r[1]),u=parseFloat(l[1]);else{const a=s.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);a&&(h=parseFloat(a[1]),u=parseFloat(a[2]))}h!==null&&u!==null&&!isNaN(h)&&!isNaN(u)?(M({...x,url_map:s,lat:h,lng:u}),Y(`${h}, ${u}`)):M({...x,url_map:s})}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-sm font-semibold text-slate-700",children:"Hotel URL"}),e.jsx("input",{type:"url",placeholder:"e.g. https://booking.com/...",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm transition-all outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",value:x.url_property,onChange:t=>{let s=t.target.value;s.startsWith("https://www.booking.com/")&&(s=s.split("?")[0]),M({...x,url_property:s})}})]})]})]})]}):e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-slate-100 p-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-baseline items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Itinerary"}),(()=>{const t=ne.find(a=>a.date);if(!t||!t.date)return null;const s=new Date,h=(new Date(`${t.date}T${t.time||"12:00"}`).getTime()-s.getTime())/(1e3*60*60*24),u=Math.round(h*10)/10;return u>0?e.jsxs("span",{className:"text-md inline-flex items-center rounded-full px-2.5 py-0.5 font-semibold text-red-700",children:["starting in ",u.toFixed(1)," day",u!==1&&"s"]}):null})()]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:[Me," stops and ",m.length-Me," unconnected points"]})]}),!z&&e.jsx("button",{disabled:d===null,onClick:()=>Ce(),className:"rounded-lg bg-indigo-600 p-2 text-white shadow-md transition-all hover:bg-indigo-700 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50",title:"Add Stop",children:e.jsx(Ee,{size:20})})]}),e.jsx("div",{ref:se,className:"scrollbar-thin scrollbar-thumb-slate-200 flex-1 overflow-y-auto p-6",onDragOver:t=>{t.preventDefault(),oe.current={y:t.clientY}},children:y?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-indigo-600"})}):_?e.jsx("div",{className:"px-4 py-12 text-center font-medium text-red-500",children:_}):ne.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 text-slate-400",children:e.jsx(Ot,{size:32})}),e.jsx("p",{className:"font-medium text-slate-500",children:"No stops added yet."}),!z&&e.jsx("button",{disabled:d===null,onClick:()=>Ce(),className:"mt-2 text-sm font-bold text-indigo-600 hover:underline disabled:opacity-50",children:d===null?"Create a trip first":"Start planning now"})]}):e.jsx("div",{className:"relative flex flex-col space-y-2",children:(()=>{const t=ne.filter(a=>!a.parent_id),s=ne.reduce((a,f)=>(f.parent_id&&(a[f.parent_id]||(a[f.parent_id]=[]),a[f.parent_id].push(f)),a),{}),r=t.filter(a=>a.is_connected).length,l=a=>e.jsxs("div",{className:`relative ${T?"py-2":"py-6"}`,onDragOver:xt,children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-dashed border-slate-200"})}),e.jsx("div",{className:"relative flex justify-center",children:e.jsx("span",{className:"bg-white px-4 text-[10px] font-bold tracking-[0.2em] text-slate-400 uppercase",children:"Extra Locations"})})]},a),h=(a,f,$,D)=>{const $e=t[$].is_connected?$+1:String.fromCharCode(65+($-r)),mt=f?`${$e}.${D+1}`:$e;return e.jsxs("div",{id:`travel-item-${a.id}`,className:`relative ${f?"py-0 pr-0 pl-16":"py-1 pl-10"} transition-all ${O===a.id?"opacity-20":""} ${je===a.id?"select-none":""}`,onClick:()=>C(a),"data-testid":"travel-item",draggable:!z&&je===a.id&&S!==a.id,onDragStart:()=>pt(a.id),onDragOver:L=>ut(L,a.id),onDragEnd:ht,children:[$<r&&e.jsxs(e.Fragment,{children:[($<r-1||$===r-1&&f)&&e.jsx("div",{className:"absolute top-0 bottom-0 left-4 z-0 w-[3px] -translate-x-1/2 bg-indigo-200"}),$===r-1&&!f&&e.jsx("div",{className:"absolute top-0 left-4 z-0 h-4 w-[3px] -translate-x-1/2 bg-indigo-200"}),($>0||f)&&e.jsx("div",{className:`absolute left-4 ${T?"-top-2 h-2":"-top-4 h-4"} z-0 w-[3px] -translate-x-1/2 bg-indigo-200`})]}),f&&e.jsx("div",{className:"absolute top-0 bottom-1/2 left-10 z-0 h-full w-4 w-[2px] -translate-x-1/2 rounded-bl-lg border-b-2 border-l-2 border-slate-200 bg-slate-200"}),e.jsx("div",{className:`absolute ${f?"left-6 mt-1.5 h-7 w-7":"top-1.5 left-0 h-8 w-8"} z-20 flex items-center justify-center rounded-full border-[3px] shadow-sm transition-colors ${j?.id===a.id||S===a.id?"border-indigo-200 bg-indigo-500 text-white":a.is_connected?"border-indigo-200 bg-slate-200 text-slate-500":f?"border-indigo-200 bg-green-500 text-white":"border-indigo-200 bg-amber-500 text-white"}`,children:e.jsx("span",{className:"text-[0.8rem] font-bold",children:mt})}),e.jsxs("div",{className:`${T?"p-2":"p-4"} group/item relative z-10 flex flex-col rounded-xl border shadow-sm transition-all ${a.hide_from_map?"bg-white":f?"bg-green-50":a.is_connected?"bg-indigo-50":"bg-amber-50"} ${j?.id===a.id?"border-indigo-200":f?"border-green-200 hover:border-green-300":a.is_connected?"border-indigo-200 hover:border-indigo-300":"border-amber-200 hover:border-amber-300"}`,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"mb-1 flex items-start justify-between",children:e.jsxs("span",{className:`text-xs font-bold tracking-wider uppercase ${f?"text-green-600":a.is_connected?"text-indigo-600":"text-amber-600"}`,children:[[a.date?ce(a.date,!0):null,a.time?a.time.substring(0,5):null].filter(Boolean).join(" @ "),(a.date_departure||a.time_departure)&&e.jsxs(e.Fragment,{children:[" → ",[a.date_departure?ce(a.date_departure):null,a.time_departure?a.time_departure.substring(0,5):null].filter(Boolean).join(" @ ")]}),!a.date&&!a.time&&"Flexible Timing"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.category&&e.jsx("div",{className:`shrink-0 ${f?"text-green-400":a.is_connected?"text-indigo-400":"text-amber-400"}`,children:(()=>{const L=De.find(ft=>ft.id===a.category),gt=L?L.icon:ye;return e.jsx(gt,{size:16})})()}),e.jsx("h3",{className:`${T?"text-sm":"text-base"} truncate font-bold text-slate-900`,children:a.location}),a.is_tba&&e.jsx("span",{className:"shrink-0 rounded border border-pink-200 bg-pink-100 px-1.5 py-0.5 text-[10px] font-bold tracking-wider text-pink-700 uppercase",children:"TBA"})]}),(a.url_property||a.url_map)&&e.jsxs("div",{className:"mt-1 flex gap-2",children:[a.url_property&&e.jsxs("a",{href:a.url_property,target:"_blank",rel:"noopener noreferrer",onClick:L=>L.stopPropagation(),className:"inline-flex items-center gap-1 rounded border border-blue-500 bg-blue-50 px-2 py-0.5 text-[10px] font-bold text-blue-800 uppercase transition-colors hover:text-blue-900",children:[e.jsx(Ge,{size:10}),"Hotel"]}),a.url_map&&e.jsxs("a",{href:a.url_map,target:"_blank",rel:"noopener noreferrer",onClick:L=>L.stopPropagation(),className:"inline-flex items-center gap-1 rounded border border-amber-500 bg-amber-50 px-2 py-0.5 text-[10px] font-bold text-amber-600 uppercase transition-colors hover:text-amber-800",children:[e.jsx(fe,{size:10}),"Google Map"]})]}),!T&&e.jsxs(e.Fragment,{children:[a.description&&e.jsx(be,{text:a.description,className:"mt-1",textClassName:"text-sm text-slate-600"}),!z&&a.description_private&&e.jsx(be,{text:a.description_private,className:"mt-1.5 rounded-md border border-slate-100/50 bg-slate-50/50 p-1.5",textClassName:"text-sm text-slate-700/80",badge:e.jsx("span",{className:"mt-0.5 shrink-0 rounded bg-slate-200 px-1 text-[10px] font-bold text-slate-800 uppercase",children:"Private"})})]})]}),!z&&e.jsxs("div",{className:"ml-auto flex shrink-0 items-center gap-3","data-testid":"list-control-icons",children:[e.jsxs("div",{className:"flex gap-1",children:[!f&&$>0&&e.jsx("button",{onClick:L=>{L.stopPropagation(),ot(a,t[$-1])},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Make Child of Previous Item",children:e.jsx(Ht,{size:T?14:16})}),f&&e.jsx("button",{onClick:L=>{L.stopPropagation(),lt(a)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Make it a Parent Item",children:e.jsx(Bt,{size:T?14:16})}),e.jsx("button",{onClick:L=>{L.stopPropagation(),Se(a)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Edit",children:e.jsx(Be,{size:T?14:16})}),e.jsx("button",{onClick:L=>{L.stopPropagation(),ct(a)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-indigo-50 hover:text-indigo-600",title:"Duplicate",children:e.jsx(Tt,{size:T?14:16})}),e.jsx("button",{onClick:L=>{L.stopPropagation(),dt(a.id)},className:"rounded-md p-1.5 text-slate-400 transition-all hover:bg-red-50 hover:text-red-600",title:"Delete",children:e.jsx(ge,{size:T?14:16})})]}),e.jsx("div",{className:"cursor-grab touch-none p-1 text-slate-400 transition-all hover:text-slate-600 active:cursor-grabbing",onMouseDown:()=>Q(a.id),onMouseUp:()=>Q(null),onTouchStart:()=>Q(a.id),onTouchEnd:()=>Q(null),onTouchCancel:()=>Q(null),children:e.jsx($t,{size:T?16:20})})]})]})]},a.id)},u=[];return t.forEach((a,f)=>{f===r&&u.push(l(`marker-${f}`)),u.push(h(a,!1,f,0)),s[a.id]?.forEach(($,D)=>u.push(h($,!0,f,D)))}),r===t.length&&t.length>0&&u.push(l("marker-end")),u})()})})]})}),e.jsx("div",{className:`${T||E&&!k?"hidden md:block":"block"} ${T?"md:hidden":""} h-full flex-1`,children:e.jsx(cs,{items:ne.filter(t=>!t.hide_from_map),selectedItem:j,editingItemId:S,editingItemLocation:E?{lat:x.lat,lng:x.lng,category:x.category,is_connected:x.is_connected,hide_from_map:x.hide_from_map}:null,onSelectItem:C,onEdit:Se,onLocationSelect:(t,s)=>{M({...x,lat:t,lng:s}),Y(`${t.toFixed(6)}, ${s.toFixed(6)}`),R(!1)},onCancelLocationSelect:()=>R(!1),isSelectingLocation:k,isCollapsed:T})})]}),A&&n&&e.jsx(ss,{auth:n,onClose:()=>I(!1)}),te&&n&&X&&e.jsx(ps,{auth:n,trip:X,onClose:()=>ue(!1),onUpdate:t=>{o(s=>s.map(r=>r.id===t.id?t:r))}})]})},Fe=document.getElementById("root");Fe&&(document.body.classList.add("travel-page"),ReactDOM.createRoot(Fe).render(e.jsx(React.StrictMode,{children:e.jsx(us,{})})));
