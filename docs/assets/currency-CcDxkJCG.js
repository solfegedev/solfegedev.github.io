import"./index-BNZvnabD.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as m}from"./button-ChVf0VhC.js";import{A as U}from"./api-CH_Pe6Vg.js";import{c as _,f as L}from"./utils-Bp7-rn4K.js";import{c as B}from"./createLucideIcon-DtX1aPOG.js";import{R as G}from"./refresh-cw-pTx9cW3g.js";import"./clsx-B-dksMZM.js";const T=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],$=B("arrow-left-right",T);const z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],H=B("save",z),V=["USD","GBP","VND"],O=()=>{const[x,f]=React.useState({}),[u,h]=React.useState({}),[p,g]=React.useState(null),[q,v]=React.useState(!1),[b,j]=React.useState(!1),[N,l]=React.useState(null),[o,y]=React.useState(()=>{const t=localStorage.getItem("defaultFromCurrency");return V.includes(t)?t:"USD"}),[c,S]=React.useState(()=>{const t=localStorage.getItem("defaultToCurrency");return V.includes(t)?t:"GBP"}),[d,i]=React.useState("1"),[w,R]=React.useState(!1),C=t=>{if(!t)return"";const[r,a]=t.split("."),s=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return t.includes(".")?`${s}.${a}`:s},P=()=>{localStorage.setItem("defaultFromCurrency",o),localStorage.setItem("defaultToCurrency",c),R(!0),setTimeout(()=>R(!1),2e3)},D=React.useCallback(async()=>{v(!0),l(null);try{const t=await fetch(`${U}/currency/`);if(!t.ok)throw new Error("Failed to fetch rates");const r=await t.json(),a={},s={};r.rates.forEach(n=>{a[n.target_currency]=n.rate,s[n.target_currency]=n.default_amount}),f(a),h(s),g(r.last_updated),r.rates.length===0&&await k()}catch(t){l(t instanceof Error?t.message:"An error occurred")}finally{v(!1)}},[]),k=async()=>{j(!0),l(null);try{const t=await fetch(`${U}/currency/update`,{method:"POST"});if(!t.ok)throw new Error("Failed to update rates");const r=await t.json(),a={},s={};r.rates.forEach(n=>{a[n.target_currency]=n.rate,s[n.target_currency]=n.default_amount}),f(a),h(s),g(r.last_updated),s[o]&&i(s[o].toString())}catch(t){l(t instanceof Error?t.message:"An error occurred during update")}finally{j(!1)}};React.useEffect(()=>{D()},[D]),React.useEffect(()=>{u[o]&&i(u[o].toString())},[o,u]);const I=(t,r,a)=>{const s=parseFloat(t);if(isNaN(s))return"0";if(r===a)return t;const n=r==="USD"?s:s/(x[r]||1),E=a==="USD"?n:n*(x[a]||1);return a==="VND"?Math.round(E).toLocaleString():E.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},A=()=>{y(c),S(o)},F=I(d,o,c);return e.jsx("div",{className:"min-h-screen px-4 py-8 md:px-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl overflow-hidden rounded-xl bg-white/80 p-6 shadow-xl backdrop-blur-sm","data-testid":"currency-container",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900","data-testid":"page-title",children:[e.jsx("img",{src:"/favicon_currency.png",alt:"Currency Converter",className:"aspect-square h-10 w-10 object-contain md:hidden"}),e.jsx("span",{className:"hidden md:inline",children:"Currency Converter"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(m,{variant:"outline",size:"default",onClick:P,className:_("flex items-center gap-2",w?"border-green-600 text-green-600":"bg-indigo-600 text-white"),"data-testid":"save-default-button",children:[e.jsx(H,{className:"h-4 w-4"}),w?"Saved!":"Save as default currencies"]}),e.jsxs(m,{variant:"outline",size:"default",onClick:k,disabled:b,className:"flex items-center gap-2 bg-indigo-600 text-white hover:bg-indigo-700","data-testid":"update-button",children:[e.jsx(G,{className:_("h-4 w-4",b&&"animate-spin")}),"Update Rates"]})]})]}),N&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-600","data-testid":"error-message",children:N}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Amount"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C(d),onChange:t=>{const a=t.target.value.replace(/,/g,"");/^\d*\.?\d*$/.test(a)&&i(a)},className:"w-full rounded-lg border border-slate-300 p-3 transition-all outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter amount","data-testid":"amount-input"}),e.jsx(m,{variant:"outline",className:"h-auto bg-indigo-600 px-4 text-white hover:bg-indigo-700",onClick:()=>{const t=parseFloat(d);t!==0&&!isNaN(t)&&i((1/t).toString())},title:"Inverse (1/x)","data-testid":"inverse-button",children:e.jsxs("div",{className:"flex flex-col items-center text-[10px] leading-tight font-bold",children:[e.jsx("span",{children:"1"}),e.jsx("div",{className:"h-px w-3 bg-current"}),e.jsx("span",{children:"x"})]})})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"From"}),e.jsxs("select",{value:o,onChange:t=>y(t.target.value),className:"w-full rounded-lg border border-slate-300 p-3 outline-none","data-testid":"from-currency-select",children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"}),e.jsx("option",{value:"VND",children:"VND - Vietnamese Dong"})]})]}),e.jsx("button",{onClick:A,className:"mb-0.5 rounded-lg bg-slate-100 p-3 transition-colors hover:bg-slate-200",title:"Swap Currencies","data-testid":"swap-button",children:e.jsx($,{className:"h-5 w-5 text-slate-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"To"}),e.jsxs("select",{value:c,onChange:t=>S(t.target.value),className:"w-full rounded-lg border border-slate-300 p-3 outline-none","data-testid":"to-currency-select",children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"}),e.jsx("option",{value:"VND",children:"VND - Vietnamese Dong"})]})]})]}),e.jsxs("div",{className:"mt-8 rounded-xl bg-blue-50 p-6 text-center",children:[e.jsxs("p",{className:"mb-1 text-sm font-medium text-blue-600",children:[C(d)," ",o," ="]}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900","data-testid":"converted-value",children:[F," ",c]})]}),p&&e.jsxs("p",{className:"last-updated mt-4 text-center text-xs text-slate-500","data-testid":"last-updated",children:["Rates last updated: ",L(p,!1,!0)]})]})]})})},M=document.getElementById("root");if(!M)throw new Error("Root element not found");document.body.classList.add("currency");ReactDOM.createRoot(M).render(e.jsx(React.StrictMode,{children:e.jsx(O,{})}));
