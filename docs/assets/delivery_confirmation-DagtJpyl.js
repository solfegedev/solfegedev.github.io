import"./index-BRH-H6m_.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as Fe}from"./api-CH_Pe6Vg.js";import{B as le}from"./button-BRMX--fC.js";import"./clsx-B-dksMZM.js";import"./utils-CN4411gJ.js";const J=1,V=["free","plus","pro"],F={free:"Free",plus:"Plus",pro:"Pro"},Te=({authMode:t,email:o,password:i,roleSelection:d,showPassword:c,loadingAuth:n,resettingPassword:h,rememberMe:x,authError:l,resetFlash:b,switchAuthMode:u,setEmail:_,setPassword:y,setRoleSelection:r,setShowPassword:p,setRememberMe:j,handleAuthSubmit:w,handlePasswordReset:D})=>e.jsxs("section",{className:"mx-auto grid w-full max-w-[520px] gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-50",children:t==="login"?"Login":"Create account"}),e.jsx("p",{className:"m-0 text-slate-300",children:t==="login"?"Use your email to manage or confirm deliveries.":"Register with your email; new accounts start on a Free membership."})]}),e.jsxs("div",{className:"inline-flex w-fit gap-2 rounded-xl bg-white/5 p-1 text-sm font-semibold",role:"tablist","aria-label":"Authentication mode",children:[e.jsx("button",{type:"button",role:"tab","aria-selected":t==="login",className:t==="login"?"rounded-lg bg-cyan-200/10 px-3 py-2 text-slate-50":"rounded-lg px-3 py-2 text-slate-300 hover:text-slate-50",onClick:()=>u("login"),children:"Login"}),e.jsx("button",{type:"button",role:"tab","aria-selected":t==="register",className:t==="register"?"rounded-lg bg-cyan-200/10 px-3 py-2 text-slate-50":"rounded-lg px-3 py-2 text-slate-300 hover:text-slate-50",onClick:()=>u("register"),children:"Register"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:w,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"email",children:"Email address"}),e.jsx("input",{id:"email",name:"email",type:"email",value:o,onChange:v=>_(v.target.value),placeholder:"you@example.com",className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",required:!0,autoComplete:"email"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative grid items-center",children:[e.jsx("input",{id:"password",name:"password",type:c?"text":"password",value:i,onChange:v=>y(v.target.value),className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",required:!0,autoComplete:t==="register"?"new-password":"current-password",minLength:t==="register"?J:void 0}),e.jsx("button",{type:"button",className:"absolute top-1/2 right-2.5 -translate-y-1/2 text-slate-400 transition hover:text-slate-100 focus:outline-none","aria-label":c?"Hide characters":"Show characters","aria-controls":"password","aria-pressed":c,onMouseDown:()=>p(!0),onMouseUp:()=>p(!1),onMouseLeave:()=>p(!1),onBlur:()=>p(!1),onTouchStart:()=>p(!0),onTouchEnd:()=>p(!1),onTouchCancel:()=>p(!1),"aria-live":"polite",children:"ðŸ‘"})]})]}),t==="register"&&e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"role",children:"Choose your role"}),e.jsxs("div",{className:"grid gap-1.5",role:"radiogroup","aria-label":"Role",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 font-semibold text-slate-200",children:[e.jsx("input",{type:"radio",name:"role",value:"shop",checked:d==="shop",onChange:()=>r("shop")}),"Shop â€” create deliveries"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 font-semibold text-slate-200",children:[e.jsx("input",{type:"radio",name:"role",value:"driver",checked:d==="driver",onChange:()=>r("driver")}),"Driver â€” confirm deliveries"]})]}),e.jsx("p",{className:"m-0 text-sm text-slate-400",children:"All new accounts start on the Free membership."})]}),l&&e.jsx("div",{className:"dc-alert rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-rose-100","data-testid":"dc-alert",role:"status",children:l}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsx(le,{className:"min-w-[120px] px-4 py-3",type:"submit",disabled:n,children:n?t==="login"?"Logging in...":"Creating account...":t==="login"?"Login":"Register"})}),t==="login"&&e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm font-semibold text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:v=>j(v.target.checked)}),"Remember me for 14 days"]}),e.jsx(le,{variant:"outline",className:"rounded-xl border-slate-400/35 bg-white/5 px-4 py-3 font-bold text-slate-100 hover:border-slate-300/50",type:"button",onClick:D,disabled:h||n,children:h?"Requesting...":"Forgot password?"})]}),b&&e.jsx("div",{className:"dc-alert rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100","data-testid":"dc-alert",role:"status",children:b})]})]}),Oe=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),C=t=>{const o=typeof t=="string"?new Date(t):t;return Oe.format(o)},ne=t=>t==="pending"?"Pending":t==="validated"?"Complete":"Locked",Ue=(t,o,i)=>t==="validated"&&o?"Code accepted â€” this delivery is now complete.":t==="locked"?"Maximum attempts reached. Delivery is locked.":o?"Attempt verified.":i===1?"Incorrect code. One attempt left.":`Incorrect code. ${i} attempts left.`,$e=({attemptDeliveryId:t,attemptCode:o,attemptResult:i,attemptError:d,submittingAttempt:c,handleSubmitAttempt:n,onAttemptDeliveryIdChange:h,onAttemptCodeChange:x})=>e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-cyan-200/45 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_20px_45px_rgba(34,211,238,0.22)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Validate a delivery"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Enter the delivery ID and the 6-digit code provided by the shop team."})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:n,children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"deliveryId",children:"Delivery ID"}),e.jsx("input",{id:"deliveryId",name:"deliveryId",type:"text",inputMode:"numeric",pattern:"^[0-9]+$",className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",value:t,onChange:l=>h(l.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"secretCode",children:"Secret code"}),e.jsx("input",{id:"secretCode",name:"secretCode",type:"text",inputMode:"numeric",autoComplete:"one-time-code",pattern:"^[0-9]{6}$",maxLength:6,className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",value:o,onChange:l=>x(l.target.value),required:!0})]})]}),e.jsx("button",{className:"inline-flex w-fit items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:c,children:c?"Submitting...":"Submit attempt"}),d&&e.jsx("div",{className:"rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-rose-100",children:d}),i&&e.jsxs("div",{className:i.success?"grid gap-1 rounded-[14px] border border-emerald-400/40 bg-emerald-400/10 px-3 py-2 text-slate-100":"grid gap-1 rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",role:"status",children:[e.jsxs("div",{className:"dc-alert__title font-bold",children:["Attempt ",i.attempt_number," Â· Delivery ",i.delivery_id]}),e.jsx("p",{className:"dc-alert__hint m-0 text-sm text-slate-300",children:Ue(i.status,i.success,i.remaining_attempts)})]})]})]}),Me=({group:t,expanded:o,onToggle:i})=>{const d=t.attempts[0],c=t.status==="validated"?"rounded-full bg-emerald-400/20 px-3 py-1 text-sm font-bold text-emerald-300":t.status==="locked"?"rounded-full bg-rose-400/15 px-3 py-1 text-sm font-bold text-rose-300":"rounded-full bg-cyan-200/20 px-3 py-1 text-sm font-bold text-cyan-200";return e.jsxs("article",{className:"grid gap-3 rounded-2xl border border-slate-400/35 bg-slate-800/70 p-4 shadow-[0_10px_30px_rgba(0,0,0,0.25)]",children:[e.jsxs("header",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold tracking-[0.08em] text-slate-400 uppercase",children:["Delivery ",t.delivery_id]}),e.jsx("h3",{className:"mt-0.5 text-lg font-semibold text-slate-50",children:t.address}),d&&e.jsxs("p",{className:"m-0 text-sm text-slate-400",children:["Last attempt #",d.attempt_number," Â· ",C(d.created_at)]})]}),e.jsx("span",{className:c,children:ne(t.status)})]}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Total attempts"}),e.jsx("dd",{className:"m-0 text-slate-100",children:t.attempts.length})]}),d&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Latest result"}),e.jsx("dd",{className:d.success?"m-0 inline-flex items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"m-0 inline-flex items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:d.success?"Verified":"Failed"})]})]}),e.jsx("footer",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",onClick:()=>i(t.delivery_id),children:o?"Hide attempts":"View attempts"})}),o&&e.jsxs("div",{className:"overflow-x-auto rounded-xl border border-slate-400/35",children:[e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr] gap-2 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-200 md:text-base",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:"When"}),e.jsx("span",{children:"Result"})]}),t.attempts.map(n=>e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr] items-center gap-2 border-t border-slate-400/35 px-3 py-2 text-sm text-slate-100 md:text-base",children:[e.jsx("span",{children:n.attempt_number}),e.jsx("span",{children:C(n.created_at)}),e.jsx("span",{className:n.success?"inline-flex w-fit items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"inline-flex w-fit items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:n.success?"Verified":"Failed"})]},`${n.delivery_id}-${n.attempt_number}`))]})]},t.delivery_id)},Pe=({driverAttemptGroups:t,expandedDriverDeliveries:o,toggleDriverDeliveryExpansion:i})=>e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Recent attempts"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Your attempts grouped by delivery"})]}),t.length===0?e.jsx("p",{className:"m-0 text-slate-400",children:"No attempts logged yet."}):e.jsx("div",{className:"grid gap-3",children:t.map(d=>e.jsx(Me,{group:d,expanded:o[d.delivery_id],onToggle:i},d.delivery_id))})]}),Be=({attemptDeliveryId:t,attemptCode:o,attemptResult:i,attemptError:d,submittingAttempt:c,attemptHistory:n,expandedDriverDeliveries:h,handleSubmitAttempt:x,onAttemptDeliveryIdChange:l,onAttemptCodeChange:b,toggleDriverDeliveryExpansion:u})=>{const _=React.useMemo(()=>{if(!n.length)return[];const y=new Map;return n.forEach(r=>{y.has(r.delivery_id)||y.set(r.delivery_id,{delivery_id:r.delivery_id,address:r.address,status:r.status,attempts:[]});const p=y.get(r.delivery_id);p&&p.attempts.push(r)}),Array.from(y.values()).map(r=>({...r,attempts:[...r.attempts].sort((p,j)=>new Date(j.created_at).getTime()-new Date(p.created_at).getTime())})).sort((r,p)=>{const j=r.attempts[0]?.created_at??0,w=p.attempts[0]?.created_at??0;return new Date(w).getTime()-new Date(j).getTime()}).map(r=>({...r,status:r.attempts[0]?.status??r.status,address:r.attempts[0]?.address??r.address}))},[n]);return e.jsxs("section",{className:"grid gap-4",children:[e.jsx($e,{attemptDeliveryId:t,attemptCode:o,attemptResult:i,attemptError:d,submittingAttempt:c,handleSubmitAttempt:x,onAttemptDeliveryIdChange:l,onAttemptCodeChange:b}),e.jsx(Pe,{driverAttemptGroups:_,expandedDriverDeliveries:h,toggleDriverDeliveryExpansion:u})]})},qe=({deliveries:t,selectedDeliveryAttempts:o,addressInput:i,creationFlash:d,isCreating:c,handleCreateDelivery:n,handleAddressChange:h,toggleDeliveryAttempts:x})=>e.jsxs("section",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-cyan-200/45 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_20px_45px_rgba(34,211,238,0.22)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Create delivery"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Generate a delivery ID and one-time code tied to the address."})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:n,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"address",children:"Delivery address"}),e.jsx("textarea",{id:"address",name:"address",className:"min-h-[110px] w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:ring-2 focus:ring-cyan-300/60 focus:outline-none",value:i,onChange:l=>h(l.target.value),placeholder:"12 Finchley rd, London, NW3 5JD",rows:3,required:!0})]}),e.jsx("button",{className:"inline-flex w-fit items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:c,children:c?"Creating...":"Generate code"}),d&&e.jsxs("div",{className:"dc-alert__codes grid gap-1 rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",role:"status",children:[e.jsx("div",{className:"font-bold",children:"Delivery created"}),e.jsxs("div",{className:"flex flex-wrap items-baseline gap-3 text-sm",children:[e.jsxs("span",{children:["Delivery ID: ",d.delivery_id]}),e.jsxs("span",{className:"inline-flex items-baseline gap-2",children:[e.jsx("span",{children:"Secret code:"}),e.jsx("span",{className:"font-mono text-xl font-bold tracking-[0.18em] text-amber-100",children:d.secret_code})]})]}),e.jsx("div",{className:"m-0 text-sm text-slate-300",children:"Share these with the recipient securely."})]})]})]}),e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsx("div",{className:"grid gap-1",children:e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Your deliveries"})}),t.length===0?e.jsx("p",{className:"m-0 text-slate-400",children:"No deliveries yet."}):e.jsx("div",{className:"grid gap-3",children:t.map(l=>{const b=l.status==="validated"?"rounded-full bg-emerald-400/20 px-3 py-1 text-sm font-bold text-emerald-300":l.status==="locked"?"rounded-full bg-rose-400/15 px-3 py-1 text-sm font-bold text-rose-300":"rounded-full bg-cyan-200/20 px-3 py-1 text-sm font-bold text-cyan-200";return e.jsxs("article",{className:"grid gap-3 rounded-2xl border border-slate-400/35 bg-slate-800/70 p-4 shadow-[0_10px_30_rgba(0,0,0,0.25)]",children:[e.jsxs("header",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold tracking-[0.08em] text-slate-400 uppercase",children:["Delivery ",l.delivery_id]}),e.jsx("h3",{className:"mt-0.5 text-lg font-semibold text-slate-50",children:l.address})]}),e.jsx("span",{className:b,children:ne(l.status)})]}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Secret code"}),e.jsx("dd",{className:"m-0 inline-flex items-center rounded-lg bg-white/10 px-2.5 py-1 font-mono text-xl font-semibold tracking-[0.18em] text-slate-50",children:l.secret_code})]}),e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Created"}),e.jsx("dd",{className:"m-0 text-slate-100",children:C(l.created_at)})]}),l.validated_at&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Completed"}),e.jsx("dd",{className:"m-0 text-slate-100",children:C(l.validated_at)})]}),l.locked_at&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm md:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Locked"}),e.jsx("dd",{className:"m-0 text-slate-100",children:C(l.locked_at)})]})]}),e.jsx("footer",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",onClick:()=>x(l.delivery_id),children:o[l.delivery_id]?"Close":"View attempts"})}),o[l.delivery_id]&&e.jsxs("div",{className:"overflow-x-auto rounded-xl border border-slate-400/35",children:[e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr,120px] gap-2 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-200 md:text-base",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:"When"}),e.jsx("span",{children:"User"}),e.jsx("span",{children:"Result"})]}),o[l.delivery_id].map(u=>e.jsxs("div",{className:"grid min-w-[600px] grid-cols-[60px,1fr,1fr,120px] items-center gap-2 border-t border-slate-400/35 px-3 py-2 text-sm text-slate-100 md:text-base",children:[e.jsx("span",{children:u.attempt_number}),e.jsx("span",{children:C(u.created_at)}),e.jsx("span",{children:u.delivery_person}),e.jsx("span",{className:u.success?"inline-flex w-fit items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"inline-flex w-fit items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:u.success?"Verified":"Failed"})]},u.attempt_number)),o[l.delivery_id].length===0&&e.jsx("div",{className:"border-t border-slate-400/35 px-3 py-2 text-sm text-slate-400 md:text-base",children:"No attempts yet."})]})]},l.delivery_id)})})]})]}),Ge=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}),Je=[{id:"free",headline:"Free",blurb:"Great for trying, with a maximum of 100 deliveries per month.",price:0},{id:"plus",headline:"Plus",blurb:"with a maximum of 1000 deliveries per month.",price:9.99},{id:"pro",headline:"Pro",blurb:"with a maximum of 10000 deliveries per month.",price:29.99}],Ve=({currentMembership:t,isAuthenticated:o,onUpgrade:i})=>{const[d,c]=React.useState(!1),[n,h]=React.useState(null),x=t??"free",l=React.useMemo(()=>V.indexOf(x),[x]),b=()=>{c(r=>!r),h(null)},u=r=>{const p=i(r);h(p.message),p.ok&&c(!1)},_=t?`${F[t]} plan`:"Guest Â· Free start",y=t==="pro"?"Manage membership":"Upgrade";return e.jsxs("div",{className:"relative inline-flex justify-end",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-amber-300 via-orange-400 to-pink-500 px-4 py-2.5 font-bold text-slate-900 shadow-[0_10px_30px_rgba(251,191,36,0.25)] transition-transform hover:-translate-y-0.5 focus:ring-2 focus:ring-amber-300/60 focus:outline-none",onClick:b,"aria-expanded":d,"aria-haspopup":"dialog",children:[e.jsx("span",{children:y}),e.jsx("span",{"aria-hidden":"true",children:"â†—"})]}),d&&e.jsxs("div",{className:"absolute right-0 z-20 mt-2 w-[min(380px,calc(100vw-2rem))] rounded-2xl border border-slate-400/35 bg-slate-950/95 p-4 text-left shadow-[0_20px_45px_rgba(0,0,0,0.45)] backdrop-blur",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-sm font-semibold tracking-[0.08em] text-amber-200/90 uppercase",children:"Memberships"}),e.jsx("h3",{className:"mt-1 text-lg font-semibold text-slate-50",children:"Pick your plan"}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:"Upgrade to unlock more delivery confirmations."})]}),e.jsx("span",{className:"rounded-full border border-slate-400/45 bg-white/5 px-3 py-1 text-xs font-semibold text-slate-100",children:_})]}),e.jsx("div",{className:"mt-3 grid gap-2",children:Je.map(r=>{const p=V.indexOf(r.id),j=r.id===x,w=p<l,D=j?"Current plan":w?"Downgrade not available":`Upgrade to ${F[r.id]}`,v=j||w;return e.jsxs("button",{type:"button",className:v?"grid gap-1 rounded-xl border border-slate-500/40 bg-slate-800/50 px-3 py-2 text-left text-slate-300 opacity-70":"grid gap-1 rounded-xl border border-amber-300/35 bg-amber-300/10 px-3 py-2 text-left text-slate-100 hover:border-amber-200/80 hover:bg-amber-200/20",onClick:()=>u(r.id),disabled:v,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:r.headline}),e.jsx("span",{className:"text-xs font-bold tracking-[0.08em] text-amber-200 uppercase",children:D})]}),e.jsxs("div",{className:"flex items-baseline justify-between text-sm",children:[e.jsx("span",{className:"font-semibold text-amber-100",children:Ge.format(r.price)}),e.jsx("span",{className:"text-xs text-slate-300",children:"per month"})]}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:r.blurb}),!o&&!j&&!w&&e.jsx("p",{className:"m-0 text-xs font-semibold text-amber-200/90",children:"Sign in to finish upgrade"})]},r.id)})}),n&&e.jsx("div",{className:"mt-3 rounded-xl border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-sm text-slate-100",children:n})]})]})},S=`${Fe}/delivery_confirmation`,R="delivery_confirmation_auth",He=336*60*60*1e3,G="delivery_confirmation_last_email",E=t=>({Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),L=async(t,o)=>{try{if((t.headers.get("content-type")??"").includes("application/json")){const c=await t.json();if(typeof c=="string")return c;if(Array.isArray(c)){const n=c[0];if(typeof n=="string")return n;if(n&&typeof n=="object"){const h=n.message;if(typeof h=="string")return h}}if(c&&typeof c=="object"){const n=c,h=["detail","message","error"];for(const x of h){const l=n[x];if(typeof l=="string")return l}}}return(await t.text()).trim()||o}catch(i){return console.error("Failed to parse error response",i),o}},We=()=>{const[t,o]=React.useState(null),[i,d]=React.useState(""),[c,n]=React.useState(""),[h,x]=React.useState(null),[l,b]=React.useState(!1),[u,_]=React.useState("login"),[y,r]=React.useState(!1),[p,j]=React.useState("driver"),[w,D]=React.useState(!1),[v,H]=React.useState(!1),[oe,k]=React.useState(null),[I,T]=React.useState(null),[de,O]=React.useState([]),[W,U]=React.useState({}),[$,M]=React.useState(""),[ce,P]=React.useState(null),[me,Y]=React.useState(!1),[z,K]=React.useState(""),[Q,X]=React.useState(""),[xe,B]=React.useState(null),[pe,A]=React.useState(null),[ue,Z]=React.useState([]),[he,ee]=React.useState(!1),[ge,te]=React.useState({}),se=t?.role==="shop",fe=t?.role==="driver",ae=s=>V.indexOf(s);React.useEffect(()=>{t?.role==="shop"&&be(),t?.role==="driver"&&re()},[t?.role]),React.useEffect(()=>{if(!I)return;const s=window.setTimeout(()=>T(null),5e3);return()=>window.clearTimeout(s)},[I]),React.useEffect(()=>{try{const s=localStorage.getItem(R);if(!s)return;const a=JSON.parse(s);if(!a?.auth||!a.expiresAt)return;if(a.expiresAt<Date.now()){localStorage.removeItem(R);return}o(a.auth),r(!0)}catch(s){console.warn("Failed to restore session",s),localStorage.removeItem(R)}},[]),React.useEffect(()=>{const s=localStorage.getItem(G);s&&d(s)},[]),React.useEffect(()=>{const s=i.trim();s?localStorage.setItem(G,s):localStorage.removeItem(G)},[i]);const be=async()=>{if(!t)return;const s=await fetch(`${S}/deliveries`,{headers:E(t.token)});if(!s.ok)return;const a=await s.json(),m=Array.isArray(a)?a:[];O(m)},ye=async s=>{if(!t)return;const a=await fetch(`${S}/deliveries/${s}/attempts`,{headers:E(t.token)});if(!a.ok)return;const m=await a.json(),g=Array.isArray(m?.attempts)?m.attempts:[];U(f=>({...f,[s]:g}))},re=async()=>{if(!t)return;const s=await fetch(`${S}/attempts`,{headers:E(t.token)});if(!s.ok)return;const a=await s.json(),m=Array.isArray(a)?a:[];Z(m)},je=s=>{const a=s.replace(/\D/g,"").slice(0,6);X(a)},ve=s=>{const a=s.replace(/\D/g,"");K(a)},Ne=s=>{M(s)},we=s=>{if(W[s]){U(a=>{const m={...a};return delete m[s],m});return}ye(s)},_e=s=>{te(a=>({...a,[s]:!a[s]}))},Se=()=>{o(null),O([]),U({}),Z([]),B(null),A(null),te({}),K(""),X(""),P(null),M(""),k(null),n(""),_("login"),r(!1),T(null),localStorage.removeItem(R)},Re=s=>{if(!t)return{ok:!1,message:"Sign in to choose a membership."};const a=ae(t.membership),m=ae(s);if(m<=a)return{ok:!1,message:m===a?"You're already on that membership.":"Downgrades are not available from this view."};o(f=>f&&{...f,membership:s});const g=`Upgraded to ${F[s]} membership.`;return T(g),{ok:!0,message:g}},Ce=s=>{_(s),x(null),k(null)},De=async s=>{s.preventDefault();const a=i.trim().toLowerCase();if(x(null),k(null),!a){x("Email is required.");return}if(!c.trim()){x("Password is required.");return}if(u==="register"&&c.length<J){x(`Password must be at least ${J} characters.`);return}b(!0);try{const m=u==="login"?"login":"register",g={email:a,password:c};u==="register"&&(g.role=p);const f=await fetch(`${S}/${m}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!f.ok){const q=await L(f,u==="login"?"Unable to log in":"Unable to register");throw new Error(q)}const N=await f.json();if(o({token:N.access_token,email:N.username,role:N.role,membership:N.membership}),y){const q=Date.now()+He;localStorage.setItem(R,JSON.stringify({auth:{token:N.access_token,email:N.username,role:N.role,membership:N.membership},expiresAt:q}))}else localStorage.removeItem(R);n("")}catch(m){x(m instanceof Error?m.message:u==="login"?"Login failed":"Registration failed")}finally{b(!1)}},ke=async()=>{const s=i.trim().toLowerCase();if(k(null),x(null),!s){x("Email is required to reset password.");return}H(!0);try{const a=await fetch(`${S}/password_reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})});if(!a.ok)throw new Error(await L(a,"Unable to request password reset"));const m=await a.json();k(m.message)}catch(a){x(a instanceof Error?a.message:"Reset failed")}finally{H(!1)}},Ae=async s=>{if(s.preventDefault(),!(!t||!$.trim())){Y(!0);try{const a=await fetch(`${S}/deliveries`,{method:"POST",headers:E(t.token),body:JSON.stringify({address:$.trim()})});if(!a.ok)throw new Error(await L(a,"Unable to create delivery"));const m=await a.json();O(g=>[m,...g]),P(m),M("")}catch(a){P(null),x(a instanceof Error?a.message:"Unable to create delivery")}finally{Y(!1)}}},Ee=async s=>{if(s.preventDefault(),!t)return;const a=z.trim(),m=Q.trim();if(!a){A("Delivery ID is required.");return}if(!/^\d{6}$/.test(m)){A("Code must be exactly 6 digits.");return}A(null),ee(!0);try{const g=await fetch(`${S}/attempts`,{method:"POST",headers:E(t.token),body:JSON.stringify({delivery_id:Number(a),code:m})});if(!g.ok){const N=await L(g,"Attempt rejected");throw new Error(N)}const f=await g.json();B(f),await re()}catch(g){B(null),A(g instanceof Error?g.message:"Attempt failed")}finally{ee(!1)}},Ie=React.useMemo(()=>t?t.role==="shop"?"Create deliveries, hand off the one-time code, and check delivery confirmations.":"Confirm deliveries.":"Generate and validate single-use delivery codes.",[t]),Le=React.useMemo(()=>t?t.role==="shop"?"Shop":"Driver":null,[t]);return e.jsx("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_20%,rgba(34,211,238,0.18),transparent_45%),radial-gradient(circle_at_80%_10%,rgba(56,189,248,0.15),transparent_40%),#0b1021] px-[clamp(1.25rem,3vw,2rem)] py-[clamp(1.25rem,3vw,2rem)] font-['Space_Grotesk','Inter',system-ui,-apple-system,sans-serif] text-slate-100",children:e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-5",children:[e.jsxs("header",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("span",{className:"text-sm font-bold tracking-[0.08em] text-cyan-300 uppercase",children:"Delivery Confirmation"}),e.jsx("h1",{className:"m-0 text-3xl font-semibold text-slate-50",children:"One-time codes"}),e.jsx("p",{className:"m-0 max-w-3xl text-slate-300",children:Ie})]}),e.jsxs("div",{className:"grid justify-end gap-2 text-right",children:[se&&t&&e.jsx(Ve,{currentMembership:t.membership,isAuthenticated:!0,onUpgrade:Re}),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dc-status__role text-sm font-bold tracking-[0.01em] text-lime-200 uppercase","data-testid":"dc-status-role",children:Le}),e.jsxs("div",{className:"text-sm text-slate-300",children:["Signed in as ",t.email," Â· ",F[t.membership]," member"]}),e.jsx("button",{className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",type:"button",onClick:Se,children:"Log out"})]}):e.jsx("div",{className:"text-sm text-slate-300",children:"Start on Free and upgrade to Plus or Pro whenever you are ready."})]})]}),I&&e.jsx("div",{className:"rounded-xl border border-emerald-400/40 bg-emerald-400/10 px-4 py-3 text-sm text-emerald-50 shadow-[0_12px_30px_rgba(16,185,129,0.25)]",children:I}),!t&&e.jsx(Te,{authMode:u,email:i,password:c,roleSelection:p,showPassword:w,loadingAuth:l,resettingPassword:v,authError:h,resetFlash:oe,rememberMe:y,switchAuthMode:Ce,setEmail:d,setPassword:n,setRoleSelection:j,setShowPassword:D,setRememberMe:r,handleAuthSubmit:De,handlePasswordReset:ke}),se&&e.jsx(qe,{deliveries:de,selectedDeliveryAttempts:W,addressInput:$,creationFlash:ce,isCreating:me,handleCreateDelivery:Ae,handleAddressChange:Ne,toggleDeliveryAttempts:we}),fe&&e.jsx(Be,{attemptDeliveryId:z,attemptCode:Q,attemptResult:xe,attemptError:pe,submittingAttempt:he,attemptHistory:ue,expandedDriverDeliveries:ge,handleSubmitAttempt:Ee,onAttemptDeliveryIdChange:ve,onAttemptCodeChange:je,toggleDriverDeliveryExpansion:_e})]})})},ie=document.getElementById("root");if(!ie)throw new Error("Root element #root not found");document.body.classList.add("delivery-page");ReactDOM.createRoot(ie).render(e.jsx(React.StrictMode,{children:e.jsx(We,{})}));
