import"./index-CBYLtEE8.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as C,T as M}from"./Toast-COaeoAQl.js";import{A as U}from"./api-CH_Pe6Vg.js";import{P as F,A as $}from"./Auth-uEj7rJlD.js";import{C as I}from"./check-CWX8rMms.js";import{X as B}from"./x-BS-d4QNZ.js";import{P as A}from"./pen-vQk8amFZ.js";import{T as z}from"./trash-2-DQbJ9aIh.js";import{c as v}from"./createLucideIcon-DtX1aPOG.js";import{U as L}from"./users-IjmMAbyY.js";import{S as P}from"./settings-G074OJw9.js";import{U as J}from"./user-plus-CET0zEKp.js";import{C as O}from"./copy-CzC7y2Qs.js";import{B as _}from"./button-D6DGr86I.js";import"./circle-check-F4iM422t.js";import"./eye-Jn_UhOO1.js";import"./clsx-B-dksMZM.js";const q=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],V=v("calendar",q);const G=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],Y=v("chart-pie",G);const W=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],E=v("coins",W);const X=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],H=v("credit-card",X);const K=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Q=v("link",K),S=`${U}/multicount`,k=async s=>{if(s.ok)return s.json();throw await s.json().catch(()=>({detail:s.statusText}))},g={get:(s,a)=>fetch(`${S}${s}`,{headers:a?{Authorization:`Bearer ${a}`}:{}}).then(k),post:(s,a,n)=>fetch(`${S}${s}`,{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify(a)}).then(k),put:(s,a,n)=>fetch(`${S}${s}`,{method:"PUT",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify(a)}).then(k),delete:(s,a)=>fetch(`${S}${s}`,{method:"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}).then(k)},Z=({auth:s})=>{const{errorToast:a}=C(),[n,i]=React.useState([]),[d,h]=React.useState(!0),[c,l]=React.useState(null),[b,p]=React.useState(""),[m,r]=React.useState(""),[u,j]=React.useState(""),N=async()=>{try{const o=await g.get("/currencies",s.access_token);i(o)}catch(o){console.error("Failed to fetch currencies",o)}finally{h(!1)}};React.useEffect(()=>{N()},[]);const x=async o=>{o.preventDefault();try{const y=await g.post("/currencies",{code:b,name:m,rate_to_usd:parseFloat(u)},s.access_token);i([...n,y]),R()}catch{a("Failed to add currency")}},t=async o=>{try{const y=await g.put(`/currencies/${o}`,{code:b,name:m,rate_to_usd:parseFloat(u)},s.access_token);i(n.map(T=>T.id===o?y:T)),l(null),R()}catch{a("Failed to update currency")}},f=async o=>{if(confirm("Are you sure you want to delete this currency?"))try{await g.delete(`/currencies/${o}`,s.access_token),i(n.filter(y=>y.id!==o))}catch{a("Failed to delete currency")}},w=o=>{l(o.id),p(o.code),r(o.name),j(o.rate_to_usd.toString())},R=()=>{p(""),r(""),j("")};return d?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading currencies..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Currency Management"}),e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"Add New Currency"}),e.jsxs("form",{onSubmit:x,className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx("input",{placeholder:"Code (e.g. USD)",value:b,onChange:o=>p(o.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("input",{placeholder:"Name (e.g. US Dollar)",value:m,onChange:o=>r(o.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("input",{placeholder:"Rate to USD (e.g. 1.0)",type:"number",step:"0.0001",value:u,onChange:o=>j(o.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("button",{className:"rounded-lg bg-cyan-600 py-2 font-bold text-white transition-all hover:bg-cyan-500",children:"Add Currency"})]})]}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-800 bg-slate-900/40",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-800 bg-slate-900/60",children:[e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Code"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Name"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Rate to USD"}),e.jsx("th",{className:"px-6 py-4 text-right font-bold text-slate-300",children:"Actions"})]})}),e.jsx("tbody",{children:n.map(o=>e.jsxs("tr",{className:"border-b border-slate-800/50 transition-colors hover:bg-slate-800/20",children:[e.jsx("td",{className:"px-6 py-4",children:c===o.id?e.jsx("input",{value:b,onChange:y=>p(y.target.value),className:"w-20 rounded border border-slate-800 bg-slate-950 px-2 py-1"}):o.code}),e.jsx("td",{className:"px-6 py-4",children:c===o.id?e.jsx("input",{value:m,onChange:y=>r(y.target.value),className:"w-full rounded border border-slate-800 bg-slate-950 px-2 py-1"}):o.name}),e.jsx("td",{className:"px-6 py-4",children:c===o.id?e.jsx("input",{type:"number",step:"0.0001",value:u,onChange:y=>j(y.target.value),className:"w-24 rounded border border-slate-800 bg-slate-950 px-2 py-1"}):o.rate_to_usd}),e.jsx("td",{className:"px-6 py-4 text-right",children:c===o.id?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>t(o.id),className:"p-1 text-emerald-400 hover:text-emerald-300",children:e.jsx(I,{size:18})}),e.jsx("button",{onClick:()=>l(null),className:"p-1 text-slate-400 hover:text-white",children:e.jsx(B,{size:18})})]}):e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>w(o),className:"p-1 text-cyan-400 hover:text-cyan-300",children:e.jsx(A,{size:18})}),e.jsx("button",{onClick:()=>f(o.id),className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(z,{size:18})})]})})]},o.id))})]})})]})},ee=({auth:s,onSelectTrip:a})=>{const[n,i]=React.useState([]),[d,h]=React.useState([]),[c,l]=React.useState(!0),[b,p]=React.useState(!1),[m,r]=React.useState(""),[u,j]=React.useState("USD"),N=async()=>{try{const[t,f]=await Promise.all([g.get("/trips",s.access_token),g.get("/currencies",s.access_token)]);i(t),h(f)}catch(t){console.error("Failed to fetch data",t)}finally{l(!1)}};React.useEffect(()=>{N()},[]);const x=async t=>{if(t.preventDefault(),!!m.trim())try{const f=await g.post("/trips",{name:m,default_currency:u},s.access_token);i([f,...n]),r(""),p(!1)}catch(f){console.error("Failed to create trip",f)}};return c?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading your trips..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Your Trips"}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 rounded-lg bg-cyan-600 px-4 py-2 font-medium text-white transition-all hover:bg-cyan-500",children:[e.jsx(F,{size:18}),"New Trip"]})]}),b&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-4 rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:e.jsxs("form",{onSubmit:x,className:"flex flex-col gap-4 md:flex-row",children:[e.jsx("input",{type:"text",placeholder:"Trip Name (e.g. Summer in Spain)",value:m,onChange:t=>r(t.target.value),"data-testid":"trip-name-input",className:"flex-1 rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-slate-800 bg-slate-950 px-3",children:[e.jsx(E,{size:16,className:"text-slate-500"}),e.jsx("select",{value:u,onChange:t=>j(t.target.value),"data-testid":"trip-currency-select",className:"cursor-pointer border-none bg-transparent py-2 pr-2 text-slate-200 outline-none",children:d.map(t=>e.jsxs("option",{value:t.code,className:"bg-slate-900",children:[t.code," - ",t.name]},t.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit","data-testid":"create-trip-submit",className:"flex-1 rounded-lg bg-cyan-600 px-6 py-2 font-medium text-white transition-all hover:bg-cyan-500 md:flex-none",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-2 text-slate-400 hover:text-white",children:"Cancel"})]})]})}),n.length===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-800 bg-slate-900/20 py-20 text-center",children:[e.jsx(L,{size:48,className:"mx-auto mb-4 text-slate-700"}),e.jsx("p",{className:"text-lg text-slate-400",children:"No trips yet. Create one to get started!"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:n.map(t=>e.jsxs("div",{onClick:()=>a(t.id),"data-testid":`trip-card-${t.id}`,className:"group cursor-pointer rounded-2xl border border-slate-800 bg-slate-900/40 p-6 transition-all hover:border-cyan-500/50 hover:shadow-xl hover:shadow-cyan-900/10",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold transition-colors group-hover:text-cyan-400",children:t.name}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{size:14}),new Date(t.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1 font-medium text-cyan-500/70",children:[e.jsx(E,{size:14}),t.default_currency]})]})]},t.id))})]})},te=({auth:s,tripId:a})=>{const[n,i]=React.useState(null),[d,h]=React.useState("expenses"),[c,l]=React.useState(!0),b=async()=>{try{const p=await g.get(`/trips/${a}`,s.access_token);i(p)}catch(p){console.error("Failed to fetch trip",p)}finally{l(!1)}};return React.useEffect(()=>{b()},[a]),c?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading trip details..."}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-bold",children:n.name}),e.jsxs("p",{className:"mt-1 text-slate-400","data-testid":"trip-member-count",children:[n.members.length," members"]})]}),e.jsxs("div",{className:"flex self-start rounded-xl border border-slate-800 bg-slate-900/60 p-1",children:[e.jsxs("button",{onClick:()=>h("expenses"),"data-testid":"tab-expenses",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${d==="expenses"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(H,{size:16}),"Expenses"]}),e.jsxs("button",{onClick:()=>h("balances"),"data-testid":"tab-balances",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${d==="balances"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(Y,{size:16}),"Balances"]}),e.jsxs("button",{onClick:()=>h("settings"),"data-testid":"tab-settings",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${d==="settings"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(P,{size:16}),"Settings"]})]})]}),e.jsxs("div",{className:"mt-8",children:[d==="expenses"&&e.jsx(se,{auth:s,trip:n}),d==="balances"&&e.jsx(ae,{auth:s,trip:n}),d==="settings"&&e.jsx(ne,{auth:s,trip:n})]})]}):e.jsx("div",{className:"py-12 text-center text-red-400",children:"Trip not found."})},se=({auth:s,trip:a})=>{const{successToast:n,errorToast:i}=C(),[d,h]=React.useState([]),[c,l]=React.useState([]),[b,p]=React.useState(!1),[m,r]=React.useState(null),u=async()=>{try{const[t,f]=await Promise.all([g.get(`/trips/${a.id}/expenses`,s.access_token),g.get("/currencies",s.access_token)]);h(t),l(f)}catch(t){console.error("Failed to fetch expenses",t)}};React.useEffect(()=>{u()},[a.id,s.access_token]);const j=async t=>{try{const f=await g.post(`/trips/${a.id}/expenses`,t,s.access_token);h([f,...d]),p(!1)}catch{i("Failed to add expense")}},N=async t=>{if(m)try{const f=await g.put(`/expenses/${m.id}`,t,s.access_token);h(d.map(w=>w.id===f.id?f:w)),r(null)}catch{i("Failed to update expense")}},x=async t=>{if(confirm("Delete this expense?"))try{await g.delete(`/expenses/${t}`,s.access_token),h(d.filter(f=>f.id!==t))}catch{i("Failed to delete expense")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Trip Expenses"}),e.jsxs("button",{onClick:()=>{p(!b),r(null)},className:"flex items-center gap-2 rounded-lg bg-cyan-600 px-4 py-2 font-medium text-white transition-all hover:bg-cyan-500",children:[e.jsx(F,{size:18}),"Add Expense"]})]}),b&&e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:e.jsx(D,{trip:a,currencies:c,onSubmit:j,onCancel:()=>p(!1),initialData:{currency:a.default_currency,beneficiary_ids:a.members.map(t=>t.user.id)}})}),m&&e.jsxs("div",{className:"rounded-xl border border-cyan-500/30 bg-cyan-900/10 p-6",children:[e.jsx("h4",{className:"mb-4 text-sm font-bold tracking-wider text-cyan-400 uppercase",children:"Editing Expense"}),e.jsx(D,{trip:a,currencies:c,onSubmit:N,onCancel:()=>r(null),initialData:{amount:m.amount.toString(),currency:m.currency,description:m.description,beneficiary_ids:m.beneficiaries.map(t=>t.id)}})]}),e.jsx("div",{className:"space-y-4",children:d.map(t=>e.jsxs("div",{"data-testid":"expense-item",className:"group flex items-center justify-between rounded-xl border border-slate-800 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-slate-800 font-bold text-slate-300",children:t.payer.name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:t.description}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Paid by ",t.payer.name," • ",new Date(t.date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-6",children:[e.jsxs("div",{className:"text-lg font-bold text-cyan-400",children:[t.amount.toFixed(2)," ",t.currency]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>{r(t),p(!1),window.scrollTo({top:0,behavior:"smooth"})},className:"p-2 text-slate-400 transition-colors hover:text-cyan-400",title:"Edit",children:e.jsx(A,{size:18})}),e.jsx("button",{onClick:()=>x(t.id),className:"p-2 text-slate-400 transition-colors hover:text-red-400",title:"Delete",children:e.jsx(z,{size:18})})]})]})]},t.id))})]})},D=({trip:s,currencies:a,onSubmit:n,onCancel:i,initialData:d})=>{const[h,c]=React.useState(d?.amount||""),[l,b]=React.useState(d?.currency||s.default_currency),[p,m]=React.useState(d?.description||""),[r,u]=React.useState(d?.beneficiary_ids||s.members.map(x=>x.user.id)),j=x=>{x.preventDefault(),n({amount:parseFloat(h),currency:l,description:p,beneficiary_ids:r})},N=x=>{u(t=>t.includes(x)?t.filter(f=>f!==x):[...t,x])};return e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:h,onChange:x=>c(x.target.value),"data-testid":"expense-amount-input",className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Currency"}),e.jsx("select",{value:l,onChange:x=>b(x.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",children:a.map(x=>e.jsxs("option",{value:x.code,children:[x.code," - ",x.name]},x.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Description"}),e.jsx("input",{type:"text",placeholder:"What was it for?",value:p,onChange:x=>m(x.target.value),"data-testid":"expense-description-input",className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-slate-400",children:"Split between:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.members.map(x=>e.jsx("button",{type:"button",onClick:()=>N(x.user.id),className:`rounded-full border px-3 py-1.5 text-sm font-medium transition-all ${r.includes(x.user.id)?"border-cyan-500 bg-cyan-500/20 text-cyan-300":"border-slate-800 bg-slate-950 text-slate-500"}`,children:x.user.name},x.user.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 text-slate-400 hover:text-white",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-cyan-600 px-8 py-2 font-bold text-white hover:bg-cyan-500",children:"Save Expense"})]})]})},ae=({auth:s,trip:a})=>{const[n,i]=React.useState([]),[d,h]=React.useState(!0);return React.useEffect(()=>{(async()=>{try{const l=await g.get(`/trips/${a.id}/balances`,s.access_token);i(l)}catch(l){console.error("Failed to fetch balances",l)}finally{h(!1)}})()},[a.id,s.access_token]),d?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Calculating balances..."}):e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:n.map(c=>e.jsxs("div",{"data-testid":"balance-card",className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-cyan-500/20 font-bold text-cyan-400",children:c.user.name[0]}),e.jsx("h4",{className:"text-xl font-bold",children:c.user.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${c.estimated_total_default_currency>=0?"text-emerald-400":"text-red-400"}`,children:[c.estimated_total_default_currency>=0?"+":"",c.estimated_total_default_currency.toFixed(2)," ",c.default_currency,"*"]}),c.default_currency!=="USD"&&e.jsxs("div",{className:"text-xs text-slate-500",children:["≈ ",c.estimated_total_usd>=0?"+":"",c.estimated_total_usd.toFixed(2)," USD"]})]})]}),e.jsx("div",{className:"space-y-3",children:c.balances.map(l=>e.jsxs("div",{className:"flex justify-between rounded-lg border border-slate-800/50 bg-slate-950 p-3",children:[e.jsx("span",{className:"font-bold text-slate-300",children:l.currency}),e.jsxs("span",{className:`font-bold ${l.balance>=0?"text-emerald-500":"text-red-500"}`,children:[l.balance>=0?"+":"",l.balance.toFixed(2)]})]},l.currency))})]},c.user.id))})},ne=({auth:s,trip:a})=>{const{infoToast:n,errorToast:i}=C(),[d,h]=React.useState([]),[c,l]=React.useState(!1);React.useEffect(()=>{(async()=>{try{const u=await g.get(`/trips/${a.id}/invitations`,s.access_token);h(u)}catch(u){console.error("Failed to fetch invitations",u)}})()},[a.id,s.access_token]);const b=async()=>{try{const r=await g.post(`/trips/${a.id}/invitations`,{},s.access_token);h([r,...d])}catch{i("Failed to create invitation")}},p=r=>{const u=`${window.location.origin}${window.location.pathname}?join=${r}`;navigator.clipboard.writeText(u),n("Copied!"),l(!0),setTimeout(()=>l(!1),2e3)},m=d.find(r=>!r.is_expired);return e.jsxs("div",{className:"max-w-2xl space-y-8",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xl font-bold",children:[e.jsx(J,{size:20,className:"text-cyan-400"}),"Invite Members"]}),e.jsx("p",{className:"mb-6 text-sm text-slate-400",children:"Share this secret link with friends to let them join the trip."}),m?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 truncate rounded-lg border border-slate-800 bg-slate-950 px-4 py-3 text-sm text-slate-300",children:[window.location.origin,window.location.pathname,"?join=",m.uuid]}),e.jsxs("button",{onClick:()=>p(m.uuid),className:"flex items-center gap-2 rounded-lg bg-slate-800 px-4 py-2 whitespace-nowrap text-white transition-all hover:bg-slate-700",children:[c?e.jsx(I,{size:18,className:"text-emerald-400"}):e.jsx(O,{size:18}),c?"Copied!":"Copy Link"]})]}):e.jsxs("button",{onClick:b,"data-testid":"generate-invite-button",className:"flex w-full items-center justify-center gap-2 rounded-xl bg-cyan-600 py-3 font-bold text-white hover:bg-cyan-500",children:[e.jsx(Q,{size:18})," Generate Invitation Link"]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"Trip Members"}),e.jsx("div",{className:"space-y-3",children:a.members.map(r=>e.jsx("div",{className:"flex items-center justify-between rounded-lg border border-slate-800/30 bg-slate-950/50 p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-slate-800 text-xs font-bold",children:r.user.name[0]}),e.jsx("div",{className:"text-sm font-bold",children:r.user.name})]})},r.user.id))})]})]})},re=()=>{const{errorToast:s}=C(),[a,n]=React.useState("landing"),[i,d]=React.useState(null),[h,c]=React.useState(null),[l,b]=React.useState(null);React.useEffect(()=>{const r=localStorage.getItem("multicount_auth")||sessionStorage.getItem("multicount_auth");if(r)try{d(JSON.parse(r)),n("dashboard")}catch{localStorage.removeItem("multicount_auth"),sessionStorage.removeItem("multicount_auth")}const j=new URLSearchParams(window.location.search).get("join");j&&(b(j),window.history.replaceState({},"",window.location.pathname))},[]),React.useEffect(()=>{l&&i?n("join_confirmation"):l&&!i&&n("login")},[l,i]);const p=async r=>{try{const u=await g.post(`/trips/join/${r}`,{},i?.access_token);b(null),c(u.id),n("trip")}catch(u){console.error("Failed to join trip",u),b(null),s("Failed to join trip. The invitation might be expired or invalid.")}},m=()=>{d(null),localStorage.removeItem("multicount_auth"),sessionStorage.removeItem("multicount_auth"),n("landing")};return e.jsxs("div",{className:"min-h-screen font-sans text-slate-100",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-slate-800/50 bg-slate-900/50 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto flex h-16 max-w-6xl items-center justify-between px-4",children:[e.jsxs("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>n(i?"dashboard":"landing"),children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-cyan-500 font-bold text-slate-900",children:"M"}),e.jsx("span",{className:"text-xl font-bold tracking-tight",children:"MultiCount"})]}),e.jsx("nav",{className:"flex items-center gap-4",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden text-sm text-slate-400 md:inline",children:i.user.name}),i.user.role==="admin"&&e.jsx("button",{onClick:()=>n("admin"),className:`text-sm font-medium transition-colors ${a==="admin"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Admin"}),e.jsx("button",{onClick:()=>n("dashboard"),className:`text-sm font-medium transition-colors ${a==="dashboard"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Trips"}),e.jsx("button",{onClick:m,className:"text-sm font-medium text-slate-300 transition-colors hover:text-white",children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n("login"),className:"text-sm font-medium text-slate-300 transition-colors hover:text-white",children:"Login"}),e.jsx(_,{onClick:()=>n("register"),"data-testid":"signup-button",children:"Sign Up"})]})})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl px-4 py-8",children:[a==="landing"&&e.jsx(le,{onGetStarted:()=>n("register")}),a==="login"&&e.jsx($,{appName:"MultiCount",loginEndpoint:"/multicount/auth/login",registerEndpoint:"/multicount/auth/register",initialMode:"login",onSuccess:(r,u)=>{d(r),n("dashboard"),u?localStorage.setItem("multicount_auth",JSON.stringify(r)):sessionStorage.setItem("multicount_auth",JSON.stringify(r))},className:"min-h-[calc(100vh-8rem)] bg-transparent"}),a==="register"&&e.jsx($,{appName:"MultiCount",loginEndpoint:"/multicount/auth/login",registerEndpoint:"/multicount/auth/register",initialMode:"register",onSuccess:(r,u)=>{d(r),n("dashboard"),u?localStorage.setItem("multicount_auth",JSON.stringify(r)):sessionStorage.setItem("multicount_auth",JSON.stringify(r))},className:"min-h-[calc(100vh-8rem)] bg-transparent"}),a==="dashboard"&&i&&e.jsx(ee,{auth:i,onSelectTrip:r=>{c(r),n("trip")}}),a==="trip"&&i&&h&&e.jsx(te,{auth:i,tripId:h}),a==="admin"&&i&&i.user.role==="admin"&&e.jsx(Z,{auth:i}),a==="join_confirmation"&&l&&e.jsx(ie,{uuid:l,onConfirm:()=>p(l),onCancel:()=>{b(null),n("dashboard")}})]})]})},ie=({uuid:s,onConfirm:a,onCancel:n})=>{const[i,d]=React.useState(null),[h,c]=React.useState(!0),[l,b]=React.useState(null);return React.useEffect(()=>{(async()=>{try{const m=await g.get(`/trips/invitation/${s}`);d(m)}catch{b("Invalid or expired invitation link.")}finally{c(!1)}})()},[s]),h?e.jsx("div",{className:"py-20 text-center",children:"Loading trip information..."}):l||!i?e.jsx("div",{className:"mx-auto max-w-md py-20 text-center",children:e.jsxs("div",{className:"rounded-xl border border-red-500/50 bg-red-900/20 p-6",children:[e.jsx("h2",{className:"mb-2 text-xl font-bold text-red-400",children:"Error"}),e.jsx("p",{className:"mb-6 text-slate-300",children:l||"Trip not found"}),e.jsx("button",{onClick:n,className:"rounded-lg bg-slate-800 px-4 py-2 transition-colors hover:bg-slate-700",children:"Back to Dashboard"})]})}):e.jsx("div",{className:"mx-auto max-w-md py-20",children:e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-8 text-center shadow-xl",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-cyan-500/10 text-cyan-500",children:e.jsx(L,{className:"h-8 w-8"})}),e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:"Join Trip?"}),e.jsxs("p",{className:"mb-8 text-slate-400",children:["You've been invited to join ",e.jsxs("span",{className:"font-semibold text-white",children:['"',i.name,'"']}),". Once you join, you'll be able to see and add expenses."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(_,{onClick:a,className:"w-full py-6 text-base",children:"Accept and Join"}),e.jsx("button",{onClick:n,className:"w-full rounded-xl bg-slate-800 py-3 font-medium text-slate-300 transition-all hover:bg-slate-700",children:"Not Now"})]})]})})},le=({onGetStarted:s})=>e.jsxs("div",{className:"py-20 text-center",children:[e.jsxs("h1",{className:"mb-6 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-5xl font-extrabold text-transparent md:text-7xl",children:["Split Expenses, ",e.jsx("br",{}),"Not Friendships."]}),e.jsx("p",{className:"mx-auto mb-10 max-w-2xl text-xl text-slate-400",children:"The simple way to track shared expenses on trips. Multi-currency support, automated balances, and secret join links."}),e.jsx(_,{onClick:s,className:"px-8 py-6 text-lg",children:"Get Started for Free"})]});ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(M,{children:e.jsx(re,{})})}));
