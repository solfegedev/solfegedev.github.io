import"./index-DEHygn5w.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as xe}from"./api-CH_Pe6Vg.js";import{S as ge,C as he}from"./search-XMVjuEej.js";import{c as y}from"./createLucideIcon-DtX1aPOG.js";import{C as ue}from"./copy-CzC7y2Qs.js";import{M as W,a as pe,L as fe}from"./map-21CgSxyq.js";import{X as be}from"./x-BS-d4QNZ.js";import{L as I}from"./leaflet-src-DBNPRDgh.js";const ye=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],Y=y("bike",ye);const we=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],je=y("book-open",we);const ve=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],J=y("chevron-left",ve);const Ne=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],K=y("chevron-right",Ne);const ke=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],_e=y("external-link",ke);const Se=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ce=y("eye",Se);const Pe=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Re=y("file-text",Pe);const $e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Me=y("frown",$e);const Ie=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Le=y("funnel",Ie);const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],X=y("globe",De);const Be=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Ae=y("heart",Be);const Fe=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],ee=y("house",Fe);const ze=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ee=y("image",ze);const Te=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Ge=y("maximize",Te);const Ve=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],te=y("navigation",Ve);const He=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Ue=y("shield-alert",He),Oe=async t=>{const f=await fetch(`${xe}/properties/?source=${t}`);if(!f.ok){const d=await f.json();throw new Error(d.detail||"Failed to fetch properties")}return f.json()},qe=({filters:t,onChange:f,propertyGroups:d,sortBy:h,onSortChange:j})=>{const i=u=>{const{name:o,value:r,type:k}=u.target,l=k==="checkbox"?u.target.checked:o==="minPrice"||o==="maxPrice"||o==="minBedrooms"?Number(r):r;f({...t,[o]:l})};return e.jsx("div",{className:"bg-white border-b border-gray-200 p-4 shadow-sm z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx("input",{type:"text",name:"searchQuery",value:t.searchQuery,onChange:i,placeholder:"Search location or features...",className:"w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all"}),e.jsx(ge,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Type"}),e.jsx("select",{name:"propertyGroup",value:t.propertyGroup,onChange:i,className:"bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",children:d.map(u=>e.jsx("option",{value:u,children:u},u))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Beds"}),e.jsxs("select",{name:"minBedrooms",value:t.minBedrooms,onChange:i,className:"bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",children:[e.jsx("option",{value:0,children:"Any"}),e.jsx("option",{value:1,children:"1+"}),e.jsx("option",{value:2,children:"2+"}),e.jsx("option",{value:3,children:"3+"}),e.jsx("option",{value:4,children:"4+"}),e.jsx("option",{value:5,children:"5+"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Sold/Let"}),e.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 gap-2",children:[e.jsx("input",{type:"checkbox",name:"includeSoldLet",id:"includeSoldLet",checked:t.includeSoldLet,onChange:i,className:"w-4 h-4 rounded text-indigo-600 focus:ring-indigo-500/20 border-gray-300 cursor-pointer"}),e.jsx("label",{htmlFor:"includeSoldLet",className:"text-sm font-bold text-gray-700 cursor-pointer",children:"Include"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Price"}),e.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-xl overflow-hidden",children:[e.jsx("input",{type:"number",name:"minPrice",value:t.minPrice,onChange:i,placeholder:"Min",className:"w-20 md:w-24 px-3 py-2 text-sm font-bold text-gray-700 bg-transparent focus:outline-none"}),e.jsx("span",{className:"text-gray-300 px-1",children:"—"}),e.jsx("input",{type:"number",name:"maxPrice",value:t.maxPrice,onChange:i,placeholder:"Max",className:"w-20 md:w-24 px-3 py-2 text-sm font-bold text-gray-700 bg-transparent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Sort"}),e.jsxs("select",{value:h,onChange:u=>j(u.target.value),className:"bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"last-modified",children:"Last Modified"}),e.jsx("option",{value:"price-asc",children:"Price: Low to High"}),e.jsx("option",{value:"price-desc",children:"Price: High to Low"})]})]})]})})},ae=React.memo(({property:t,onSelect:f,onViewDetails:d,onShowOnMap:h,isSelected:j,index:i,total:u})=>{const[o,r]=React.useState(0),k=s=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(s),l=s=>{s.stopPropagation(),r(x=>(x+1)%t.images.length)},v=s=>{s.stopPropagation(),r(x=>(x-1+t.images.length)%t.images.length)},w=()=>{f(t)},b=s=>{s.stopPropagation(),d(t)},m=t.images[o]?.url||"https://via.placeholder.com/400x300?text=No+Image",p=s=>{s.stopPropagation();const x=new URLSearchParams;x.set("location",window.location.search.includes("location")?new URLSearchParams(window.location.search).get("location"):"chesterfield_ashgate"),x.set("id",t.id);const g=`${window.location.origin}${window.location.pathname}?${x.toString()}`;navigator.clipboard.writeText(g).then(()=>{console.log("Link copied to clipboard!")})};return e.jsxs("div",{id:`property-${t.id}`,"data-testid":"property-card",onClick:w,className:`group flex flex-col md:flex-row rounded-md overflow-hidden border transition-all duration-300 cursor-pointer mx-0.5 ${j?"border-indigo-600 ring-2 ring-indigo-600 shadow-lg z-10 bg-white":"border-gray-200 hover:border-indigo-300 hover:shadow-md z-0 bg-white"}`,children:[e.jsxs("div",{className:"relative w-full md:w-40 h-48 md:h-auto overflow-hidden bg-gray-100 pointer-events-none",children:[e.jsx("img",{src:m,alt:t.address,className:"w-full h-full object-cover transition-transform duration-500",loading:"lazy",referrerPolicy:"no-referrer"}),t.images.length>1&&e.jsxs("div",{className:"pointer-events-auto",children:[e.jsx("button",{onClick:v,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full backdrop-blur-sm transition-all opacity-70 hover:opacity-100 cursor-pointer z-10",children:e.jsx(J,{className:"w-6 h-6"})}),e.jsx("button",{onClick:l,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full backdrop-blur-sm transition-all opacity-70 hover:opacity-100 cursor-pointer z-10",children:e.jsx(K,{className:"w-6 h-6"})})]}),t.is_new&&e.jsx("div",{className:"absolute top-3 left-3 bg-indigo-600 text-white text-[0.625rem] font-black px-2 py-1 rounded-md uppercase tracking-wider shadow-sm",children:"New"}),t.sold_let&&e.jsx("div",{className:"absolute top-3 right-3 bg-yellow-400 text-black text-[0.625rem] font-black px-2 py-1 rounded-md uppercase tracking-wider shadow-sm border border-black/10",children:t.sold_let}),e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/50 backdrop-blur-sm text-white text-[0.625rem] font-bold px-2 py-1 rounded-md flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),o+1," / ",t.images.length]})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-start mb-1",children:e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("h3",{className:"text-lg font-black text-gray-900 leading-tight",children:k(t.price)}),e.jsxs("span",{className:"text-[0.8rem] font-bold text-gray-800 uppercase tracking-widest",children:[i+1," / ",u]}),e.jsxs("span",{className:"text-xs font-bold text-gray-400 bg-gray-50 px-2 py-1 rounded-md",children:[t.property_group_icon," ",t.property_group]})]})})}),e.jsx("p",{className:"text-sm font-bold text-gray-600 line-clamp-1 mb-2",children:t.address}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-black text-gray-700",children:[t.bedrooms," ",e.jsx("span",{className:"font-medium text-gray-500",children:"Beds"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-black text-gray-700",children:[t.bathrooms," ",e.jsx("span",{className:"font-medium text-gray-500",children:"Baths"})]})]}),t.size_sqm&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-black text-gray-700",children:[Math.round(t.size_sqm)," ",e.jsx("span",{className:"font-medium text-gray-500",children:"m²"})]})]})]}),e.jsx("div",{className:"space-y-0.5 mb-3",children:(()=>{const s=new Date,x=t.date_added?new Date(t.date_added):null;let g=null;if(t.previous_prices&&t.previous_prices.length>0){const _=t.previous_prices[0].price;t.price<_&&t.date_updated&&(g=new Date(t.date_updated))}return e.jsxs("div",{className:"text-[0.8rem] font-bold leading-tight",children:[g&&e.jsxs("div",{className:"text-gray-400 mb-1",children:[e.jsxs("span",{className:"text-emerald-600",children:["Reduced"," ",((s.getTime()-g.getTime())/(1e3*60*60*24)).toFixed(1)," ","days ago"]})," ","(on"," ",g.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),")"]}),t.previous_prices&&t.previous_prices.length>0&&e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-0.5 mb-1 opacity-80",children:[...t.previous_prices].reverse().map((_,F)=>e.jsxs("div",{className:"text-gray-400 bg-emerald-50 px-1.5 py-0.5 rounded border border-gray-100",children:[new Date(_.date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),": ",k(_.price)]},F))}),x&&e.jsxs("div",{className:"text-gray-400",children:[e.jsxs("span",{className:g?"":"text-orange-500",children:["First added"," ",((s.getTime()-x.getTime())/(1e3*60*60*24)).toFixed(1)," ","days ago"]})," ","(on"," ",x.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),")"]})]})})()})]}),e.jsxs("div",{className:"flex gap-2 pointer-events-auto",children:[e.jsxs("button",{onClick:p,title:"Copy shareable link",className:"text-[0.625rem] font-bold text-gray-700 hover:text-gray-900 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded-md transition-all uppercase cursor-pointer flex items-center gap-1 border border-gray-200",children:["Copy",e.jsx(ue,{className:"w-3 h-3"})]}),e.jsx("button",{onClick:b,className:"text-[0.625rem] font-bold text-indigo-700 hover:text-indigo-900 bg-indigo-100 hover:bg-indigo-200 px-2 py-1 rounded-md transition-all uppercase cursor-pointer",children:"View Details"}),e.jsxs("a",{href:`https://www.rightmove.co.uk/properties/${t.id}#/?channel=RES_BUY`,target:"_blank",rel:"noopener noreferrer",className:"text-[0.625rem] font-bold text-teal-700 hover:text-teal-900 bg-teal-100 hover:bg-teal-200 px-2 py-1 rounded-md transition-all uppercase cursor-pointer flex items-center gap-1 border border-teal-200",onClick:s=>s.stopPropagation(),title:"View on Rightmove",children:["Original",e.jsx(_e,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-gray-50",children:[e.jsx("a",{href:`https://www.google.com/maps/@${t.coordinates[0]},${t.coordinates[1]},3a,90y,70t/data=!3m1!1e1`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-green-100 text-green-700 hover:bg-green-200 transition-colors border border-green-200 shadow-sm",title:"Street View",onClick:s=>s.stopPropagation(),children:e.jsx(W,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://open.xploria.co.uk/app/know-your-place?map=${t.coordinates[1]}*${t.coordinates[0]}*18&view=elcAu7IT4&theme=w0fDyvnN_`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-orange-100 text-orange-700 hover:bg-orange-200 transition-colors border border-orange-200 shadow-sm",title:"Crime Map",onClick:s=>s.stopPropagation(),children:e.jsx(Ue,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://open.xploria.co.uk/app/know-your-place?map=${t.coordinates[1]}*${t.coordinates[0]}*18&view=elcAu7IT4`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors border border-blue-200 shadow-sm",title:"Living Standard",onClick:s=>s.stopPropagation(),children:e.jsx(Ae,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://www.cyclosm.org/#map=17/${t.coordinates[0]}/${t.coordinates[1]}/cyclosm`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors border border-purple-200 shadow-sm",title:"Cycle Map",onClick:s=>s.stopPropagation(),children:e.jsx(Y,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://earth.google.com/web/@${t.coordinates[0]},${t.coordinates[1]},132a,25d,35y,0h,0t,0r`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-cyan-100 text-cyan-700 hover:bg-cyan-200 transition-colors border border-cyan-200 shadow-sm",title:"Google Earth",onClick:s=>s.stopPropagation(),children:e.jsx(X,{className:"w-3.5 h-3.5"})}),t.closest?.coords&&e.jsx("a",{href:`https://www.google.com/maps/dir/${t.closest.coords[0]},${t.closest.coords[1]}/${t.coordinates[0]},${t.coordinates[1]}/@2696m/data=!3m2!1e3!4b1!4m2!4m1!3e2`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-rose-100 text-rose-700 hover:bg-rose-200 transition-colors border border-rose-200 shadow-sm",title:"Directions from Nearest",onClick:s=>s.stopPropagation(),children:e.jsx(te,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.agency?.url&&e.jsx("img",{src:t.agency.url,alt:t.agency.caption,className:"h-4 max-w-[80px] object-contain opacity-70 grayscale hover:grayscale-0 transition-all",loading:"lazy",referrerPolicy:"no-referrer"}),!t.agency?.url&&t.agency?.caption&&e.jsx("span",{className:"text-[0.625rem] font-bold text-gray-400 uppercase tracking-tight",children:t.agency.caption})]}),e.jsx("div",{className:"flex items-center gap-1.5 pointer-events-auto",children:t.closest&&e.jsxs("button",{onClick:s=>{s.stopPropagation(),h?.(t)},"data-testid":"distance-button",className:"text-[0.625rem] font-bold text-indigo-700 hover:text-indigo-900 bg-indigo-100 hover:bg-indigo-200 px-2 py-1 rounded-md transition-colors uppercase cursor-pointer",children:[t.closest.miles?.toFixed(1)||0," miles to"," ",t.closest.place||"nearest"]})})]})]})]})});ae.displayName="PropertyCard";const Ze=({property:t,onClose:f})=>{const[d,h]=React.useState(0),j=o=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(o),i=o=>{o.stopPropagation(),h(r=>(r+1)%t.images.length)},u=o=>{o.stopPropagation(),h(r=>(r-1+t.images.length)%t.images.length)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6 bg-gray-900/40 backdrop-blur-sm animate-in fade-in duration-300",onClick:f,"data-testid":"x-property-modal",children:e.jsxs("div",{className:"bg-white w-full max-w-5xl max-h-[90vh] rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-300",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-100 flex items-center justify-between bg-white sticky top-0 z-10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-gray-900 leading-tight",children:j(t.price)}),e.jsx("p",{className:"text-sm font-bold text-gray-500",children:t.address})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors text-gray-400 hover:text-gray-900",children:e.jsx(be,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 md:gap-8 p-0 md:p-8",children:[e.jsx("div",{className:"relative aspect-[16/10] md:aspect-square bg-gray-100 md:rounded-2xl overflow-hidden group/carousel",children:t.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.images[d].url,alt:t.images[d].caption||`Image ${d+1}`,className:"w-full h-full object-cover animate-in fade-in duration-500"},d),t.images[d].caption&&e.jsx("div",{className:"absolute bottom-0 inset-x-0 p-4 bg-black/40 backdrop-blur-md text-white text-[0.625rem] font-bold uppercase tracking-wider",children:t.images[d].caption}),t.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:u,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-md text-white transition-all opacity-0 group-hover/carousel:opacity-100 border border-white/10",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:i,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-md text-white transition-all opacity-0 group-hover/carousel:opacity-100 border border-white/10",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"absolute top-4 right-4 px-3 py-1 bg-black/40 backdrop-blur-md rounded-full text-white text-[0.625rem] font-black tracking-widest uppercase border border-white/10",children:[d+1," / ",t.images.length]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 font-bold uppercase tracking-widest text-[0.625rem]",children:"No images available"})}),e.jsxs("div",{className:"p-6 md:p-0 space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4",children:"Key Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.key_features.map((o,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsx("div",{className:"mt-1 w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:o})]},r))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4",children:"Description"}),e.jsx("div",{className:"text-gray-600 text-sm leading-relaxed font-medium bg-gray-50/50 p-4 rounded-2xl italic border-l-4 border-indigo-200",dangerouslySetInnerHTML:{__html:t.summary}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.floorplans.length>0&&e.jsxs("a",{href:t.floorplans[0].url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-indigo-50 text-indigo-700 font-black text-sm hover:bg-indigo-100 transition-colors border border-indigo-100",children:[e.jsx(Re,{className:"w-5 h-5"}),"Floorplan"]}),t.brochures.length>0&&e.jsxs("a",{href:t.brochures[0].url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-emerald-50 text-emerald-700 font-black text-sm hover:bg-emerald-100 transition-colors border border-emerald-100",children:[e.jsx(je,{className:"w-5 h-5"}),"Brochure"]}),e.jsxs("a",{href:`https://www.google.com/maps/@${t.coordinates[0]},${t.coordinates[1]},3a,90y,70t/data=!3m1!1e1`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-green-50 text-green-700 font-black text-sm hover:bg-green-100 transition-colors border border-green-100",children:[e.jsx(W,{className:"w-5 h-5"}),"Street View"]}),e.jsxs("a",{href:`https://www.cyclosm.org/#map=17/${t.coordinates[0]}/${t.coordinates[1]}/cyclosm`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-purple-50 text-purple-700 font-black text-sm hover:bg-purple-100 transition-colors border border-purple-100",children:[e.jsx(Y,{className:"w-5 h-5"}),"Cycle Map"]}),e.jsxs("a",{href:`https://earth.google.com/web/@${t.coordinates[0]},${t.coordinates[1]},132a,25d,35y,0h,0t,0r`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-cyan-50 text-cyan-700 font-black text-sm hover:bg-cyan-100 transition-colors border border-cyan-100",children:[e.jsx(X,{className:"w-5 h-5"}),"Google Earth"]}),t.closest?.coords&&e.jsxs("a",{href:`https://www.google.com/maps/dir/${t.closest.coords[0]},${t.closest.coords[1]}/${t.coordinates[0]},${t.coordinates[1]}/@2696m/data=!3m2!1e3!4b1!4m2!4m1!3e2`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-rose-50 text-rose-700 font-black text-sm hover:bg-rose-100 transition-colors border border-rose-100",children:[e.jsx(te,{className:"w-5 h-5"}),"Directions"]})]}),t.previous_prices&&t.previous_prices.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4",children:"Price History"}),e.jsx("div",{className:"space-y-2",children:t.previous_prices.map((o,r)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-4 bg-gray-50 rounded-xl text-sm font-bold",children:[e.jsx("span",{className:"text-gray-500",children:new Date(o.date).toLocaleDateString()}),e.jsx("span",{className:"text-gray-900",children:j(o.price)})]},r))})]})]})]})}),e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-100 flex flex-col md:flex-row items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.agency?.url&&e.jsx("img",{src:t.agency.url,alt:t.agency.caption,className:"h-6 object-contain"}),e.jsx("span",{className:"text-sm font-bold text-gray-500",children:t.agency?.caption})]})})]})})},Qe=typeof window<"u"?window.innerWidth<768:!1,L=10,se=.5,We=se*1e3+500,Ye=({properties:t,selectedProperty:f,onPropertySelect:d,zoom:h,onZoomChange:j,center:i,onCenterChange:u})=>{const o=React.useRef(null),r=React.useRef(null),k=React.useRef(null),l=React.useRef(new Map),v=React.useRef(i),w=React.useRef(h);return React.useEffect(()=>{v.current=i},[i]),React.useEffect(()=>{w.current=h},[h]),React.useEffect(()=>{if(!o.current)return;r.current=I.map(o.current,{zoomControl:!1,attributionControl:!1}).setView(i||[51.2627,-1.0856],h||15),I.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19}).addTo(r.current),k.current=I.layerGroup().addTo(r.current),r.current.on("zoomend",()=>{r.current&&j&&j(r.current.getZoom())}),r.current.on("moveend",()=>{if(r.current&&u){const m=o.current;if(m&&(m.offsetWidth===0||m.offsetHeight===0))return;const p=r.current.getCenter();u([p.lat,p.lng])}});const b=new ResizeObserver(()=>{r.current&&(r.current.invalidateSize(),o.current&&o.current.offsetWidth>0&&v.current&&r.current.setView(v.current,w.current||r.current.getZoom(),{animate:!1}))});return o.current&&b.observe(o.current),()=>{b.disconnect(),r.current?.remove()}},[]),React.useEffect(()=>{if(r.current&&i){const b=r.current.getCenter(),m=1e-5,p=r.current.getZoom(),s=h!==void 0&&Math.abs(p-h)>.1;(Math.abs(b.lat-i[0])>m||Math.abs(b.lng-i[1])>m||s)&&r.current.setView(i,h!==void 0?h:p,{animate:!0,duration:se,noMoveStart:!1})}},[i,h]),React.useEffect(()=>{if(!r.current||!k.current||(k.current.clearLayers(),l.current.clear(),t.length===0))return;const b=I.latLngBounds([]);t.forEach(m=>{const[p,s]=m.coordinates;if(!p||!s)return;b.extend([p,s]);const x=I.marker([p,s]).on("click",()=>d(m)).addTo(k.current);l.current.set(m.id,x)}),!i&&t.length>0&&!f&&r.current.fitBounds(b,{padding:[50,50],maxZoom:15})},[t,d]),React.useEffect(()=>{l.current.forEach((b,m)=>{const p=t.find(g=>g.id===m);if(!p)return;const s=f?.id===m,x=I.divIcon({className:"custom-div-icon",html:`
          <div class="flex items-center justify-center transition-all duration-300 ${s?"scale-125 z-50":"hover:scale-110"}">
            <div class="px-2 py-1 rounded-lg font-black text-xs shadow-lg border-2 flex items-center gap-1 ${s?"bg-indigo-600 text-white border-white":"bg-white text-gray-900 border-indigo-600"}">
              £${(p.price/1e3).toFixed(0)}k
            </div>
            <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45 border-r-2 border-b-2 ${s?"bg-indigo-600 border-white":"bg-white border-indigo-600"}"></div>
          </div>
        `,iconSize:[60,30],iconAnchor:[30,30]});b.setIcon(x),s?b.setZIndexOffset(1e3):b.setZIndexOffset(0)})},[f,t]),e.jsx("div",{ref:o,className:"w-full h-full z-0"})},Je=()=>{const t=new URLSearchParams(window.location.search),f=t.get("location")||"chesterfield_ashgate",d=t.get("view")||"list",h=t.get("z")?parseInt(t.get("z")):15,j=t.get("id"),i=t.get("lat")?parseFloat(t.get("lat")):null,u=t.get("lng")?parseFloat(t.get("lng")):null,o=t.get("sold_let")!=="false",[r,k]=React.useState(f),[l,v]=React.useState(1),[w,b]=React.useState(null),[m,p]=React.useState(!0),[s,x]=React.useState(null),[g,_]=React.useState(null),[F,z]=React.useState(null),[R,D]=React.useState(d),[T,G]=React.useState(h),[B,$]=React.useState(i&&u?[i,u]:void 0),[V,re]=React.useState(!1),[N,Z]=React.useState({minPrice:0,maxPrice:2e6,minBedrooms:0,propertyGroup:"All",searchQuery:"",includeSoldLet:o}),[S,ne]=React.useState("last-modified"),[H,U]=React.useState(j),O=React.useRef(!0),C=React.useMemo(()=>{if(!w)return[];let a=w.items.filter(n=>{if(!N.includeSoldLet&&n.sold_let||n.price<N.minPrice||n.price>N.maxPrice||n.bedrooms<N.minBedrooms||N.propertyGroup!=="All"&&n.property_group!==N.propertyGroup)return!1;if(N.searchQuery){const c=N.searchQuery.toLowerCase();return n.address.toLowerCase().includes(c)||n.summary.toLowerCase().includes(c)}return!0});return a.sort((n,c)=>{if(S==="price-asc")return n.price-c.price;if(S==="price-desc")return c.price-n.price;if(S==="newest")return new Date(c.date_added||0).getTime()-new Date(n.date_added||0).getTime();if(S==="last-modified"){const E=new Date(n.date_updated||n.date_added||0).getTime();return new Date(c.date_updated||c.date_added||0).getTime()-E}return 0}),a},[w,N,S]),M=Math.ceil(C.length/L),Q=React.useMemo(()=>{const a=(l-1)*L;return C.slice(a,a+L)},[C,l]);React.useEffect(()=>{if(H&&R==="list"){const a=document.getElementById(`property-${H}`);if(a){const n=setTimeout(()=>{a.scrollIntoView({behavior:"smooth",block:"center"}),U(null)},100);return()=>clearTimeout(n)}}},[H,R,l,Q]);const oe=React.useCallback(a=>{_(a),$([...a.coordinates]);const n=new URLSearchParams(window.location.search);n.set("id",a.id);const c=`${window.location.pathname}?${n.toString()}`;window.history.replaceState({},"",c)},[]),ie=React.useCallback(a=>{_(a),z(a);const n=new URLSearchParams(window.location.search);n.set("id",a.id);const c=`${window.location.pathname}?${n.toString()}`;window.history.replaceState({},"",c)},[]),le=React.useCallback(a=>{_(a),$([...a.coordinates]),D("map"),G(15)},[]);React.useEffect(()=>{const a=new URLSearchParams;a.set("location",r),R==="map"&&a.set("view","map"),a.set("z",T.toString()),B&&(a.set("lat",B[0].toFixed(6)),a.set("lng",B[1].toFixed(6))),g&&a.set("id",g.id),N.includeSoldLet||a.set("sold_let","false");const n=`${window.location.pathname}?${a.toString()}`;window.history.replaceState({},"",n)},[r,R,g,T,B,N.includeSoldLet]),React.useEffect(()=>{(async()=>{p(!0),O.current?z(null):(_(null),z(null),D("list"),G(15),$(void 0),v(1));try{const n=await Oe(r);if(b(n),x(null),O.current&&j){const c=n.items.find(E=>E.id===j);if(c){_(c);const q=[...n.items].sort((P,A)=>{if(S==="price-asc")return P.price-A.price;if(S==="price-desc")return A.price-P.price;if(S==="newest")return new Date(A.date_added||0).getTime()-new Date(P.date_added||0).getTime();if(S==="last-modified"){const me=new Date(P.date_updated||P.date_added||0).getTime();return new Date(A.date_updated||A.date_added||0).getTime()-me}return 0}).findIndex(P=>P.id===j);if(q>=0){const P=Math.floor(q/L)+1;v(P)}d==="list"&&U(c.id)}}}catch(n){x(n.message)}finally{p(!1),O.current=!1}})()},[r]);const ce=React.useCallback(a=>{_(a),$([...a.coordinates]),Qe&&setTimeout(()=>{D("list")},We);const n=C.findIndex(c=>c.id===a.id);if(n>=0){const c=Math.floor(n/L)+1;v(c)}U(a.id)},[C]),de=React.useMemo(()=>{if(!w)return["All"];const a=new Set(w.items.map(n=>n.property_group));return["All",...Array.from(a)]},[w]);return React.useEffect(()=>{v(1)},[N,S]),e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 overflow-hidden font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-3 flex flex-col md:flex-row md:items-center justify-between gap-4 shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg transform transition-hover hover:scale-105",children:e.jsx(ee,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-extrabold text-gray-900 tracking-tight",children:"Properties"}),e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:w?.region||"Loading..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>re(!V),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${V?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),"Filters"]}),e.jsx("label",{htmlFor:"location-select",className:"text-xs font-black text-gray-400 uppercase tracking-tight hidden md:block ml-2",children:"Location"}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{id:"location-select",name:"location",value:r,"data-testid":"source-select",onChange:a=>k(a.target.value),className:"appearance-none bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pr-10 text-sm font-bold text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 transition-all cursor-pointer relative",children:[e.jsx("option",{value:"chesterfield_ashgate",children:"Chesterfield (Ashgate)"}),e.jsx("option",{value:"chesterfield",children:"Chesterfield"}),e.jsx("option",{value:"chesterfield_rent",children:"Chesterfield (Rent)"}),e.jsx("option",{value:"herts",children:"Herts"}),e.jsx("option",{value:"hitchin_johnsonpl",children:"Hitchin (Johnson Pl)"}),e.jsx("option",{value:"hitchin_rent",children:"Hitchin (Rent)"}),e.jsx("option",{value:"london",children:"London"}),e.jsx("option",{value:"basingstoke",children:"Basingstoke"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-indigo-600",children:e.jsx(he,{className:"w-4 h-4"})})]})]})]}),V&&e.jsx(qe,{filters:N,onChange:Z,propertyGroups:de,sortBy:S,onSortChange:ne}),e.jsxs("main",{className:"flex-1 flex flex-col md:flex-row overflow-hidden relative",children:[e.jsxs("div",{className:`w-full md:w-2/5 flex flex-col bg-stone-200 overflow-hidden border-r border-gray-200 ${R==="map"?"hidden md:flex":"flex"}`,children:[!m&&!s&&w&&e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white/80 backdrop-blur-sm flex items-center justify-center gap-1 relative","data-testid":"pagination-controls",children:[e.jsxs("div",{className:"flex flex-col items-start md:absolute md:left-4 md:top-1/2 md:-translate-y-1/2 text-gray-900 font-bold text-sm px-2",children:[e.jsx("span",{children:m?"Searching...":g?`Property ${C.findIndex(a=>a.id===g.id)+1} / ${C.length}`:`${C.length} properties`}),w&&e.jsxs("span",{className:"text-xs text-gray-800 font-medium",children:["Updated:"," ",new Date(w.updated_on).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),M>1&&e.jsxs("div",{className:"flex items-center justify-center gap-1 ml-auto md:ml-0",children:[l>3&&e.jsx("button",{onClick:()=>v(1),className:"px-3 py-2 rounded-lg text-sm font-bold transition-all bg-gray-100 text-gray-600 hover:bg-gray-200","data-testid":"pagination-first",title:"First page",children:"1"}),l>3&&e.jsx("span",{className:"px-2 py-2 text-sm text-gray-400",children:"..."}),[l-2,l-1,l,l+1,l+2].filter(a=>a>=1&&a<=M).map(a=>e.jsx("button",{onClick:()=>v(a),className:`px-3 py-2 rounded-lg text-sm font-bold transition-all ${a===l?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,"data-testid":`pagination-page-${a}`,children:a},a)),l<M-2&&e.jsx("span",{className:"px-2 py-2 text-sm text-gray-400",children:"..."}),l<M-2&&e.jsx("button",{onClick:()=>v(M),className:"px-3 py-2 rounded-lg text-sm font-bold transition-all bg-gray-100 text-gray-600 hover:bg-gray-200","data-testid":"pagination-last",title:"Last page",children:M})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto md:px-2 space-y-1 md:space-y-2 scrollbar-thin scrollbar-thumb-gray-200 scrollbar-track-transparent","data-testid":"property-list",children:m?e.jsx("div",{className:"flex items-center justify-center h-64","data-testid":"loading-spinner",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"})}):s?e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-xl border border-red-100 text-center font-medium",children:s}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-300 mb-4 flex justify-center",children:e.jsx(Me,{className:"w-16 h-16"})}),e.jsx("p",{className:"text-gray-500 font-bold",children:"No properties found matching your criteria."}),e.jsx("button",{onClick:()=>Z({minPrice:0,maxPrice:2e6,minBedrooms:0,propertyGroup:"All",searchQuery:"",includeSoldLet:!0}),className:"mt-4 text-indigo-600 font-bold hover:underline",children:"Clear all filters"})]}):Q.map((a,n)=>e.jsx(ae,{property:a,onSelect:oe,onViewDetails:ie,onShowOnMap:le,isSelected:g?.id===a.id,index:(l-1)*L+n,total:C.length},a.id))})]}),e.jsx("div",{className:`w-full md:w-3/5 relative ${R==="list"?"hidden md:block":"flex-1 md:block"}`,children:e.jsx(Ye,{properties:C,selectedProperty:g,onPropertySelect:ce,zoom:T,onZoomChange:G,center:B,onCenterChange:$})}),e.jsx("button",{onClick:()=>{R==="list"?(g&&$([...g.coordinates]),D("map")):D("list")},className:"md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-[40] bg-gray-900 text-white px-6 py-3 rounded-full font-bold shadow-2xl flex items-center gap-2 border border-white/10 active:scale-95 transition-transform",children:R==="list"?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-5 h-5"}),"Show Map"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-5 h-5"}),"Show List"]})})]}),F&&e.jsx(Ze,{property:F,onClose:()=>z(null)})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Je,{})}));
