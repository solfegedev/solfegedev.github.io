import"./index-BNZvnabD.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as z}from"./api-CH_Pe6Vg.js";import{C as T}from"./check-CWX8rMms.js";import{X as A}from"./x-BS-d4QNZ.js";import{c as v}from"./createLucideIcon-DtX1aPOG.js";import{T as E}from"./trash-2-DQbJ9aIh.js";import{B as w}from"./button-ChVf0VhC.js";import{P as F}from"./plus-DDkdk0pc.js";import{U as L,L as I}from"./users-DXQZEc7K.js";import{C as U}from"./copy-CzC7y2Qs.js";import"./clsx-B-dksMZM.js";import"./utils-Bp7-rn4K.js";const B=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],M=v("calendar",B);const P=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],q=v("chart-pie",P);const J=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],R=v("coins",J);const V=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],O=v("credit-card",V);const G=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],D=v("pen",G);const W=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Y=v("settings",W);const H=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],X=v("user-plus",H),k=`${z}/multicount`,S=async t=>{if(t.ok)return t.json();throw await t.json().catch(()=>({detail:t.statusText}))},g={get:(t,s)=>fetch(`${k}${t}`,{headers:s?{Authorization:`Bearer ${s}`}:{}}).then(S),post:(t,s,a)=>fetch(`${k}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(s)}).then(S),put:(t,s,a)=>fetch(`${k}${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(s)}).then(S),delete:(t,s)=>fetch(`${k}${t}`,{method:"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}).then(S)},K=({auth:t})=>{const[s,a]=React.useState([]),[h,o]=React.useState(!0),[p,n]=React.useState(null),[r,x]=React.useState(""),[l,c]=React.useState(""),[b,f]=React.useState(""),y=async()=>{try{const d=await g.get("/currencies",t.access_token);a(d)}catch(d){console.error("Failed to fetch currencies",d)}finally{o(!1)}};React.useEffect(()=>{y()},[]);const m=async d=>{d.preventDefault();try{const j=await g.post("/currencies",{code:r,name:l,rate_to_usd:parseFloat(b)},t.access_token);a([...s,j]),C()}catch{alert("Failed to add currency")}},i=async d=>{try{const j=await g.put(`/currencies/${d}`,{code:r,name:l,rate_to_usd:parseFloat(b)},t.access_token);a(s.map(_=>_.id===d?j:_)),n(null),C()}catch{alert("Failed to update currency")}},u=async d=>{if(confirm("Are you sure you want to delete this currency?"))try{await g.delete(`/currencies/${d}`,t.access_token),a(s.filter(j=>j.id!==d))}catch{alert("Failed to delete currency")}},N=d=>{n(d.id),x(d.code),c(d.name),f(d.rate_to_usd.toString())},C=()=>{x(""),c(""),f("")};return h?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading currencies..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Currency Management"}),e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"Add New Currency"}),e.jsxs("form",{onSubmit:m,className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx("input",{placeholder:"Code (e.g. USD)",value:r,onChange:d=>x(d.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("input",{placeholder:"Name (e.g. US Dollar)",value:l,onChange:d=>c(d.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("input",{placeholder:"Rate to USD (e.g. 1.0)",type:"number",step:"0.0001",value:b,onChange:d=>f(d.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("button",{className:"rounded-lg bg-cyan-600 py-2 font-bold text-white transition-all hover:bg-cyan-500",children:"Add Currency"})]})]}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-800 bg-slate-900/40",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-800 bg-slate-900/60",children:[e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Code"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Name"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Rate to USD"}),e.jsx("th",{className:"px-6 py-4 text-right font-bold text-slate-300",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(d=>e.jsxs("tr",{className:"border-b border-slate-800/50 transition-colors hover:bg-slate-800/20",children:[e.jsx("td",{className:"px-6 py-4",children:p===d.id?e.jsx("input",{value:r,onChange:j=>x(j.target.value),className:"w-20 rounded border border-slate-800 bg-slate-950 px-2 py-1"}):d.code}),e.jsx("td",{className:"px-6 py-4",children:p===d.id?e.jsx("input",{value:l,onChange:j=>c(j.target.value),className:"w-full rounded border border-slate-800 bg-slate-950 px-2 py-1"}):d.name}),e.jsx("td",{className:"px-6 py-4",children:p===d.id?e.jsx("input",{type:"number",step:"0.0001",value:b,onChange:j=>f(j.target.value),className:"w-24 rounded border border-slate-800 bg-slate-950 px-2 py-1"}):d.rate_to_usd}),e.jsx("td",{className:"px-6 py-4 text-right",children:p===d.id?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(d.id),className:"p-1 text-emerald-400 hover:text-emerald-300",children:e.jsx(T,{size:18})}),e.jsx("button",{onClick:()=>n(null),className:"p-1 text-slate-400 hover:text-white",children:e.jsx(A,{size:18})})]}):e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>N(d),className:"p-1 text-cyan-400 hover:text-cyan-300",children:e.jsx(D,{size:18})}),e.jsx("button",{onClick:()=>u(d.id),className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(E,{size:18})})]})})]},d.id))})]})})]})},Q=({onLogin:t,onSwitchToRegister:s})=>{const[a,h]=React.useState(""),[o,p]=React.useState(""),[n,r]=React.useState(""),[x,l]=React.useState(!1),c=async b=>{b.preventDefault(),r(""),l(!0);try{const f=await g.post("/auth/login",{email:a,password:o});t(f)}catch{r("Invalid email or password")}finally{l(!1)}};return e.jsxs("div",{className:"mx-auto mt-12 max-w-md rounded-2xl border border-slate-800 bg-slate-900/40 p-8 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-6 text-center text-3xl font-bold",children:"Welcome Back"}),n&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-800 bg-red-900/30 p-3 text-sm text-red-200",children:n}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-email",className:"mb-1 block text-sm font-medium text-slate-400",children:"Email"}),e.jsx("input",{id:"login-email",type:"email",value:a,onChange:b=>h(b.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-password","disable-role-check":"true",className:"mb-1 block text-sm font-medium text-slate-400",children:"Password"}),e.jsx("input",{id:"login-password",type:"password",value:o,onChange:b=>p(b.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsx(w,{disabled:x,"data-testid":"login-submit",className:"mt-4 w-full",children:x?"Logging in...":"Login"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-400",children:["Don't have an account?"," ",e.jsx("button",{onClick:s,"data-testid":"switch-to-register",className:"text-cyan-400 hover:underline",children:"Sign up"})]})]})},Z=({onRegister:t,onSwitchToLogin:s})=>{const[a,h]=React.useState(""),[o,p]=React.useState(""),[n,r]=React.useState(""),[x,l]=React.useState(""),[c,b]=React.useState(!1),f=async y=>{y.preventDefault(),l(""),b(!0);try{await g.post("/auth/register",{email:a,password:o,name:n}),t()}catch{l("Registration failed. Email might already be taken.")}finally{b(!1)}};return e.jsxs("div",{className:"mx-auto mt-12 max-w-md rounded-2xl border border-slate-800 bg-slate-900/40 p-8 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-6 text-center text-3xl font-bold",children:"Create Account"}),x&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-800 bg-red-900/30 p-3 text-sm text-red-200",children:x}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-name",className:"mb-1 block text-sm font-medium text-slate-400",children:"Full Name"}),e.jsx("input",{id:"reg-name",type:"text",value:n,onChange:y=>r(y.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-email",className:"mb-1 block text-sm font-medium text-slate-400",children:"Email"}),e.jsx("input",{id:"reg-email",type:"email",value:a,onChange:y=>h(y.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-password","disable-role-check":"true",className:"mb-1 block text-sm font-medium text-slate-400",children:"Password"}),e.jsx("input",{id:"reg-password",type:"password",value:o,onChange:y=>p(y.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsx(w,{disabled:c,"data-testid":"register-submit",className:"mt-4 w-full",children:c?"Creating account...":"Sign Up"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-400",children:["Already have an account?"," ",e.jsx("button",{onClick:s,"data-testid":"switch-to-login",className:"text-cyan-400 hover:underline",children:"Login"})]})]})},ee=({auth:t,onSelectTrip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState([]),[n,r]=React.useState(!0),[x,l]=React.useState(!1),[c,b]=React.useState(""),[f,y]=React.useState("USD"),m=async()=>{try{const[u,N]=await Promise.all([g.get("/trips",t.access_token),g.get("/currencies",t.access_token)]);h(u),p(N)}catch(u){console.error("Failed to fetch data",u)}finally{r(!1)}};React.useEffect(()=>{m()},[]);const i=async u=>{if(u.preventDefault(),!!c.trim())try{const N=await g.post("/trips",{name:c,default_currency:f},t.access_token);h([N,...a]),b(""),l(!1)}catch(N){console.error("Failed to create trip",N)}};return n?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading your trips..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Your Trips"}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 rounded-lg bg-cyan-600 px-4 py-2 font-medium text-white transition-all hover:bg-cyan-500",children:[e.jsx(F,{size:18}),"New Trip"]})]}),x&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-4 rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:e.jsxs("form",{onSubmit:i,className:"flex flex-col gap-4 md:flex-row",children:[e.jsx("input",{type:"text",placeholder:"Trip Name (e.g. Summer in Spain)",value:c,onChange:u=>b(u.target.value),className:"flex-1 rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-slate-800 bg-slate-950 px-3",children:[e.jsx(R,{size:16,className:"text-slate-500"}),e.jsx("select",{value:f,onChange:u=>y(u.target.value),"data-testid":"trip-currency-select",className:"cursor-pointer border-none bg-transparent py-2 pr-2 text-slate-200 outline-none",children:o.map(u=>e.jsxs("option",{value:u.code,className:"bg-slate-900",children:[u.code," - ",u.name]},u.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit","data-testid":"create-trip-submit",className:"flex-1 rounded-lg bg-cyan-600 px-6 py-2 font-medium text-white transition-all hover:bg-cyan-500 md:flex-none",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"px-2 text-slate-400 hover:text-white",children:"Cancel"})]})]})}),a.length===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-800 bg-slate-900/20 py-20 text-center",children:[e.jsx(L,{size:48,className:"mx-auto mb-4 text-slate-700"}),e.jsx("p",{className:"text-lg text-slate-400",children:"No trips yet. Create one to get started!"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:a.map(u=>e.jsxs("div",{onClick:()=>s(u.id),"data-testid":`trip-card-${u.id}`,className:"group cursor-pointer rounded-2xl border border-slate-800 bg-slate-900/40 p-6 transition-all hover:border-cyan-500/50 hover:shadow-xl hover:shadow-cyan-900/10",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold transition-colors group-hover:text-cyan-400",children:u.name}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:14}),new Date(u.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1 font-medium text-cyan-500/70",children:[e.jsx(R,{size:14}),u.default_currency]})]})]},u.id))})]})},te=({auth:t,tripId:s})=>{const[a,h]=React.useState(null),[o,p]=React.useState("expenses"),[n,r]=React.useState(!0),x=async()=>{try{const l=await g.get(`/trips/${s}`,t.access_token);h(l)}catch(l){console.error("Failed to fetch trip",l)}finally{r(!1)}};return React.useEffect(()=>{x()},[s]),n?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading trip details..."}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-bold",children:a.name}),e.jsxs("p",{className:"mt-1 text-slate-400","data-testid":"trip-member-count",children:[a.members.length," members"]})]}),e.jsxs("div",{className:"flex self-start rounded-xl border border-slate-800 bg-slate-900/60 p-1",children:[e.jsxs("button",{onClick:()=>p("expenses"),"data-testid":"tab-expenses",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${o==="expenses"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(O,{size:16}),"Expenses"]}),e.jsxs("button",{onClick:()=>p("balances"),"data-testid":"tab-balances",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${o==="balances"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(q,{size:16}),"Balances"]}),e.jsxs("button",{onClick:()=>p("settings"),"data-testid":"tab-settings",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${o==="settings"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(Y,{size:16}),"Settings"]})]})]}),e.jsxs("div",{className:"mt-8",children:[o==="expenses"&&e.jsx(se,{auth:t,trip:a}),o==="balances"&&e.jsx(ae,{auth:t,trip:a}),o==="settings"&&e.jsx(ne,{auth:t,trip:a})]})]}):e.jsx("div",{className:"py-12 text-center text-red-400",children:"Trip not found."})},se=({auth:t,trip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState([]),[n,r]=React.useState(!1),[x,l]=React.useState(null),c=async()=>{try{const[m,i]=await Promise.all([g.get(`/trips/${s.id}/expenses`,t.access_token),g.get("/currencies",t.access_token)]);h(m),p(i)}catch(m){console.error("Failed to fetch expenses",m)}};React.useEffect(()=>{c()},[s.id,t.access_token]);const b=async m=>{try{const i=await g.post(`/trips/${s.id}/expenses`,m,t.access_token);h([i,...a]),r(!1)}catch{alert("Failed to add expense")}},f=async m=>{if(x)try{const i=await g.put(`/expenses/${x.id}`,m,t.access_token);h(a.map(u=>u.id===i.id?i:u)),l(null)}catch{alert("Failed to update expense")}},y=async m=>{if(confirm("Delete this expense?"))try{await g.delete(`/expenses/${m}`,t.access_token),h(a.filter(i=>i.id!==m))}catch{alert("Failed to delete expense")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Trip Expenses"}),e.jsxs("button",{onClick:()=>{r(!n),l(null)},className:"flex items-center gap-2 rounded-lg bg-cyan-600 px-4 py-2 font-medium text-white transition-all hover:bg-cyan-500",children:[e.jsx(F,{size:18}),"Add Expense"]})]}),n&&e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:e.jsx($,{trip:s,currencies:o,onSubmit:b,onCancel:()=>r(!1),initialData:{currency:s.default_currency,beneficiary_ids:s.members.map(m=>m.user.id)}})}),x&&e.jsxs("div",{className:"rounded-xl border border-cyan-500/30 bg-cyan-900/10 p-6",children:[e.jsx("h4",{className:"mb-4 text-sm font-bold tracking-wider text-cyan-400 uppercase",children:"Editing Expense"}),e.jsx($,{trip:s,currencies:o,onSubmit:f,onCancel:()=>l(null),initialData:{amount:x.amount.toString(),currency:x.currency,description:x.description,beneficiary_ids:x.beneficiaries.map(m=>m.id)}})]}),e.jsx("div",{className:"space-y-4",children:a.map(m=>e.jsxs("div",{"data-testid":"expense-item",className:"group flex items-center justify-between rounded-xl border border-slate-800 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-slate-800 font-bold text-slate-300",children:m.payer.name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:m.description}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Paid by ",m.payer.name," • ",new Date(m.date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-6",children:[e.jsxs("div",{className:"text-lg font-bold text-cyan-400",children:[m.amount.toFixed(2)," ",m.currency]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>{l(m),r(!1),window.scrollTo({top:0,behavior:"smooth"})},className:"p-2 text-slate-400 transition-colors hover:text-cyan-400",title:"Edit",children:e.jsx(D,{size:18})}),e.jsx("button",{onClick:()=>y(m.id),className:"p-2 text-slate-400 transition-colors hover:text-red-400",title:"Delete",children:e.jsx(E,{size:18})})]})]})]},m.id))})]})},$=({trip:t,currencies:s,onSubmit:a,onCancel:h,initialData:o})=>{const[p,n]=React.useState(o?.amount||""),[r,x]=React.useState(o?.currency||t.default_currency),[l,c]=React.useState(o?.description||""),[b,f]=React.useState(o?.beneficiary_ids||t.members.map(i=>i.user.id)),y=i=>{i.preventDefault(),a({amount:parseFloat(p),currency:r,description:l,beneficiary_ids:b})},m=i=>{f(u=>u.includes(i)?u.filter(N=>N!==i):[...u,i])};return e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:p,onChange:i=>n(i.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Currency"}),e.jsx("select",{value:r,onChange:i=>x(i.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",children:s.map(i=>e.jsxs("option",{value:i.code,children:[i.code," - ",i.name]},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Description"}),e.jsx("input",{type:"text",placeholder:"What was it for?",value:l,onChange:i=>c(i.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-slate-400",children:"Split between:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.members.map(i=>e.jsx("button",{type:"button",onClick:()=>m(i.user.id),className:`rounded-full border px-3 py-1.5 text-sm font-medium transition-all ${b.includes(i.user.id)?"border-cyan-500 bg-cyan-500/20 text-cyan-300":"border-slate-800 bg-slate-950 text-slate-500"}`,children:i.user.name},i.user.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 text-slate-400 hover:text-white",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-cyan-600 px-8 py-2 font-bold text-white hover:bg-cyan-500",children:"Save Expense"})]})]})},ae=({auth:t,trip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState(!0);return React.useEffect(()=>{(async()=>{try{const r=await g.get(`/trips/${s.id}/balances`,t.access_token);h(r)}catch(r){console.error("Failed to fetch balances",r)}finally{p(!1)}})()},[s.id,t.access_token]),o?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Calculating balances..."}):e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:a.map(n=>e.jsxs("div",{"data-testid":"balance-card",className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-cyan-500/20 font-bold text-cyan-400",children:n.user.name[0]}),e.jsx("h4",{className:"text-xl font-bold",children:n.user.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${n.estimated_total_default_currency>=0?"text-emerald-400":"text-red-400"}`,children:[n.estimated_total_default_currency>=0?"+":"",n.estimated_total_default_currency.toFixed(2)," ",n.default_currency,"*"]}),n.default_currency!=="USD"&&e.jsxs("div",{className:"text-xs text-slate-500",children:["≈ ",n.estimated_total_usd>=0?"+":"",n.estimated_total_usd.toFixed(2)," USD"]})]})]}),e.jsx("div",{className:"space-y-3",children:n.balances.map(r=>e.jsxs("div",{className:"flex justify-between rounded-lg border border-slate-800/50 bg-slate-950 p-3",children:[e.jsx("span",{className:"font-bold text-slate-300",children:r.currency}),e.jsxs("span",{className:`font-bold ${r.balance>=0?"text-emerald-500":"text-red-500"}`,children:[r.balance>=0?"+":"",r.balance.toFixed(2)]})]},r.currency))})]},n.user.id))})},ne=({auth:t,trip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState(!1);React.useEffect(()=>{(async()=>{try{const c=await g.get(`/trips/${s.id}/invitations`,t.access_token);h(c)}catch(c){console.error("Failed to fetch invitations",c)}})()},[s.id,t.access_token]);const n=async()=>{try{const l=await g.post(`/trips/${s.id}/invitations`,{},t.access_token);h([l,...a])}catch{alert("Failed to create invitation")}},r=l=>{const c=`${window.location.origin}${window.location.pathname}?join=${l}`;navigator.clipboard.writeText(c),p(!0),setTimeout(()=>p(!1),2e3)},x=a.find(l=>!l.is_expired);return e.jsxs("div",{className:"max-w-2xl space-y-8",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xl font-bold",children:[e.jsx(X,{size:20,className:"text-cyan-400"}),"Invite Members"]}),e.jsx("p",{className:"mb-6 text-sm text-slate-400",children:"Share this secret link with friends to let them join the trip."}),x?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 truncate rounded-lg border border-slate-800 bg-slate-950 px-4 py-3 text-sm text-slate-300",children:[window.location.origin,window.location.pathname,"?join=",x.uuid]}),e.jsxs("button",{onClick:()=>r(x.uuid),className:"flex items-center gap-2 rounded-lg bg-slate-800 px-4 py-2 whitespace-nowrap text-white transition-all hover:bg-slate-700",children:[o?e.jsx(T,{size:18,className:"text-emerald-400"}):e.jsx(U,{size:18}),o?"Copied!":"Copy Link"]})]}):e.jsxs("button",{onClick:n,"data-testid":"generate-invite-button",className:"flex w-full items-center justify-center gap-2 rounded-xl bg-cyan-600 py-3 font-bold text-white hover:bg-cyan-500",children:[e.jsx(I,{size:18})," Generate Invitation Link"]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"Trip Members"}),e.jsx("div",{className:"space-y-3",children:s.members.map(l=>e.jsx("div",{className:"flex items-center justify-between rounded-lg border border-slate-800/30 bg-slate-950/50 p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-slate-800 text-xs font-bold",children:l.user.name[0]}),e.jsx("div",{className:"text-sm font-bold",children:l.user.name})]})},l.user.id))})]})]})},re=()=>{const[t,s]=React.useState("landing"),[a,h]=React.useState(null),[o,p]=React.useState(null),[n,r]=React.useState(null);React.useEffect(()=>{const c=localStorage.getItem("multicount_auth");if(c)try{h(JSON.parse(c)),s("dashboard")}catch{localStorage.removeItem("multicount_auth")}const f=new URLSearchParams(window.location.search).get("join");f&&(r(f),window.history.replaceState({},"",window.location.pathname))},[]),React.useEffect(()=>{n&&a?s("join_confirmation"):n&&!a&&s("login")},[n,a]);const x=async c=>{try{const b=await g.post(`/trips/join/${c}`,{},a?.access_token);r(null),p(b.id),s("trip")}catch(b){console.error("Failed to join trip",b),r(null),alert("Failed to join trip. The invitation might be expired or invalid.")}},l=()=>{h(null),localStorage.removeItem("multicount_auth"),s("landing")};return e.jsxs("div",{className:"min-h-screen font-sans text-slate-100",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-slate-800/50 bg-slate-900/50 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto flex h-16 max-w-6xl items-center justify-between px-4",children:[e.jsxs("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>s(a?"dashboard":"landing"),children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-cyan-500 font-bold text-slate-900",children:"M"}),e.jsx("span",{className:"text-xl font-bold tracking-tight",children:"MultiCount"})]}),e.jsx("nav",{className:"flex items-center gap-4",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden text-sm text-slate-400 md:inline",children:a.user.name}),a.user.role==="admin"&&e.jsx("button",{onClick:()=>s("admin"),className:`text-sm font-medium transition-colors ${t==="admin"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Admin"}),e.jsx("button",{onClick:()=>s("dashboard"),className:`text-sm font-medium transition-colors ${t==="dashboard"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Trips"}),e.jsx("button",{onClick:l,className:"text-sm font-medium text-slate-300 transition-colors hover:text-white",children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("login"),className:"text-sm font-medium text-slate-300 transition-colors hover:text-white",children:"Login"}),e.jsx(w,{onClick:()=>s("register"),"data-testid":"signup-button",children:"Sign Up"})]})})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl px-4 py-8",children:[t==="landing"&&e.jsx(ie,{onGetStarted:()=>s("register")}),t==="login"&&e.jsx(Q,{onLogin:c=>{h(c),s("dashboard"),localStorage.setItem("multicount_auth",JSON.stringify(c))},onSwitchToRegister:()=>s("register")}),t==="register"&&e.jsx(Z,{onRegister:()=>s("login"),onSwitchToLogin:()=>s("login")}),t==="dashboard"&&a&&e.jsx(ee,{auth:a,onSelectTrip:c=>{p(c),s("trip")}}),t==="trip"&&a&&o&&e.jsx(te,{auth:a,tripId:o}),t==="admin"&&a&&a.user.role==="admin"&&e.jsx(K,{auth:a}),t==="join_confirmation"&&n&&e.jsx(le,{uuid:n,onConfirm:()=>x(n),onCancel:()=>{r(null),s("dashboard")}})]})]})},le=({uuid:t,onConfirm:s,onCancel:a})=>{const[h,o]=React.useState(null),[p,n]=React.useState(!0),[r,x]=React.useState(null);return React.useEffect(()=>{(async()=>{try{const c=await g.get(`/trips/invitation/${t}`);o(c)}catch{x("Invalid or expired invitation link.")}finally{n(!1)}})()},[t]),p?e.jsx("div",{className:"py-20 text-center",children:"Loading trip information..."}):r||!h?e.jsx("div",{className:"mx-auto max-w-md py-20 text-center",children:e.jsxs("div",{className:"rounded-xl border border-red-500/50 bg-red-900/20 p-6",children:[e.jsx("h2",{className:"mb-2 text-xl font-bold text-red-400",children:"Error"}),e.jsx("p",{className:"mb-6 text-slate-300",children:r||"Trip not found"}),e.jsx("button",{onClick:a,className:"rounded-lg bg-slate-800 px-4 py-2 transition-colors hover:bg-slate-700",children:"Back to Dashboard"})]})}):e.jsx("div",{className:"mx-auto max-w-md py-20",children:e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-8 text-center shadow-xl",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-cyan-500/10 text-cyan-500",children:e.jsx(L,{className:"h-8 w-8"})}),e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:"Join Trip?"}),e.jsxs("p",{className:"mb-8 text-slate-400",children:["You've been invited to join"," ",e.jsxs("span",{className:"font-semibold text-white",children:['"',h.name,'"']}),". Once you join, you'll be able to see and add expenses."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(w,{onClick:s,className:"w-full py-6 text-base",children:"Accept and Join"}),e.jsx("button",{onClick:a,className:"w-full rounded-xl bg-slate-800 py-3 font-medium text-slate-300 transition-all hover:bg-slate-700",children:"Not Now"})]})]})})},ie=({onGetStarted:t})=>e.jsxs("div",{className:"py-20 text-center",children:[e.jsxs("h1",{className:"mb-6 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-5xl font-extrabold text-transparent md:text-7xl",children:["Split Expenses, ",e.jsx("br",{}),"Not Friendships."]}),e.jsx("p",{className:"mx-auto mb-10 max-w-2xl text-xl text-slate-400",children:"The simple way to track shared expenses on trips. Multi-currency support, automated balances, and secret join links."}),e.jsx(w,{onClick:t,className:"px-8 py-6 text-lg",children:"Get Started for Free"})]});document.body.classList.add("menuall-page");ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(re,{})}));
