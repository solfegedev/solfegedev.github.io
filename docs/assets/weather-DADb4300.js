import"./index-CTMTiFxB.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{P as we,u as Ve,T as Be}from"./Toast-DP-6vaks.js";import{A as M}from"./api-CH_Pe6Vg.js";import{B as U}from"./button-BRMX--fC.js";import{M as ce}from"./map-pin-BZQ0wcyB.js";import{C as ge,M as Ze}from"./map-afHLg9l6.js";import{C as Je,E as Re}from"./eye-DYKha3dp.js";import{c as J}from"./createLucideIcon-DtX1aPOG.js";import{L as De,a as Z,I as B}from"./label-D6I6lMvU.js";import{L as Ye}from"./log-out-B0TqtotO.js";import{P as ye}from"./pen-vQk8amFZ.js";import{T as Pe}from"./trash-2-DQbJ9aIh.js";import{G as Ae,U as Ke,D as Xe}from"./upload-CK6mc6ZD.js";import{S as Qe}from"./search-Cfl0sis-.js";import{X as et}from"./x-BS-d4QNZ.js";import{S as tt}from"./save-rN7CZjMN.js";import{L as at}from"./index-BehiXGmn.js";import{C as st}from"./check-CWX8rMms.js";import"./utils-CN4411gJ.js";import"./clsx-B-dksMZM.js";const nt=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rt=J("arrow-left",nt);const ot=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],it=J("clock",ot);const lt=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],Ce=J("cloud-rain",lt);const dt=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]],ct=J("cloud-sun",dt);const ut=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],_e=J("eye-off",ut);const mt=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],ht=J("layers",mt);const pt=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],xt=J("sun",pt);const ft=[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m4.93 10.93 1.41 1.41",key:"2a7f42"}],["path",{d:"M2 18h2",key:"j10viu"}],["path",{d:"M20 18h2",key:"wocana"}],["path",{d:"m19.07 10.93-1.41 1.41",key:"15zs5n"}],["path",{d:"M22 22H2",key:"19qnx5"}],["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M16 18a4 4 0 0 0-8 0",key:"1lzouq"}]],gt=J("sunrise",ft);const wt=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],Le=J("thermometer",wt);const yt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],bt=J("zoom-in",yt),fe="e1f10a1e78da46f5b10a1e78da96f525";function de(t,a){return t.map(s=>s!==null&&s<=a?0:s)}const G=()=>{const t=localStorage.getItem("weather_token"),a={"Content-Type":"application/json"};return t&&(a.Authorization=`Bearer ${t}`),a},$={async getWeatherData(){const t=await fetch(`${M}/weather/data`,{headers:G()});if(!t.ok)throw new Error("Failed to fetch weather data");return t.json()},async register(t,a,s,n){const h=await fetch(`${M}/weather/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a,first_name:s,last_name:n})});if(!h.ok)throw new Error("Registration failed");return h.json()},async login(t,a){const s=await fetch(`${M}/weather/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a})});if(!s.ok)throw new Error("Login failed");return s.json()},async getMe(){const t=await fetch(`${M}/weather/me`,{headers:G()});if(!t.ok)throw new Error("Failed to get user");return t.json()},async getTiers(){const t=await fetch(`${M}/weather/tiers`,{headers:G()});if(!t.ok)throw new Error("Failed to fetch tiers");return t.json()},async upgrade(t){const a=await fetch(`${M}/weather/upgrade?level=${encodeURIComponent(t)}`,{method:"POST",headers:G()});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.detail||"Upgrade failed")}return a.json()},async addGroup(t){const a=await fetch(`${M}/weather/groups`,{method:"POST",headers:G(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to add group");return a.json()},async updateGroup(t,a){const s=await fetch(`${M}/weather/groups/${t}`,{method:"PUT",headers:G(),body:JSON.stringify(a)});if(!s.ok)throw new Error("Failed to update group");return s.json()},async deleteGroup(t){const a=await fetch(`${M}/weather/groups/${t}`,{method:"DELETE",headers:G()});if(!a.ok)throw new Error("Failed to delete group");return a.json()},async reorderGroups(t){const a=await fetch(`${M}/weather/groups/reorder`,{method:"POST",headers:G(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to reorder groups");return a.json()},async addPlace(t){const a=await fetch(`${M}/weather/places`,{method:"POST",headers:G(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to add place");return a.json()},async updatePlace(t,a){const s=await fetch(`${M}/weather/places/${t}`,{method:"PUT",headers:G(),body:JSON.stringify(a)});if(!s.ok)throw new Error("Failed to update place");return s.json()},async deletePlace(t){const a=await fetch(`${M}/weather/places/${t}`,{method:"DELETE",headers:G()});if(!a.ok)throw new Error("Failed to delete place");return a.json()},async reorderPlaces(t){const a=await fetch(`${M}/weather/places/reorder`,{method:"POST",headers:G(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to reorder places");return a.json()},async exportPlaces(){const t=await fetch(`${M}/weather/export`,{headers:G()});if(!t.ok)throw new Error("Failed to export places");return t.json()},async importPlaces(t){const a=await fetch(`${M}/weather/import`,{method:"POST",headers:G(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to import places");return a.json()},async searchPlace(t){const a=await fetch(`${M}/weather/search?link_wu=${encodeURIComponent(t)}`,{headers:G()});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.detail||"Failed to search place")}return a.json()},async fetchWUForecast(t){const a=`https://api.weather.com/v3/wx/forecast/hourly/15day?apiKey=${fe}&geocode=${t.coords[0]}%2C${t.coords[1]}&units=m&language=en-US&format=json`,n=await(await fetch(a,{referrerPolicy:"no-referrer"})).json();return{tzOffset:n.validTimeLocal[0]?.slice(19),x:n.validTimeLocal.map(h=>new Date(h.slice(0,19))),y_precipitation:n.qpf,y_humidity:n.relativeHumidity,y_snow:de(n.qpfSnow,0),y_temperature:n.temperature,y_windGust:n.windGust,y_precipChance:n.precipChance,y_uvIndex:de(n.uvIndex,0),y_cloudCover:de(n.cloudCover,0)}},async fetchWUHistory(t){const a=`https://api.weather.com/v3/wx/conditions/historical/hourly/1day?apiKey=${fe}&geocode=${t.coords[0]}%2C${t.coords[1]}&units=m&language=en-US&format=json`,n=await(await fetch(a,{referrerPolicy:"no-referrer"})).json();return{tzOffset:n.validTimeLocal[0]?.slice(19),x:n.validTimeLocal.map(h=>new Date(h.slice(0,19))),y_precipitation:[],y_humidity:n.relativeHumidity,y_snow:[],y_temperature:n.temperature,y_windGust:n.windGust,y_precipChance:[],y_uvIndex:de(n.uvIndex,0),y_cloudCover:[],sunriseTimeLocal:n.sunriseTimeLocal[0],sunsetTimeLocal:n.sunsetTimeLocal[0]}},async fetchWUPollen(t){const a=`https://api.weather.com/v2/turbo/vt1pollenforecast?apiKey=${fe}&geocode=${t.coords[0]}%2C${t.coords[1]}&language=en&format=json`,n=await(await fetch(a)).json();return{x:n.vt1pollenforecast?.reportDate.map(h=>new Date(h.slice(0,19)))||[],y_tree:n.vt1pollenforecast?.tree||[],y_weed:n.vt1pollenforecast?.weed||[],y_grass:n.vt1pollenforecast?.grass||[]}}},jt=()=>{const[t,a]=React.useState([]),[s,n]=React.useState([]),[h,c]=React.useState([]),[i,f]=React.useState(null),S=React.useMemo(()=>!i||i.role==="admin"?t:t.filter(r=>r.user_id===i.id),[t,i]),g=React.useMemo(()=>!i||i.role==="admin"?s:s.filter(r=>r.user_id===i.id),[s,i]),[w,j]=React.useState(null),[l,v]=React.useState(()=>{const r=localStorage.getItem("weather_zoom");return r==="STANDARD"?"z1x":r==="DETAILED"?"z2x":r==="MACRO"?"z3x":r==="COMPACT"?"z2x":r||"z2x"}),[y,I]=React.useState(!0),[z,d]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[p,o]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit"),[u,T]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="upgrade"),[W,b]=React.useState("idle"),D=React.useCallback(async()=>{b("loading");try{const[r,m]=await Promise.all([$.getWeatherData(),$.getTiers()]);a(r.places),n(r.groups),c(m);const ee=new URLSearchParams(window.location.search).get("location"),V=localStorage.getItem("weather_location"),re=r.places.find(oe=>oe.name===ee)||r.places.find(oe=>oe.name===V)||r.places[0];j(re),b("success")}catch(r){console.error("Failed to load weather data",r),b("error")}finally{I(!1)}},[]);React.useEffect(()=>{D(),localStorage.getItem("weather_token")&&$.getMe().then(f).catch(()=>{localStorage.removeItem("weather_token"),f(null)})},[D]),React.useEffect(()=>{i&&w&&i.role!=="admin"&&w.user_id!==i.id&&(S.length>0?j(S[0]):j(null))},[i,S,w]),React.useEffect(()=>{const r=()=>{const m=new URLSearchParams(window.location.search);d(m.get("view")==="login"),o(m.get("view")==="edit"),T(m.get("view")==="upgrade");const E=m.get("location");E&&a(ee=>{const V=ee.find(re=>re.name===E);return V&&j(V),ee})};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const P=()=>{const r=new URLSearchParams(window.location.search);r.get("view")!=="login"&&(r.set("view","login"),window.history.pushState({},"",`?${r.toString()}`),d(!0),o(!1))},H=()=>{const r=new URLSearchParams(window.location.search);r.get("view")!=="edit"&&(r.set("view","edit"),window.history.pushState({},"",`?${r.toString()}`),o(!0),d(!1),T(!1))},te=()=>{const r=new URLSearchParams(window.location.search);r.get("view")!=="upgrade"&&(r.set("view","upgrade"),window.history.pushState({},"",`?${r.toString()}`),T(!0),o(!1),d(!1))},Y=()=>{const r=new URLSearchParams(window.location.search);if(r.has("view")){r.delete("view");const m=r.toString();window.history.pushState({},"",m?`?${m}`:window.location.pathname),d(!1),o(!1),T(!1)}else d(!1),o(!1),T(!1)};return React.useEffect(()=>{i&&new URLSearchParams(window.location.search).get("view")!=="edit"&&H()},[i]),{places:S,groups:g,tiers:h,selectedPlace:w,loading:y,user:i,showLogin:z,showEdit:p,showUpgrade:u,requestState:W,zoomLevel:l,setZoomLevel:r=>{v(r),localStorage.setItem("weather_zoom",r)},handlePlaceChange:r=>{j(r),localStorage.setItem("weather_location",r.name);const m=new URLSearchParams(window.location.search);m.get("location")!==r.name&&(m.set("location",r.name),window.history.pushState({},"",`?${m.toString()}`))},login:async(r,m)=>{try{const E=await $.login(r,m);return localStorage.setItem("weather_token",E.access_token),f(E.user),await D(),!0}catch(E){return console.error("Login failed",E),!1}},register:async(r,m,E,ee)=>{try{const V=await $.register(r,m,E,ee);return localStorage.setItem("weather_token",V.access_token),f(V.user),await D(),!0}catch(V){return console.error("Registration failed",V),!1}},logout:async()=>{localStorage.removeItem("weather_token"),f(null),await D(),Y()},navigateToLogin:P,navigateToEdit:H,navigateToUpgrade:te,navigateToPublic:Y,handleAddGroup:async r=>{const m=await $.addGroup(r);a(m.places),n(m.groups)},handleUpdateGroup:async(r,m)=>{const E=await $.updateGroup(r,m);a(E.places),n(E.groups)},handleDeleteGroup:async r=>{if(!window.confirm("Are you sure you want to delete this group? Places in this group will become standalone."))return;const m=await $.deleteGroup(r);a(m.places),n(m.groups)},handleReorderGroups:async r=>{const m=await $.reorderGroups(r);a(m.places),n(m.groups)},handleAddPlace:async r=>{const m=await $.addPlace(r);a(m.places),n(m.groups)},handleUpdatePlace:async(r,m)=>{const E=await $.updatePlace(r,m);a(E.places),n(E.groups)},handleDeletePlace:async r=>{if(!window.confirm("Are you sure you want to delete this location?"))return;const m=await $.deletePlace(r);a(m.places),n(m.groups)},handleReorderPlaces:async r=>{const m=await $.reorderPlaces(r);a(m.places),n(m.groups)},handleSearchPlace:async r=>await $.searchPlace(r),handleExportPlaces:async()=>await $.exportPlaces(),handleImportPlaces:async r=>{const m=await $.importPlaces(r);a(m.places)},handleUpgrade:async r=>{try{const m=await $.upgrade(r);f(m),H()}catch(m){console.error("Upgrade failed",m),alert(m instanceof Error?m.message:"Upgrade failed")}}}},Ie=({places:t,selectedPlace:a,onSelect:s})=>{const[n,h]=React.useState(!1),[c,i]=React.useState(null),f=React.useRef(null),S=React.useRef(null),{groups:g,standalone:w}=React.useMemo(()=>{const l={},v=[];return t.forEach(y=>{y.group?(l[y.group]||(l[y.group]=[]),l[y.group].push(y)):v.push(y)}),{groups:l,standalone:v}},[t]);React.useEffect(()=>{const l=v=>{f.current&&!f.current.contains(v.target)&&h(!1)};return n&&document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[n]),React.useEffect(()=>{n?a?.group&&i(a.group):i(null)},[n,a]);const j=l=>{s(l),h(!1)};return e.jsxs("div",{className:"relative inline-block w-full md:w-64",ref:f,"data-testid":"place-dropdown",children:[e.jsxs("button",{type:"button",ref:S,onClick:()=>h(!n),className:"flex w-full items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-2 text-left font-semibold text-slate-700 shadow-sm transition-all hover:bg-slate-50 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none","aria-haspopup":"listbox","aria-expanded":n,"data-testid":"place-dropdown-trigger",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(ce,{className:"size-4 shrink-0 text-indigo-500"}),e.jsx("span",{className:"truncate",children:a?.name||"Select location..."})]}),e.jsx(ge,{className:`size-4 text-slate-400 transition-transform duration-200 ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"animate-in fade-in zoom-in absolute z-20 mt-2 max-h-80 w-full overflow-hidden rounded-xl border border-slate-200 bg-white p-1 shadow-xl duration-200",role:"listbox",children:c?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("button",{type:"button",onClick:()=>i(null),className:"flex w-full items-center gap-2 rounded-lg border-b border-slate-100 px-3 py-2 text-left text-xs font-bold text-indigo-600 transition-colors hover:bg-slate-50","data-testid":"group-back-button",children:[e.jsx(Je,{className:"size-3.5"}),e.jsx("span",{children:"Back to all"}),e.jsx("span",{className:"ml-auto font-normal text-slate-400",children:c})]}),e.jsx("ul",{className:"max-h-60 overflow-auto p-1",children:g[c].map(l=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>j(l),className:`flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-sm transition-colors ${a?.name===l.name?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":a?.name===l.name,"data-testid":`place-item-${l.name}`,children:[e.jsx(ce,{className:`size-3.5 ${a?.name===l.name?"text-indigo-500":"text-slate-400"}`}),e.jsx("span",{className:"truncate",children:l.name}),l.country&&e.jsx("span",{className:"ml-auto text-[10px] font-medium tracking-wider text-slate-400 uppercase",children:l.country})]})},l.name))})]}):e.jsxs("ul",{className:"max-h-60 overflow-auto",children:[Object.keys(g).map(l=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>i(l),className:"flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm text-slate-600 transition-colors hover:bg-slate-50","data-testid":`group-item-${l}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"size-3.5 text-indigo-400"}),e.jsx("span",{className:"font-bold",children:l})]}),e.jsx(ge,{className:"size-3.5 -rotate-90 text-slate-300"})]})},l)),w.map(l=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>j(l),className:`flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-sm transition-colors ${a?.name===l.name?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":a?.name===l.name,"data-testid":`place-item-${l.name}`,children:[e.jsx(ce,{className:`size-3.5 ${a?.name===l.name?"text-indigo-500":"text-slate-400"}`}),e.jsx("span",{className:"truncate",children:l.name}),l.country&&e.jsx("span",{className:"ml-auto text-[10px] font-medium tracking-wider text-slate-400 uppercase",children:l.country})]})},l.name))]})})]})},vt=({isAdmin:t,userEmail:a,userFirstName:s,userMembership:n,onLoginClick:h,onLogoutClick:c,onLogoClick:i,onUpgradeClick:f,showLoginButton:S,showUpgradeButton:g,places:w=[],selectedPlace:j=null,onPlaceChange:l,tiers:v=[]})=>{const y=v.findIndex(d=>d.name===n),z=(y!==-1&&y<v.length-1?v[y+1]:null)?.name;return e.jsxs("header",{className:"sticky top-0 z-10 w-full border-b bg-white shadow-sm","data-testid":"weather-navbar",children:[e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between gap-4 px-4 py-2 md:py-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:i,className:"flex items-center gap-2 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:[e.jsx("img",{src:"/favicon_weather.png",alt:"",className:"size-8","aria-hidden":"true"}),e.jsx("h1",{className:"bg-gradient-to-r from-indigo-600 to-violet-600 bg-clip-text text-2xl font-bold text-transparent",children:"Weather"})]})}),l&&e.jsx("div",{className:"hidden max-w-md flex-1 items-center gap-3 md:flex","data-testid":"place-dropdown-desktop",children:e.jsx(Ie,{places:w,selectedPlace:j,onSelect:l})}),e.jsxs("div",{className:"flex items-center gap-4",children:[S&&e.jsxs(U,{variant:"ghost",className:"gap-2 text-slate-600 hover:bg-slate-100",onClick:h,"data-testid":"login-button",children:[e.jsx(De,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Login"})]}),a&&e.jsxs("div",{className:"flex items-center gap-4",children:[g&&z&&e.jsxs(U,{variant:"outline",onClick:f,className:"rounded-2xl border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100","data-testid":"upgrade-button",children:[e.jsxs("span",{className:"hidden md:inline",children:["Upgrade to ",z]}),e.jsx("span",{className:"md:hidden",children:"Upgrade"})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500 md:inline","data-testid":"user-display-name",children:s||a}),n&&e.jsx("span",{className:"text-[10px] font-bold tracking-wider text-indigo-500 uppercase","data-testid":"user-membership",children:n})]}),e.jsx(U,{variant:"ghost",size:"icon",onClick:c,className:"text-slate-400 hover:bg-slate-100 hover:text-red-500",title:"Logout","data-testid":"logout-button",children:e.jsx(Ye,{size:20})})]})]})]}),l&&e.jsx("div",{className:"border-t px-4 py-2 md:hidden","data-testid":"place-dropdown-mobile",children:e.jsx(Ie,{places:w,selectedPlace:j,onSelect:l})})]})},Nt=({onLogin:t,onRegister:a,onCancel:s})=>{const[n,h]=React.useState(""),[c,i]=React.useState(""),[f,S]=React.useState(""),[g,w]=React.useState(""),[j,l]=React.useState(""),[v,y]=React.useState(""),[I,z]=React.useState(!1),[d,p]=React.useState(!1),[o,u]=React.useState(!1),[T,W]=React.useState(!1),b=async P=>{if(P.preventDefault(),y(""),d&&c!==f){y("Passwords do not match");return}z(!0),(d?await a(n,c,g,j):await t(n,c))||(y(d?"Registration failed":"Invalid email or password"),z(!1))},D=()=>e.jsx("span",{className:"ml-0.5 font-bold text-red-500",children:"*"});return e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4","data-testid":"login-view",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-white p-8 shadow-xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 rounded-2xl bg-indigo-50 p-3",children:e.jsx(De,{className:"size-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold","data-testid":"login-title",children:d?"Create Account":"Login"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:d?"Join us to save your locations":"Access your personalized weather"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[d&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"firstName",children:["First Name ",e.jsx(D,{})]}),e.jsx(B,{id:"firstName",value:g,onChange:P=>w(P.target.value),placeholder:"John",required:!0,className:"rounded-xl","data-testid":"login-firstname-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"lastName",children:["Last Name ",e.jsx(D,{})]}),e.jsx(B,{id:"lastName",value:j,onChange:P=>l(P.target.value),placeholder:"Doe",required:!0,className:"rounded-xl","data-testid":"login-lastname-input"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"email",children:["Email address ",e.jsx(D,{})]}),e.jsx(B,{id:"email",type:"email",autoComplete:"email",value:n,onChange:P=>h(P.target.value),placeholder:"user@example.com",required:!0,className:"rounded-xl","data-testid":"login-email-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"password",children:["Password ",e.jsx(D,{})]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"password",type:o?"text":"password",autoComplete:d?"new-password":"current-password",value:c,onChange:P=>i(P.target.value),placeholder:"••••••••",required:!0,className:"rounded-xl pr-10","data-testid":"login-password-input"}),e.jsx("button",{type:"button",onClick:()=>u(!o),className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-400 hover:text-slate-600","data-testid":"toggle-password-visibility",children:o?e.jsx(Re,{size:20}):e.jsx(_e,{size:20})})]})]}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"confirmPassword",children:["Confirm Password ",e.jsx(D,{})]}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{id:"confirmPassword",type:T?"text":"password",autoComplete:"new-password",value:f,onChange:P=>S(P.target.value),placeholder:"••••••••",required:!0,className:"rounded-xl pr-10","data-testid":"login-confirm-password-input"}),e.jsx("button",{type:"button",onClick:()=>W(!T),className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-400 hover:text-slate-600","data-testid":"toggle-confirm-password-visibility",children:T?e.jsx(Re,{size:20}):e.jsx(_e,{size:20})})]})]}),v&&e.jsx("p",{className:"text-sm font-medium text-red-500","data-testid":"login-error-message",children:v}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[e.jsx(U,{type:"submit",disabled:I,className:"h-auto w-full rounded-xl py-6 text-lg","data-testid":"login-submit-button",children:I?d?"Creating...":"Logging in...":d?"Sign Up":"Login"}),e.jsx("button",{type:"button",onClick:()=>p(!d),className:"text-sm text-indigo-600 hover:underline","data-testid":"toggle-auth-mode",children:d?"Already have an account? Login":"Don't have an account? Sign up"}),e.jsx(U,{type:"button",variant:"ghost",onClick:s,className:"w-full text-slate-500","data-testid":"login-cancel-button",children:"Cancel"})]})]})]})})},St=({groups:t,userId:a,userGroups:s,orderedGroups:n,limits:h,isAtGroupLimit:c,draggedGroupId:i,canDragGroupId:f,onAddGroup:S,onUpdateGroup:g,onDeleteGroup:w,onDragStart:j,onDragOver:l,onDragEnd:v,setCanDragGroupId:y})=>{const[I,z]=React.useState(""),[d,p]=React.useState(null),[o,u]=React.useState(""),T=async b=>{b.preventDefault(),I.trim()&&(await S(I),z(""))},W=async b=>{b.preventDefault(),!(!d||!o.trim())&&(await g(d,o),p(null),u(""))};return e.jsx("div",{className:"mt-8","data-testid":"groups-management-section",children:e.jsx("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm","data-testid":"groups-table-container",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b bg-slate-50 md:table-header-group",children:e.jsx("tr",{children:e.jsx("th",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:"Groups"}),e.jsxs("span",{className:"text-xs font-normal text-slate-500",children:[s.length," / ",h.groups]})]})})})}),e.jsxs("tbody",{className:"divide-y",children:[n.map(b=>e.jsxs("tr",{draggable:f===b.id,onDragStart:()=>b.id&&j(b.id),onDragOver:D=>b.id&&l(D,b.id),onDragEnd:v,className:`flex flex-col border-b transition-colors last:border-b-0 hover:bg-slate-50 md:table-row md:border-b-0 ${i===b.id?"bg-indigo-50/50 opacity-40":""} ${f===b.id?"select-none":""}`,"data-testid":`group-row-${b.id}`,children:[e.jsx("td",{className:"block px-6 pt-2 md:table-cell",children:d===b.id?e.jsxs("form",{onSubmit:W,className:"flex flex-1 gap-2 py-2",children:[e.jsx(B,{value:o,onChange:D=>u(D.target.value),autoFocus:!0,className:"h-9 rounded-xl"}),e.jsx(U,{type:"submit",className:"h-9",children:"Save"}),e.jsx(U,{variant:"outline",onClick:()=>p(null),className:"h-9",children:"Cancel"})]}):e.jsx("span",{className:"block font-bold",children:b.name})}),e.jsx("td",{className:"ml-auto block px-6 text-left md:table-cell md:text-right",children:e.jsxs("div",{className:"flex justify-start gap-1 md:justify-end",children:[e.jsx(U,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-indigo-600","data-testid":`edit-group-${b.id}`,onClick:()=>{p(b.id),u(b.name)},children:e.jsx(ye,{size:14})}),e.jsx(U,{variant:"ghost",size:"icon",className:"h-8 w-8 text-slate-400 hover:text-red-600","data-testid":`delete-group-${b.id}`,onClick:()=>b.id&&w(b.id),children:e.jsx(Pe,{size:14})}),e.jsx("div",{className:"cursor-grab touch-none p-2 text-slate-300 transition-colors hover:text-indigo-600 active:cursor-grabbing",title:"Hold to drag","data-testid":`group-drag-handle-${b.id}`,onMouseDown:()=>y(b.id||null),onMouseUp:()=>y(null),onTouchStart:()=>y(b.id||null),onTouchEnd:()=>y(null),onTouchCancel:()=>y(null),onClick:D=>D.stopPropagation(),children:e.jsx(Ae,{size:18})})]})})]},b.id)),!c&&e.jsx("tr",{className:"flex flex-col bg-slate-50/30 md:table-row",children:e.jsx("td",{colSpan:2,className:"block px-6 py-4 md:table-cell",children:e.jsxs("form",{onSubmit:T,className:"flex gap-2",children:[e.jsx(B,{placeholder:"New Group Name...",value:I,onChange:b=>z(b.target.value),className:"rounded-xl","data-testid":"new-group-name-input"}),e.jsxs(U,{type:"submit",disabled:!I.trim(),className:"gap-2 rounded-xl","data-testid":"submit-group-button",children:[e.jsx(we,{size:18})," Add"]})]})})})]})]})})})},kt=({isImporting:t,onImportClick:a,onExportYAML:s})=>e.jsxs("div",{className:"mb-8 flex flex-col items-start justify-between gap-4 px-4 sm:flex-row sm:items-center","data-testid":"management-header",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold","data-testid":"management-title",children:"Manage"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(U,{variant:"outline",onClick:a,className:"gap-2 rounded-xl",disabled:t,"data-testid":"import-yaml-button",children:[e.jsx(Ke,{size:18})," Import YAML"]}),e.jsxs(U,{variant:"outline",onClick:s,className:"gap-2 rounded-xl","data-testid":"export-yaml-button",children:[e.jsx(Xe,{size:18})," Export YAML"]})]})]}),Rt=({groups:t,userId:a,userRole:s,className:n="",...h})=>e.jsxs("select",{className:`flex h-10 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:ring-2 focus-visible:ring-indigo-600 focus-visible:ring-offset-2 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50 ${n}`,"data-testid":"group-select",...h,children:[e.jsx("option",{value:"",children:"---"}),t.filter(c=>c.user_id===a||s==="admin").map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),Ct=({editingPlace:t,groups:a,userId:s,userRole:n,isSearching:h,isAutoFetching:c,onSearchPlace:i,onSubmit:f,onCancel:S})=>{const[g,w]=React.useState({name:"",coords:[0,0],linkWU:"",country:"",group_id:null}),[j,l]=React.useState(""),[v,y]=React.useState(!1);React.useEffect(()=>{t?(w(t),l(`${t.coords[0]}, ${t.coords[1]}`)):(w({name:"",coords:[0,0],linkWU:"",country:"",group_id:null}),l(""))},[t]);const I=async()=>{if(g.linkWU){y(!0);try{const p=await i(g.linkWU);w(o=>({...o,name:p.city||o.name,coords:[p.lat,p.lon],country:p.countryCode||o.country})),l(`${p.lat}, ${p.lon}`)}finally{y(!1)}}},z=p=>{p.preventDefault(),f(g,j)},d=v||h||c;return e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-4 mb-8 rounded-2xl border bg-white p-6 shadow-lg duration-300","data-testid":"place-form-container",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-lg font-bold",children:[t?e.jsx(ye,{size:20,className:"text-indigo-600"}):e.jsx(we,{size:20,className:"text-indigo-600"}),t?"Edit Location":"Add New Location"]}),e.jsxs("form",{onSubmit:z,className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"name",children:["City Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"name",value:g.name,onChange:p=>w({...g,name:p.target.value}),required:!0,className:"rounded-xl","data-testid":"place-name-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"country",children:"Country Code"}),e.jsx(B,{id:"country",value:g.country||"",onChange:p=>w({...g,country:p.target.value}),placeholder:"GB, FRA, ZAF...",className:"rounded-xl","data-testid":"place-country-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"coords",children:"Coordinates (lat, lon)"}),e.jsx(B,{id:"coords",value:j,onChange:p=>l(p.target.value),placeholder:"51.507, -0.127 (Auto-fetch if empty)",className:"rounded-xl","data-testid":"place-coords-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:"linkWU",children:["WU Path (or URL) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{id:"linkWU",value:g.linkWU,onChange:p=>{let o=p.target.value;const u="https://www.wunderground.com/weather/";o.startsWith(u)&&(o=o.substring(u.length)),w({...g,linkWU:o})},placeholder:"gb/london/ILONDO440",required:!0,className:"rounded-xl","data-testid":"place-link-wu-input"}),e.jsx(U,{type:"button",variant:"outline",size:"icon",onClick:I,disabled:!g.linkWU||d,className:"shrink-0 rounded-xl",title:"Fetch details from Wunderground","data-testid":"fetch-wu-details-button",children:e.jsx(Qe,{size:18,className:v?"animate-pulse":""})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"group",children:"Group"}),e.jsx(Rt,{id:"group",value:g.group_id||"",onChange:p=>w({...g,group_id:p.target.value?parseInt(p.target.value):null}),groups:a,userId:s,userRole:n,"data-testid":"place-group-select"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 md:col-span-2",children:[e.jsxs(U,{type:"button",variant:"outline",onClick:S,disabled:d,className:"rounded-xl","data-testid":"cancel-form-button",children:[e.jsx(et,{size:18,className:"mr-2"})," Cancel"]}),e.jsx(U,{type:"submit",className:"min-w-[120px] rounded-xl",disabled:d,"data-testid":"save-place-button",children:c?e.jsx(e.Fragment,{children:"Searching..."}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:18,className:"mr-2"})," ",t?"Update":"Save"]})})]})]})]})},_t=({places:t,orderedPlaces:a,groups:s,userPlaces:n,limits:h,isAtLimit:c,draggedId:i,canDragId:f,onAddClick:S,onEdit:g,onDelete:w,onDragStart:j,onDragOver:l,onDragEnd:v,onDropOnGroup:y,setCanDragId:I})=>{const z=React.useMemo(()=>{const d={};a.forEach(o=>{const u=o.group||"---";d[u]||(d[u]=[]),d[u].push(o)});const p=[];return s.forEach(o=>{p.push([o.name,d[o.name]||[]]),delete d[o.name]}),(d["---"]||p.length===0)&&(p.push(["---",d["---"]||[]]),delete d["---"]),Object.entries(d).forEach(o=>p.push(o)),p.filter(([o,u])=>u.length>0?!0:o!=="---")},[s,a]);return e.jsx("div",{className:"rounded-2xl border bg-white shadow-sm","data-testid":"places-table-container",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"border-b bg-slate-50 md:table-header-group",children:e.jsx("tr",{children:e.jsx("th",{className:"px-6 text-xs tracking-wider text-slate-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-slate-500 uppercase",children:"Locations"}),e.jsxs("span",{className:"p-4 text-xs font-normal text-slate-500","data-testid":"location-counter",children:[n.length," / ",h.locations," locations used"]}),e.jsxs(U,{onClick:S,disabled:c,className:"flex h-8 gap-2 rounded-xl","data-testid":"add-place-button",children:[e.jsx(we,{size:16})," ",c?"Limit Reached":"Add"]})]})})})}),e.jsx("tbody",{className:"divide-y",children:z.map(([d,p])=>e.jsxs(React.Fragment,{children:[e.jsx("tr",{className:"flex flex-col bg-slate-50/50 transition-colors md:table-row",onDragOver:o=>{o.preventDefault(),o.currentTarget.classList.add("bg-indigo-100/50")},onDragLeave:o=>{o.currentTarget.classList.remove("bg-indigo-100/50")},onDrop:o=>{o.currentTarget.classList.remove("bg-indigo-100/50"),y(o,d)},"data-testid":`group-header-${d}`,children:e.jsx("td",{colSpan:2,className:"block px-6 py-2 text-[0.75rem] font-bold tracking-widest text-indigo-500 uppercase md:table-cell",children:d})}),p.map(o=>e.jsxs("tr",{draggable:f===o.id,onDragStart:()=>o.id&&j(o.id),onDragOver:u=>o.id&&l(u,o.id),onDragEnd:v,onDrop:u=>o.id&&y(u,d),className:`flex flex-col border-b transition-colors last:border-b-0 hover:bg-slate-50 md:table-row md:border-b-0 ${i===o.id?"bg-indigo-50/50 opacity-40":""} ${f===o.id?"select-none":""}`,"data-testid":`place-row-${o.id}`,children:[e.jsx("td",{className:"block px-6 pt-2 md:table-cell",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg bg-indigo-50 p-2",children:e.jsx(ce,{size:16,className:"text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:o.name}),e.jsx("div",{className:"flex gap-2 text-xs text-slate-400",children:e.jsx("span",{children:o.country||"N/A"})})]})]})}),e.jsx("td",{className:"ml-auto block px-6 text-left md:table-cell md:text-right",children:e.jsxs("div",{className:"flex justify-start gap-2 md:justify-end",children:[e.jsx("a",{href:`https://www.wunderground.com/weather/${o.linkWU}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex rounded-lg p-2 text-slate-400 transition-colors hover:bg-indigo-50 hover:text-indigo-600",title:"View on Weather Underground","data-testid":`view-wu-link-${o.id}`,children:e.jsx(ct,{size:16})}),e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${o.coords[0]},${o.coords[1]}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex rounded-lg p-2 text-slate-400 transition-colors hover:bg-indigo-50 hover:text-indigo-600",title:"View on Google Maps","data-testid":`view-map-link-${o.id}`,children:e.jsx(Ze,{size:16})}),e.jsx(U,{variant:"ghost",size:"icon",onClick:()=>g(o),className:"text-slate-400 hover:bg-indigo-50 hover:text-indigo-600",title:"Edit location","data-testid":`edit-place-${o.id}`,children:e.jsx(ye,{size:16})}),e.jsx(U,{variant:"ghost",size:"icon",onClick:()=>o.id&&w(o.id),className:"text-slate-400 hover:bg-red-50 hover:text-red-600",title:"Delete location","data-testid":`delete-place-${o.id}`,children:e.jsx(Pe,{size:16})}),e.jsx("div",{className:"cursor-grab touch-none p-2 text-slate-300 transition-colors hover:text-indigo-600 active:cursor-grabbing",title:"Hold to drag","data-testid":`drag-handle-${o.id}`,onMouseDown:()=>I(o.id||null),onMouseUp:()=>I(null),onTouchStart:()=>I(o.id||null),onTouchEnd:()=>I(null),onTouchCancel:()=>I(null),onClick:u=>u.stopPropagation(),children:e.jsx(Ae,{size:18})})]})})]},o.id))]},d))})]})})},Lt=({places:t,groups:a,userMembership:s,userRole:n,userId:h,onAddGroup:c,onUpdateGroup:i,onDeleteGroup:f,onReorderGroups:S,onAddPlace:g,onUpdatePlace:w,onDeletePlace:j,onReorderPlaces:l,onSearchPlace:v,onExportPlaces:y,onImportPlaces:I,tiers:z})=>{const{successToast:d,errorToast:p,warningToast:o}=Ve(),[u,T]=React.useState(!1),[W,b]=React.useState(!1),[D,P]=React.useState(!1),[H,te]=React.useState(null),[Y,se]=React.useState(!1),X=React.useRef(null),[q,ue]=React.useState(null),[be,me]=React.useState(null),[Q,he]=React.useState(null),[je,pe]=React.useState(null),ie=React.useMemo(()=>t.filter(x=>x.user_id===h),[t,h]),[K,xe]=React.useState(t);React.useEffect(()=>{q===null&&xe(t)},[t,q]);const ne=React.useMemo(()=>z.find(R=>R.name===s)?.limits||{locations:10,groups:1},[z,s]),ve=ie.length>=ne.locations,le=React.useMemo(()=>a.filter(x=>x.user_id===h),[a,h]),Ne=le.length>=ne.groups,[r,m]=React.useState(a);React.useEffect(()=>{Q===null&&m(a)},[a,Q]);const E=()=>{te(null),T(!1),b(!1),P(!1)},ee=x=>{te(x),T(!1)},V=async x=>{try{await c({name:x}),d("Group added successfully")}catch(R){p(`Failed to add group: ${R}`)}},re=async(x,R)=>{try{await i(x,{name:R}),d("Group updated successfully")}catch(N){p(`Failed to update group: ${N}`)}},oe=async x=>{try{await f(x),d("Group deleted successfully")}catch(R){p(`Failed to delete group: ${R}`)}},Ue=async()=>{try{const x=await y(),R=jsyaml.dump(x),N=new Blob([R],{type:"text/yaml"}),k=URL.createObjectURL(N),C=document.createElement("a");C.href=k,C.download=`weather-places-${new Date().toISOString().split("T")[0]}.yml`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(k)}catch(x){p(`Failed to export YAML: ${x}`)}},ze=async x=>{const R=x.target.files?.[0];if(!R)return;se(!0);const N=new FileReader;N.onload=async k=>{try{const C=k.target?.result,O=jsyaml.load(C);let A=O;if(Array.isArray(O))A={places:[{name:null,items:O}]};else if(!(O&&O.places&&Array.isArray(O.places)))throw new Error("Invalid YAML format");await I(A),d("Locations imported successfully.")}catch(C){p(`Failed to import YAML: ${C}`)}finally{se(!1),X.current&&(X.current.value="")}},N.readAsText(R)},$e=async(x,R)=>{let N=x.coords,k=x.name,C=x.country;const O=R.trim();if(O===""||O==="0, 0"||O==="0,0"){if(x.linkWU){P(!0);try{const F=await v(x.linkWU);N=[F.lat,F.lon],k=x.name||F.city||"",C=x.country||F.countryCode||""}catch(F){p(`Failed to fetch coordinates: ${F}`),P(!1);return}finally{P(!1)}}}else{const F=O.split(/[, ]+/);if(F.length>=2){const Se=parseFloat(F[0]),ke=parseFloat(F[1]);!isNaN(Se)&&!isNaN(ke)&&(N=[Se,ke])}}const A={...x,name:k,country:C,coords:N};if(ie.some(F=>F.name.toLowerCase()===k.toLowerCase()&&F.id!==(H?.id||null))){o(`A location with the name "${k}" already exists in your list.`);return}try{H?.id?await w(H.id,A):await g(A),E()}catch(F){p(`Failed to save location: ${F}`)}},Me=x=>{ue(x)},Oe=(x,R)=>{if(x.preventDefault(),q===null||q===R)return;const N=K.findIndex(A=>A.id===q),k=K.findIndex(A=>A.id===R);if(N===-1||k===-1)return;const C=[...K],[O]=C.splice(N,1);C.splice(k,0,O),C.map(A=>A.id).join(",")!==K.map(A=>A.id).join(",")&&xe(C)},Fe=()=>{if(q!==null){const x=t.map(N=>N.id).join(","),R=K.map(N=>N.id).join(",");if(x!==R){const N=K.map(k=>k.id).filter(k=>k!==void 0);l(N).catch(k=>console.error("Failed to reorder",k))}}ue(null),me(null)},Ge=x=>{he(x)},We=(x,R)=>{if(x.preventDefault(),Q===null||Q===R)return;const N=r.findIndex(A=>A.id===Q),k=r.findIndex(A=>A.id===R);if(N===-1||k===-1)return;const C=[...r],[O]=C.splice(N,1);C.splice(k,0,O),C.map(A=>A.id).join(",")!==r.map(A=>A.id).join(",")&&m(C)},He=()=>{if(Q!==null){const x=le.map(N=>N.id).join(","),R=r.map(N=>N.id).join(",");if(x!==R){const N=r.map(k=>k.id).filter(k=>k!==void 0);S(N).catch(k=>console.error("Failed to reorder groups",k))}}he(null),pe(null)},qe=async(x,R)=>{if(x.preventDefault(),q===null)return;const N=K.find(C=>C.id===q);if(!N)return;const k=R==="---"?null:a.find(C=>C.name===R)?.id||null;if(N.group_id!==k)try{await w(q,{...N,group_id:k}),d(`Moved ${N.name} to ${R==="---"?"Standalone":R}`)}catch(C){p(`Failed to move item: ${C}`)}};return e.jsxs("div",{className:"mx-auto max-w-4xl py-4 md:px-4","data-testid":"management-view",children:[e.jsx("input",{type:"file",accept:".yml,.yaml",className:"hidden",ref:X,onChange:ze,disabled:Y}),e.jsx(kt,{isImporting:Y,onImportClick:()=>X.current?.click(),onExportYAML:Ue}),(u||H)&&e.jsx(Ct,{editingPlace:H,groups:a,userId:h,userRole:n,isSearching:W,isAutoFetching:D,onSearchPlace:v,onSubmit:$e,onCancel:E}),e.jsx(_t,{places:t,orderedPlaces:K,groups:a,userPlaces:ie,limits:ne,isAtLimit:ve,draggedId:q,canDragId:be,onAddClick:()=>{E(),T(!0)},onEdit:ee,onDelete:j,onDragStart:Me,onDragOver:Oe,onDragEnd:Fe,onDropOnGroup:qe,setCanDragId:me}),e.jsx(St,{groups:a,userId:h,userGroups:le,orderedGroups:r,limits:ne,isAtGroupLimit:Ne,draggedGroupId:Q,canDragGroupId:je,onAddGroup:V,onUpdateGroup:re,onDeleteGroup:oe,onDragStart:Ge,onDragOver:We,onDragEnd:He,setCanDragGroupId:pe})]})},L={LINE_WIDTH_DEFAULT:2,LINE_WIDTH_FILLED_AREA:2,TENSION:.3,POINT_RADIUS:1,HIT_RADIUS:16},It={z1x:"2000px",z2x:"4000px",z3x:"6000px",z4x:"8000px"},_={Temperature:"#ef4444",Precipitation:"#3b82f6",PrecipChance:"#0ea5e9",WindGust:"#8b5cf6",UV:"#f59e0b",CloudCover:"#94a3b8",Humidity:"#10b981",Snow:"#d946ef"};function Tt(){Chart.Chart.register(Chart.CategoryScale,Chart.LinearScale,Chart.PointElement,Chart.LineElement,Chart.BarElement,Chart.Title,Chart.Tooltip,Chart.Legend,Chart.Filler)}function Ee(t){const a=new Date;if(!t||t==="Local")return a;let s=0;if(t!=="Z"){const h=t.startsWith("-")?-1:1,c=parseInt(t.slice(1,3)),i=parseInt(t.slice(3,5))||0;s=h*(c*36e5+i*6e4)}const n=a.getTime()+a.getTimezoneOffset()*6e4;return new Date(n+s)}const Dt={id:"nowLine",afterDatasetsDraw:t=>{const{ctx:a,chartArea:{top:s,bottom:n},scales:{x:h}}=t;if(!h)return;const c=t.options.plugins?.nowLine?.tzOffset,i=Ee(c),f=t.data.labels;let S=-1,g=1/0;if(f.forEach((w,j)=>{const l=new Date(w),v=Math.abs(l.getTime()-i.getTime());v<g&&(g=v,S=j)}),S!==-1&&g<24*36e5){const w=h.getPixelForValue(f[S]);a.save(),a.beginPath(),a.lineWidth=2,a.strokeStyle="#0d9488",a.moveTo(w,s),a.lineTo(w,n),a.stroke(),a.fillStyle="#0d9488",a.font="bold 13px sans-serif",a.textAlign="left";const j=i.getHours().toString().padStart(2,"0"),l=i.getMinutes().toString().padStart(2,"0"),v=`${j}:${l}`,y=a.measureText(v);a.fillStyle="rgba(13, 148, 136, 0.9)",a.fillRect(w,s+10,y.width+16,24),a.fillStyle="#ffffff",a.fillText(v,w+8,s+27),a.restore()}}},Pt=()=>({type:"category",grid:{color:t=>{const a=t.chart.data.labels[t.index];return new Date(a).getHours()===0?"#0f172a":"transparent"},lineWidth:t=>{const a=t.chart.data.labels[t.index];return new Date(a).getHours()===0?2:0},drawTicks:!0},ticks:{maxRotation:0,autoSkip:!1,padding:10,color:"#334155",font:{weight:"bold",size:14},callback:function(t){const a=this.getLabelForValue(t),s=new Date(a);return isNaN(s.getTime())?"":s.getHours()===12?s.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):""}}});Tt();const At=({place:t,zoomLevel:a})=>{const[s,n]=React.useState(null),[h,c]=React.useState(!0),i=React.useRef(null),f=React.useRef(null);if(React.useEffect(()=>{c(!0),Promise.all([$.fetchWUForecast(t),$.fetchWUHistory(t)]).then(([u,T])=>{n({forecast:u,history:T}),c(!1)})},[t]),React.useEffect(()=>{if(!h&&s&&i.current){const u=setTimeout(()=>{const T=f.current,W=i.current;if(T&&W){const b=Ee(s.forecast.tzOffset),D=T.data.labels;let P=-1,H=1/0;if(D.forEach((te,Y)=>{const se=new Date(te),X=Math.abs(se.getTime()-b.getTime());X<H&&(H=X,P=Y)}),P!==-1){const Y=T.scales.x.getPixelForValue(D[P])-W.offsetWidth/2;W.scrollTo({left:Math.max(0,Y),behavior:"smooth"})}}},500);return()=>clearTimeout(u)}},[h,s,a]),h||!s)return e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-slate-400",children:"Loading forecast data..."})});const S=1440*60*1e3,g=[...s.history.x.slice().reverse(),...s.forecast.x].map(u=>u.toISOString()),w=s.history.x.length,j=s.history.sunriseTimeLocal?new Date(s.history.sunriseTimeLocal.slice(0,19)):null,l=s.history.sunsetTimeLocal?new Date(s.history.sunsetTimeLocal.slice(0,19)):null;let v=0,y=null;if(j&&l){const u=l.getTime()-j.getTime();v=u/S*100,y=new Date(j.getTime()+u/2)}const I=s.forecast.y_temperature.slice(0,24).filter(u=>u!==null),z=I.length>0?Math.min(...I):null,d=I.length>0?Math.max(...I):null,p={labels:g,datasets:[{label:"Temperature (°C)",data:[...s.history.y_temperature.slice().reverse(),...s.forecast.y_temperature],borderColor:_.Temperature,backgroundColor:_.Temperature+"20",yAxisID:"y_temp",tension:L.TENSION,pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,borderWidth:L.LINE_WIDTH_DEFAULT},{label:"Rain Probability (%)",data:[...Array(w).fill(null),...s.forecast.y_precipChance],borderColor:_.PrecipChance,backgroundColor:_.PrecipChance+"20",yAxisID:"y_perc",tension:L.TENSION,pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,borderWidth:L.LINE_WIDTH_DEFAULT},{label:"Rain (mm/h)",data:[...Array(w).fill(null),...s.forecast.y_precipitation],borderColor:_.Precipitation,backgroundColor:_.Precipitation+"40",yAxisID:"y_rain",fill:!0,pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,borderWidth:L.LINE_WIDTH_FILLED_AREA},{label:"Wind Gust (km/h)",data:[...s.history.y_windGust.slice().reverse(),...s.forecast.y_windGust],borderColor:_.WindGust,yAxisID:"y_wind",pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,borderDash:[5,5],borderWidth:L.LINE_WIDTH_DEFAULT},{label:"Cloud Cover (%)",data:[...s.history.y_cloudCover.slice().reverse(),...s.forecast.y_cloudCover],borderColor:_.CloudCover,yAxisID:"y_cloud",pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,fill:!1,borderWidth:L.LINE_WIDTH_DEFAULT},{label:"UV Index",data:[...s.history.y_uvIndex.slice().reverse(),...s.forecast.y_uvIndex],borderColor:_.UV,yAxisID:"y_uv",pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,fill:!1,borderWidth:L.LINE_WIDTH_DEFAULT},{label:"Humidity (%)",data:[...s.history.y_humidity.slice().reverse(),...s.forecast.y_humidity],borderColor:_.Humidity,yAxisID:"y_humidity",pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,fill:!1,borderWidth:L.LINE_WIDTH_DEFAULT},{label:"Snow (cm/h)",data:[...s.history.y_snow.slice().reverse(),...s.forecast.y_snow],borderColor:_.Snow,backgroundColor:_.Snow+"30",yAxisID:"y_snow",fill:"origin",pointRadius:L.POINT_RADIUS,pointHitRadius:L.HIT_RADIUS,borderWidth:L.LINE_WIDTH_FILLED_AREA}]},o={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!0},plugins:{legend:{position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{filter:u=>{const T=u.dataset.yAxisID,W=u.raw;return T==="y_temp"?!0:["y_perc","y_rain","y_uv","y_snow"].includes(T)?W!==0&&W!==null:!1},callbacks:{title:u=>new Date(u[0].label).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1})}},nowLine:{tzOffset:s.forecast.tzOffset}},scales:{x:Pt(),y_temp:{type:"linear",display:!0,position:"left",grid:{color:"rgba(239, 68, 68, 0.15)",drawOnChartArea:!0},ticks:{color:_.Temperature,font:{size:10,weight:"bold"},stepSize:5,precision:0},title:{display:!0,text:"Temperature °C",color:_.Temperature,font:{size:12,weight:"bold"}},beginAtZero:!1,afterDataLimits:u=>{u.min=Math.floor(u.min/5)*5,u.max=Math.ceil(u.max/5)*5}},y_perc:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:_.PrecipChance,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"Rain %",color:_.PrecipChance,font:{size:12,weight:"bold"}}},y_rain:{type:"linear",display:!0,position:"left",min:0,suggestedMax:1,grid:{color:"rgba(59, 130, 246, 0.1)",drawOnChartArea:!0},ticks:{color:_.Precipitation,font:{size:10,weight:"bold"},stepSize:1},title:{display:!0,text:"Rain mm/h",color:_.Precipitation,font:{size:12,weight:"bold"}},afterDataLimits:u=>{u.max=Math.ceil(Math.max(u.max,1))}},y_snow:{type:"linear",display:!0,position:"left",min:0,suggestedMax:1,grid:{drawOnChartArea:!1},ticks:{color:_.Snow,font:{size:10,weight:"bold"},stepSize:1},title:{display:!0,text:"Snow cm/h",color:_.Snow,font:{size:12,weight:"bold"}},afterDataLimits:u=>{u.max=Math.ceil(Math.max(u.max,1))}},y_wind:{type:"linear",display:!0,position:"left",min:0,grid:{drawOnChartArea:!1},ticks:{color:_.WindGust,font:{size:10,weight:"bold"},stepSize:25},title:{display:!0,text:"Wind Gust km/h",color:_.WindGust,font:{size:12,weight:"bold"}}},y_cloud:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:_.CloudCover,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"Cloud Coverage %",color:_.CloudCover,font:{size:12,weight:"bold"}}},y_uv:{type:"linear",display:!0,position:"left",min:0,max:12,grid:{drawOnChartArea:!1},ticks:{color:_.UV,font:{size:10,weight:"bold"},stepSize:12},title:{display:!0,text:"UV",color:_.UV,font:{size:12,weight:"bold"}}},y_humidity:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:_.Humidity,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"Humidity %",color:_.Humidity,font:{size:12,weight:"bold"}}}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-4 md:grid-cols-3",children:[e.jsx(ae,{icon:e.jsx(Le,{className:"text-red-500"}),label:"TEMP / UV index",value:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-red-500",children:[s.forecast.y_temperature[0],"°C"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-amber-500",children:["UV ",s.forecast.y_uvIndex[0]]})]})}),e.jsx(ae,{icon:e.jsx(Le,{className:"text-slate-500"}),label:"Min / Max",value:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-blue-500",children:[z,"°"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-red-500",children:[d,"°"]})]})}),e.jsx(ae,{icon:e.jsx(Ce,{className:"text-sky-500"}),label:"Rain / Precip",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsxs("span",{className:"text-sky-500",children:[s.forecast.y_precipChance[0],"%"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-blue-500",children:[s.forecast.y_precipitation[0]," mm/h"]})]})}),e.jsx(ae,{icon:e.jsx(Ce,{className:"text-emerald-500"}),label:"Humidity / Cloud",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsxs("span",{className:"text-emerald-500",children:[s.forecast.y_humidity[0],"%"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-slate-400",children:[s.forecast.y_cloudCover[0],"%"]})]})}),e.jsx(ae,{icon:e.jsx(gt,{className:"text-slate-500"}),label:"Sun rise / Set",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsx("span",{className:"text-slate-900",children:j?j.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A"}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsx("span",{className:"text-slate-900",children:l?l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A"})]})}),e.jsx(ae,{icon:e.jsx(it,{className:"text-slate-500"}),label:"Noon / Daylight %",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsx("span",{className:"text-slate-900",children:y?y.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A"}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsx("span",{className:"text-slate-900",children:v>0?`${v.toFixed(1)}%`:"N/A"})]})})]}),e.jsx("div",{ref:i,className:"custom-scrollbar h-[400px] w-full overflow-x-auto",children:e.jsx("div",{className:"h-full",style:{width:It[a]},children:e.jsx(at,{ref:f,data:p,options:o,plugins:[Dt]})})})]})},ae=({icon:t,label:a,value:s})=>e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-slate-50 p-2 md:p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-[10px] font-semibold tracking-wider text-slate-500 md:text-xs",children:a}),e.jsx("div",{className:"truncate text-base font-bold md:text-lg",children:s})]})]}),Te=[{value:"z1x",label:"1x"},{value:"z2x",label:"2x"},{value:"z3x",label:"3x"},{value:"z4x",label:"4x"}],Et=({currentZoom:t,onSelect:a})=>{const[s,n]=React.useState(!1),h=React.useRef(null);React.useEffect(()=>{const i=f=>{h.current&&!h.current.contains(f.target)&&n(!1)};return s&&document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[s]);const c=Te.find(i=>i.value===t)?.label||t;return e.jsxs("div",{className:"relative inline-block",ref:h,"data-testid":"zoom-dropdown",children:[e.jsxs("button",{type:"button",onClick:()=>n(!s),className:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition-all hover:bg-slate-50 focus:outline-none",children:[e.jsx(bt,{className:"size-4 text-indigo-500"}),e.jsxs("span",{children:["Zoom: ",c]}),e.jsx(ge,{className:`size-3 text-slate-400 transition-transform duration-200 ${s?"rotate-180":""}`})]}),s&&e.jsx("ul",{className:"animate-in fade-in zoom-in absolute right-0 z-20 mt-2 w-40 overflow-hidden rounded-xl border border-slate-200 bg-white p-1 shadow-xl duration-200",children:Te.map(i=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{a(i.value),n(!1)},className:`flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm transition-colors ${t===i.value?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,children:e.jsx("span",{children:i.label})})},i.value))})]})},Ut=({selectedPlace:t,zoomLevel:a,onZoomChange:s})=>e.jsx("div",{className:"mx-auto max-w-7xl md:px-4 md:py-8","data-testid":"public-view",children:t&&e.jsxs("div",{className:"space-y-8","data-testid":"weather-details",children:[e.jsxs("div",{className:"rounded-b-2xl border bg-white py-4 shadow-sm md:rounded-2xl md:p-6","data-testid":"weather-charts-container",children:[e.jsx(At,{place:t,zoomLevel:a}),e.jsx("div",{className:"mt-8 flex justify-center","data-testid":"zoom-dropdown-container",children:e.jsx(Et,{currentZoom:a,onSelect:s})})]}),e.jsx("section",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 shadow-sm md:p-6","data-testid":"external-links-container",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-bold",children:[e.jsx(xt,{className:"size-5 text-amber-500"})," External Links"]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:`https://www.wunderground.com/forecast/${t.linkWU}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"wu-link",children:"Weather Underground Forecast"})}),e.jsx("li",{children:e.jsx("a",{href:`https://www.lightningmaps.org/?lang=en#m=oss;y=${t.coords[0]};x=${t.coords[1]};z=13`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"lightning-maps-link",children:"Lightning Maps"})})]})]})})]})}),zt=({currentMembership:t,tiers:a,onUpgrade:s,onBack:n})=>{const h=c=>{const i=a.map(g=>g.name),f=i.indexOf(t),S=i.indexOf(c);return S===f?"current":S<f&&S!==-1?"lower":"upgrade"};return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-8","data-testid":"upgrade-view",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsx(U,{variant:"ghost",size:"icon",onClick:n,title:"Back to management",children:e.jsx(rt,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"Upgrade Membership"}),e.jsx("p",{className:"text-slate-500",children:"Choose the plan that best fits your needs"})]})]}),e.jsx("div",{className:"grid gap-8 md:grid-cols-3",children:a.map(c=>{const i=h(c.name);return e.jsxs("div",{className:`relative flex flex-col rounded-2xl border bg-white p-8 shadow-sm transition-all hover:shadow-md ${i==="current"?"ring-2 ring-indigo-500":""}`,children:[i==="current"&&e.jsx("span",{className:"absolute -top-3 left-1/2 -translate-x-1/2 rounded-full bg-indigo-500 px-3 py-1 text-xs font-bold tracking-wider text-white uppercase",children:"Current Plan"}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold tracking-tight text-slate-900 uppercase",children:c.name}),e.jsxs("div",{className:"mt-4 flex items-baseline gap-1",children:[e.jsx("span",{className:"text-4xl font-extrabold text-slate-900",children:c.price}),e.jsx("span",{className:"text-slate-500",children:"/month"})]}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:c.description})]}),e.jsx("ul",{className:"mb-8 flex-1 space-y-4",children:c.features.map((f,S)=>e.jsxs("li",{className:"flex items-center justify-between gap-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(st,{size:18,className:"mt-0.5 shrink-0 text-emerald-500"}),e.jsx("span",{children:f})]}),i==="upgrade"&&e.jsx("button",{onClick:()=>s(c.name),className:"rounded bg-indigo-50 px-2 py-1 text-[10px] font-bold text-indigo-600 uppercase transition-colors hover:bg-indigo-100","data-testid":`upgrade-feature-${c.name}-${S}`,children:"Upgrade"})]},S))}),e.jsx(U,{className:"w-full",variant:i==="upgrade"?"default":"outline",disabled:i!=="upgrade",onClick:()=>s(c.name),"data-testid":`upgrade-button-${c.name}`,children:i==="current"?"Current Plan":i==="lower"?"Included":`Upgrade to ${c.name}`})]},c.name)})})]})},$t=()=>e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center","data-testid":"weather-loading-spinner",children:e.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-indigo-500"})}),Mt=()=>{const t=jt(),a=React.useMemo(()=>t.tiers.filter(n=>n.apps?.includes("weather")),[t.tiers]),s=()=>t.loading?e.jsx($t,{}):t.showLogin?e.jsx(Nt,{onLogin:t.login,onRegister:t.register,onCancel:t.navigateToPublic}):t.user&&t.showUpgrade?e.jsx(zt,{currentMembership:t.user.membership,tiers:a,onUpgrade:t.handleUpgrade,onBack:t.navigateToEdit}):t.user&&t.showEdit?e.jsx(Lt,{places:t.places,groups:t.groups,userMembership:t.user.membership,userRole:t.user.role,userId:t.user.id,onAddGroup:t.handleAddGroup,onUpdateGroup:t.handleUpdateGroup,onDeleteGroup:t.handleDeleteGroup,onReorderGroups:t.handleReorderGroups,onAddPlace:t.handleAddPlace,onUpdatePlace:t.handleUpdatePlace,onDeletePlace:t.handleDeletePlace,onReorderPlaces:t.handleReorderPlaces,onSearchPlace:t.handleSearchPlace,onExportPlaces:t.handleExportPlaces,onImportPlaces:t.handleImportPlaces,tiers:t.tiers}):e.jsx(Ut,{selectedPlace:t.selectedPlace,zoomLevel:t.zoomLevel,onZoomChange:t.setZoomLevel});return e.jsxs("div",{className:"min-h-screen bg-slate-50 pb-12 font-sans text-slate-900","data-testid":"weather-page",children:[e.jsx(vt,{isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,userMembership:t.user?.membership,onLoginClick:t.navigateToLogin,onLogoutClick:()=>t.logout(),onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,onUpgradeClick:t.navigateToUpgrade,showLoginButton:!t.user&&!t.showLogin,showUpgradeButton:t.showEdit&&a.findIndex(n=>n.name===t.user?.membership)<a.length-1,places:t.places,selectedPlace:t.selectedPlace,onPlaceChange:t.handlePlaceChange,tiers:a}),e.jsx("main",{"data-testid":"weather-main-content",children:s()})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Be,{children:e.jsx(Mt,{})})}));
