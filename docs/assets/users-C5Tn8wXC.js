import"./modulepreload-polyfill-B5Qt9EMX.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as j}from"./button-UTh2Cu_R.js";import{A as x}from"./api-CH_Pe6Vg.js";const u=s=>s.replace(/^value error,\s*/i,"").trim()||s,y=s=>{if(!s)return null;if(typeof s=="string")return u(s);if(typeof s=="object"){const a=s.detail;if(typeof a=="string")return u(a);if(Array.isArray(a)&&a.length>0){const o=a[0];if(o&&typeof o=="object"){const i=o.msg;if(typeof i=="string")return u(i);const l=o.ctx?.error;if(typeof l=="string")return u(l)}}}return null},b=()=>{const[s,a]=React.useState({email:"",password:"",confirm:""}),[o,i]=React.useState(!1),[l,n]=React.useState(null),[h,m]=React.useState(!1),p=React.useMemo(()=>{if(typeof window>"u")return null;const r=new URLSearchParams(window.location.search).get("back");return r&&r.startsWith("/")?r:null},[]),d=(t,r)=>{a(c=>({...c,[t]:r})),n(null)},g=async t=>{if(t.preventDefault(),!s.email.trim()||!s.password.trim()){n("Email and password are required.");return}if(s.password.length<8){n("Password must be at least 8 characters long.");return}if(s.password!==s.confirm){n("Passwords must match.");return}i(!0),n(null);try{const r=await fetch(`${x}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email.trim().toLowerCase(),password:s.password})});if(!r.ok){const c=await r.json().catch(()=>null),w=y(c)??"Unable to register.";throw new Error(w)}m(!0),n("Account created! You can now log in from the to-do list page."),a({email:"",password:"",confirm:""})}catch(r){const c=r instanceof Error?r.message:"Registration failed.";n(c),m(!1)}finally{i(!1)}};return e.jsx("div",{className:"users-app",children:e.jsxs("section",{className:"users-card","aria-live":"polite",children:[e.jsx("p",{className:"users-card__eyebrow",children:"Create account"}),e.jsx("h1",{children:"Register"}),e.jsx("p",{className:"users-card__subtitle",children:"Create a personal login to keep your to-do list private. You can log in from the to-do page once you finish."}),e.jsxs("form",{className:"users-form",onSubmit:g,children:[e.jsxs("label",{className:"users-form__field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",value:s.email,onChange:t=>d("email",t.target.value),placeholder:"you@example.com",required:!0,autoComplete:"email"})]}),e.jsxs("label",{className:"users-form__field",children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",value:s.password,onChange:t=>d("password",t.target.value),placeholder:"********",required:!0,autoComplete:"new-password"})]}),e.jsxs("label",{className:"users-form__field",children:[e.jsx("span",{children:"Confirm password"}),e.jsx("input",{type:"password",value:s.confirm,onChange:t=>d("confirm",t.target.value),placeholder:"********",required:!0,autoComplete:"new-password"})]}),e.jsx(j,{type:"submit",className:"users-form__submit",disabled:o,children:o?"Creating accountâ€¦":"Register"})]}),l?e.jsx("p",{className:`users-card__feedback${h?" users-card__feedback--success":""}`,children:l}):null,p?e.jsx("a",{className:"users-card__link",href:p,children:"Back"}):null]})})},f=document.getElementById("root");if(!f)throw new Error("Root element #root not found");ReactDOM.createRoot(f).render(e.jsx(React.StrictMode,{children:e.jsx(b,{})}));
