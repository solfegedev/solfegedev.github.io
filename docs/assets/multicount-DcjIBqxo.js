import"./index-CiIqH9NT.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as _,P as F,T as I}from"./Toast-BeU9NfmR.js";import{A as U}from"./api-CH_Pe6Vg.js";import{C as D}from"./check-CWX8rMms.js";import{X as B}from"./x-BS-d4QNZ.js";import{P as L}from"./pen-vQk8amFZ.js";import{T as A}from"./trash-2-DQbJ9aIh.js";import{B as w}from"./button-ChVf0VhC.js";import{c as v}from"./createLucideIcon-DtX1aPOG.js";import{U as z,S as M}from"./users-BSGUDG_u.js";import{C as P}from"./copy-CzC7y2Qs.js";import"./utils-Bp7-rn4K.js";import"./clsx-B-dksMZM.js";const q=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],J=v("calendar",q);const V=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],O=v("chart-pie",V);const G=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],$=v("coins",G);const W=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Y=v("credit-card",W);const H=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],X=v("link",H);const K=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Q=v("user-plus",K),S=`${U}/multicount`,C=async t=>{if(t.ok)return t.json();throw await t.json().catch(()=>({detail:t.statusText}))},y={get:(t,a)=>fetch(`${S}${t}`,{headers:a?{Authorization:`Bearer ${a}`}:{}}).then(C),post:(t,a,s)=>fetch(`${S}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}},body:JSON.stringify(a)}).then(C),put:(t,a,s)=>fetch(`${S}${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}},body:JSON.stringify(a)}).then(C),delete:(t,a)=>fetch(`${S}${t}`,{method:"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}).then(C)},Z=({auth:t})=>{const{errorToast:a}=_(),[s,l]=React.useState([]),[o,u]=React.useState(!0),[i,c]=React.useState(null),[p,m]=React.useState(""),[x,r]=React.useState(""),[b,g]=React.useState(""),N=async()=>{try{const d=await y.get("/currencies",t.access_token);l(d)}catch(d){console.error("Failed to fetch currencies",d)}finally{u(!1)}};React.useEffect(()=>{N()},[]);const h=async d=>{d.preventDefault();try{const j=await y.post("/currencies",{code:p,name:x,rate_to_usd:parseFloat(b)},t.access_token);l([...s,j]),R()}catch{a("Failed to add currency")}},n=async d=>{try{const j=await y.put(`/currencies/${d}`,{code:p,name:x,rate_to_usd:parseFloat(b)},t.access_token);l(s.map(T=>T.id===d?j:T)),c(null),R()}catch{a("Failed to update currency")}},f=async d=>{if(confirm("Are you sure you want to delete this currency?"))try{await y.delete(`/currencies/${d}`,t.access_token),l(s.filter(j=>j.id!==d))}catch{a("Failed to delete currency")}},k=d=>{c(d.id),m(d.code),r(d.name),g(d.rate_to_usd.toString())},R=()=>{m(""),r(""),g("")};return o?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading currencies..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Currency Management"}),e.jsxs("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"Add New Currency"}),e.jsxs("form",{onSubmit:h,className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx("input",{placeholder:"Code (e.g. USD)",value:p,onChange:d=>m(d.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("input",{placeholder:"Name (e.g. US Dollar)",value:x,onChange:d=>r(d.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("input",{placeholder:"Rate to USD (e.g. 1.0)",type:"number",step:"0.0001",value:b,onChange:d=>g(d.target.value),className:"rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0}),e.jsx("button",{className:"rounded-lg bg-cyan-600 py-2 font-bold text-white transition-all hover:bg-cyan-500",children:"Add Currency"})]})]}),e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-800 bg-slate-900/40",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-800 bg-slate-900/60",children:[e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Code"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Name"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Rate to USD"}),e.jsx("th",{className:"px-6 py-4 text-right font-bold text-slate-300",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(d=>e.jsxs("tr",{className:"border-b border-slate-800/50 transition-colors hover:bg-slate-800/20",children:[e.jsx("td",{className:"px-6 py-4",children:i===d.id?e.jsx("input",{value:p,onChange:j=>m(j.target.value),className:"w-20 rounded border border-slate-800 bg-slate-950 px-2 py-1"}):d.code}),e.jsx("td",{className:"px-6 py-4",children:i===d.id?e.jsx("input",{value:x,onChange:j=>r(j.target.value),className:"w-full rounded border border-slate-800 bg-slate-950 px-2 py-1"}):d.name}),e.jsx("td",{className:"px-6 py-4",children:i===d.id?e.jsx("input",{type:"number",step:"0.0001",value:b,onChange:j=>g(j.target.value),className:"w-24 rounded border border-slate-800 bg-slate-950 px-2 py-1"}):d.rate_to_usd}),e.jsx("td",{className:"px-6 py-4 text-right",children:i===d.id?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>n(d.id),className:"p-1 text-emerald-400 hover:text-emerald-300",children:e.jsx(D,{size:18})}),e.jsx("button",{onClick:()=>c(null),className:"p-1 text-slate-400 hover:text-white",children:e.jsx(B,{size:18})})]}):e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>k(d),className:"p-1 text-cyan-400 hover:text-cyan-300",children:e.jsx(L,{size:18})}),e.jsx("button",{onClick:()=>f(d.id),className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(A,{size:18})})]})})]},d.id))})]})})]})},ee=({onLogin:t,onSwitchToRegister:a})=>{const[s,l]=React.useState(""),[o,u]=React.useState(""),[i,c]=React.useState(""),[p,m]=React.useState(!1),x=async r=>{r.preventDefault(),c(""),m(!0);try{const b=await y.post("/auth/login",{email:s,password:o});t(b)}catch{c("Invalid email or password")}finally{m(!1)}};return e.jsxs("div",{className:"mx-auto mt-12 max-w-md rounded-2xl border border-slate-800 bg-slate-900/40 p-8 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-6 text-center text-3xl font-bold",children:"Welcome Back"}),i&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-800 bg-red-900/30 p-3 text-sm text-red-200",children:i}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-email",className:"mb-1 block text-sm font-medium text-slate-400",children:"Email"}),e.jsx("input",{id:"login-email",type:"email",autoComplete:"email",value:s,onChange:r=>l(r.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-password","disable-role-check":"true",className:"mb-1 block text-sm font-medium text-slate-400",children:"Password"}),e.jsx("input",{id:"login-password",type:"password",autoComplete:"current-password",value:o,onChange:r=>u(r.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsx(w,{disabled:p,"data-testid":"login-submit",className:"mt-4 w-full",children:p?"Logging in...":"Login"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-400",children:["Don't have an account?"," ",e.jsx("button",{onClick:a,"data-testid":"switch-to-register",className:"text-cyan-400 hover:underline",children:"Sign up"})]})]})},te=({onRegister:t,onSwitchToLogin:a})=>{const[s,l]=React.useState(""),[o,u]=React.useState(""),[i,c]=React.useState(""),[p,m]=React.useState(""),[x,r]=React.useState(!1),b=async g=>{g.preventDefault(),m(""),r(!0);try{await y.post("/auth/register",{email:s,password:o,name:i}),t()}catch{m("Registration failed. Email might already be taken.")}finally{r(!1)}};return e.jsxs("div",{className:"mx-auto mt-12 max-w-md rounded-2xl border border-slate-800 bg-slate-900/40 p-8 backdrop-blur-sm",children:[e.jsx("h2",{className:"mb-6 text-center text-3xl font-bold",children:"Create Account"}),p&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-800 bg-red-900/30 p-3 text-sm text-red-200",children:p}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-name",className:"mb-1 block text-sm font-medium text-slate-400",children:"Full Name"}),e.jsx("input",{id:"reg-name",type:"text",value:i,onChange:g=>c(g.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-email",className:"mb-1 block text-sm font-medium text-slate-400",children:"Email"}),e.jsx("input",{id:"reg-email",type:"email",autoComplete:"email",value:s,onChange:g=>l(g.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-password","disable-role-check":"true",className:"mb-1 block text-sm font-medium text-slate-400",children:"Password"}),e.jsx("input",{id:"reg-password",type:"password",autoComplete:"new-password",value:o,onChange:g=>u(g.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsx(w,{disabled:x,"data-testid":"register-submit",className:"mt-4 w-full",children:x?"Creating account...":"Sign Up"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-400",children:["Already have an account?"," ",e.jsx("button",{onClick:a,"data-testid":"switch-to-login",className:"text-cyan-400 hover:underline",children:"Login"})]})]})},se=({auth:t,onSelectTrip:a})=>{const[s,l]=React.useState([]),[o,u]=React.useState([]),[i,c]=React.useState(!0),[p,m]=React.useState(!1),[x,r]=React.useState(""),[b,g]=React.useState("USD"),N=async()=>{try{const[n,f]=await Promise.all([y.get("/trips",t.access_token),y.get("/currencies",t.access_token)]);l(n),u(f)}catch(n){console.error("Failed to fetch data",n)}finally{c(!1)}};React.useEffect(()=>{N()},[]);const h=async n=>{if(n.preventDefault(),!!x.trim())try{const f=await y.post("/trips",{name:x,default_currency:b},t.access_token);l([f,...s]),r(""),m(!1)}catch(f){console.error("Failed to create trip",f)}};return i?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading your trips..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Your Trips"}),e.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 rounded-lg bg-cyan-600 px-4 py-2 font-medium text-white transition-all hover:bg-cyan-500",children:[e.jsx(F,{size:18}),"New Trip"]})]}),p&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-4 rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:e.jsxs("form",{onSubmit:h,className:"flex flex-col gap-4 md:flex-row",children:[e.jsx("input",{type:"text",placeholder:"Trip Name (e.g. Summer in Spain)",value:x,onChange:n=>r(n.target.value),className:"flex-1 rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 transition-all outline-none focus:ring-2 focus:ring-cyan-500",autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-slate-800 bg-slate-950 px-3",children:[e.jsx($,{size:16,className:"text-slate-500"}),e.jsx("select",{value:b,onChange:n=>g(n.target.value),"data-testid":"trip-currency-select",className:"cursor-pointer border-none bg-transparent py-2 pr-2 text-slate-200 outline-none",children:o.map(n=>e.jsxs("option",{value:n.code,className:"bg-slate-900",children:[n.code," - ",n.name]},n.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit","data-testid":"create-trip-submit",className:"flex-1 rounded-lg bg-cyan-600 px-6 py-2 font-medium text-white transition-all hover:bg-cyan-500 md:flex-none",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-2 text-slate-400 hover:text-white",children:"Cancel"})]})]})}),s.length===0?e.jsxs("div",{className:"rounded-2xl border border-dashed border-slate-800 bg-slate-900/20 py-20 text-center",children:[e.jsx(z,{size:48,className:"mx-auto mb-4 text-slate-700"}),e.jsx("p",{className:"text-lg text-slate-400",children:"No trips yet. Create one to get started!"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:s.map(n=>e.jsxs("div",{onClick:()=>a(n.id),"data-testid":`trip-card-${n.id}`,className:"group cursor-pointer rounded-2xl border border-slate-800 bg-slate-900/40 p-6 transition-all hover:border-cyan-500/50 hover:shadow-xl hover:shadow-cyan-900/10",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold transition-colors group-hover:text-cyan-400",children:n.name}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{size:14}),new Date(n.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1 font-medium text-cyan-500/70",children:[e.jsx($,{size:14}),n.default_currency]})]})]},n.id))})]})},ae=({auth:t,tripId:a})=>{const[s,l]=React.useState(null),[o,u]=React.useState("expenses"),[i,c]=React.useState(!0),p=async()=>{try{const m=await y.get(`/trips/${a}`,t.access_token);l(m)}catch(m){console.error("Failed to fetch trip",m)}finally{c(!1)}};return React.useEffect(()=>{p()},[a]),i?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Loading trip details..."}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-bold",children:s.name}),e.jsxs("p",{className:"mt-1 text-slate-400","data-testid":"trip-member-count",children:[s.members.length," members"]})]}),e.jsxs("div",{className:"flex self-start rounded-xl border border-slate-800 bg-slate-900/60 p-1",children:[e.jsxs("button",{onClick:()=>u("expenses"),"data-testid":"tab-expenses",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${o==="expenses"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(Y,{size:16}),"Expenses"]}),e.jsxs("button",{onClick:()=>u("balances"),"data-testid":"tab-balances",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${o==="balances"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(O,{size:16}),"Balances"]}),e.jsxs("button",{onClick:()=>u("settings"),"data-testid":"tab-settings",className:`flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all ${o==="settings"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(M,{size:16}),"Settings"]})]})]}),e.jsxs("div",{className:"mt-8",children:[o==="expenses"&&e.jsx(ne,{auth:t,trip:s}),o==="balances"&&e.jsx(re,{auth:t,trip:s}),o==="settings"&&e.jsx(le,{auth:t,trip:s})]})]}):e.jsx("div",{className:"py-12 text-center text-red-400",children:"Trip not found."})},ne=({auth:t,trip:a})=>{const{successToast:s,errorToast:l}=_(),[o,u]=React.useState([]),[i,c]=React.useState([]),[p,m]=React.useState(!1),[x,r]=React.useState(null),b=async()=>{try{const[n,f]=await Promise.all([y.get(`/trips/${a.id}/expenses`,t.access_token),y.get("/currencies",t.access_token)]);u(n),c(f)}catch(n){console.error("Failed to fetch expenses",n)}};React.useEffect(()=>{b()},[a.id,t.access_token]);const g=async n=>{try{const f=await y.post(`/trips/${a.id}/expenses`,n,t.access_token);u([f,...o]),m(!1)}catch{l("Failed to add expense")}},N=async n=>{if(x)try{const f=await y.put(`/expenses/${x.id}`,n,t.access_token);u(o.map(k=>k.id===f.id?f:k)),r(null)}catch{l("Failed to update expense")}},h=async n=>{if(confirm("Delete this expense?"))try{await y.delete(`/expenses/${n}`,t.access_token),u(o.filter(f=>f.id!==n))}catch{l("Failed to delete expense")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Trip Expenses"}),e.jsxs("button",{onClick:()=>{m(!p),r(null)},className:"flex items-center gap-2 rounded-lg bg-cyan-600 px-4 py-2 font-medium text-white transition-all hover:bg-cyan-500",children:[e.jsx(F,{size:18}),"Add Expense"]})]}),p&&e.jsx("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:e.jsx(E,{trip:a,currencies:i,onSubmit:g,onCancel:()=>m(!1),initialData:{currency:a.default_currency,beneficiary_ids:a.members.map(n=>n.user.id)}})}),x&&e.jsxs("div",{className:"rounded-xl border border-cyan-500/30 bg-cyan-900/10 p-6",children:[e.jsx("h4",{className:"mb-4 text-sm font-bold tracking-wider text-cyan-400 uppercase",children:"Editing Expense"}),e.jsx(E,{trip:a,currencies:i,onSubmit:N,onCancel:()=>r(null),initialData:{amount:x.amount.toString(),currency:x.currency,description:x.description,beneficiary_ids:x.beneficiaries.map(n=>n.id)}})]}),e.jsx("div",{className:"space-y-4",children:o.map(n=>e.jsxs("div",{"data-testid":"expense-item",className:"group flex items-center justify-between rounded-xl border border-slate-800 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-slate-800 font-bold text-slate-300",children:n.payer.name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:n.description}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Paid by ",n.payer.name," • ",new Date(n.date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-6",children:[e.jsxs("div",{className:"text-lg font-bold text-cyan-400",children:[n.amount.toFixed(2)," ",n.currency]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>{r(n),m(!1),window.scrollTo({top:0,behavior:"smooth"})},className:"p-2 text-slate-400 transition-colors hover:text-cyan-400",title:"Edit",children:e.jsx(L,{size:18})}),e.jsx("button",{onClick:()=>h(n.id),className:"p-2 text-slate-400 transition-colors hover:text-red-400",title:"Delete",children:e.jsx(A,{size:18})})]})]})]},n.id))})]})},E=({trip:t,currencies:a,onSubmit:s,onCancel:l,initialData:o})=>{const[u,i]=React.useState(o?.amount||""),[c,p]=React.useState(o?.currency||t.default_currency),[m,x]=React.useState(o?.description||""),[r,b]=React.useState(o?.beneficiary_ids||t.members.map(h=>h.user.id)),g=h=>{h.preventDefault(),s({amount:parseFloat(u),currency:c,description:m,beneficiary_ids:r})},N=h=>{b(n=>n.includes(h)?n.filter(f=>f!==h):[...n,h])};return e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:u,onChange:h=>i(h.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Currency"}),e.jsx("select",{value:c,onChange:h=>p(h.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",children:a.map(h=>e.jsxs("option",{value:h.code,children:[h.code," - ",h.name]},h.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-400",children:"Description"}),e.jsx("input",{type:"text",placeholder:"What was it for?",value:m,onChange:h=>x(h.target.value),className:"w-full rounded-lg border border-slate-800 bg-slate-950 px-4 py-2 outline-none focus:ring-2 focus:ring-cyan-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-slate-400",children:"Split between:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.members.map(h=>e.jsx("button",{type:"button",onClick:()=>N(h.user.id),className:`rounded-full border px-3 py-1.5 text-sm font-medium transition-all ${r.includes(h.user.id)?"border-cyan-500 bg-cyan-500/20 text-cyan-300":"border-slate-800 bg-slate-950 text-slate-500"}`,children:h.user.name},h.user.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 text-slate-400 hover:text-white",children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-cyan-600 px-8 py-2 font-bold text-white hover:bg-cyan-500",children:"Save Expense"})]})]})},re=({auth:t,trip:a})=>{const[s,l]=React.useState([]),[o,u]=React.useState(!0);return React.useEffect(()=>{(async()=>{try{const c=await y.get(`/trips/${a.id}/balances`,t.access_token);l(c)}catch(c){console.error("Failed to fetch balances",c)}finally{u(!1)}})()},[a.id,t.access_token]),o?e.jsx("div",{className:"py-12 text-center text-slate-400",children:"Calculating balances..."}):e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:s.map(i=>e.jsxs("div",{"data-testid":"balance-card",className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-cyan-500/20 font-bold text-cyan-400",children:i.user.name[0]}),e.jsx("h4",{className:"text-xl font-bold",children:i.user.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${i.estimated_total_default_currency>=0?"text-emerald-400":"text-red-400"}`,children:[i.estimated_total_default_currency>=0?"+":"",i.estimated_total_default_currency.toFixed(2)," ",i.default_currency,"*"]}),i.default_currency!=="USD"&&e.jsxs("div",{className:"text-xs text-slate-500",children:["≈ ",i.estimated_total_usd>=0?"+":"",i.estimated_total_usd.toFixed(2)," USD"]})]})]}),e.jsx("div",{className:"space-y-3",children:i.balances.map(c=>e.jsxs("div",{className:"flex justify-between rounded-lg border border-slate-800/50 bg-slate-950 p-3",children:[e.jsx("span",{className:"font-bold text-slate-300",children:c.currency}),e.jsxs("span",{className:`font-bold ${c.balance>=0?"text-emerald-500":"text-red-500"}`,children:[c.balance>=0?"+":"",c.balance.toFixed(2)]})]},c.currency))})]},i.user.id))})},le=({auth:t,trip:a})=>{const{infoToast:s,errorToast:l}=_(),[o,u]=React.useState([]),[i,c]=React.useState(!1);React.useEffect(()=>{(async()=>{try{const b=await y.get(`/trips/${a.id}/invitations`,t.access_token);u(b)}catch(b){console.error("Failed to fetch invitations",b)}})()},[a.id,t.access_token]);const p=async()=>{try{const r=await y.post(`/trips/${a.id}/invitations`,{},t.access_token);u([r,...o])}catch{l("Failed to create invitation")}},m=r=>{const b=`${window.location.origin}${window.location.pathname}?join=${r}`;navigator.clipboard.writeText(b),s("Copied!"),c(!0),setTimeout(()=>c(!1),2e3)},x=o.find(r=>!r.is_expired);return e.jsxs("div",{className:"max-w-2xl space-y-8",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-xl font-bold",children:[e.jsx(Q,{size:20,className:"text-cyan-400"}),"Invite Members"]}),e.jsx("p",{className:"mb-6 text-sm text-slate-400",children:"Share this secret link with friends to let them join the trip."}),x?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 truncate rounded-lg border border-slate-800 bg-slate-950 px-4 py-3 text-sm text-slate-300",children:[window.location.origin,window.location.pathname,"?join=",x.uuid]}),e.jsxs("button",{onClick:()=>m(x.uuid),className:"flex items-center gap-2 rounded-lg bg-slate-800 px-4 py-2 whitespace-nowrap text-white transition-all hover:bg-slate-700",children:[i?e.jsx(D,{size:18,className:"text-emerald-400"}):e.jsx(P,{size:18}),i?"Copied!":"Copy Link"]})]}):e.jsxs("button",{onClick:p,"data-testid":"generate-invite-button",className:"flex w-full items-center justify-center gap-2 rounded-xl bg-cyan-600 py-3 font-bold text-white hover:bg-cyan-500",children:[e.jsx(X,{size:18})," Generate Invitation Link"]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/40 p-6",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"Trip Members"}),e.jsx("div",{className:"space-y-3",children:a.members.map(r=>e.jsx("div",{className:"flex items-center justify-between rounded-lg border border-slate-800/30 bg-slate-950/50 p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-slate-800 text-xs font-bold",children:r.user.name[0]}),e.jsx("div",{className:"text-sm font-bold",children:r.user.name})]})},r.user.id))})]})]})},ie=()=>{const{errorToast:t}=_(),[a,s]=React.useState("landing"),[l,o]=React.useState(null),[u,i]=React.useState(null),[c,p]=React.useState(null);React.useEffect(()=>{const r=localStorage.getItem("multicount_auth");if(r)try{o(JSON.parse(r)),s("dashboard")}catch{localStorage.removeItem("multicount_auth")}const g=new URLSearchParams(window.location.search).get("join");g&&(p(g),window.history.replaceState({},"",window.location.pathname))},[]),React.useEffect(()=>{c&&l?s("join_confirmation"):c&&!l&&s("login")},[c,l]);const m=async r=>{try{const b=await y.post(`/trips/join/${r}`,{},l?.access_token);p(null),i(b.id),s("trip")}catch(b){console.error("Failed to join trip",b),p(null),t("Failed to join trip. The invitation might be expired or invalid.")}},x=()=>{o(null),localStorage.removeItem("multicount_auth"),s("landing")};return e.jsxs("div",{className:"min-h-screen font-sans text-slate-100",children:[e.jsx("header",{className:"sticky top-0 z-10 border-b border-slate-800/50 bg-slate-900/50 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto flex h-16 max-w-6xl items-center justify-between px-4",children:[e.jsxs("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>s(l?"dashboard":"landing"),children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-cyan-500 font-bold text-slate-900",children:"M"}),e.jsx("span",{className:"text-xl font-bold tracking-tight",children:"MultiCount"})]}),e.jsx("nav",{className:"flex items-center gap-4",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden text-sm text-slate-400 md:inline",children:l.user.name}),l.user.role==="admin"&&e.jsx("button",{onClick:()=>s("admin"),className:`text-sm font-medium transition-colors ${a==="admin"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Admin"}),e.jsx("button",{onClick:()=>s("dashboard"),className:`text-sm font-medium transition-colors ${a==="dashboard"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Trips"}),e.jsx("button",{onClick:x,className:"text-sm font-medium text-slate-300 transition-colors hover:text-white",children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("login"),className:"text-sm font-medium text-slate-300 transition-colors hover:text-white",children:"Login"}),e.jsx(w,{onClick:()=>s("register"),"data-testid":"signup-button",children:"Sign Up"})]})})]})}),e.jsxs("main",{className:"mx-auto max-w-6xl px-4 py-8",children:[a==="landing"&&e.jsx(oe,{onGetStarted:()=>s("register")}),a==="login"&&e.jsx(ee,{onLogin:r=>{o(r),s("dashboard"),localStorage.setItem("multicount_auth",JSON.stringify(r))},onSwitchToRegister:()=>s("register")}),a==="register"&&e.jsx(te,{onRegister:()=>s("login"),onSwitchToLogin:()=>s("login")}),a==="dashboard"&&l&&e.jsx(se,{auth:l,onSelectTrip:r=>{i(r),s("trip")}}),a==="trip"&&l&&u&&e.jsx(ae,{auth:l,tripId:u}),a==="admin"&&l&&l.user.role==="admin"&&e.jsx(Z,{auth:l}),a==="join_confirmation"&&c&&e.jsx(ce,{uuid:c,onConfirm:()=>m(c),onCancel:()=>{p(null),s("dashboard")}})]})]})},ce=({uuid:t,onConfirm:a,onCancel:s})=>{const[l,o]=React.useState(null),[u,i]=React.useState(!0),[c,p]=React.useState(null);return React.useEffect(()=>{(async()=>{try{const x=await y.get(`/trips/invitation/${t}`);o(x)}catch{p("Invalid or expired invitation link.")}finally{i(!1)}})()},[t]),u?e.jsx("div",{className:"py-20 text-center",children:"Loading trip information..."}):c||!l?e.jsx("div",{className:"mx-auto max-w-md py-20 text-center",children:e.jsxs("div",{className:"rounded-xl border border-red-500/50 bg-red-900/20 p-6",children:[e.jsx("h2",{className:"mb-2 text-xl font-bold text-red-400",children:"Error"}),e.jsx("p",{className:"mb-6 text-slate-300",children:c||"Trip not found"}),e.jsx("button",{onClick:s,className:"rounded-lg bg-slate-800 px-4 py-2 transition-colors hover:bg-slate-700",children:"Back to Dashboard"})]})}):e.jsx("div",{className:"mx-auto max-w-md py-20",children:e.jsxs("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/80 p-8 text-center shadow-xl",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-cyan-500/10 text-cyan-500",children:e.jsx(z,{className:"h-8 w-8"})}),e.jsx("h2",{className:"mb-2 text-2xl font-bold",children:"Join Trip?"}),e.jsxs("p",{className:"mb-8 text-slate-400",children:["You've been invited to join ",e.jsxs("span",{className:"font-semibold text-white",children:['"',l.name,'"']}),". Once you join, you'll be able to see and add expenses."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(w,{onClick:a,className:"w-full py-6 text-base",children:"Accept and Join"}),e.jsx("button",{onClick:s,className:"w-full rounded-xl bg-slate-800 py-3 font-medium text-slate-300 transition-all hover:bg-slate-700",children:"Not Now"})]})]})})},oe=({onGetStarted:t})=>e.jsxs("div",{className:"py-20 text-center",children:[e.jsxs("h1",{className:"mb-6 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-5xl font-extrabold text-transparent md:text-7xl",children:["Split Expenses, ",e.jsx("br",{}),"Not Friendships."]}),e.jsx("p",{className:"mx-auto mb-10 max-w-2xl text-xl text-slate-400",children:"The simple way to track shared expenses on trips. Multi-currency support, automated balances, and secret join links."}),e.jsx(w,{onClick:t,className:"px-8 py-6 text-lg",children:"Get Started for Free"})]});document.body.classList.add("menuall-page");ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(I,{children:e.jsx(ie,{})})}));
