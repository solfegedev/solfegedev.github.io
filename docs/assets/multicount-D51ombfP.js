import"./index-CvrIQurp.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as L}from"./api-CH_Pe6Vg.js";import{c as v,C as $,a as M}from"./copy-CeF1Ng62.js";const D=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],z=v("calendar",D);const A=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],I=v("chart-pie",A);const U=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],_=v("coins",U);const B=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],P=v("credit-card",B);const q=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],V=v("link",q);const J=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],E=v("pen",J);const O=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],T=v("plus",O);const H=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],G=v("settings",H);const W=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],F=v("trash-2",W);const Y=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],X=v("user-plus",Y);const K=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Q=v("users",K);const Z=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ee=v("x",Z),w=`${L}/multicount`,k=async t=>{if(t.ok)return t.json();throw await t.json().catch(()=>({detail:t.statusText}))},g={get:(t,s)=>fetch(`${w}${t}`,{headers:s?{Authorization:`Bearer ${s}`}:{}}).then(k),post:(t,s,a)=>fetch(`${w}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(s)}).then(k),put:(t,s,a)=>fetch(`${w}${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(s)}).then(k),delete:(t,s)=>fetch(`${w}${t}`,{method:"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}).then(k)},te=({auth:t})=>{const[s,a]=React.useState([]),[h,o]=React.useState(!0),[p,n]=React.useState(null),[r,x]=React.useState(""),[l,c]=React.useState(""),[b,y]=React.useState(""),f=async()=>{try{const d=await g.get("/currencies",t.access_token);a(d)}catch(d){console.error("Failed to fetch currencies",d)}finally{o(!1)}};React.useEffect(()=>{f()},[]);const u=async d=>{d.preventDefault();try{const j=await g.post("/currencies",{code:r,name:l,rate_to_usd:parseFloat(b)},t.access_token);a([...s,j]),S()}catch{alert("Failed to add currency")}},i=async d=>{try{const j=await g.put(`/currencies/${d}`,{code:r,name:l,rate_to_usd:parseFloat(b)},t.access_token);a(s.map(C=>C.id===d?j:C)),n(null),S()}catch{alert("Failed to update currency")}},m=async d=>{if(confirm("Are you sure you want to delete this currency?"))try{await g.delete(`/currencies/${d}`,t.access_token),a(s.filter(j=>j.id!==d))}catch{alert("Failed to delete currency")}},N=d=>{n(d.id),x(d.code),c(d.name),y(d.rate_to_usd.toString())},S=()=>{x(""),c(""),y("")};return h?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading currencies..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Currency Management"}),e.jsxs("div",{className:"bg-slate-900/40 border border-slate-800 rounded-xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Currency"}),e.jsxs("form",{onSubmit:u,className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("input",{placeholder:"Code (e.g. USD)",value:r,onChange:d=>x(d.target.value),className:"bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none",required:!0}),e.jsx("input",{placeholder:"Name (e.g. US Dollar)",value:l,onChange:d=>c(d.target.value),className:"bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none",required:!0}),e.jsx("input",{placeholder:"Rate to USD (e.g. 1.0)",type:"number",step:"0.0001",value:b,onChange:d=>y(d.target.value),className:"bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none",required:!0}),e.jsx("button",{className:"bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 rounded-lg transition-all",children:"Add Currency"})]})]}),e.jsx("div",{className:"bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-800 bg-slate-900/60",children:[e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Code"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Name"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300",children:"Rate to USD"}),e.jsx("th",{className:"px-6 py-4 font-bold text-slate-300 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(d=>e.jsxs("tr",{className:"border-b border-slate-800/50 hover:bg-slate-800/20 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:p===d.id?e.jsx("input",{value:r,onChange:j=>x(j.target.value),className:"bg-slate-950 border border-slate-800 rounded px-2 py-1 w-20"}):d.code}),e.jsx("td",{className:"px-6 py-4",children:p===d.id?e.jsx("input",{value:l,onChange:j=>c(j.target.value),className:"bg-slate-950 border border-slate-800 rounded px-2 py-1 w-full"}):d.name}),e.jsx("td",{className:"px-6 py-4",children:p===d.id?e.jsx("input",{type:"number",step:"0.0001",value:b,onChange:j=>y(j.target.value),className:"bg-slate-950 border border-slate-800 rounded px-2 py-1 w-24"}):d.rate_to_usd}),e.jsx("td",{className:"px-6 py-4 text-right",children:p===d.id?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(d.id),className:"text-emerald-400 hover:text-emerald-300 p-1",children:e.jsx($,{size:18})}),e.jsx("button",{onClick:()=>n(null),className:"text-slate-400 hover:text-white p-1",children:e.jsx(ee,{size:18})})]}):e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>N(d),className:"text-cyan-400 hover:text-cyan-300 p-1",children:e.jsx(E,{size:18})}),e.jsx("button",{onClick:()=>m(d.id),className:"text-red-400 hover:text-red-300 p-1",children:e.jsx(F,{size:18})})]})})]},d.id))})]})})]})},se=({onLogin:t,onSwitchToRegister:s})=>{const[a,h]=React.useState(""),[o,p]=React.useState(""),[n,r]=React.useState(""),[x,l]=React.useState(!1),c=async b=>{b.preventDefault(),r(""),l(!0);try{const y=await g.post("/auth/login",{email:a,password:o});t(y)}catch{r("Invalid email or password")}finally{l(!1)}};return e.jsxs("div",{className:"max-w-md mx-auto mt-12 p-8 bg-slate-900/40 border border-slate-800 rounded-2xl backdrop-blur-sm",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"Welcome Back"}),n&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-800 text-red-200 rounded-lg text-sm",children:n}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-email",className:"block text-sm font-medium text-slate-400 mb-1",children:"Email"}),e.jsx("input",{id:"login-email",type:"email",value:a,onChange:b=>h(b.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-password","disable-role-check":"true",className:"block text-sm font-medium text-slate-400 mb-1",children:"Password"}),e.jsx("input",{id:"login-password",type:"password",value:o,onChange:b=>p(b.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none transition-all",required:!0})]}),e.jsx("button",{disabled:x,"data-testid":"login-submit",className:"w-full bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 text-white font-bold py-3 rounded-lg transition-all mt-4",children:x?"Logging in...":"Login"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-400",children:["Don't have an account? ",e.jsx("button",{onClick:s,"data-testid":"switch-to-register",className:"text-cyan-400 hover:underline",children:"Sign up"})]})]})},ae=({onRegister:t,onSwitchToLogin:s})=>{const[a,h]=React.useState(""),[o,p]=React.useState(""),[n,r]=React.useState(""),[x,l]=React.useState(""),[c,b]=React.useState(!1),y=async f=>{f.preventDefault(),l(""),b(!0);try{await g.post("/auth/register",{email:a,password:o,name:n}),t()}catch{l("Registration failed. Email might already be taken.")}finally{b(!1)}};return e.jsxs("div",{className:"max-w-md mx-auto mt-12 p-8 bg-slate-900/40 border border-slate-800 rounded-2xl backdrop-blur-sm",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"Create Account"}),x&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-800 text-red-200 rounded-lg text-sm",children:x}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-name",className:"block text-sm font-medium text-slate-400 mb-1",children:"Full Name"}),e.jsx("input",{id:"reg-name",type:"text",value:n,onChange:f=>r(f.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-email",className:"block text-sm font-medium text-slate-400 mb-1",children:"Email"}),e.jsx("input",{id:"reg-email",type:"email",value:a,onChange:f=>h(f.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none transition-all",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reg-password","disable-role-check":"true",className:"block text-sm font-medium text-slate-400 mb-1",children:"Password"}),e.jsx("input",{id:"reg-password",type:"password",value:o,onChange:f=>p(f.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none transition-all",required:!0})]}),e.jsx("button",{disabled:c,"data-testid":"register-submit",className:"w-full bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 text-white font-bold py-3 rounded-lg transition-all mt-4",children:c?"Creating account...":"Sign Up"})]}),e.jsxs("p",{className:"mt-6 text-center text-sm text-slate-400",children:["Already have an account? ",e.jsx("button",{onClick:s,"data-testid":"switch-to-login",className:"text-cyan-400 hover:underline",children:"Login"})]})]})},ne=({auth:t,onSelectTrip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState([]),[n,r]=React.useState(!0),[x,l]=React.useState(!1),[c,b]=React.useState(""),[y,f]=React.useState("USD"),u=async()=>{try{const[m,N]=await Promise.all([g.get("/trips",t.access_token),g.get("/currencies",t.access_token)]);h(m),p(N)}catch(m){console.error("Failed to fetch data",m)}finally{r(!1)}};React.useEffect(()=>{u()},[]);const i=async m=>{if(m.preventDefault(),!!c.trim())try{const N=await g.post("/trips",{name:c,default_currency:y},t.access_token);h([N,...a]),b(""),l(!1)}catch(N){console.error("Failed to create trip",N)}};return n?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading your trips..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Your Trips"}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg font-medium transition-all",children:[e.jsx(T,{size:18}),"New Trip"]})]}),x&&e.jsx("div",{className:"p-6 bg-slate-900/40 border border-slate-800 rounded-xl animate-in fade-in slide-in-from-top-4",children:e.jsxs("form",{onSubmit:i,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("input",{type:"text",placeholder:"Trip Name (e.g. Summer in Spain)",value:c,onChange:m=>b(m.target.value),className:"flex-1 bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none transition-all",autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-950 border border-slate-800 rounded-lg px-3",children:[e.jsx(_,{size:16,className:"text-slate-500"}),e.jsx("select",{value:y,onChange:m=>f(m.target.value),"data-testid":"trip-currency-select",className:"bg-transparent border-none py-2 pr-2 text-slate-200 outline-none cursor-pointer",children:o.map(m=>e.jsxs("option",{value:m.code,className:"bg-slate-900",children:[m.code," - ",m.name]},m.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit","data-testid":"create-trip-submit",className:"flex-1 md:flex-none bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg font-medium transition-all",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"text-slate-400 hover:text-white px-2",children:"Cancel"})]})]})}),a.length===0?e.jsxs("div",{className:"text-center py-20 bg-slate-900/20 border border-slate-800 border-dashed rounded-2xl",children:[e.jsx(Q,{size:48,className:"mx-auto mb-4 text-slate-700"}),e.jsx("p",{className:"text-slate-400 text-lg",children:"No trips yet. Create one to get started!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(m=>e.jsxs("div",{onClick:()=>s(m.id),"data-testid":`trip-card-${m.id}`,className:"group p-6 bg-slate-900/40 border border-slate-800 rounded-2xl hover:border-cyan-500/50 cursor-pointer transition-all hover:shadow-xl hover:shadow-cyan-900/10",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 group-hover:text-cyan-400 transition-colors",children:m.name}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{size:14}),new Date(m.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1 font-medium text-cyan-500/70",children:[e.jsx(_,{size:14}),m.default_currency]})]})]},m.id))})]})},re=({auth:t,tripId:s})=>{const[a,h]=React.useState(null),[o,p]=React.useState("expenses"),[n,r]=React.useState(!0),x=async()=>{try{const l=await g.get(`/trips/${s}`,t.access_token);h(l)}catch(l){console.error("Failed to fetch trip",l)}finally{r(!1)}};return React.useEffect(()=>{x()},[s]),n?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Loading trip details..."}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl font-bold",children:a.name}),e.jsxs("p",{className:"text-slate-400 mt-1","data-testid":"trip-member-count",children:[a.members.length," members"]})]}),e.jsxs("div",{className:"flex bg-slate-900/60 p-1 rounded-xl border border-slate-800 self-start",children:[e.jsxs("button",{onClick:()=>p("expenses"),"data-testid":"tab-expenses",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="expenses"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(P,{size:16}),"Expenses"]}),e.jsxs("button",{onClick:()=>p("balances"),"data-testid":"tab-balances",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="balances"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(I,{size:16}),"Balances"]}),e.jsxs("button",{onClick:()=>p("settings"),"data-testid":"tab-settings",className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${o==="settings"?"bg-slate-800 text-cyan-400 shadow-sm":"text-slate-400 hover:text-white"}`,children:[e.jsx(G,{size:16}),"Settings"]})]})]}),e.jsxs("div",{className:"mt-8",children:[o==="expenses"&&e.jsx(le,{auth:t,trip:a}),o==="balances"&&e.jsx(ie,{auth:t,trip:a}),o==="settings"&&e.jsx(ce,{auth:t,trip:a})]})]}):e.jsx("div",{className:"text-center py-12 text-red-400",children:"Trip not found."})},le=({auth:t,trip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState([]),[n,r]=React.useState(!1),[x,l]=React.useState(null),c=async()=>{try{const[u,i]=await Promise.all([g.get(`/trips/${s.id}/expenses`,t.access_token),g.get("/currencies",t.access_token)]);h(u),p(i)}catch(u){console.error("Failed to fetch expenses",u)}};React.useEffect(()=>{c()},[s.id,t.access_token]);const b=async u=>{try{const i=await g.post(`/trips/${s.id}/expenses`,u,t.access_token);h([i,...a]),r(!1)}catch{alert("Failed to add expense")}},y=async u=>{if(x)try{const i=await g.put(`/expenses/${x.id}`,u,t.access_token);h(a.map(m=>m.id===i.id?i:m)),l(null)}catch{alert("Failed to update expense")}},f=async u=>{if(confirm("Delete this expense?"))try{await g.delete(`/expenses/${u}`,t.access_token),h(a.filter(i=>i.id!==u))}catch{alert("Failed to delete expense")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Trip Expenses"}),e.jsxs("button",{onClick:()=>{r(!n),l(null)},className:"flex items-center gap-2 bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg font-medium transition-all",children:[e.jsx(T,{size:18}),"Add Expense"]})]}),n&&e.jsx("div",{className:"p-6 bg-slate-900/40 border border-slate-800 rounded-xl",children:e.jsx(R,{trip:s,currencies:o,onSubmit:b,onCancel:()=>r(!1),initialData:{currency:s.default_currency,beneficiary_ids:s.members.map(u=>u.user.id)}})}),x&&e.jsxs("div",{className:"p-6 bg-cyan-900/10 border border-cyan-500/30 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-bold text-cyan-400 mb-4 uppercase tracking-wider",children:"Editing Expense"}),e.jsx(R,{trip:s,currencies:o,onSubmit:y,onCancel:()=>l(null),initialData:{amount:x.amount.toString(),currency:x.currency,description:x.description,beneficiary_ids:x.beneficiaries.map(u=>u.id)}})]}),e.jsx("div",{className:"space-y-4",children:a.map(u=>e.jsxs("div",{"data-testid":"expense-item",className:"p-4 bg-slate-900/40 border border-slate-800 rounded-xl flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center font-bold text-slate-300",children:u.payer.name[0]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:u.description}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Paid by ",u.payer.name," • ",new Date(u.date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-6",children:[e.jsxs("div",{className:"text-lg font-bold text-cyan-400",children:[u.amount.toFixed(2)," ",u.currency]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{l(u),r(!1),window.scrollTo({top:0,behavior:"smooth"})},className:"p-2 text-slate-400 hover:text-cyan-400 transition-colors",title:"Edit",children:e.jsx(E,{size:18})}),e.jsx("button",{onClick:()=>f(u.id),className:"p-2 text-slate-400 hover:text-red-400 transition-colors",title:"Delete",children:e.jsx(F,{size:18})})]})]})]},u.id))})]})},R=({trip:t,currencies:s,onSubmit:a,onCancel:h,initialData:o})=>{const[p,n]=React.useState(o?.amount||""),[r,x]=React.useState(o?.currency||t.default_currency),[l,c]=React.useState(o?.description||""),[b,y]=React.useState(o?.beneficiary_ids||t.members.map(i=>i.user.id)),f=i=>{i.preventDefault(),a({amount:parseFloat(p),currency:r,description:l,beneficiary_ids:b})},u=i=>{y(m=>m.includes(i)?m.filter(N=>N!==i):[...m,i])};return e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",value:p,onChange:i=>n(i.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Currency"}),e.jsx("select",{value:r,onChange:i=>x(i.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none",children:s.map(i=>e.jsxs("option",{value:i.code,children:[i.code," - ",i.name]},i.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Description"}),e.jsx("input",{type:"text",placeholder:"What was it for?",value:l,onChange:i=>c(i.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 outline-none",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-3",children:"Split between:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.members.map(i=>e.jsx("button",{type:"button",onClick:()=>u(i.user.id),className:`px-3 py-1.5 rounded-full text-sm font-medium transition-all border ${b.includes(i.user.id)?"bg-cyan-500/20 border-cyan-500 text-cyan-300":"bg-slate-950 border-slate-800 text-slate-500"}`,children:i.user.name},i.user.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:h,className:"text-slate-400 hover:text-white px-4",children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-cyan-600 hover:bg-cyan-500 text-white px-8 py-2 rounded-lg font-bold",children:"Save Expense"})]})]})},ie=({auth:t,trip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState(!0);return React.useEffect(()=>{(async()=>{try{const r=await g.get(`/trips/${s.id}/balances`,t.access_token);h(r)}catch(r){console.error("Failed to fetch balances",r)}finally{p(!1)}})()},[s.id,t.access_token]),o?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Calculating balances..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(n=>e.jsxs("div",{"data-testid":"balance-card",className:"p-6 bg-slate-900/40 border border-slate-800 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-cyan-500/20 text-cyan-400 rounded-full flex items-center justify-center font-bold",children:n.user.name[0]}),e.jsx("h4",{className:"text-xl font-bold",children:n.user.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-bold ${n.estimated_total_default_currency>=0?"text-emerald-400":"text-red-400"}`,children:[n.estimated_total_default_currency>=0?"+":"",n.estimated_total_default_currency.toFixed(2)," ",n.default_currency,"*"]}),n.default_currency!=="USD"&&e.jsxs("div",{className:"text-xs text-slate-500",children:["≈ ",n.estimated_total_usd>=0?"+":"",n.estimated_total_usd.toFixed(2)," USD"]})]})]}),e.jsx("div",{className:"space-y-3",children:n.balances.map(r=>e.jsxs("div",{className:"flex justify-between p-3 bg-slate-950 rounded-lg border border-slate-800/50",children:[e.jsx("span",{className:"font-bold text-slate-300",children:r.currency}),e.jsxs("span",{className:`font-bold ${r.balance>=0?"text-emerald-500":"text-red-500"}`,children:[r.balance>=0?"+":"",r.balance.toFixed(2)]})]},r.currency))})]},n.user.id))})},ce=({auth:t,trip:s})=>{const[a,h]=React.useState([]),[o,p]=React.useState(!1);React.useEffect(()=>{(async()=>{try{const c=await g.get(`/trips/${s.id}/invitations`,t.access_token);h(c)}catch(c){console.error("Failed to fetch invitations",c)}})()},[s.id,t.access_token]);const n=async()=>{try{const l=await g.post(`/trips/${s.id}/invitations`,{},t.access_token);h([l,...a])}catch{alert("Failed to create invitation")}},r=l=>{const c=`${window.location.origin}${window.location.pathname}?join=${l}`;navigator.clipboard.writeText(c),p(!0),setTimeout(()=>p(!1),2e3)},x=a.find(l=>!l.is_expired);return e.jsxs("div",{className:"max-w-2xl space-y-8",children:[e.jsxs("div",{className:"p-6 bg-slate-900/40 border border-slate-800 rounded-2xl",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(X,{size:20,className:"text-cyan-400"}),"Invite Members"]}),e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"Share this secret link with friends to let them join the trip."}),x?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 bg-slate-950 border border-slate-800 rounded-lg px-4 py-3 text-sm text-slate-300 truncate",children:[window.location.origin,window.location.pathname,"?join=",x.uuid]}),e.jsxs("button",{onClick:()=>r(x.uuid),className:"bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-all whitespace-nowrap",children:[o?e.jsx($,{size:18,className:"text-emerald-400"}):e.jsx(M,{size:18}),o?"Copied!":"Copy Link"]})]}):e.jsxs("button",{onClick:n,"data-testid":"generate-invite-button",className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2",children:[e.jsx(V,{size:18})," Generate Invitation Link"]})]}),e.jsxs("div",{className:"p-6 bg-slate-900/40 border border-slate-800 rounded-2xl",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Trip Members"}),e.jsx("div",{className:"space-y-3",children:s.members.map(l=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-slate-950/50 rounded-lg border border-slate-800/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-800 rounded-full flex items-center justify-center text-xs font-bold",children:l.user.name[0]}),e.jsx("div",{className:"font-bold text-sm",children:l.user.name})]})},l.user.id))})]})]})},oe=()=>{const[t,s]=React.useState("landing"),[a,h]=React.useState(null),[o,p]=React.useState(null),[n,r]=React.useState(null);React.useEffect(()=>{const c=localStorage.getItem("multicount_auth");if(c)try{h(JSON.parse(c)),s("dashboard")}catch{localStorage.removeItem("multicount_auth")}const y=new URLSearchParams(window.location.search).get("join");y&&(r(y),window.history.replaceState({},"",window.location.pathname))},[]),React.useEffect(()=>{n&&a?s("join_confirmation"):n&&!a&&s("login")},[n,a]);const x=async c=>{try{const b=await g.post(`/trips/join/${c}`,{},a?.access_token);r(null),p(b.id),s("trip")}catch(b){console.error("Failed to join trip",b),r(null),alert("Failed to join trip. The invitation might be expired or invalid.")}},l=()=>{h(null),localStorage.removeItem("multicount_auth"),s("landing")};return e.jsxs("div",{className:"min-h-screen text-slate-100 font-sans",children:[e.jsx("header",{className:"border-b border-slate-800/50 bg-slate-900/50 backdrop-blur-md sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer",onClick:()=>s(a?"dashboard":"landing"),children:[e.jsx("div",{className:"w-8 h-8 bg-cyan-500 rounded-lg flex items-center justify-center font-bold text-slate-900",children:"M"}),e.jsx("span",{className:"font-bold text-xl tracking-tight",children:"MultiCount"})]}),e.jsx("nav",{className:"flex items-center gap-4",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-slate-400 hidden md:inline",children:a.user.name}),a.user.role==="admin"&&e.jsx("button",{onClick:()=>s("admin"),className:`text-sm font-medium transition-colors ${t==="admin"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Admin"}),e.jsx("button",{onClick:()=>s("dashboard"),className:`text-sm font-medium transition-colors ${t==="dashboard"?"text-cyan-400":"text-slate-300 hover:text-white"}`,children:"Trips"}),e.jsx("button",{onClick:l,className:"text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"Logout"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s("login"),className:"text-sm font-medium text-slate-300 hover:text-white transition-colors",children:"Login"}),e.jsx("button",{onClick:()=>s("register"),"data-testid":"signup-button",className:"bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all",children:"Sign Up"})]})})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[t==="landing"&&e.jsx(xe,{onGetStarted:()=>s("register")}),t==="login"&&e.jsx(se,{onLogin:c=>{h(c),s("dashboard"),localStorage.setItem("multicount_auth",JSON.stringify(c))},onSwitchToRegister:()=>s("register")}),t==="register"&&e.jsx(ae,{onRegister:()=>s("login"),onSwitchToLogin:()=>s("login")}),t==="dashboard"&&a&&e.jsx(ne,{auth:a,onSelectTrip:c=>{p(c),s("trip")}}),t==="trip"&&a&&o&&e.jsx(re,{auth:a,tripId:o}),t==="admin"&&a&&a.user.role==="admin"&&e.jsx(te,{auth:a}),t==="join_confirmation"&&n&&e.jsx(de,{uuid:n,onConfirm:()=>x(n),onCancel:()=>{r(null),s("dashboard")}})]})]})},de=({uuid:t,onConfirm:s,onCancel:a})=>{const[h,o]=React.useState(null),[p,n]=React.useState(!0),[r,x]=React.useState(null);return React.useEffect(()=>{(async()=>{try{const c=await g.get(`/trips/invitation/${t}`);o(c)}catch{x("Invalid or expired invitation link.")}finally{n(!1)}})()},[t]),p?e.jsx("div",{className:"text-center py-20",children:"Loading trip information..."}):r||!h?e.jsx("div",{className:"max-w-md mx-auto py-20 text-center",children:e.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 p-6 rounded-xl",children:[e.jsx("h2",{className:"text-xl font-bold text-red-400 mb-2",children:"Error"}),e.jsx("p",{className:"text-slate-300 mb-6",children:r||"Trip not found"}),e.jsx("button",{onClick:a,className:"bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg transition-colors",children:"Back to Dashboard"})]})}):e.jsx("div",{className:"max-w-md mx-auto py-20",children:e.jsxs("div",{className:"bg-slate-900/80 border border-slate-800 p-8 rounded-2xl shadow-xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-cyan-500/10 text-cyan-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Join Trip?"}),e.jsxs("p",{className:"text-slate-400 mb-8",children:["You've been invited to join"," ",e.jsxs("span",{className:"text-white font-semibold",children:['"',h.name,'"']}),". Once you join, you'll be able to see and add expenses."]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:s,className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl transition-all shadow-lg shadow-cyan-900/20",children:"Accept and Join"}),e.jsx("button",{onClick:a,className:"w-full bg-slate-800 hover:bg-slate-700 text-slate-300 font-medium py-3 rounded-xl transition-all",children:"Not Now"})]})]})})},xe=({onGetStarted:t})=>e.jsxs("div",{className:"py-20 text-center",children:[e.jsxs("h1",{className:"text-5xl md:text-7xl font-extrabold mb-6 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent",children:["Split Expenses, ",e.jsx("br",{}),"Not Friendships."]}),e.jsx("p",{className:"text-xl text-slate-400 mb-10 max-w-2xl mx-auto",children:"The simple way to track shared expenses on trips. Multi-currency support, automated balances, and secret join links."}),e.jsx("button",{onClick:t,className:"bg-cyan-600 hover:bg-cyan-500 text-white px-8 py-4 rounded-xl text-lg font-bold transition-all shadow-lg shadow-cyan-900/20",children:"Get Started for Free"})]});document.body.classList.add("menuall-page");ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(oe,{})}));
