import"./modulepreload-polyfill-B5Qt9EMX.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as A}from"./button-UTh2Cu_R.js";import{A as Se}from"./api-CH_Pe6Vg.js";const ye="todo.jwt",ke=a=>{if(!a)return null;if(typeof a=="string"){const o=a.trim();return o||null}if(Array.isArray(a)){for(const o of a){const c=ke(o);if(c)return c}return null}if(typeof a=="object"){const o=a;if("detail"in o){const i=ke(o.detail);if(i)return i}if(typeof o.msg=="string"){const i=o.msg.trim();if(i)return i}if(typeof o.message=="string"){const i=o.message.trim();if(i)return i}const c=Object.values(o).find(i=>typeof i=="string"&&!!i.trim());return c?c.trim():null}return null},yt=()=>{const a=React.useMemo(()=>`${Se}/tasks/auth`,[]),[o,c]=React.useState(()=>typeof window>"u"?null:window.localStorage.getItem(ye)),[i,_]=React.useState(null),[T,E]=React.useState(!1),[k,b]=React.useState(null),[W,K]=React.useState(!1),p=React.useCallback(m=>{c(m),!(typeof window>"u")&&(m?window.localStorage.setItem(ye,m):window.localStorage.removeItem(ye))},[]),j=React.useCallback(m=>{b(m||null),p(null),_(null)},[p]),$=React.useCallback(async m=>{const x=await fetch(`${a}/me`,{headers:{Authorization:`Bearer ${m}`}});if(!x.ok)throw new Error(x.status===401?"Session expired. Please log in again.":"Unable to load profile.");const h=await x.json();_({id:h.id,email:h.email}),b(null)},[a]);React.useEffect(()=>{if(!o){_(null),E(!0);return}E(!1),$(o).catch(m=>{const x=m instanceof Error?m.message:"Session expired.";j(x)}).finally(()=>{E(!0)})},[j,$,o]);const f=React.useCallback(async(m,x)=>{K(!0),b(null);try{const h=await fetch(`${a}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m,password:x})});if(!h.ok){const S=await h.json().catch(()=>null),ue=ke(S)??"Invalid credentials";throw new Error(ue)}const N=await h.json();p(N.access_token),await $(N.access_token)}catch(h){const N=h instanceof Error?h.message:"Unable to log in.";throw j(N),new Error(N)}finally{K(!1)}},[a,j,$,p]),D=React.useCallback(()=>{j()},[j]),w=React.useCallback(async(m,x)=>{if(!o)throw new Error("Not authenticated");const h=new Headers(x?.headers);h.set("Authorization",`Bearer ${o}`);const N=await fetch(m,{...x,headers:h});if(N.status===401)throw j("Session expired. Please log in again."),new Error("Session expired. Please log in again.");return N},[j,o]),I=React.useCallback(()=>b(null),[]);return{user:i,token:o,ready:T,isAuthenticated:!!(i&&o),login:f,logout:D,authenticatedFetch:w,sessionError:k,clearSessionError:I,loginPending:W}},xt=a=>a.toISOString().split("T")[0],xe=()=>{const a=xt(new Date);return{name:"",description:"",startDate:a,dueDate:a,category:"",isCompleted:!1}},V=a=>{const o=a.slice(0,10),[c,i,_]=o.split("-"),T=Number(c),E=Number(i),k=Number(_);if([T,E,k].some(b=>Number.isNaN(b))){const b=new Date(a);return b.setHours(0,0,0,0),b}return new Date(T,E-1,k)},Ce=()=>{const a=new Date;return a.setHours(0,0,0,0),a},jt=1440*60*1e3,wt=a=>({name:a.name,description:a.description,startDate:a.start_date,dueDate:a.due_date,category:a.category,isCompleted:a.is_completed}),de=a=>a.replace(/^value error,\s*/i,"").trim()||a,vt=a=>{if(!a)return null;if(typeof a=="string")return de(a);if(typeof a=="object"){const o=a.detail;if(typeof o=="string")return de(o);if(Array.isArray(o)&&o.length>0){const c=o[0];if(c&&typeof c=="object"){const i=c.msg;if(typeof i=="string")return de(i);const _=c.ctx?.error;if(typeof _=="string")return de(_)}}}return null},je=()=>({email:"",password:"",confirm:""}),O=`${Se}/tasks`,We="NONE",et="todoLastLoginEmail",we=()=>{if(typeof window>"u")return"";try{return window.localStorage.getItem(et)??""}catch{return""}},kt=a=>{if(typeof window>"u")return;const o=a.trim();if(o)try{window.localStorage.setItem(et,o)}catch{}},Ze=a=>{const o=V(a);return Number.isNaN(o.valueOf())?a:new Intl.DateTimeFormat(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(o)},Qe=(a,o=!1)=>{if(o)return!1;const c=Ce(),i=V(a);return i.setHours(0,0,0,0),i<c},Nt=a=>{const o=V(a);if(Number.isNaN(o.valueOf()))return 0;o.setHours(0,0,0,0);const c=Ce();return Math.round((o.getTime()-c.getTime())/jt)},St=a=>a>0?`+${a}d`:`${a}d`,Xe=a=>a.trim().toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,""),Ne=a=>{const o=Ce(),c=V(a);return c.setHours(0,0,0,0),c.getTime()<=o.getTime()},ve=a=>a.is_completed?{label:"Completed",modifier:"todo-status--completed"}:Ne(a.start_date)?{label:"Active",modifier:"todo-status--active"}:{label:"Blocked",modifier:"todo-status--blocked"},Ct=()=>{const[a,o]=React.useState([]),[c,i]=React.useState(xe),[_,T]=React.useState(!0),[E,k]=React.useState(null),[b,W]=React.useState(!1),[K,p]=React.useState(null),[j,$]=React.useState(null),[f,D]=React.useState([]),[w,I]=React.useState(null),[m,x]=React.useState(!1),[h,N]=React.useState(!1),[S,ue]=React.useState({key:"due_date",direction:"asc"}),[Z,Q]=React.useState(()=>new Set),[X,Re]=React.useState(!1),[Ee,Y]=React.useState(null),[G,me]=React.useState(!1),[U,De]=React.useState({label:"",slug:""}),[Te,Le]=React.useState(!1),[Fe,Ae]=React.useState(!1),[$e,C]=React.useState(null),{user:st,ready:ee,isAuthenticated:g,login:Pe,logout:Oe,authenticatedFetch:v,sessionError:Ie,clearSessionError:te,loginPending:Ue}=yt(),[Be,J]=React.useState(!1),[B,se]=React.useState(()=>({email:we(),password:""})),[ae,oe]=React.useState(null),[Me,qe]=React.useState(!1),[M,ge]=React.useState(je),[ze,He]=React.useState(!1),[he,L]=React.useState(null),[Ke,P]=React.useState(!1),R=React.useCallback(()=>{oe(null),te()},[te]),Ye=React.useCallback((t,s)=>{se(n=>({...n,[t]:s})),ae&&oe(null),te()},[te,ae]),re=React.useCallback(()=>{ge(je()),L(null),P(!1)},[]),at=React.useCallback(()=>{re(),qe(!0)},[re]),fe=React.useCallback(()=>{qe(!1),re()},[re]),pe=(t,s)=>{ge(n=>({...n,[t]:s})),he&&L(null),Ke&&P(!1)},ot=async t=>{t.preventDefault();const s=M.email.trim(),n=M.password,l=M.confirm;if(!s||!n){L("Email and password are required."),P(!1);return}if(n.length<8){L("Password must be at least 8 characters long."),P(!1);return}if(n!==l){L("Passwords must match."),P(!1);return}He(!0),L(null);try{const r=await fetch(`${Se}/tasks/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.toLowerCase(),password:n})});if(!r.ok){const d=await r.json().catch(()=>null),u=vt(d)??"Unable to register.";throw new Error(u)}P(!0),L("Account created! You can now log in from the to-do list page."),ge(je())}catch(r){const d=r instanceof Error?r.message:"Registration failed.";L(d),P(!1)}finally{He(!1)}},_e=React.useMemo(()=>{const t=a.filter(r=>!r.is_completed),s=t.filter(r=>Qe(r.due_date,r.is_completed)).length,n=t.filter(r=>Ne(r.start_date)).length,l=t.filter(r=>!Ne(r.start_date)).length;return{overdue:s,ready:n,blocked:l,total:a.length}},[a]),Ge=React.useMemo(()=>a.filter(t=>{const s=ve(t).label;return!(!m&&s==="Blocked"||!h&&s==="Completed")}),[a,m,h]),q=React.useCallback(async()=>{if(!g){o([]),T(!1),$(null),k("Log in to view your tasks.");return}T(!0),k(null);try{const n=(await(await v(`${O}/?limit=100`)).json()).map(l=>({...l,category:l.category??"",is_completed:!!l.is_completed}));o(n),$(new Date)}catch(t){const s=t instanceof Error?t.message:"Unable to load tasks.";k(s)}finally{T(!1)}},[v,g]);React.useEffect(()=>{ee&&q()},[ee,q]);const ne=React.useCallback(async()=>{if(!g){D([]);return}try{const t=await v(`${O}/categories`);if(!t.ok)throw new Error("Unable to load categories");const s=await t.json();D(s)}catch{D([])}},[v,g]);React.useEffect(()=>{ee&&ne()},[ee,ne]);const rt=React.useCallback(async t=>{t.preventDefault(),R();const s=B.email.trim(),n=B.password;if(!s||!n){oe("Enter email and password.");return}kt(s);const l=s.toLowerCase();try{await Pe(l,n),J(!1),se({email:s,password:""}),k(null),q(),ne()}catch(r){const d=r instanceof Error?r.message:"Unable to log in.";oe(d)}},[ne,q,Pe,B.email,B.password,R]),nt=React.useCallback(()=>{Oe(),o([]),D([]),i(xe()),I(null),Q(new Set),k("Log in to view your tasks."),J(!1),R()},[Oe,R]),lt=React.useCallback(()=>{R(),J(!0)},[R]),ct=React.useCallback(()=>{R(),J(!1)},[R]);React.useEffect(()=>{const t=we();t&&se(s=>s.email?s:{...s,email:t})},[]),React.useEffect(()=>{g&&(J(!1),se(t=>({email:t.email||we(),password:""})),R())},[g,R]),React.useEffect(()=>{g&&fe()},[g,fe]),React.useEffect(()=>{g||me(!1)},[g]),React.useEffect(()=>{Q(t=>{if(t.size===0)return t;const s=new Set(a.map(r=>r.id));let n=!1;const l=new Set;return t.forEach(r=>{s.has(r)?l.add(r):n=!0}),n?l:t})},[a]);const be=React.useCallback(()=>{const t=xe(),s=f[0]?.value;return s?{...t,category:s}:t},[f]);React.useEffect(()=>{f.length!==0&&i(t=>t.category&&f.some(s=>s.value===t.category)?t:{...t,category:f[0].value})},[f]);const le=React.useMemo(()=>f.reduce((t,s)=>(t[s.value]=s.label,t),{}),[f]),it=React.useMemo(()=>{const t=[...Ge],s=r=>{const d=V(r).getTime();return Number.isNaN(d)?0:d},n={Blocked:0,Active:1,Completed:2},l=r=>{switch(S.key){case"start_date":return s(r.start_date);case"due_date":return s(r.due_date);case"status":return n[ve(r).label]??0;case"category":default:return(le[r.category]??r.category??"").toLowerCase()}};return t.sort((r,d)=>{const u=l(r),y=l(d);if(typeof u=="number"&&typeof y=="number")return u===y?r.id-d.id:S.direction==="asc"?u-y:y-u;const F=u.toString(),H=y.toString();return F===H?r.id-d.id:S.direction==="asc"?F.localeCompare(H,void 0,{sensitivity:"base"}):H.localeCompare(F,void 0,{sensitivity:"base"})})},[le,S,Ge]),z=(t,s)=>{i(n=>({...n,[t]:s}))},dt=async t=>{t.preventDefault(),p(null);const s=c.name.trim(),n=c.description.trim();if(!s){p("Please provide a name.");return}if(!c.category){p("Select a category for this task.");return}if(c.startDate>c.dueDate){p("Start date must be on or before the due date.");return}if(!g){p("Log in to manage tasks.");return}const l=w!==null,r=l?`${O}/${w}`:`${O}/`,d=l?"PUT":"POST";W(!0);try{const u=await v(r,{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s,description:n,start_date:c.startDate,due_date:c.dueDate,category:c.category,is_completed:c.isCompleted})});if(!u.ok)throw new Error("Failed to save the task");const y=await u.json();o(F=>l?F.map(H=>H.id===y.id?y:H):[y,...F]),i(be()),I(null),p(l?"Task updated":"Task saved")}catch(u){const y=u instanceof Error?u.message:"Unexpected error";p(y)}finally{W(!1)}},Je=React.useCallback(t=>{i(wt(t)),I(t.id),p(null)},[]),ut=React.useCallback(()=>{i(be()),I(null),p(null)},[be]),mt=t=>{ue(s=>s.key===t?{key:t,direction:s.direction==="asc"?"desc":"asc"}:{key:t,direction:"asc"})},ce=t=>S.key!==t?"none":S.direction==="asc"?"ascending":"descending",ie=(t,s)=>{const n=S.key===t?S.direction:null,l=n?`Sort by ${s} (${n==="asc"?"ascending":"descending"})`:`Sort by ${s}`;return e.jsxs("button",{type:"button",className:"todo-table__sort",onClick:()=>mt(t),"aria-label":l,children:[e.jsx("span",{children:s}),e.jsx("span",{className:"todo-table__sort-icon","aria-hidden":"true",children:n?n==="asc"?"↑":"↓":"↕"})]})},gt=React.useCallback((t,s)=>{Q(n=>{const l=new Set(n);return s?l.add(t):l.delete(t),l})},[]),ht=React.useCallback(async()=>{const t=Array.from(Z);if(t.length===0||X){Y(t.length===0?"Select at least one task to delete.":null);return}if(!g){Y("Log in to delete tasks.");return}Re(!0),Y(null);const s=new Set(t);try{await Promise.all(t.map(async n=>{if(!(await v(`${O}/${n}`,{method:"DELETE"})).ok)throw new Error("Unable to delete selected tasks.")})),o(n=>n.filter(l=>!s.has(l.id))),Q(new Set),Y(t.length===1?"Deleted 1 task.":`Deleted ${t.length} tasks.`)}catch(n){const l=n instanceof Error?n.message:"Failed to delete selected tasks.";Y(l)}finally{Re(!1)}},[v,X,g,Z]),ft=(t,s)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),Je(s))},pt=Z.size,Ve=React.useCallback((t,s)=>{De(n=>t==="label"&&!Te?{label:s,slug:Xe(s)}:{...n,[t]:s}),t==="slug"&&Le(!0),C(null)},[Te]),_t=React.useCallback(async t=>{t.preventDefault();const s=U.label.trim(),n=U.slug||s,l=Xe(n);if(!s||!l){C("Provide both a label and a slug.");return}if(f.some(r=>r.value===l)){C("That slug already exists.");return}if(!g){C("Log in to manage categories.");return}Ae(!0),C(null);try{const r=await v(`${O}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:l,label:s})});if(!r.ok)throw new Error("Unable to add category.");const d=await r.json();D(u=>[...u,d].sort((y,F)=>y.label.localeCompare(F.label))),De({label:"",slug:""}),Le(!1),C("Category added.")}catch(r){const d=r instanceof Error?r.message:"Failed to add category.";C(d)}finally{Ae(!1)}},[v,U.label,U.slug,f,g]),bt=React.useCallback(async t=>{if(!(!t||t===We)){if(!g){C("Log in to manage categories.");return}try{if(!(await v(`${O}/categories/${t}`,{method:"DELETE"})).ok)throw new Error("Unable to delete category.");D(n=>n.filter(l=>l.value!==t)),C("Category removed.")}catch(s){const n=s instanceof Error?s.message:"Failed to delete category.";C(n)}}},[v,g,D]);return e.jsxs("div",{className:"todo-app",children:[Me&&!g&&e.jsx("section",{className:"todo-register",role:"dialog","aria-modal":"true","aria-labelledby":"todo-register-title",children:e.jsxs("div",{className:"todo-register__card",children:[e.jsxs("header",{className:"todo-register__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"todo-register__eyebrow",children:"Create account"}),e.jsx("h1",{id:"todo-register-title",children:"Register"}),e.jsx("p",{className:"todo-register__subtitle",children:"Create a personal login to keep your to-do list private. You can log in from the to-do page once you finish."})]}),e.jsx("button",{type:"button",className:"todo-register__close",onClick:fe,"aria-label":"Close registration dialog",children:"Close"})]}),e.jsxs("form",{className:"todo-register__form",onSubmit:ot,children:[e.jsxs("label",{className:"todo-register__field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",value:M.email,onChange:t=>pe("email",t.target.value),placeholder:"you@example.com",required:!0,autoComplete:"email"})]}),e.jsxs("label",{className:"todo-register__field",children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",value:M.password,onChange:t=>pe("password",t.target.value),placeholder:"********",required:!0,autoComplete:"new-password","data-testid":"register-password"})]}),e.jsxs("label",{className:"todo-register__field",children:[e.jsx("span",{children:"Confirm password"}),e.jsx("input",{type:"password",value:M.confirm,onChange:t=>pe("confirm",t.target.value),placeholder:"********",required:!0,autoComplete:"new-password","data-testid":"register-confirm-password"})]}),e.jsx(A,{type:"submit",className:"todo-register__submit",disabled:ze,children:ze?"Creating account…":"Create account"})]}),he?e.jsx("p",{className:`todo-register__feedback${Ke?" todo-register__feedback--success":""}`,role:"status",children:he}):null]})}),e.jsxs("nav",{className:"todo-nav","aria-label":"Primary navigation",children:[e.jsx("div",{className:"todo-nav__logo",children:"To Do list"}),e.jsxs("ul",{className:"todo-nav__menu",children:[e.jsx("li",{className:"todo-nav__item",children:e.jsx("button",{type:"button",className:`todo-nav__link todo-nav__link--button${G?"":" todo-nav__link--active"}`,"aria-pressed":!G,onClick:()=>me(!1),children:"Tasks"})}),e.jsx("li",{className:"todo-nav__item",children:e.jsx("button",{type:"button",className:`todo-nav__link todo-nav__link--button${G?" todo-nav__link--active":""}`,"aria-pressed":G,onClick:()=>me(t=>!t),children:"Manage categories"})})]}),e.jsx("div",{className:"todo-nav__auth",children:g?e.jsxs("div",{className:"todo-nav__user",children:[e.jsx("div",{className:"todo-nav__user-details",children:e.jsx("span",{className:"todo-nav__user-email",children:st?.email})}),e.jsx("button",{type:"button",className:"todo-nav__logout",onClick:nt,children:"Logout"})]}):e.jsxs("div",{className:"todo-nav__login",children:[Be?e.jsxs("form",{className:"todo-nav__login-form",onSubmit:rt,children:[e.jsxs("label",{className:"todo-nav__login-field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",value:B.email,onChange:t=>Ye("email",t.target.value),autoComplete:"email",required:!0})]}),e.jsxs("label",{className:"todo-nav__login-field",children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",value:B.password,onChange:t=>Ye("password",t.target.value),autoComplete:"current-password",required:!0})]}),e.jsxs("div",{className:"todo-nav__login-actions",children:[e.jsx("button",{type:"submit",className:"todo-nav__login-submit",disabled:Ue,children:Ue?"Signing in…":"Sign in"}),e.jsx("button",{type:"button",className:"todo-nav__login-cancel",onClick:ct,children:"Cancel"})]})]}):e.jsx("button",{type:"button",className:"todo-nav__link todo-nav__link--button",onClick:lt,children:"Login"}),!Be&&e.jsx("button",{type:"button",className:"todo-nav__register-link",onClick:at,"aria-expanded":Me,children:"Register"}),(ae||Ie)&&e.jsx("p",{className:"todo-nav__feedback",role:"status",children:ae??Ie})]})})]}),g?G?e.jsx("section",{className:"todo-categories","aria-label":"Category manager",children:e.jsxs("div",{className:"todo-categories__panel",children:[e.jsx("div",{children:e.jsx("h3",{children:"Manage categories"})}),e.jsxs("form",{className:"todo-categories__form",onSubmit:_t,children:[e.jsxs("label",{className:"todo-categories__field",children:[e.jsx("span",{children:"Category label"}),e.jsx("input",{type:"text",value:U.label,onChange:t=>Ve("label",t.target.value),placeholder:"can include spaces",required:!0})]}),e.jsxs("label",{className:"todo-categories__field",children:[e.jsx("span",{children:"Category slug"}),e.jsx("input",{type:"text",value:U.slug,onChange:t=>Ve("slug",t.target.value),placeholder:"DESIGN",required:!0})]}),e.jsx(A,{type:"submit",className:"todo-button todo-button--primary",disabled:Fe,children:Fe?"Adding…":"Add category"})]}),e.jsx("ul",{className:"todo-categories__list",children:f.map(t=>e.jsxs("li",{className:"todo-categories__item",children:[e.jsxs("span",{children:[e.jsx("strong",{children:t.label})," ",e.jsx("small",{children:t.value})]}),e.jsx(A,{type:"button",variant:"outline",className:"todo-button todo-button--danger-solid",onClick:()=>void bt(t.value),disabled:t.value===We,children:"Delete"})]},t.value))}),$e?e.jsx("p",{className:"todo-categories__feedback",children:$e}):null]})}):e.jsx(e.Fragment,{children:e.jsxs("main",{className:"todo-app__layout",children:[e.jsxs("section",{className:"todo-form","aria-labelledby":"todo-form-title",children:[e.jsxs("div",{className:"todo-form__header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"todo-form__eyebrow",children:w?"Edit":"Create"}),e.jsx("h2",{id:"todo-form-title",children:w?"Update task":"New task"})]}),e.jsx("div",{className:"todo-form__header-actions",children:e.jsx(A,{type:"button",variant:"outline",className:"todo-button todo-button--outline",onClick:()=>void q(),disabled:_,children:_?"Syncing…":"Refresh"})})]}),w?e.jsxs("p",{className:"todo-form__notice",children:["Editing task #",w]}):null,e.jsxs("form",{className:"todo-form__body",onSubmit:dt,children:[e.jsxs("label",{className:"todo-form__field",htmlFor:"task-name",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{id:"task-name",type:"text",value:c.name,onChange:t=>z("name",t.target.value),placeholder:"Write the task title",required:!0})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-description",children:[e.jsxs("span",{children:["Description ",e.jsx("span",{className:"todo-form__optional",children:"(optional)"})]}),e.jsx("textarea",{id:"task-description",value:c.description,onChange:t=>z("description",t.target.value),rows:3})]}),e.jsxs("div",{className:"todo-form__grid",children:[e.jsxs("label",{className:"todo-form__field",htmlFor:"task-start",children:[e.jsx("span",{children:"Start date"}),e.jsx("input",{id:"task-start",type:"date",value:c.startDate,onChange:t=>z("startDate",t.target.value)})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-due",children:[e.jsx("span",{children:"Due date"}),e.jsx("input",{id:"task-due",type:"date",value:c.dueDate,onChange:t=>z("dueDate",t.target.value)})]})]}),e.jsxs("label",{className:"todo-form__field",htmlFor:"task-category",children:[e.jsx("span",{children:"Category"}),e.jsx("select",{id:"task-category",value:c.category,onChange:t=>z("category",t.target.value),children:f.length===0?e.jsx("option",{value:c.category,children:le[c.category]??c.category}):f.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"todo-form__field todo-form__field--inline",htmlFor:"task-completed",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Status"}),e.jsx("p",{children:"Is the task complete?"})]}),e.jsx("input",{id:"task-completed",type:"checkbox",checked:c.isCompleted,onChange:t=>z("isCompleted",t.target.checked)})]}),e.jsxs("div",{className:"todo-form__actions",children:[e.jsx(A,{type:"button",variant:"outline",className:"todo-button todo-button--outline",onClick:ut,children:w?"Cancel edit":"Clear"}),e.jsx(A,{type:"submit",className:"todo-button todo-button--primary",disabled:b,children:b?"Saving…":w?"Save changes":"Save"})]}),K?e.jsx("p",{className:"todo-form__feedback",children:K}):null]})]}),e.jsxs("section",{className:"todo-list","aria-live":"polite","aria-busy":_,children:[e.jsx("header",{className:"todo-list__header",children:e.jsxs("div",{className:"todo-list__header-actions",children:[e.jsxs("label",{className:"todo-list__toggle",htmlFor:"toggle-show-blocked",children:[e.jsxs("div",{className:"todo-list__toggle-copy",children:[e.jsx("span",{children:"Show blocked tasks"}),e.jsx("p",{children:"Tasks that cannot be started yet"})]}),e.jsx("input",{id:"toggle-show-blocked",type:"checkbox",role:"switch","aria-checked":m,checked:m,onChange:t=>x(t.target.checked)})]}),e.jsxs("label",{className:"todo-list__toggle",htmlFor:"toggle-show-completed",children:[e.jsxs("div",{className:"todo-list__toggle-copy",children:[e.jsx("span",{children:"Show completed tasks"}),e.jsx("p",{children:"Tasks done"})]}),e.jsx("input",{id:"toggle-show-completed",type:"checkbox",role:"switch","aria-checked":h,checked:h,onChange:t=>N(t.target.checked)})]}),e.jsxs("dl",{className:"todo-list__stats",children:[e.jsxs("div",{className:"todo-list__stats-item todo-list__stats-item--blocked",children:[e.jsx("dt",{children:"Blocked"}),e.jsx("dd",{children:_e.blocked})]}),e.jsxs("div",{className:"todo-list__stats-item todo-list__stats-item--active",children:[e.jsx("dt",{children:"Active"}),e.jsx("dd",{children:_e.ready})]}),e.jsxs("div",{className:"todo-list__stats-item todo-list__stats-item--overdue",children:[e.jsx("dt",{children:"Overdue"}),e.jsx("dd",{children:_e.overdue})]})]}),e.jsx(A,{type:"button",variant:"outline",className:"todo-button todo-button--danger",onClick:()=>void ht(),disabled:X||pt===0,children:X?"Deleting…":"Delete selected"}),Ee?e.jsx("p",{className:"todo-list__feedback",role:"status",children:Ee}):null]})}),_?e.jsx("p",{className:"todo-list__status",children:"Loading tasks…"}):E?e.jsxs("div",{className:"todo-list__status todo-list__status--error",children:[e.jsx("p",{children:E}),e.jsx(A,{type:"button",size:"sm",className:"todo-button todo-button--outline todo-button--compact",onClick:()=>void q(),children:"Try again"})]}):a.length===0?e.jsx("div",{className:"todo-list__status",children:e.jsx("p",{children:"No tasks yet. Save your first task on the left."})}):e.jsx("div",{className:"todo-list__table-wrapper",children:e.jsxs("table",{className:"todo-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"todo-table__select-header",children:"Select"}),e.jsx("th",{scope:"col","aria-sort":ce("status"),children:ie("status","Status")}),e.jsx("th",{scope:"col",children:"Task"}),e.jsx("th",{scope:"col","aria-sort":ce("category"),children:ie("category","Category")}),e.jsx("th",{scope:"col",children:"Days left"}),e.jsx("th",{scope:"col","aria-sort":ce("start_date"),children:ie("start_date","Start date")}),e.jsx("th",{scope:"col","aria-sort":ce("due_date"),children:ie("due_date","Due date")})]})}),e.jsx("tbody",{children:it.map(t=>{const s=ve(t),n=`todo-status${s.modifier?` ${s.modifier}`:""}`,l=Nt(t.due_date),r=["todo-table__due-offset"];l<0?r.push("todo-table__due-offset--overdue"):l===0?r.push("todo-table__due-offset--today"):r.push("todo-table__due-offset--upcoming");const d=["todo-table__row"];return Qe(t.due_date,t.is_completed)&&d.push("todo-table__row--overdue"),w===t.id&&d.push("todo-table__row--selected"),e.jsxs("tr",{className:d.join(" "),onClick:()=>Je(t),onKeyDown:u=>ft(u,t),tabIndex:0,children:[e.jsx("td",{className:"todo-table__cell todo-table__cell--select",children:e.jsx("input",{type:"checkbox",className:"todo-table__select-input","aria-label":`Select task ${t.name}`,checked:Z.has(t.id),onChange:u=>gt(t.id,u.target.checked),onClick:u=>u.stopPropagation()})}),e.jsx("td",{className:"todo-table__cell todo-table__cell--status",children:e.jsx("span",{className:n,children:s.label})}),e.jsx("td",{className:"todo-table__cell todo-table__task",children:e.jsx("span",{className:"todo-table__task-name",children:t.name})}),e.jsx("td",{className:"todo-table__cell",children:e.jsx("span",{className:"todo-table__chip",children:le[t.category]??(t.category||"Uncategorized")})}),e.jsx("td",{className:"todo-table__cell todo-table__cell--due-offset",children:e.jsx("span",{className:r.join(" "),children:St(l)})}),e.jsx("td",{className:"todo-table__cell todo-table__cell--date",children:Ze(t.start_date)}),e.jsx("td",{className:"todo-table__cell todo-table__cell--date",children:e.jsx("span",{className:"todo-table__date-value",children:Ze(t.due_date)})})]},t.id)})})]})}),j?e.jsxs("p",{className:"todo-list__synced",children:["Last synced ",j.toLocaleTimeString()]}):null]})]})}):e.jsx("section",{className:"todo-empty","aria-live":"polite",children:e.jsxs("div",{className:"todo-empty__panel",children:[e.jsx("h3",{children:"Welcome"}),e.jsx("p",{children:"Use the Login button above to access and manage your personal task board."})]})})]})},tt=document.getElementById("root");if(!tt)throw new Error("Root element #root not found");ReactDOM.createRoot(tt).render(e.jsx(React.StrictMode,{children:e.jsx(Ct,{})}));
