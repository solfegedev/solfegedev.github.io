import"./index-CBYLtEE8.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{P as Ne,A as Ye}from"./Auth-uEj7rJlD.js";import{A as Me}from"./api-CH_Pe6Vg.js";import{D as Qe,U as et}from"./upload--Rbr-3Yq.js";import{C as De}from"./chevron-down-3_LVzg6l.js";import{P as Ie}from"./pencil-DHu_drsE.js";import{G as Re}from"./grip-vertical-BjGCJcsX.js";import{E as Oe}from"./external-link-Bw0ICscN.js";import{M as be}from"./map-BMvedaBo.js";import{T as Se}from"./trash-2-DQbJ9aIh.js";import{S as tt}from"./search-Cfl0sis-.js";import{f as st,b as at,e as rt,g as ot,u as Le,T as ve,M as nt,a as lt,P as it}from"./TileLayer-KcMz5fwj.js";import{L as pe}from"./LayersControl-bsTFKbeJ.js";import{u as ct,T as dt}from"./Toast-COaeoAQl.js";import{X as ut}from"./x-BS-d4QNZ.js";import{C as mt}from"./copy-CzC7y2Qs.js";import{c as pt}from"./createLucideIcon-DtX1aPOG.js";import{S as gt}from"./settings-G074OJw9.js";import{L as ht}from"./log-out-B0TqtotO.js";import{L as xt}from"./list-BhDG0LsZ.js";/* empty css                */import"./button-D6DGr86I.js";import"./clsx-B-dksMZM.js";import"./eye-Jn_UhOO1.js";import"./circle-check-F4iM422t.js";const ft=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],bt=pt("share-2",ft),wt=st(function({children:r,...o},c){const u=new L.LayerGroup([],o);return at(u,rt(c,{layerContainer:u}))}),yt=ot(function(r){return new L.Control.Zoom(r)}),v=`${Me}/maps`,k=()=>{const t=localStorage.getItem("map_token")||sessionStorage.getItem("map_token");return{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}}},b={login:async(t,r,o=!0)=>{const c=await fetch(`${v}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:r,remember:o})});if(!c.ok){const d=await c.json().catch(()=>({detail:"Login failed"}));throw new Error(d.detail||"Login failed")}const u=await c.json();return o?localStorage.setItem("map_token",u.access_token):sessionStorage.setItem("map_token",u.access_token),u},getMe:async()=>{const t=await fetch(`${v}/auth/me`,{headers:k(),credentials:"include"});if(!t.ok)throw new Error("Not authenticated");return t.json()},getLists:async()=>{const t=await fetch(`${v}/lists`,{headers:k(),credentials:"include"});if(!t.ok)throw new Error("Failed to fetch lists");return t.json()},createList:async t=>{const r=await fetch(`${v}/lists`,{method:"POST",headers:k(),credentials:"include",body:JSON.stringify({name:t})});if(!r.ok)throw new Error("Failed to create list");return r.json()},reorderLists:async t=>{const r=await fetch(`${v}/lists/reorder`,{method:"POST",headers:k(),credentials:"include",body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to reorder lists");return r.json()},deleteList:async t=>{const r=await fetch(`${v}/lists/${t}`,{method:"DELETE",headers:k(),credentials:"include"});if(!r.ok)throw new Error("Failed to delete list");return r.json()},getGroups:async t=>{const r=t?`${v}/groups?list_id=${t}`:`${v}/groups`,o=await fetch(r,{headers:k(),credentials:"include"});if(!o.ok)throw new Error("Failed to fetch groups");return o.json()},createGroup:async(t,r,o,c)=>{const u=await fetch(`${v}/groups`,{method:"POST",headers:k(),credentials:"include",body:JSON.stringify({name:t,color:r,list_id:o,note:c})});if(!u.ok)throw new Error("Failed to create group");return u.json()},updateGroup:async(t,r)=>{const o=await fetch(`${v}/groups/${t}`,{method:"PUT",headers:k(),credentials:"include",body:JSON.stringify(r)});if(!o.ok)throw new Error("Failed to update group");return o.json()},deleteGroup:async t=>{const r=await fetch(`${v}/groups/${t}`,{method:"DELETE",headers:k(),credentials:"include"});if(!r.ok)throw new Error("Failed to delete group");return r.json()},getItems:async t=>{const r=t?`${v}/items?list_id=${t}`:`${v}/items`,o=await fetch(r,{headers:k(),credentials:"include"});if(!o.ok)throw new Error("Failed to fetch items");return o.json()},createItem:async(t,r,o,c,u,d,p,w,m)=>{const f=await fetch(`${v}/items`,{method:"POST",headers:k(),credentials:"include",body:JSON.stringify({group_id:t,name:r,latitude:o,longitude:c,note:u,url_google:d,url_item:p,exclude_initial_map:w,visited:m})});if(!f.ok)throw new Error("Failed to create item");return f.json()},updateItem:async(t,r)=>{const o=await fetch(`${v}/items/${t}`,{method:"PUT",headers:k(),credentials:"include",body:JSON.stringify(r)});if(!o.ok)throw new Error("Failed to update item");return o.json()},deleteItem:async t=>{const r=await fetch(`${v}/items/${t}`,{method:"DELETE",headers:k(),credentials:"include"});if(!r.ok)throw new Error("Failed to delete item");return r.json()},reorderGroups:async t=>{const r=await fetch(`${v}/groups/reorder`,{method:"POST",headers:k(),credentials:"include",body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to reorder groups");return r.json()},reorderItems:async t=>{const r=await fetch(`${v}/items/reorder`,{method:"POST",headers:k(),credentials:"include",body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to reorder items");return r.json()},exportData:async()=>{const t=await fetch(`${v}/export`,{headers:k(),credentials:"include"});if(!t.ok)throw new Error("Export failed");const r=await t.blob(),o=window.URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download="map_data.yaml",c.click(),window.URL.revokeObjectURL(o)},importData:async t=>{const r=await fetch(`${v}/import`,{method:"POST",headers:{...k(),"Content-Type":"text/plain"},credentials:"include",body:t});if(!r.ok){const o=await r.json().catch(()=>({detail:"Import failed"}));throw new Error(o.detail||"Import failed")}return r.json()},logout:async()=>{try{await fetch(`${Me}/bookmarks/logout`,{method:"POST",credentials:"include"})}catch(t){console.error("Logout API call failed",t)}localStorage.removeItem("map_token"),sessionStorage.removeItem("map_token")},getSharedData:async t=>{const r=await fetch(`${v}/shared/${t}`);if(!r.ok)throw new Error("Failed to fetch shared list");return r.json()}},Pe=React.createContext(void 0),jt=({children:t})=>{const[r,o]=React.useState(null),[c,u]=React.useState([]),[d,p]=React.useState(null),[w,m]=React.useState([]),[f,l]=React.useState([]),[C,_]=React.useState(null),[V,x]=React.useState(!1),[E,R]=React.useState(!1),[G,M]=React.useState(null),[N,H]=React.useState(!0),[W,B]=React.useState(!1),[P,K]=React.useState(null),[ee,A]=React.useState(null),[ge,X]=React.useState("map"),T=(n,g,h)=>{h?localStorage.setItem("map_token",n):sessionStorage.setItem("map_token",n),o(g),y()},Z=(n,g=!0)=>{_(n),x(g)},Y=n=>{W||(p(n),m([]),l([]),n?localStorage.setItem("map_current_list_id",String(n.id)):localStorage.removeItem("map_current_list_id"))},y=async()=>{if(W&&P){try{const n=await b.getSharedData(P);u([n.list]),p(n.list),m(n.groups),l(n.items)}catch(n){console.error(n),A("Failed to load shared list")}return}try{const n=await b.getLists();u(n);let g=d;if(!g&&n.length>0){const h=localStorage.getItem("map_current_list_id");h?g=n.find(j=>j.id===Number(h))||n[0]:g=n[0],p(g)}if(g){const[h,j]=await Promise.all([b.getGroups(g.id),b.getItems(g.id)]);m(h),l(j)}else m([]),l([])}catch(n){console.error(n)}};React.useEffect(()=>{y()},[d?.id,W,P]),React.useEffect(()=>{(async()=>{const h=new URLSearchParams(window.location.search).get("share_token");if(h){B(!0),K(h),H(!1);return}const j=localStorage.getItem("map_token")||sessionStorage.getItem("map_token");try{const U=await b.getMe();o(U)}catch{j&&(localStorage.removeItem("map_token"),sessionStorage.removeItem("map_token"))}H(!1)})()},[]);const he=async(n,g)=>{A(null);try{await b.login(n,g);const h=await b.getMe();o(h),await y()}catch(h){throw A(h.message||"Login failed"),h}},te=async()=>{await b.logout(),o(null),u([]),p(null),m([]),l([])},se=async n=>{await b.createList(n),await y()},ae=async n=>{await b.reorderLists(n),await y()},xe=async n=>{await b.deleteList(n),d?.id===n&&(p(null),localStorage.removeItem("map_current_list_id")),await y()},re=async(n,g,h)=>{const j=await b.createGroup(n,g,d?.id||void 0,h);return await y(),j},oe=async(n,g)=>{await b.updateGroup(n,g),await y()},ne=async n=>{await b.deleteGroup(n),await y()},le=async(n,g,h,j,U,z,fe,we,me)=>{const F=await b.createItem(n,g,h,j,U,z,fe,we,me);return await y(),F},ie=async(n,g)=>{await b.updateItem(n,g),await y()},ce=async n=>{await b.deleteItem(n),await y()},J=async n=>{await b.reorderGroups(n),await y()},de=async n=>{await b.reorderItems(n),await y()},ue=async()=>{await b.exportData()},D=async n=>{await b.importData(n),await y()};return React.useEffect(()=>{(async()=>{const g=localStorage.getItem("map_token")||sessionStorage.getItem("map_token");try{const h=await b.getMe();o(h)}catch{g&&(localStorage.removeItem("map_token"),sessionStorage.removeItem("map_token"))}H(!1)})()},[]),e.jsx(Pe.Provider,{value:{user:r,lists:c,currentList:d,setCurrentList:Y,groups:w,items:f,selectedItem:C,setSelectedItem:Z,shouldFocusItem:V,showAddItem:E,setShowAddItem:R,editingItem:G,setEditingItem:M,isLoading:N,isReadOnly:W,shareToken:P,error:ee,login:he,logout:te,refreshData:y,createList:se,reorderLists:ae,deleteList:xe,createGroup:re,updateGroup:oe,deleteGroup:ne,createItem:le,updateItem:ie,deleteItem:ce,reorderGroups:J,reorderItems:de,exportData:ue,importData:D,mobileView:ge,setMobileView:X,handleAuthSuccess:T},children:t})},q=()=>{const t=React.useContext(Pe);if(t===void 0)throw new Error("useMap must be used within a MapProvider");return t},Ae={"red-500":"#ef4444","orange-500":"#f97316","amber-500":"#f59e0b","yellow-500":"#eab308","lime-500":"#84cc16","green-500":"#22c55e","emerald-500":"#10b981","teal-500":"#14b8a6","cyan-500":"#06b6d4","sky-500":"#0ea5e9","blue-500":"#3b82f6","indigo-500":"#6366f1","violet-500":"#8b5cf6","purple-500":"#a855f7","fuchsia-500":"#d946ef","pink-500":"#ec4899","rose-500":"#f43f5e","slate-500":"#64748b","gray-500":"#6b7280","zinc-500":"#71717a","neutral-500":"#737373","stone-500":"#78716c","red-600":"#dc2626","orange-600":"#ea580c","amber-600":"#d97706","yellow-600":"#ca8a04","lime-600":"#65a30d","green-600":"#16a34a","emerald-600":"#059669","teal-600":"#0d9488","cyan-600":"#0891b2","sky-600":"#0284c7","blue-600":"#2563eb","indigo-600":"#4f46e5","violet-600":"#7c3aed","purple-600":"#9333ea","fuchsia-600":"#c026d3","pink-600":"#db2777","rose-600":"#e11d48","slate-600":"#475569","gray-600":"#4b5563","zinc-600":"#52525b","neutral-600":"#525252","stone-600":"#57534e","red-400":"#f87171","orange-400":"#fb923c","amber-400":"#fbbf24","yellow-400":"#facc15","lime-400":"#a3e635","green-400":"#4ade80","emerald-400":"#34d399","teal-400":"#2dd4bf","cyan-400":"#22d3ee","sky-400":"#38bdf8","blue-400":"#60a5fa","indigo-400":"#818cf8","violet-400":"#a78bfa","purple-400":"#c084fc","fuchsia-400":"#e879f9","pink-400":"#f472b6","rose-400":"#fb7185","slate-400":"#94a3b8","gray-400":"#9ca3af","zinc-400":"#a1a1aa","neutral-400":"#a3a3a3","stone-400":"#a8a29e"},Te=t=>Ae[t]||t,vt="bg-red-200",ke="bg-gray-100",Nt=()=>{const{groups:t,items:r,currentList:o,selectedItem:c,setSelectedItem:u,createGroup:d,updateGroup:p,deleteGroup:w,createItem:m,updateItem:f,deleteItem:l,reorderGroups:C,reorderItems:_,exportData:V,importData:x,logout:E,isReadOnly:R,showAddItem:G,setShowAddItem:M,editingItem:N,setEditingItem:H}=q(),[W,B]=React.useState(!1),[P,K]=React.useState(""),[ee,A]=React.useState("blue-500"),[ge,X]=React.useState(""),[T,Z]=React.useState(null),[Y,y]=React.useState(""),[he,te]=React.useState(""),[se,ae]=React.useState(""),[xe,re]=React.useState(""),[oe,ne]=React.useState(!1),[le,ie]=React.useState(!1),[ce,J]=React.useState(""),[de,ue]=React.useState(""),[D,n]=React.useState(null),[g,h]=React.useState(null),[j,U]=React.useState(r),[z,fe]=React.useState(null),[we,me]=React.useState(null),[F,_e]=React.useState(t),[ye,Ue]=React.useState(new Set),je=()=>{y(""),te(""),ae(""),re(""),ne(!1),ie(!1),J(""),ue(""),H(null)};React.useEffect(()=>{console.log("Items in ListView:",r),U(r)},[r]),React.useEffect(()=>{_e(t)},[t]),React.useEffect(()=>{N&&(u(N),y(N.name),te(N.note||""),ae(N.url_google||""),re(N.url_item||""),ne(N.exclude_initial_map),ie(N.visited),ue(String(N.group_id)),J(N.latitude!==null&&N.latitude!==void 0?`${N.latitude}, ${N.longitude}`:""))},[N]);const ze=s=>{const a=new Set(ye);a.has(s)?a.delete(s):a.add(s),Ue(a)},Fe=s=>{n(s)},Ve=(s,a)=>{if(s.preventDefault(),D===null||D===a)return;const i=j.findIndex(Q=>Q.id===D),I=j.findIndex(Q=>Q.id===a);if(i===-1||I===-1)return;const S={...j[i]},O=j[I];S.group_id!==O.group_id&&(S.group_id=O.group_id);const $=[...j];$.splice(i,1),$.splice(I,0,S),U($)},Ee=async()=>{D!==null&&(n(null),h(null),await _(j.map(s=>({id:s.id,group_id:s.group_id}))))},Be=s=>{fe(s)},Ze=(s,a)=>{if(s.preventDefault(),z===null||z===a)return;const i=F.findIndex($=>$.id===z),I=F.findIndex($=>$.id===a);if(i===-1||I===-1)return;const S=[...F],[O]=S.splice(i,1);S.splice(I,0,O),_e(S)},Je=async()=>{z!==null&&(fe(null),me(null),await C(F.map(s=>s.id)))},qe=async s=>{s.preventDefault();const a=ge.trim()||null;T?await p(T.id,{name:P,color:ee,note:a}):await d(P,ee,a),K(""),A("blue-500"),X(""),Z(null),B(!1)},He=s=>{const i=s.trim().split(/[\s,]+/);if(i.length>=2){const I=parseFloat(i[0]),S=parseFloat(i[1]);if(!isNaN(I)&&!isNaN(S))return{lat:I,lng:S}}return null},Ge=s=>{if(!s)return"";try{const a=new URL(s),i=a.hostname==="maps.google.com"||a.hostname.includes("google.com")&&a.pathname.includes("/maps"),I=a.hostname.includes("booking.com");return i||I?a.origin+a.pathname:s}catch{return s}},We=async s=>{s.preventDefault();const a=He(ce);if(ce.trim()&&!a){alert("Invalid coordinates format. Please use 'lat, lng'.");return}let i=Number(de);if(!de){const $=t.find(Q=>Q.name.toUpperCase()==="DEFAULT");$?i=$.id:i=(await d("DEFAULT","gray-500","Default group for locations")).id}const I=he.trim()||null,S=Ge(se.trim())||null,O=Ge(xe.trim())||null;N?await f(N.id,{group_id:i,name:Y,latitude:a?.lat??null,longitude:a?.lng??null,note:I,url_google:S,url_item:O,exclude_initial_map:oe,visited:le}):await m(i,Y,a?.lat??null,a?.lng??null,I,S,O,oe,le),je(),M(!1)},Ke=()=>{const s=se.trim();if(!s)return;const a=s.match(/\/place\/([^/]+)/);a&&!Y.trim()&&y(decodeURIComponent(a[1].replace(/\+/g," ")));const i=s.match(/!3d(-?\d+(?:\.\d+)?)/),I=s.match(/!4d(-?\d+(?:\.\d+)?)/);if(i&&I)J(`${i[1]}, ${I[1]}`);else{const S=s.match(/@(-?\d+(?:\.\d+)?),(-?\d+(?:\.\d+)?)/);S&&J(`${S[1]}, ${S[2]}`)}},Xe=async s=>{const a=s.target.files?.[0];if(a){const i=await a.text();await x(i)}};return e.jsxs("div",{className:"flex h-full flex-col overflow-y-auto bg-white p-4",children:[!R&&e.jsx("div",{className:"mb-4 border-b pb-4",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("button",{"data-testid":"add-group-button",onClick:()=>{Z(null),K(""),A("blue-500"),X(""),B(!0)},className:"flex flex-col items-center justify-center gap-1 rounded-lg border border-blue-100 bg-blue-50/50 py-2 text-[10px] font-bold text-blue-700 transition-colors hover:bg-blue-50",title:"Add Group",children:[e.jsx(Ne,{size:14}),"Group"]}),e.jsxs("button",{"data-testid":"add-location-button",onClick:()=>{je(),M(!0)},className:"flex flex-col items-center justify-center gap-1 rounded-lg border border-green-100 bg-green-50/50 py-2 text-[10px] font-bold text-green-700 transition-colors hover:bg-green-50",title:"Add Location",children:[e.jsx(Ne,{size:14}),"Location"]}),e.jsxs("button",{onClick:V,className:"flex flex-col items-center justify-center gap-1 rounded-lg border border-gray-100 bg-gray-50 py-2 text-[10px] font-bold text-gray-600 transition-colors hover:bg-gray-100",title:"Export Data",children:[e.jsx(Qe,{size:14}),"Export"]}),e.jsxs("label",{className:"flex cursor-pointer flex-col items-center justify-center gap-1 rounded-lg border border-gray-100 bg-gray-50 py-2 text-[10px] font-bold text-gray-600 transition-colors hover:bg-gray-100",title:"Import Data",children:[e.jsx(et,{size:14}),"Import",e.jsx("input",{type:"file",className:"hidden",accept:".yaml,.yml",onChange:Xe})]})]})}),e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"text-xl font-bold",children:"Locations"})}),e.jsxs("div",{className:"flex-1 space-y-4",children:[F.length===0&&e.jsxs("div",{className:"py-10 text-center text-gray-500",children:[e.jsx("p",{children:"No groups yet."}),e.jsx("p",{className:"text-sm",children:"Create a group to start adding locations."})]}),F.map(s=>e.jsxs("div",{"data-testid":`group-container-${s.id}`,draggable:!R&&we===s.id,onDragStart:()=>Be(s.id),onDragOver:a=>{z!==null&&Ze(a,s.id)},onDragEnd:Je,className:`rounded-lg border border-gray-100 bg-gray-50/30 p-4 shadow-sm transition-all hover:shadow-md ${z===s.id?"opacity-30":""}`,children:[e.jsxs("div",{className:"mb-3 flex cursor-pointer items-center justify-between",onClick:()=>ze(s.id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{size:18,className:`mr-2 text-gray-400 transition-transform ${ye.has(s.id)?"-rotate-90":""}`}),e.jsx("div",{className:"mr-3 h-3 w-3 rounded-full shadow-sm ring-2 ring-white",style:{backgroundColor:Te(s.color)}}),e.jsx("h3",{className:"font-bold text-gray-800",children:s.name})]}),e.jsxs("div",{className:"ml-4 flex flex-1 items-center justify-between gap-2",children:[e.jsxs("span",{className:"rounded-full border bg-white px-2 py-0.5 text-xs font-medium text-gray-400",children:[j.filter(a=>a.group_id===s.id).length," items"]}),!R&&e.jsxs("div",{className:"flex items-center gap-1",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),K(s.name),A(s.color),X(s.note||""),Z(s),B(!0)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Edit Group",children:e.jsx(Ie,{size:14})}),e.jsx("div",{"data-testid":`group-grip-${s.id}`,className:"cursor-grab p-0.5 text-gray-400 transition-colors hover:text-gray-600 active:cursor-grabbing",onMouseDown:()=>me(s.id),onMouseUp:()=>me(null),children:e.jsx(Re,{size:14})})]})]})]}),!ye.has(s.id)&&e.jsxs(e.Fragment,{children:[s.note&&e.jsx("div",{className:"mb-3 line-clamp-2 pl-6 text-xs whitespace-pre-wrap text-gray-500 italic transition-all hover:line-clamp-none",children:s.note}),e.jsx("ul",{"data-testid":`group-items-${s.id}`,className:"min-h-[20px] space-y-2 pl-6",onDragOver:a=>{a.preventDefault()},onDrop:a=>{if(a.preventDefault(),D===null)return;const i=j.findIndex(O=>O.id===D);if(i===-1)return;const I=j[i];if(I.group_id===s.id)return;const S=[...j];S[i]={...I,group_id:s.id},U(S),Ee()},children:j.filter(a=>a.group_id===s.id).map(a=>e.jsxs("li",{"data-testid":`item-${a.id}`,"data-visited":a.visited,onClick:()=>u(a),draggable:!R&&g===a.id,onDragStart:i=>{i.stopPropagation(),Fe(a.id)},onDragOver:i=>{i.stopPropagation(),Ve(i,a.id)},onDragEnd:Ee,className:`group/item flex cursor-pointer items-center justify-between rounded-md p-1.5 text-sm transition-colors hover:bg-white/50 ${c?.id===a.id?"bg-blue-50 shadow-sm ring-1 ring-blue-200":a.visited?ke:a.latitude===void 0||a.latitude===null?vt:"text-gray-600"} ${D===a.id?"opacity-30":""}`,children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[e.jsx("div",{className:`truncate font-medium ${c?.id===a.id?"text-blue-600":""} ${a.visited?"line-through opacity-70":""}`,children:a.name}),c?.id===a.id&&a.note&&e.jsx("div",{className:"mt-1 text-xs whitespace-pre-wrap text-gray-500 italic",children:a.note})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[a.url_item&&e.jsx("a",{href:a.url_item,target:"_blank",rel:"noopener noreferrer",onClick:i=>i.stopPropagation(),className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Open Item URL",children:e.jsx(Oe,{size:14})}),(a.url_google||a.latitude!==null&&a.latitude!==void 0)&&e.jsx("a",{href:a.url_google||`https://www.google.com/maps/search/?api=1&query=${a.latitude},${a.longitude}`,target:"_blank",rel:"noopener noreferrer",onClick:i=>i.stopPropagation(),className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Open in Google Maps",children:e.jsx(be,{size:14})}),!R&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),H(a),M(!0)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Edit",children:e.jsx(Ie,{size:14})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),l(a.id)},className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-red-50 hover:text-red-500",children:e.jsx(Se,{size:14})}),e.jsx("div",{"data-testid":`item-grip-${a.id}`,className:"cursor-grab p-0.5 text-gray-400 transition-colors hover:text-gray-600 active:cursor-grabbing",onMouseDown:()=>h(a.id),onMouseUp:()=>h(null),children:e.jsx(Re,{size:14})})]})]})]},a.id))})]})]},s.id))]}),W&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-sm rounded-lg bg-white p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold",children:T?"Edit Group":"Add Group"}),T&&e.jsx("button",{onClick:async()=>{confirm("Delete this group and all its items?")&&(await w(T.id),B(!1),Z(null))},className:"rounded-lg p-1 text-gray-400 hover:bg-red-50 hover:text-red-500",title:"Delete Group",children:e.jsx(Se,{size:18})})]}),e.jsxs("form",{onSubmit:qe,children:[e.jsx("input",{className:"mb-4 w-full rounded border p-2",placeholder:"Group Name",value:P,onChange:s=>K(s.target.value),"data-testid":"group-name-input",required:!0}),e.jsx("textarea",{className:"mb-4 w-full rounded border p-2 text-sm",placeholder:"Note (optional)",value:ge,onChange:s=>X(s.target.value),rows:3}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"mb-2 block text-xs font-medium text-gray-500",children:"Select Color"}),e.jsx("div",{className:"grid max-h-48 grid-cols-6 gap-2 overflow-y-auto rounded border p-2",children:Object.entries(Ae).map(([s,a])=>e.jsx("button",{type:"button",title:s,onClick:()=>A(s),className:`h-8 w-8 rounded-full border-2 transition-all ${ee===s?"scale-110 border-black shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:a}},s))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{B(!1),Z(null)},className:"flex-1 rounded border p-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 rounded bg-blue-600 p-2 text-white",children:T?"Save":"Add"})]})]})]})}),G&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"w-full max-w-sm rounded-lg bg-white p-6",children:[e.jsx("h3",{className:"mb-4 text-lg font-bold",children:N?"Edit Location":"Add Location"}),e.jsxs("form",{onSubmit:We,children:[e.jsx("label",{htmlFor:"group-select",className:"mb-1 block text-xs font-medium text-gray-500",children:"Group"}),e.jsxs("select",{id:"group-select","data-testid":"group-select",className:"mb-4 w-full rounded border p-2",value:de,onChange:s=>ue(s.target.value),children:[e.jsx("option",{value:"",children:"Select Group"}),t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("input",{className:"mb-4 w-full rounded border p-2",placeholder:"Location Name",value:Y,onChange:s=>y(s.target.value),"data-testid":"location-name-input",required:!0}),e.jsx("textarea",{className:"mb-4 w-full rounded border p-2 text-sm",placeholder:"Note (optional)",value:he,onChange:s=>te(s.target.value),rows:3}),e.jsxs("div",{className:"mb-4 flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded border p-2 text-sm",placeholder:"Google Maps URL (optional)",value:se,onChange:s=>ae(s.target.value),"data-testid":"location-url-input"}),e.jsx("button",{type:"button",onClick:Ke,"data-testid":"extract-url-button",className:"flex items-center justify-center rounded bg-gray-100 px-3 text-gray-600 hover:bg-gray-200",title:"Extract name and coordinates from URL",children:e.jsx(tt,{size:16})})]}),e.jsx("input",{className:"mb-4 w-full rounded border p-2 text-sm",placeholder:"Item URL (optional)",value:xe,onChange:s=>re(s.target.value),"data-testid":"item-url-input"}),e.jsx("input",{type:"text",className:"mb-4 w-full rounded border p-2",placeholder:"Coordinates (lat, lng)",value:ce,onChange:s=>J(s.target.value),"data-testid":"location-coordinates-input"}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"exclude-initial-map",checked:oe,onChange:s=>ne(s.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"exclude-initial-map",className:"text-sm text-gray-600 select-none",children:"Exclude from Initial Map View"})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"item-visited",checked:le,onChange:s=>ie(s.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500","data-testid":"location-visited-checkbox"}),e.jsx("label",{htmlFor:"item-visited",className:"text-sm text-gray-600 select-none",children:"Visited"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{M(!1),je()},className:"flex-1 rounded border p-2",children:"Cancel"}),e.jsx("button",{type:"submit","data-testid":"save-item-button",className:"flex-1 rounded bg-blue-600 p-2 text-white",children:N?"Save":"Add"})]})]})]})})]})},Ce=13,It=[51.505,-.09],St=3,$e={duration:.5},kt=()=>{const t=Le(),{items:r,setSelectedItem:o}=q();return React.useEffect(()=>{const c=new L.Control({position:"topleft"});return c.onAdd=()=>{const u=L.DomUtil.create("div","leaflet-bar leaflet-control"),d=L.DomUtil.create("a","leaflet-control-reset",u);return d.innerHTML='<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display: block;"><path d="m21 21-6-6m6 6v-4.8m0 4.8h-4.8M3 16.2V21m0 0h4.8M3 21l6-6M21 7.8V3m0 0h-4.8M21 3l-6 6M3 7.8V3m0 0h4.8M3 3l6 6"/></svg>',d.href="#",d.title="Reset View",d.style.backgroundColor="white",d.style.cursor="pointer",d.style.width="30px",d.style.height="30px",d.style.lineHeight="30px",L.DomEvent.on(d,"click",p=>{L.DomEvent.stop(p),o(null);const w=r.filter(m=>m.latitude!==null&&m.latitude!==void 0&&!m.exclude_initial_map);if(w.length>0){const m=L.latLngBounds(w.map(f=>[f.latitude,f.longitude]));t.flyToBounds(m,{padding:[50,50],maxZoom:Ce})}else t.flyTo(It,St)}),u},t.addControl(c),()=>{t.removeControl(c)}},[t,r,o]),null},Ct=()=>{const t=Le(),{items:r,selectedItem:o,shouldFocusItem:c,currentList:u,mobileView:d}=q(),p=React.useRef(null),w=React.useRef(null),m=React.useRef(!1);return React.useEffect(()=>{const f=t.getContainer();if(f.clientWidth===0||f.clientHeight===0)return;d==="map"&&t.invalidateSize();const l=o?.id??null,C=u?.id??null;w.current!==C&&(m.current=!1,w.current=C);const V=p.current!==l,E=r.filter(G=>G.latitude!==null&&G.latitude!==void 0).filter(G=>!G.exclude_initial_map);if((E.length>0||o&&o.latitude!==null)&&(!m.current||V)){if(o&&o.latitude!==null&&o.latitude!==void 0&&(c||!m.current)){const G=m.current?t.getZoom():Ce;t.flyTo([o.latitude,o.longitude],G,$e)}else if(E.length>0&&!o){const G=L.latLngBounds(E.map(M=>[M.latitude,M.longitude]));t.flyToBounds(G,{padding:[50,50],maxZoom:Ce,...$e})}p.current=l,m.current=!0}},[r,o,c,u,t,d]),null},Lt=({children:t})=>e.jsxs(pe,{position:"topright",children:[e.jsx(pe.BaseLayer,{checked:!0,name:"Map",children:e.jsx(ve,{attribution:"Esri, HERE, Garmin, Intermap, increment P Corp., GEBCO, USGS, FAO, NPS, NRCAN, GeoBase, IGN, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), (c) OpenStreetMap contributors, and the GIS User Community",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",maxZoom:19})}),e.jsx(pe.BaseLayer,{name:"3D Terrain",children:e.jsx(ve,{attribution:'<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png",maxZoom:20})}),e.jsx(pe.BaseLayer,{name:"Satellite",children:e.jsx(ve,{attribution:"Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, GIS",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})}),t]}),_t=()=>{const t=Le();return React.useEffect(()=>{window.leafletMap=t},[t]),null},Et=(t,r,o,c)=>{const u=Te(r);let d=o?"bg-blue-600 text-white":"bg-white text-gray-900";!o&&c&&(d=`${ke} text-gray-500`);const p=o?"bg-blue-600":c?ke:"bg-white",w=c?"line-through":"",m=u;return new L.DivIcon({className:"custom-div-icon",html:`
      <div class="flex items-center justify-center transition-all duration-300 ${o?"scale-125 z-50":"hover:scale-110"}">
        <div class="px-2 py-1 rounded-lg font-black text-xs shadow-lg border-2 whitespace-nowrap ${d} ${w}" style="border-color: ${m}">
          ${t}
        </div>
        <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45 border-r-2 border-b-2 ${p}" style="border-color: ${m}"></div>
      </div>
    `,iconSize:[100,30],iconAnchor:[50,30]})},Gt=()=>{const{groups:t,items:r,selectedItem:o,setSelectedItem:c,setShowAddItem:u,setEditingItem:d,isReadOnly:p,setMobileView:w}=q();return e.jsx("div",{className:"h-full w-full",children:e.jsxs(nt,{center:[51.505,-.09],zoom:3,style:{height:"100%",width:"100%"},className:"z-0",zoomControl:!1,attributionControl:!1,zoomSnap:0,doubleClickZoom:!1,children:[e.jsxs(Lt,{children:[e.jsx(_t,{}),t.map(m=>{const f=r.filter(l=>l.group_id===m.id&&l.latitude!==null&&l.latitude!==void 0&&l.longitude!==null&&l.longitude!==void 0&&!l.visited);return console.log(`Group ${m.name} has ${f.length} items on map (total ${r.filter(l=>l.group_id===m.id).length})`),f.length===0?null:e.jsx(pe.Overlay,{checked:!0,name:m.name,children:e.jsx(wt,{children:f.map(l=>{const C=o?.id===l.id;return console.log(`Rendering marker for ${l.name}, visited: ${l.visited}`),e.jsx(lt,{position:[l.latitude,l.longitude],icon:Et(l.name,l.group_color||"#3b82f6",C,l.visited),zIndexOffset:C?1e3:0,eventHandlers:{click:()=>c(l,!0)},children:e.jsx(it,{children:e.jsxs("div",{className:"min-w-[150px] text-center",children:[e.jsx("div",{className:"mb-1 border-b pb-1 font-bold",children:l.name}),l.note&&e.jsx("div",{className:"mb-2 text-xs whitespace-pre-wrap text-gray-600 italic",children:l.note}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[l.url_item&&e.jsx("a",{href:l.url_item,target:"_blank",rel:"noopener noreferrer",onClick:_=>_.stopPropagation(),className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Open Item URL",children:e.jsx(Oe,{className:"size-4"})}),e.jsx("a",{href:l.url_google||`https://www.google.com/maps/search/?api=1&query=${l.latitude},${l.longitude}`,target:"_blank",rel:"noopener noreferrer",onClick:_=>_.stopPropagation(),className:"rounded-lg p-1 text-gray-400 transition-all hover:bg-blue-50 hover:text-blue-500",title:"Open in Google Maps",children:e.jsx(be,{className:"size-4"})}),!p&&e.jsx("button",{onClick:()=>{d(l),u(!0),w("list")},className:"flex items-center justify-center text-gray-600 transition-colors hover:text-indigo-600",title:"Edit Location",children:e.jsx(Ie,{className:"size-4"})})]})]})})},l.id)})})},m.id)})]}),e.jsx(yt,{position:"topleft"}),e.jsx(kt,{}),e.jsx(Ct,{})]})})},Rt=({onClose:t})=>{const{lists:r,createList:o,deleteList:c,currentList:u,setCurrentList:d}=q(),{successToast:p}=ct(),[w,m]=React.useState(""),[f,l]=React.useState(null),C=async x=>{x.preventDefault(),w.trim()&&(await o(w),m(""))},_=async(x,E)=>{window.confirm(`Are you sure you want to delete "${E}" and all its groups/points?`)&&await c(x)},V=(x,E)=>{const R=`${window.location.origin}${window.location.pathname}?share_token=${x}`;navigator.clipboard.writeText(R),l(E),p("Share link copied to clipboard!"),setTimeout(()=>l(null),2e3)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"flex max-h-full w-full max-w-md flex-col rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b p-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Manage Lists"}),e.jsx("button",{onClick:t,className:"rounded-lg p-1 hover:bg-gray-100",children:e.jsx(ut,{className:"h-5 w-5 text-gray-500"})})]}),e.jsxs("div",{"data-testid":"list-manager-content",className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("form",{onSubmit:C,className:"mb-6 flex gap-2",children:[e.jsx("input",{autoFocus:!0,className:"flex-1 rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:outline-none",placeholder:"New list name...",value:w,onChange:x=>m(x.target.value),"data-testid":"new-list-input"}),e.jsx("button",{type:"submit",className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200 transition-all hover:bg-blue-700",children:e.jsx(Ne,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Your Lists"}),r.length===0&&e.jsx("p",{className:"py-4 text-center text-sm text-gray-500",children:"No lists created yet."}),r.map(x=>e.jsxs("div",{onClick:()=>{d(x),t()},className:`group flex cursor-pointer items-center justify-between rounded-xl border p-3 transition-all hover:border-gray-200 hover:bg-white hover:shadow-sm ${u?.id===x.id?"border-blue-200 bg-blue-50/50 shadow-sm":"border-gray-100 bg-gray-50"}`,children:[e.jsx("span",{className:"font-bold text-gray-700",children:x.name}),e.jsxs("div",{className:"flex gap-1",onClick:E=>E.stopPropagation(),children:[e.jsx("button",{onClick:()=>V(x.share_token,x.id),className:`rounded-lg p-1.5 transition-all ${f===x.id?"bg-green-100 text-green-600":"text-gray-400 hover:bg-blue-50 hover:text-blue-600"}`,title:"Copy Share Link",children:f===x.id?e.jsx(mt,{className:"h-4 w-4"}):e.jsx(bt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(x.id,x.name),className:"rounded-lg p-1.5 text-gray-400 hover:bg-red-50 hover:text-red-500",children:e.jsx(Se,{className:"h-4 w-4"})})]})]},x.id))]})]}),e.jsx("div",{className:"border-t p-4",children:e.jsx("button",{onClick:t,className:"w-full rounded-xl bg-gray-100 py-2.5 text-sm font-bold text-gray-600 transition-all hover:bg-gray-200",children:"Done"})})]})})},$t=()=>{const{user:t,lists:r,currentList:o,setCurrentList:c,logout:u,isReadOnly:d,mobileView:p,setMobileView:w}=q(),[m,f]=React.useState(!1);return e.jsxs("header",{className:"z-30 flex flex-col justify-between gap-4 border-b border-gray-200 bg-white px-4 py-3 shadow-sm md:flex-row md:items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg",children:e.jsx(be,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-extrabold tracking-tight text-gray-900",children:"Maps"}),e.jsx("p",{className:"text-xs font-medium tracking-wider text-gray-500 uppercase",children:o?.name||"No list selected"})]})]}),e.jsxs("div",{className:"flex flex-1 items-center justify-between gap-2",children:[d?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"rounded-full bg-blue-50 px-3 py-1 text-xs font-bold text-blue-600 uppercase",children:"Shared List"}),e.jsx("button",{onClick:()=>{window.location.href=window.location.pathname},className:"text-sm font-bold text-gray-500 hover:text-blue-600 hover:underline",children:"Back to My Maps"})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"list-select",className:"ml-2 hidden text-xs font-black tracking-tight text-gray-400 uppercase md:block",children:"List"}),e.jsxs("div",{className:"group relative",children:[e.jsxs("select",{id:"list-select",value:o?.id||"",onChange:l=>{const C=r.find(_=>_.id===Number(l.target.value));C&&c(C)},className:"relative cursor-pointer appearance-none rounded-xl border border-gray-200 bg-gray-50 px-4 py-2 pr-10 text-sm font-bold text-blue-600 transition-all focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:[r.length===0&&e.jsx("option",{value:"",children:"No lists"}),r.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsx("div",{className:"pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-blue-600",children:e.jsx(De,{className:"h-4 w-4"})})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex h-9 items-center justify-center gap-2 rounded-xl bg-gray-100 px-2 text-gray-600 transition-all hover:bg-gray-200 md:px-3",title:"Manage Lists",children:[e.jsx(gt,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden text-sm font-semibold md:block",children:"Settings"})]}),e.jsxs("div",{className:"ml-4 flex items-center gap-2",children:[e.jsx("span",{className:"hidden text-sm font-semibold text-gray-600 md:block",children:t?.first_name}),e.jsx("button",{onClick:u,className:"flex h-9 w-9 items-center justify-center rounded-xl text-gray-500 transition-colors hover:bg-red-50 hover:text-red-500",title:"Logout",children:e.jsx(ht,{className:"h-5 w-5"})})]})]}),e.jsx("button",{onClick:()=>w(p==="map"?"list":"map"),className:"flex h-9 items-center justify-center gap-2 rounded-xl bg-blue-600 px-3 text-white transition-all hover:bg-blue-700 md:hidden",title:p==="map"?"Show List":"Show Map",children:p==="map"?e.jsx(xt,{className:"h-5 w-5"}):e.jsx(be,{className:"h-5 w-5"})})]}),m&&e.jsx(Rt,{onClose:()=>f(!1)})]})},Mt=()=>{const{user:t,isLoading:r,mobileView:o,handleAuthSuccess:c}=q();if(r)return e.jsx("div",{className:"flex h-screen items-center justify-center",children:"Loading..."});if(!t)return e.jsx(Ye,{appName:"Maps",loginEndpoint:"/maps/auth/login",registerEndpoint:"/maps/auth/register",onSuccess:(d,p)=>c(d.access_token,d.user,p)});const u=()=>{window.leafletMap?.closePopup()};return e.jsxs("div",{className:"flex h-screen w-full flex-col overflow-hidden bg-gray-50",children:[e.jsx("div",{onClick:u,children:e.jsx($t,{})}),e.jsxs("main",{className:"relative flex flex-1 flex-col overflow-hidden md:flex-row",children:[e.jsx("div",{onClick:u,className:`h-full border-r border-gray-200 bg-white md:w-1/3 ${o==="list"?"block":"hidden md:block"}`,children:e.jsx(Nt,{})}),e.jsx("div",{className:`relative h-full overflow-hidden md:w-2/3 ${o==="map"?"block":"hidden md:block"}`,children:e.jsx(Gt,{})})]})]})};function Dt(){return e.jsx(dt,{children:e.jsx(jt,{children:e.jsx(Mt,{})})})}ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Dt,{})}));
