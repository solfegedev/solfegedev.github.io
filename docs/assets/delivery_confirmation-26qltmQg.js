import"./index-BcvDAENL.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as Re}from"./api-CH_Pe6Vg.js";const q=1,B=["free","plus","pro"],I={free:"Free",plus:"Plus",pro:"Pro"},Ae=({authMode:t,email:i,password:d,roleSelection:o,showPassword:c,loadingAuth:n,resettingPassword:u,authError:m,resetFlash:l,switchAuthMode:f,setEmail:p,setPassword:N,setRoleSelection:b,setShowPassword:s,handleAuthSubmit:g,handlePasswordReset:y})=>e.jsxs("section",{className:"w-full max-w-[520px] rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)] mx-auto grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-50",children:t==="login"?"Sign in":"Create account"}),e.jsx("p",{className:"m-0 text-slate-300",children:t==="login"?"Use your email to manage or confirm deliveries.":"Register with your email; new accounts start on a Free membership."})]}),e.jsxs("div",{className:"inline-flex w-fit gap-2 rounded-xl bg-white/5 p-1 text-sm font-semibold",role:"tablist","aria-label":"Authentication mode",children:[e.jsx("button",{type:"button",role:"tab","aria-selected":t==="login",className:t==="login"?"rounded-lg bg-cyan-200/10 px-3 py-2 text-slate-50":"rounded-lg px-3 py-2 text-slate-300 hover:text-slate-50",onClick:()=>f("login"),children:"Sign in"}),e.jsx("button",{type:"button",role:"tab","aria-selected":t==="register",className:t==="register"?"rounded-lg bg-cyan-200/10 px-3 py-2 text-slate-50":"rounded-lg px-3 py-2 text-slate-300 hover:text-slate-50",onClick:()=>f("register"),children:"Register"})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:g,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"email",children:"Email address"}),e.jsx("input",{id:"email",name:"email",type:"email",value:i,onChange:j=>p(j.target.value),placeholder:"you@example.com",className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:outline-none focus:ring-2 focus:ring-cyan-300/60",required:!0,autoComplete:t==="login"?"username":"email"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative grid items-center",children:[e.jsx("input",{id:"password",name:"password",type:c?"text":"password",value:d,onChange:j=>N(j.target.value),className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:outline-none focus:ring-2 focus:ring-cyan-300/60",required:!0,autoComplete:t==="login"?"current-password":"new-password",minLength:t==="register"?q:void 0}),e.jsx("button",{type:"button",className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-slate-400 transition hover:text-slate-100 focus:outline-none","aria-label":c?"Hide characters":"Show characters","aria-controls":"password","aria-pressed":c,onMouseDown:()=>s(!0),onMouseUp:()=>s(!1),onMouseLeave:()=>s(!1),onBlur:()=>s(!1),onTouchStart:()=>s(!0),onTouchEnd:()=>s(!1),onTouchCancel:()=>s(!1),"aria-live":"polite",children:"ðŸ‘"})]})]}),t==="register"&&e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"role",children:"Choose your role"}),e.jsxs("div",{className:"grid gap-1.5",role:"radiogroup","aria-label":"Role",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 text-slate-200 font-semibold",children:[e.jsx("input",{type:"radio",name:"role",value:"shop",checked:o==="shop",onChange:()=>b("shop")}),"Shop â€” create deliveries"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-slate-200 font-semibold",children:[e.jsx("input",{type:"radio",name:"role",value:"driver",checked:o==="driver",onChange:()=>b("driver")}),"Driver â€” confirm deliveries"]})]}),e.jsx("p",{className:"m-0 text-sm text-slate-400",children:"All new accounts start on the Free membership."})]}),m&&e.jsx("div",{className:"rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-rose-100",children:m}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"inline-flex items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:n,children:n?t==="login"?"Signing in...":"Creating account...":t==="login"?"Sign in":"Register"}),t==="login"&&e.jsx("button",{className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-3 font-bold text-slate-100 hover:border-slate-300/50",type:"button",onClick:y,disabled:u||n,children:u?"Requesting...":"Forgot password?"})]}),l&&e.jsx("div",{className:"rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",children:l})]})]}),Ee=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),S=t=>{const i=typeof t=="string"?new Date(t):t;return Ee.format(i)},te=t=>t==="pending"?"Pending":t==="validated"?"Complete":"Locked",Fe=(t,i,d)=>t==="validated"&&i?"Code accepted â€” this delivery is now complete.":t==="locked"?"Maximum attempts reached. Delivery is locked.":i?"Attempt verified.":d===1?"Incorrect code. One attempt left.":`Incorrect code. ${d} attempts left.`,Ie=({attemptDeliveryId:t,attemptCode:i,attemptResult:d,attemptError:o,submittingAttempt:c,handleSubmitAttempt:n,onAttemptDeliveryIdChange:u,onAttemptCodeChange:m})=>e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-cyan-200/45 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_20px_45px_rgba(34,211,238,0.22)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Validate a delivery"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Enter the delivery ID and the 6-digit code provided by the shop team."})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:n,children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"deliveryId",children:"Delivery ID"}),e.jsx("input",{id:"deliveryId",name:"deliveryId",type:"text",inputMode:"numeric",pattern:"^[0-9]+$",className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:outline-none focus:ring-2 focus:ring-cyan-300/60",value:t,onChange:l=>u(l.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"secretCode",children:"Secret code"}),e.jsx("input",{id:"secretCode",name:"secretCode",type:"text",inputMode:"numeric",autoComplete:"one-time-code",pattern:"^[0-9]{6}$",maxLength:6,className:"w-full rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:outline-none focus:ring-2 focus:ring-cyan-300/60",value:i,onChange:l=>m(l.target.value),required:!0})]})]}),e.jsx("button",{className:"inline-flex w-fit items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:c,children:c?"Submitting...":"Submit attempt"}),o&&e.jsx("div",{className:"rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-rose-100",children:o}),d&&e.jsxs("div",{className:d.success?"grid gap-1 rounded-[14px] border border-emerald-400/40 bg-emerald-400/10 px-3 py-2 text-slate-100":"grid gap-1 rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",children:[e.jsxs("div",{className:"font-bold",children:["Attempt ",d.attempt_number," Â· Delivery ",d.delivery_id]}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:Fe(d.status,d.success,d.remaining_attempts)})]})]})]}),Le=({group:t,expanded:i,onToggle:d})=>{const o=t.attempts[0],c=t.status==="validated"?"rounded-full bg-emerald-400/20 px-3 py-1 text-sm font-bold text-emerald-300":t.status==="locked"?"rounded-full bg-rose-400/15 px-3 py-1 text-sm font-bold text-rose-300":"rounded-full bg-cyan-200/20 px-3 py-1 text-sm font-bold text-cyan-200";return e.jsxs("article",{className:"grid gap-3 rounded-2xl border border-slate-400/35 bg-slate-800/70 p-4 shadow-[0_10px_30px_rgba(0,0,0,0.25)]",children:[e.jsxs("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-slate-400",children:["Delivery ",t.delivery_id]}),e.jsx("h3",{className:"mt-0.5 text-lg font-semibold text-slate-50",children:t.address}),o&&e.jsxs("p",{className:"m-0 text-sm text-slate-400",children:["Last attempt #",o.attempt_number," Â· ",S(o.created_at)]})]}),e.jsx("span",{className:c,children:te(t.status)})]}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm sm:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Total attempts"}),e.jsx("dd",{className:"m-0 text-slate-100",children:t.attempts.length})]}),o&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm sm:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Latest result"}),e.jsx("dd",{className:o.success?"m-0 inline-flex items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"m-0 inline-flex items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:o.success?"Verified":"Failed"})]})]}),e.jsx("footer",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",onClick:()=>d(t.delivery_id),children:i?"Hide attempts":"View attempts"})}),i&&e.jsxs("div",{className:"overflow-hidden rounded-xl border border-slate-400/35",children:[e.jsxs("div",{className:"grid grid-cols-[60px,1fr,1fr] gap-2 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-200 sm:text-base",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:"When"}),e.jsx("span",{children:"Result"})]}),t.attempts.map(n=>e.jsxs("div",{className:"grid grid-cols-[60px,1fr,1fr] items-center gap-2 border-t border-slate-400/35 px-3 py-2 text-sm text-slate-100 sm:text-base",children:[e.jsx("span",{children:n.attempt_number}),e.jsx("span",{children:S(n.created_at)}),e.jsx("span",{className:n.success?"inline-flex w-fit items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"inline-flex w-fit items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:n.success?"Verified":"Failed"})]},`${n.delivery_id}-${n.attempt_number}`))]})]},t.delivery_id)},Te=({driverAttemptGroups:t,expandedDriverDeliveries:i,toggleDriverDeliveryExpansion:d})=>e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Recent attempts"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Your attempts grouped by delivery"})]}),t.length===0?e.jsx("p",{className:"m-0 text-slate-400",children:"No attempts logged yet."}):e.jsx("div",{className:"grid gap-3",children:t.map(o=>e.jsx(Le,{group:o,expanded:i[o.delivery_id],onToggle:d},o.delivery_id))})]}),$e=({attemptDeliveryId:t,attemptCode:i,attemptResult:d,attemptError:o,submittingAttempt:c,attemptHistory:n,expandedDriverDeliveries:u,handleSubmitAttempt:m,onAttemptDeliveryIdChange:l,onAttemptCodeChange:f,toggleDriverDeliveryExpansion:p})=>{const N=React.useMemo(()=>{if(!n.length)return[];const b=new Map;return n.forEach(s=>{b.has(s.delivery_id)||b.set(s.delivery_id,{delivery_id:s.delivery_id,address:s.address,status:s.status,attempts:[]});const g=b.get(s.delivery_id);g&&g.attempts.push(s)}),Array.from(b.values()).map(s=>({...s,attempts:[...s.attempts].sort((g,y)=>new Date(y.created_at).getTime()-new Date(g.created_at).getTime())})).sort((s,g)=>{const y=s.attempts[0]?.created_at??0,j=g.attempts[0]?.created_at??0;return new Date(j).getTime()-new Date(y).getTime()}).map(s=>({...s,status:s.attempts[0]?.status??s.status,address:s.attempts[0]?.address??s.address}))},[n]);return e.jsxs("section",{className:"grid gap-4",children:[e.jsx(Ie,{attemptDeliveryId:t,attemptCode:i,attemptResult:d,attemptError:o,submittingAttempt:c,handleSubmitAttempt:m,onAttemptDeliveryIdChange:l,onAttemptCodeChange:f}),e.jsx(Te,{driverAttemptGroups:N,expandedDriverDeliveries:u,toggleDriverDeliveryExpansion:p})]})},Ue=({deliveries:t,selectedDeliveryAttempts:i,addressInput:d,creationFlash:o,isCreating:c,handleCreateDelivery:n,handleAddressChange:u,toggleDeliveryAttempts:m})=>e.jsxs("section",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-cyan-200/45 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_20px_45px_rgba(34,211,238,0.22)]",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Create delivery"}),e.jsx("p",{className:"m-0 text-slate-300",children:"Generate a delivery ID and one-time code tied to the address."})]}),e.jsxs("form",{className:"grid gap-3",onSubmit:n,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"font-semibold text-slate-100",htmlFor:"address",children:"Delivery address"}),e.jsx("textarea",{id:"address",name:"address",className:"w-full min-h-[110px] rounded-xl border border-slate-400/35 bg-slate-900/60 px-3 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-cyan-300/70 focus:outline-none focus:ring-2 focus:ring-cyan-300/60",value:d,onChange:l=>u(l.target.value),placeholder:"12 Finchley rd, London, NW3 5JD",rows:3,required:!0})]}),e.jsx("button",{className:"inline-flex w-fit items-center justify-center rounded-xl bg-gradient-to-tr from-cyan-400 to-cyan-500 px-4 py-3 font-bold text-slate-900 shadow-[0_10px_30px_rgba(34,211,238,0.35)] transition-transform hover:-translate-y-0.5 disabled:translate-y-0 disabled:opacity-60",type:"submit",disabled:c,children:c?"Creating...":"Generate code"}),o&&e.jsxs("div",{className:"grid gap-1 rounded-[14px] border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-slate-100",children:[e.jsx("div",{className:"font-bold",children:"Delivery created"}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-baseline text-sm",children:[e.jsxs("span",{children:["Delivery ID: ",o.delivery_id]}),e.jsxs("span",{className:"inline-flex items-baseline gap-2",children:[e.jsx("span",{children:"Secret code:"}),e.jsx("span",{className:"text-xl font-mono font-bold tracking-[0.18em] text-amber-100",children:o.secret_code})]})]}),e.jsx("div",{className:"m-0 text-sm text-slate-300",children:"Share these with the recipient securely."})]})]})]}),e.jsxs("div",{className:"grid gap-4 rounded-[18px] border border-slate-400/35 bg-slate-900/80 p-[clamp(1rem,2vw,1.5rem)] shadow-[0_25px_50px_rgba(0,0,0,0.35)]",children:[e.jsx("div",{className:"grid gap-1",children:e.jsx("h2",{className:"text-xl font-semibold text-slate-50",children:"Your deliveries"})}),t.length===0?e.jsx("p",{className:"m-0 text-slate-400",children:"No deliveries yet."}):e.jsx("div",{className:"grid gap-3",children:t.map(l=>{const f=l.status==="validated"?"rounded-full bg-emerald-400/20 px-3 py-1 text-sm font-bold text-emerald-300":l.status==="locked"?"rounded-full bg-rose-400/15 px-3 py-1 text-sm font-bold text-rose-300":"rounded-full bg-cyan-200/20 px-3 py-1 text-sm font-bold text-cyan-200";return e.jsxs("article",{className:"grid gap-3 rounded-2xl border border-slate-400/35 bg-slate-800/70 p-4 shadow-[0_10px_30px_rgba(0,0,0,0.25)]",children:[e.jsxs("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold uppercase tracking-[0.08em] text-slate-400",children:["Delivery ",l.delivery_id]}),e.jsx("h3",{className:"mt-0.5 text-lg font-semibold text-slate-50",children:l.address})]}),e.jsx("span",{className:f,children:te(l.status)})]}),e.jsxs("dl",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm sm:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Secret code"}),e.jsx("dd",{className:"m-0 inline-flex items-center rounded-lg bg-white/10 px-2.5 py-1 text-xl font-mono font-semibold tracking-[0.18em] text-slate-50",children:l.secret_code})]}),e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm sm:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Created"}),e.jsx("dd",{className:"m-0 text-slate-100",children:S(l.created_at)})]}),l.validated_at&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm sm:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Completed"}),e.jsx("dd",{className:"m-0 text-slate-100",children:S(l.validated_at)})]}),l.locked_at&&e.jsxs("div",{className:"grid grid-cols-[120px,1fr] items-center gap-2 text-sm sm:text-base",children:[e.jsx("dt",{className:"font-semibold text-slate-400",children:"Locked"}),e.jsx("dd",{className:"m-0 text-slate-100",children:S(l.locked_at)})]})]}),e.jsx("footer",{className:"flex justify-end",children:e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",onClick:()=>m(l.delivery_id),children:i[l.delivery_id]?"Close":"View attempts"})}),i[l.delivery_id]&&e.jsxs("div",{className:"overflow-hidden rounded-xl border border-slate-400/35",children:[e.jsxs("div",{className:"grid grid-cols-[60px,1fr,1fr,120px] gap-2 bg-white/5 px-3 py-2 text-sm font-semibold text-slate-200 sm:text-base",children:[e.jsx("span",{children:"#"}),e.jsx("span",{children:"When"}),e.jsx("span",{children:"User"}),e.jsx("span",{children:"Result"})]}),i[l.delivery_id].map(p=>e.jsxs("div",{className:"grid grid-cols-[60px,1fr,1fr,120px] items-center gap-2 border-t border-slate-400/35 px-3 py-2 text-sm text-slate-100 sm:text-base",children:[e.jsx("span",{children:p.attempt_number}),e.jsx("span",{children:S(p.created_at)}),e.jsx("span",{children:p.delivery_person}),e.jsx("span",{className:p.success?"inline-flex w-fit items-center justify-center rounded-full bg-emerald-500/20 px-2.5 py-1 text-sm font-bold text-emerald-300":"inline-flex w-fit items-center justify-center rounded-full bg-rose-500/15 px-2.5 py-1 text-sm font-bold text-rose-300",children:p.success?"Verified":"Failed"})]},p.attempt_number)),i[l.delivery_id].length===0&&e.jsx("div",{className:"border-t border-slate-400/35 px-3 py-2 text-sm text-slate-400 sm:text-base",children:"No attempts yet."})]})]},l.delivery_id)})})]})]}),Oe=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}),Pe=[{id:"free",headline:"Free",blurb:"Great for trying, with a maximum of 100 deliveries per month.",price:0},{id:"plus",headline:"Plus",blurb:"with a maximum of 1000 deliveries per month.",price:9.99},{id:"pro",headline:"Pro",blurb:"with a maximum of 10000 deliveries per month.",price:29.99}],Me=({currentMembership:t,isAuthenticated:i,onUpgrade:d})=>{const[o,c]=React.useState(!1),[n,u]=React.useState(null),m=t??"free",l=React.useMemo(()=>B.indexOf(m),[m]),f=()=>{c(s=>!s),u(null)},p=s=>{const g=d(s);u(g.message),g.ok&&c(!1)},N=t?`${I[t]} plan`:"Guest Â· Free start",b=t==="pro"?"Manage membership":"Upgrade";return e.jsxs("div",{className:"relative inline-flex justify-end",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-amber-300 via-orange-400 to-pink-500 px-4 py-2.5 font-bold text-slate-900 shadow-[0_10px_30px_rgba(251,191,36,0.25)] transition-transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-amber-300/60",onClick:f,"aria-expanded":o,"aria-haspopup":"dialog",children:[e.jsx("span",{children:b}),e.jsx("span",{"aria-hidden":"true",children:"â†—"})]}),o&&e.jsxs("div",{className:"absolute right-0 z-20 mt-2 w-[min(380px,calc(100vw-2rem))] rounded-2xl border border-slate-400/35 bg-slate-950/95 p-4 text-left shadow-[0_20px_45px_rgba(0,0,0,0.45)] backdrop-blur",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-sm font-semibold uppercase tracking-[0.08em] text-amber-200/90",children:"Memberships"}),e.jsx("h3",{className:"mt-1 text-lg font-semibold text-slate-50",children:"Pick your plan"}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:"Upgrade to unlock more delivery confirmations."})]}),e.jsx("span",{className:"rounded-full border border-slate-400/45 bg-white/5 px-3 py-1 text-xs font-semibold text-slate-100",children:N})]}),e.jsx("div",{className:"mt-3 grid gap-2",children:Pe.map(s=>{const g=B.indexOf(s.id),y=s.id===m,j=g<l,R=y?"Current plan":j?"Downgrade not available":`Upgrade to ${I[s.id]}`,A=y||j;return e.jsxs("button",{type:"button",className:A?"grid gap-1 rounded-xl border border-slate-500/40 bg-slate-800/50 px-3 py-2 text-left text-slate-300 opacity-70":"grid gap-1 rounded-xl border border-amber-300/35 bg-amber-300/10 px-3 py-2 text-left text-slate-100 hover:border-amber-200/80 hover:bg-amber-200/20",onClick:()=>p(s.id),disabled:A,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:s.headline}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-[0.08em] text-amber-200",children:R})]}),e.jsxs("div",{className:"flex items-baseline justify-between text-sm",children:[e.jsx("span",{className:"font-semibold text-amber-100",children:Oe.format(s.price)}),e.jsx("span",{className:"text-xs text-slate-300",children:"per month"})]}),e.jsx("p",{className:"m-0 text-sm text-slate-300",children:s.blurb}),!i&&!y&&!j&&e.jsx("p",{className:"m-0 text-xs font-semibold text-amber-200/90",children:"Sign in to finish upgrade"})]},s.id)})}),n&&e.jsx("div",{className:"mt-3 rounded-xl border border-cyan-200/35 bg-cyan-200/10 px-3 py-2 text-sm text-slate-100",children:n})]})]})},w=`${Re}/delivery_confirmation`,k=t=>({Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),F=async(t,i)=>{try{if((t.headers.get("content-type")??"").includes("application/json")){const c=await t.json();if(typeof c=="string")return c;if(Array.isArray(c)){const n=c[0];if(typeof n=="string")return n;if(n&&typeof n=="object"){const u=n.message;if(typeof u=="string")return u}}if(c&&typeof c=="object"){const n=c,u=["detail","message","error"];for(const m of u){const l=n[m];if(typeof l=="string")return l}}}return(await t.text()).trim()||i}catch(d){return console.error("Failed to parse error response",d),i}},qe=()=>{const[t,i]=React.useState(null),[d,o]=React.useState(""),[c,n]=React.useState(""),[u,m]=React.useState(null),[l,f]=React.useState(!1),[p,N]=React.useState("login"),[b,s]=React.useState("driver"),[g,y]=React.useState(!1),[j,R]=React.useState(!1),[A,C]=React.useState(null),[E,L]=React.useState(null),[ae,T]=React.useState([]),[G,$]=React.useState({}),[U,O]=React.useState(""),[re,P]=React.useState(null),[le,V]=React.useState(!1),[H,J]=React.useState(""),[W,Y]=React.useState(""),[ne,M]=React.useState(null),[ie,D]=React.useState(null),[de,z]=React.useState([]),[oe,K]=React.useState(!1),[ce,Q]=React.useState({}),X=t?.role==="shop",me=t?.role==="driver",Z=a=>B.indexOf(a);React.useEffect(()=>{t?.role==="shop"&&xe(),t?.role==="driver"&&ee()},[t?.role]),React.useEffect(()=>{if(!E)return;const a=window.setTimeout(()=>L(null),5e3);return()=>window.clearTimeout(a)},[E]);const xe=async()=>{if(!t)return;const a=await fetch(`${w}/deliveries`,{headers:k(t.token)});if(!a.ok)return;const r=await a.json();T(r)},pe=async a=>{if(!t)return;const r=await fetch(`${w}/deliveries/${a}/attempts`,{headers:k(t.token)});if(!r.ok)return;const x=await r.json();$(h=>({...h,[a]:x.attempts}))},ee=async()=>{if(!t)return;const a=await fetch(`${w}/attempts`,{headers:k(t.token)});if(!a.ok)return;const r=await a.json();z(r)},ue=a=>{const r=a.replace(/\D/g,"").slice(0,6);Y(r)},he=a=>{const r=a.replace(/\D/g,"");J(r)},ge=a=>{O(a)},be=a=>{if(G[a]){$(r=>{const x={...r};return delete x[a],x});return}pe(a)},fe=a=>{Q(r=>({...r,[a]:!r[a]}))},ye=()=>{i(null),T([]),$({}),z([]),M(null),D(null),Q({}),J(""),Y(""),P(null),O(""),C(null),n(""),o(""),N("login"),L(null)},je=a=>{if(!t)return{ok:!1,message:"Sign in to choose a membership."};const r=Z(t.membership),x=Z(a);if(x<=r)return{ok:!1,message:x===r?"You're already on that membership.":"Downgrades are not available from this view."};i(v=>v&&{...v,membership:a});const h=`Upgraded to ${I[a]} membership.`;return L(h),{ok:!0,message:h}},ve=a=>{N(a),m(null),C(null)},Ne=async a=>{a.preventDefault();const r=d.trim().toLowerCase();if(m(null),C(null),!r){m("Email is required.");return}if(!c.trim()){m("Password is required.");return}if(p==="register"&&c.length<q){m(`Password must be at least ${q} characters.`);return}f(!0);try{const x=p==="login"?"login":"register",h={email:r,password:c};p==="register"&&(h.role=b);const v=await fetch(`${w}/${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!v.ok){const ke=await F(v,p==="login"?"Unable to log in":"Unable to register");throw new Error(ke)}const _=await v.json();i({token:_.access_token,email:_.username,role:_.role,membership:_.membership}),n("")}catch(x){m(x instanceof Error?x.message:p==="login"?"Login failed":"Registration failed")}finally{f(!1)}},we=async()=>{const a=d.trim().toLowerCase();if(C(null),m(null),!a){m("Email is required to reset password.");return}R(!0);try{const r=await fetch(`${w}/password_reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(!r.ok)throw new Error(await F(r,"Unable to request password reset"));const x=await r.json();C(x.message)}catch(r){m(r instanceof Error?r.message:"Reset failed")}finally{R(!1)}},_e=async a=>{if(a.preventDefault(),!(!t||!U.trim())){V(!0);try{const r=await fetch(`${w}/deliveries`,{method:"POST",headers:k(t.token),body:JSON.stringify({address:U.trim()})});if(!r.ok)throw new Error(await F(r,"Unable to create delivery"));const x=await r.json();T(h=>[x,...h]),P(x),O("")}catch(r){P(null),m(r instanceof Error?r.message:"Unable to create delivery")}finally{V(!1)}}},Se=async a=>{if(a.preventDefault(),!t)return;const r=H.trim(),x=W.trim();if(!r){D("Delivery ID is required.");return}if(!/^\d{6}$/.test(x)){D("Code must be exactly 6 digits.");return}D(null),K(!0);try{const h=await fetch(`${w}/attempts`,{method:"POST",headers:k(t.token),body:JSON.stringify({delivery_id:Number(r),code:x})});if(!h.ok){const _=await F(h,"Attempt rejected");throw new Error(_)}const v=await h.json();M(v),await ee()}catch(h){M(null),D(h instanceof Error?h.message:"Attempt failed")}finally{K(!1)}},Ce=React.useMemo(()=>t?t.role==="shop"?"Create deliveries, hand off the one-time code, and check delivery confirmations.":"Confirm deliveries.":"Generate and validate single-use delivery codes.",[t]),De=React.useMemo(()=>t?t.role==="shop"?"Shop":"Driver":null,[t]);return e.jsx("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_20%,rgba(34,211,238,0.18),transparent_45%),radial-gradient(circle_at_80%_10%,rgba(56,189,248,0.15),transparent_40%),#0b1021] px-[clamp(1.25rem,3vw,2rem)] py-[clamp(1.25rem,3vw,2rem)] font-['Space_Grotesk','Inter',system-ui,-apple-system,sans-serif] text-slate-100",children:e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-5",children:[e.jsxs("header",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("span",{className:"text-sm font-bold uppercase tracking-[0.08em] text-cyan-300",children:"Delivery Confirmation"}),e.jsx("h1",{className:"m-0 text-3xl font-semibold text-slate-50",children:"One-time codes"}),e.jsx("p",{className:"m-0 max-w-3xl text-slate-300",children:Ce})]}),e.jsxs("div",{className:"grid justify-end gap-2 text-right",children:[X&&t&&e.jsx(Me,{currentMembership:t.membership,isAuthenticated:!0,onUpgrade:je}),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-bold uppercase tracking-[0.01em] text-lime-200",children:De}),e.jsxs("div",{className:"text-sm text-slate-300",children:["Signed in as ",t.email," Â· ",I[t.membership]," member"]}),e.jsx("button",{className:"inline-flex items-center justify-center rounded-xl border border-slate-400/35 bg-white/5 px-4 py-2.5 font-bold text-slate-100 hover:border-slate-300/50",type:"button",onClick:ye,children:"Log out"})]}):e.jsx("div",{className:"text-sm text-slate-300",children:"Start on Free and upgrade to Plus or Pro whenever you are ready."})]})]}),E&&e.jsx("div",{className:"rounded-xl border border-emerald-400/40 bg-emerald-400/10 px-4 py-3 text-sm text-emerald-50 shadow-[0_12px_30px_rgba(16,185,129,0.25)]",children:E}),!t&&e.jsx(Ae,{authMode:p,email:d,password:c,roleSelection:b,showPassword:g,loadingAuth:l,resettingPassword:j,authError:u,resetFlash:A,switchAuthMode:ve,setEmail:o,setPassword:n,setRoleSelection:s,setShowPassword:y,handleAuthSubmit:Ne,handlePasswordReset:we}),X&&e.jsx(Ue,{deliveries:ae,selectedDeliveryAttempts:G,addressInput:U,creationFlash:re,isCreating:le,handleCreateDelivery:_e,handleAddressChange:ge,toggleDeliveryAttempts:be}),me&&e.jsx($e,{attemptDeliveryId:H,attemptCode:W,attemptResult:ne,attemptError:ie,submittingAttempt:oe,attemptHistory:de,expandedDriverDeliveries:ce,handleSubmitAttempt:Se,onAttemptDeliveryIdChange:he,onAttemptCodeChange:ue,toggleDriverDeliveryExpansion:fe})]})})},se=document.getElementById("root");if(!se)throw new Error("Root element #root not found");document.body.classList.add("delivery-page");ReactDOM.createRoot(se).render(e.jsx(React.StrictMode,{children:e.jsx(qe,{})}));
