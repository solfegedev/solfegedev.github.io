import"./index-F_Pwjxo7.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as T}from"./api-CH_Pe6Vg.js";import{B as H}from"./button-ChVf0VhC.js";import{L as Ae,a as Q,I as Z}from"./label-BksqPqOg.js";import{L as De}from"./log-out-B0TqtotO.js";import{U as Pe,D as _e,G as ie}from"./upload-CK6mc6ZD.js";import{P as Te}from"./plus-DDkdk0pc.js";import{R as he}from"./refresh-cw-pTx9cW3g.js";import{c as pe}from"./createLucideIcon-DtX1aPOG.js";import{T as re}from"./trash-2-DQbJ9aIh.js";import{B as Ge,P as Fe}from"./index-BehiXGmn.js";import"./clsx-B-dksMZM.js";import"./utils-Bp7-rn4K.js";const fe=React.createContext(void 0),Oe=({children:t})=>{const[r,a]=React.useState(()=>({user:null,token:typeof window<"u"?localStorage.getItem("odds_token"):null,status:"idle"})),d=React.useCallback(()=>{localStorage.removeItem("odds_token"),a({user:null,token:null,status:"idle"})},[]),l=async(x,p)=>{a(o=>({...o,status:"loading"}));try{const o=await fetch(`${T}/odds/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:x,password:p})});if(!o.ok)throw new Error("Invalid credentials");const f=await o.json();localStorage.setItem("odds_token",f.access_token),a({user:f.user,token:f.access_token,status:"success"})}catch(o){throw a(f=>({...f,status:"error"})),o}},h=React.useCallback(async x=>{try{const p=await fetch(`${T}/odds/me`,{headers:{Authorization:`Bearer ${x}`}});if(p.ok){const o=await p.json();a(f=>({...f,user:o,status:"success"}))}else d()}catch(p){console.error("Failed to fetch user",p),d()}},[d]);return React.useEffect(()=>{r.token&&!r.user&&h(r.token)},[r.token,r.user,h]),e.jsx(fe.Provider,{value:{...r,login:l,logout:d},children:t})},xe=()=>{const t=React.useContext(fe);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},ze=()=>{const{user:t,token:r,logout:a}=xe(),[d,l]=React.useState([]),[h,x]=React.useState("idle"),[p,o]=React.useState(""),[f,y]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[L,b]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit");React.useEffect(()=>{const n=()=>{const i=new URLSearchParams(window.location.search);y(i.get("view")==="login"),b(i.get("view")==="edit")};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]);const j=()=>{const n=new URLSearchParams(window.location.search);n.get("view")!=="login"&&(n.set("view","login"),window.history.pushState({},"",`?${n.toString()}`),y(!0),b(!1))},R=()=>{const n=new URLSearchParams(window.location.search);n.get("view")!=="edit"&&(n.set("view","edit"),window.history.pushState({},"",`?${n.toString()}`),b(!0),y(!1))},$=()=>{const n=new URLSearchParams(window.location.search);if(n.has("view")){n.delete("view");const i=n.toString();window.history.pushState({},"",i?`?${i}`:window.location.pathname),y(!1),b(!1)}else y(!1),b(!1)},A=React.useCallback(async()=>{x("loading");try{const n=await fetch(`${T}/odds/`);if(!n.ok)throw new Error("Fetch failed");const i=await n.json();l(Array.isArray(i)?i:i.markets??[]),x("success")}catch{x("error")}},[]),P=async(n,i)=>{if(r)try{const s=await fetch(`${T}/odds/markets/${n}/favorite`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({favorite:i})});if(!s.ok)throw new Error("Patch failed");const c=await s.json();l(c.markets)}catch{alert("Failed to toggle favorite")}},v=async n=>{const i=await fetch(`${T}/odds/market-name/${n}`);if(!i.ok)throw new Error("Name fetch failed");return(await i.json()).name},M=async n=>{if(!r)return;const i=await fetch(`${T}/odds/markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)});if(!i.ok)throw new Error("Add failed");const s=await i.json();l(s.markets),o(n.id)},I=async n=>{if(!r||!window.confirm("Delete market?"))return;const i=await fetch(`${T}/odds/markets/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!i.ok)throw new Error("Delete failed");const s=await i.json();l(s.markets)},S=async n=>{if(!r)return;const i=await fetch(`${T}/odds/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({label:n})});if(!i.ok)throw new Error("Add failed");const s=await i.json();l(s.markets)},C=async n=>{if(!r||!window.confirm("Delete group?"))return;const i=await fetch(`${T}/odds/groups/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!i.ok)throw new Error("Delete failed");const s=await i.json();l(s.markets)},E=async n=>{if(!r)return;const s=await(await fetch(`${T}/odds/reorder-groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({group_ids:n})})).json();l(s.markets)},F=async(n,i)=>{if(!r)return;const c=await(await fetch(`${T}/odds/reorder-markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({group_id:n,market_ids:i})})).json();l(c.markets)},B=async n=>{if(!r)return;const s=await(await fetch(`${T}/odds/import`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)})).json();l(s.markets)},g=async()=>{if(!r)return;const i=await(await fetch(`${T}/odds/export`,{headers:{Authorization:`Bearer ${r}`}})).blob(),s=window.URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download="odds_backup.yml",c.click()};return React.useEffect(()=>{A()},[A]),React.useEffect(()=>{t&&new URLSearchParams(window.location.search).get("view")!=="edit"&&R()},[t]),{user:t,token:r,logout:a,marketGroups:d,marketListState:h,selectedMarketId:p,setSelectedMarketId:o,showLogin:f,showEdit:L,navigateToLogin:j,navigateToEdit:R,navigateToPublic:$,handleToggleFavorite:P,handleGetMarketName:v,handleAddMarket:M,handleDeleteMarket:I,handleAddGroup:S,handleDeleteGroup:C,handleReorderGroups:E,handleReorderMarkets:F,handleImportYaml:B,handleExportYaml:g}};const Be=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Ue=pe("folder-plus",Be);const We=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Ve=pe("star",We),Ye=({title:t,isAdmin:r,userEmail:a,userFirstName:d,onLoginClick:l,onLogoutClick:h,onLogoClick:x,showLoginButton:p})=>e.jsx("nav",{className:"sticky top-0 z-50 w-full border-b border-white/10 bg-[#0e1422]/90 shadow-sm backdrop-blur-md","data-testid":"navbar",children:e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:x,className:"flex items-center gap-2 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:[e.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-[#e63946] shadow-[0_0_10px_#e63946]","aria-hidden":"true"}),e.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-white",children:[t," ",r&&"Admin"]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[p&&e.jsxs(H,{variant:"ghost",className:"gap-2 text-[#e8ecf5] hover:bg-white/5",onClick:l,"data-testid":"login-button",children:[e.jsx(Ae,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Login"})]}),a&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"hidden text-sm font-medium text-[#9aa5c0] md:inline","data-testid":"user-display-name",children:d||a}),e.jsx(H,{variant:"ghost",size:"icon",onClick:h,className:"text-[#9aa5c0] hover:bg-white/5 hover:text-[#e63946]",title:"Logout","data-testid":"logout-button",children:e.jsx(De,{size:20})})]})]})]})}),qe=()=>{const{login:t}=xe(),[r,a]=React.useState(""),[d,l]=React.useState(""),[h,x]=React.useState(null),[p,o]=React.useState(!1),f=async y=>{y.preventDefault(),x(null),o(!0);try{await t(r,d)}catch{x("Invalid email or password")}finally{o(!1)}};return e.jsx("div",{className:"flex min-h-[calc(100vh-80px)] items-center justify-center px-4","data-testid":"login-view",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-white/10 bg-[#0e1422] p-8 shadow-2xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-white","data-testid":"login-view-title",children:"Admin Login"}),e.jsx("p",{className:"mt-2 text-[#9aa5c0]",children:"Enter your credentials to manage markets"})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"email",children:"Email"}),e.jsx(Z,{id:"email",type:"email",autoComplete:"email",value:r,onChange:y=>a(y.target.value),required:!0,className:"h-12 border-white/10 bg-white/5 text-lg text-white",placeholder:"admin@example.com","data-testid":"login-email-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"password",children:"Password"}),e.jsx(Z,{id:"password",type:"password",autoComplete:"current-password",value:d,onChange:y=>l(y.target.value),required:!0,className:"h-12 border-white/10 bg-white/5 text-lg text-white",placeholder:"••••••••","data-testid":"login-password-input"})]}),h&&e.jsx("p",{className:"text-center text-sm text-red-400","data-testid":"login-error-message",children:h}),e.jsx(H,{type:"submit",className:"h-12 w-full rounded-xl border-none bg-[#e63946] text-lg font-bold text-white shadow-lg transition-all hover:bg-[#d62839] active:scale-[0.98]",disabled:p,"data-testid":"login-submit-button",children:p?"Logging in...":"Login"})]})]})})},He=({marketGroups:t,onAddMarket:r,onDeleteMarket:a,onToggleFavorite:d,onGetMarketName:l,onAddGroup:h,onDeleteGroup:x,onReorderGroups:p,onReorderMarkets:o,onImportYaml:f,onExportYaml:y,requestState:L})=>{const[b,j]=React.useState(t),[R,$]=React.useState(""),[A,P]=React.useState(""),[v,M]=React.useState(""),[I,S]=React.useState(""),[C,E]=React.useState(""),[F,B]=React.useState(!1),[g,n]=React.useState(!1),[i,s]=React.useState(null),[c,w]=React.useState(null),[k,D]=React.useState(!1),O=React.useRef(null);React.useEffect(()=>{j(t)},[t]),React.useEffect(()=>{!I&&t.length>0&&S(t[0].label)},[t,I]);const[U,ee]=React.useState(null),[ae,Y]=React.useState(null),[q,J]=React.useState(null),[ne,K]=React.useState(null),ve=async u=>{const m=u.trim();if(/^1\.\d{4,}$/.test(m)){D(!0);try{const N=await l(m);M(N),P(N)}catch(N){console.error("Failed to fetch market name",N)}finally{D(!1)}}},je=async u=>{u.preventDefault(),s(null),B(!0);try{const m=R.trim();await r({id:m,label:A,api_label:v,group_label:I}),$(""),P(""),M(""),S("")}catch{s("Failed to add market. Ensure the ID is unique.")}finally{B(!1)}},ke=async u=>{u.preventDefault(),w(null),n(!0);try{await h(C),E("")}catch{w("Failed to add group. Ensure the label is unique.")}finally{n(!1)}},Ne=async u=>{const m=u.target.files?.[0];if(!m)return;const N=new FileReader;N.onload=async G=>{try{const W=(await Promise.resolve(jsyaml)).load(G.target?.result);await f(W),O.current&&(O.current.value="")}catch(_){console.error("Failed to import YAML",_);const W=_ instanceof Error?_.message:String(_);alert(`Failed to import YAML: ${W}`)}},N.readAsText(m)},Re=u=>{ee(u)},Se=(u,m,N)=>{if(u.preventDefault(),U===null||U===m)return;const G=[...b],_=G.findIndex(z=>z.markets.some(X=>X.id===U)),W=G.findIndex(z=>z.id===N);if(_===-1||W===-1)return;const V={...G[_]},Ce=V.markets.findIndex(z=>z.id===U),[oe]=V.markets.splice(Ce,1);if(_===W){const z=V.markets.findIndex(X=>X.id===m);V.markets.splice(z,0,oe),G[_]=V}else{const z={...G[W]},X=z.markets.findIndex($e=>$e.id===m);z.markets.splice(X,0,oe),G[_]=V,G[W]=z}j(G)},Me=async()=>{if(U===null)return;const u=b.find(m=>m.markets.some(N=>N.id===U));u&&await o(u.id,u.markets.map(m=>m.id)),ee(null),Y(null)},Le=u=>{J(u)},Ee=(u,m)=>{if(u.preventDefault(),q===null||q===m)return;const N=[...b],G=N.findIndex(V=>V.id===q),_=N.findIndex(V=>V.id===m);if(G===-1||_===-1)return;const[W]=N.splice(G,1);N.splice(_,0,W),j(N)},Ie=async()=>{q!==null&&(await p(b.map(u=>u.id)),J(null),K(null))};return e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-8 px-6 pt-8 pb-12","data-testid":"management-view",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 px-2 sm:flex-row sm:items-center sm:gap-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Market Management"}),e.jsxs("div",{className:"flex w-full flex-col gap-3 sm:w-auto sm:flex-row",children:[e.jsx("input",{type:"file",ref:O,onChange:Ne,accept:".yml,.yaml",className:"hidden"}),e.jsxs(H,{variant:"outline",onClick:()=>O.current?.click(),className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"import-yaml-button",children:[e.jsx(Pe,{size:18}),"Import YAML"]}),e.jsxs(H,{variant:"outline",onClick:y,className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"export-yaml-button",children:[e.jsx(_e,{size:18}),"Export YAML"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-market-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(Te,{className:"text-emerald-400",size:24}),"Add New Market"]}),e.jsxs("form",{onSubmit:je,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Q,{htmlFor:"marketId",children:["Betfair Market ID (or paste URL)",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Z,{id:"marketId",value:R,onChange:u=>{const m=u.target.value,N=m.match(/1\.\d{4,}/);N&&N[0]!==m?$(N[0]):$(m)},required:!0,placeholder:"e.g. 1.230433061 or https://...",className:"border-white/10 bg-white/5 text-white","data-testid":"market-id-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Q,{htmlFor:"label",children:["Market Label"," ",k&&e.jsx("span",{className:"ml-2 animate-pulse text-xs text-indigo-400",children:"(Fetching...)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{id:"label",value:A,onChange:u=>P(u.target.value),placeholder:k?"Fetching name...":"e.g. Premier League",className:"border-white/10 bg-white/5 text-white","data-testid":"market-label-input"}),e.jsxs(H,{type:"button",variant:"outline",onClick:()=>ve(R),disabled:k||!/^1\.\d{4,}$/.test(R.trim()),className:"gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white",title:"Fetch name from Betfair","data-testid":"fetch-market-name-button",children:[e.jsx(he,{size:16,className:k?"animate-spin":""}),"Fetch"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Q,{htmlFor:"group",children:["Group ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"group",value:I,onChange:u=>S(u.target.value),required:!0,className:"focus-visible:ring-ring flex h-11 w-full rounded-md border border-white/10 bg-white/5 px-3 py-1 text-sm text-white shadow-sm transition-colors focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50","data-testid":"group-select",children:[e.jsx("option",{value:"",disabled:!0,className:"bg-[#0e1422]",children:"Select a group"}),t.map(u=>e.jsx("option",{value:u.label,className:"bg-[#0e1422]",children:u.label},u.id))]})]}),e.jsxs("div",{className:"pt-2",children:[i&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"market-error-message",children:i}),e.jsx(H,{type:"submit",className:"h-11 w-full bg-emerald-600 text-white hover:bg-emerald-700",disabled:F,"data-testid":"add-market-button",children:F?"Adding...":"Add Market"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-group-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(Ue,{className:"text-indigo-400",size:24}),"Add New Group"]}),e.jsxs("form",{onSubmit:ke,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Q,{htmlFor:"groupLabel",children:["Group Label ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Z,{id:"groupLabel",value:C,onChange:u=>E(u.target.value),required:!0,placeholder:"e.g. Misc",className:"border-white/10 bg-white/5 text-white","data-testid":"new-group-label"})]}),e.jsxs("div",{className:"pt-2",children:[c&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"group-error-message",children:c}),e.jsx(H,{type:"submit",className:"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700",disabled:g,"data-testid":"add-group-button",children:g?"Adding...":"Add Group"})]})]})]})]}),e.jsxs("section",{className:"flex flex-col gap-6","data-testid":"tracked-markets-section",children:[e.jsx("h3",{className:"px-2 text-xl font-bold text-white",children:"Tracked Markets"}),L==="loading"&&b.length===0?e.jsx("div",{className:"animate-pulse space-y-4","data-testid":"markets-loading-skeleton",children:[1,2,3].map(u=>e.jsx("div",{className:"h-20 rounded-xl bg-white/5"},u))}):e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[b.map(u=>e.jsxs("div",{className:`group-container overflow-hidden rounded-2xl border border-white/10 bg-[#0e1422] shadow-lg transition-all ${q===u.id?"opacity-20":""}`,"data-testid":`group-container-${u.label}`,draggable:ne===u.id,onDragStart:()=>Le(u.id),onDragOver:m=>Ee(m,u.id),onDragEnd:Ie,children:[e.jsxs("div",{className:"flex items-center justify-between bg-[#26356d] px-6 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"cursor-grab text-white/40 transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>K(u.id),onMouseUp:()=>K(null),onTouchStart:()=>K(u.id),onTouchEnd:()=>K(null),children:e.jsx(ie,{size:20})}),e.jsx("h4",{className:"font-bold text-white",children:u.label})]}),e.jsx("button",{onClick:()=>x(u.id),className:"rounded-lg p-1.5 text-white/40 transition-all hover:bg-white/5 hover:text-red-400",title:"Delete group and all markets","data-testid":`delete-group-button-${u.label}`,children:e.jsx(re,{size:16})})]}),e.jsxs("div",{className:"divide-y divide-white/5",children:[u.markets.map(m=>e.jsxs("div",{className:`group flex items-center justify-between px-6 py-4 transition-colors hover:bg-white/5 ${U===m.id?"opacity-20":""}`,draggable:ae===m.id,onDragStart:()=>Re(m.id),onDragOver:N=>Se(N,m.id,u.id),onDragEnd:Me,"data-testid":`market-item-${m.id}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"cursor-grab text-[#9aa5c0] transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>Y(m.id),onMouseUp:()=>Y(null),onTouchStart:()=>Y(m.id),onTouchEnd:()=>Y(null),children:e.jsx(ie,{size:18})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-[#e8ecf5]",children:m.label||m.api_label}),m.api_label&&m.api_label!==m.label&&e.jsx("span",{className:"text-xs text-[#9aa5c0] italic",children:m.api_label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(m.id,!m.favorite),className:`rounded-lg p-2 transition-all hover:bg-white/10 ${m.favorite?"text-yellow-400":"text-[#9aa5c0]"}`,title:m.favorite?"Remove from favorites":"Add to favorites","data-testid":`favorite-button-${m.id}`,children:e.jsx(Ve,{size:18,fill:m.favorite?"currentColor":"none"})}),e.jsx("button",{onClick:()=>a(m.id),className:"rounded-lg p-2 text-[#9aa5c0] transition-all hover:bg-white/10 hover:text-[#e63946]",title:"Delete market","data-testid":`delete-market-button-${m.id}`,children:e.jsx(re,{size:18})})]})]},m.id)),u.markets.length===0&&e.jsx("div",{className:"px-6 py-4 text-sm text-[#9aa5c0] italic","data-testid":"empty-group-message",children:"No markets in this group."})]})]},u.id)),b.length===0&&e.jsx("div",{className:"rounded-2xl border-2 border-dashed border-white/10 py-12 text-center",children:e.jsx("p",{className:"text-[#9aa5c0]",children:"No markets tracked yet."})})]})]})]})},Ke=t=>t.state?.status==="ACTIVE",Je=t=>t.state?.status==="LOSER",Qe=t=>t.state?.status==="WINNER",le=t=>{if(!t||t.length===0)return null;const[r]=t;return typeof r.price!="number"||typeof r.size!="number"?null:{price:r.price,size:r.size}},Xe=(t,r,a,d)=>{const l=[],h=o=>typeof o!="number"?1:o<=0?0:1/o;if(typeof t=="number"&&t>0&&l.push({price:t,weight:h(a)}),typeof r=="number"&&r>0&&l.push({price:r,weight:h(d)}),l.length===0)return null;const x=l.reduce((o,f)=>o+f.weight,0);return x===0?null:1/(l.reduce((o,f)=>o+f.price*f.weight,0)/x)},be="* ",de="1.244214540",Ze=(t,r)=>{const a=t.eventTypes?.[0]?.eventNodes?.[0]?.marketNodes?.[0],d=a?{marketId:a.marketId,status:a.state.status,inplay:a.state.inplay,numberOfWinners:a.state.numberOfWinners,description:a.description,runners:a.runners}:void 0,l=d?.description?.marketName??"—",h=d?.runners??[],x=h.filter(Ke),p=h.filter(Je),o=h.filter(Qe),f=v=>{const M=v.description?.runnerName??"Unknown runner",I=le(v.exchange?.availableToBack),S=le(v.exchange?.availableToLay),C=I?.price??(typeof v.state?.lastPriceTraded=="number"?v.state?.lastPriceTraded:null),E=S?.price??null,F=I?.size??null,B=S?.size??null,g=v.state?.status,n=g==="ACTIVE"||g==="LOSER"||g==="WINNER"?g:"UNKNOWN",i=n==="WINNER",s=i?be+M:M,c=i?1:Xe(C,E,F,B),w=i?1:typeof E=="number"&&E>0?1/E:null,k=i?1:typeof C=="number"&&C>0?1/C:null;return{id:v.selectionId,name:s,status:n,bestBack:C,bestLay:E,impliedProbability:c,probabilityMin:w,probabilityMax:k}},L=[...[...x,...o].map(f)].sort((v,M)=>{const I=v.impliedProbability??0,S=M.impliedProbability??0;if(I!==S)return S-I;const C=v.bestBack??Number.POSITIVE_INFINITY,E=M.bestBack??Number.POSITIVE_INFINITY;return C!==E?C-E:0}),b=L.filter(v=>(v.impliedProbability??0)>=.01),j=b.reduce((v,M)=>v+(M.impliedProbability??0),0),R=Math.max(0,1-j),$=L.length-b.length,A={id:-1,name:$>0?`Others ${$}`:"Others",bestBack:null,bestLay:null,status:"AGGREGATE",impliedProbability:R,probabilityMin:R,probabilityMax:R},P=[...b,A].sort((v,M)=>{const I=v.impliedProbability??0,S=M.impliedProbability??0;return I!==S?S-I:0});return{marketId:d?.marketId??"unknown",marketName:l,runners:P,fetchedAt:r.toISOString(),status:d?.status??"UNKNOWN",inplay:!!d?.inplay,numberOfWinners:d?.numberOfWinners??1,activeRunnerCount:x.length,loserRunnerCount:p.length,winnerRunnerCount:o.length,totalRunners:x.length+p.length+o.length}},ce=t=>{const r=t.filter(d=>!!d.favorite),a=t.filter(d=>!d.favorite);return[...r,...a]},et=(t,r)=>{const a=[];return t.forEach(d=>{const l=`group-${d.id}`;a.push({kind:"group",id:l,groupId:d.id,label:d.label}),r.has(d.id)&&d.markets.forEach(h=>{a.push({kind:"option",id:`option-${h.id}`,groupId:d.id,marketId:h.id,label:h.label})})}),a},tt=(t,r)=>t.find(a=>a.markets.some(d=>d.id===r)),ue=t=>t.flatMap(r=>r.markets),ge=({favorite:t})=>t?e.jsx("span",{className:"text-base leading-none text-[#ffdc00]","aria-hidden":"true",children:"★"}):null,we=({label:t,favorite:r,closeDate:a})=>e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(ge,{favorite:r}),e.jsx("span",{children:t}),a?e.jsxs(e.Fragment,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold text-[#9aa5c0]",children:["(",a,")"]})]}):null]}),at=({selectedMarket:t,isOpen:r,onToggle:a,onClose:d,toggleRef:l})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-xl border border-white/10 bg-white/20 px-3 py-2.5 text-left font-semibold text-[#e8ecf5] shadow-[0_16px_32px_rgba(0,0,0,0.35)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946] focus-visible:ring-offset-2 focus-visible:ring-offset-transparent","aria-haspopup":"listbox","aria-expanded":r,onClick:a,onKeyDown:h=>{h.key==="Escape"&&d()},ref:l,"data-testid":"market-dropdown-trigger",children:[e.jsx(we,{label:t?.label??"",favorite:t?.favorite,closeDate:t?.close_date}),e.jsx("span",{className:"ml-1 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),st=({requestState:t})=>e.jsx("li",{children:e.jsx("span",{className:"flex w-full items-center justify-between gap-2 rounded-lg border border-transparent bg-white/10 px-2.5 py-2 text-left font-semibold text-[#e8ecf5]",children:t==="loading"?"Loading markets...":"No markets available"})}),rt=({group:t,isExpanded:r,headerId:a,onToggle:d,onKeyDown:l,setItemRef:h,isFocused:x,onFocus:p})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-lg bg-[#26356d] px-2.5 py-2 text-left font-bold text-[#e8ecf5] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]","aria-expanded":r,"aria-controls":`${t.id}-options`,onClick:d,onKeyDown:o=>l(o,a),"data-kind":"group",tabIndex:x?0:-1,ref:o=>h(a,o),onFocus:p,children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[t.isFavorites?e.jsx(ge,{favorite:!0}):null,e.jsx("span",{children:t.label})]}),e.jsx("span",{className:r?"text-sm font-bold text-[#9aa5c0]":"-rotate-90 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),nt=({market:t,isActive:r,optionId:a,onSelect:d,onDelete:l,onKeyDown:h,setItemRef:x,isFocused:p,onFocus:o})=>e.jsxs("div",{className:"group/item flex items-center gap-1",children:[e.jsx("button",{type:"button",className:r?"flex flex-1 items-center justify-between gap-3 rounded-lg border border-[rgba(230,57,70,0.35)] bg-[rgba(230,57,70,0.14)] px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-[rgba(230,57,70,0.18)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]":"flex flex-1 items-center justify-between gap-3 rounded-lg border border-transparent bg-white/20 px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]",role:"option","aria-selected":r,onClick:()=>d(t.id),onKeyDown:f=>h(f,a),"data-kind":"option",tabIndex:p?0:-1,ref:f=>x(a,f),onFocus:o,children:e.jsx(we,{label:t.label,favorite:t.favorite,closeDate:t.close_date})}),l&&e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),l(t.id)},className:"p-2 text-[#9aa5c0] opacity-0 transition-opacity group-hover/item:opacity-100 hover:text-[#e63946]",title:"Delete market",children:e.jsx(re,{size:16})})]}),ot=({group:t,selectedMarketId:r,onSelect:a,onDelete:d,onKeyDown:l,setItemRef:h,focusedItemId:x,onFocusItem:p})=>e.jsx("ul",{className:"mt-1 flex list-none flex-col gap-1 pr-1 pb-2 pl-4",id:`${t.id}-options`,role:"group",children:t.markets.map(o=>{const f=`option-${o.id}`,y=o.id===r;return e.jsx("li",{children:e.jsx(nt,{market:o,isActive:y,optionId:f,onSelect:L=>a(L),onDelete:d,onKeyDown:l,setItemRef:h,isFocused:x===f,onFocus:()=>p(f)})},f)})}),it=({normalizedGroups:t,expandedGroupIds:r,focusedItemId:a,onToggleGroup:d,onKeyDown:l,setItemRef:h,onFocusItem:x,selectedMarketId:p,onSelect:o,onDelete:f,requestState:y,dropdownStyle:L})=>e.jsx("ul",{className:"fixed z-10 mt-1 list-none space-y-1 overflow-y-auto rounded-xl border border-white/10 bg-[#0b111d] p-1 shadow-[0_16px_40px_rgba(0,0,0,0.35)]",role:"listbox","aria-label":"Choose market",style:L,children:t.length===0?e.jsx(st,{requestState:y}):t.map(b=>{const j=r.has(b.id),R=`group-${b.id}`;return e.jsxs("li",{className:"py-1",children:[e.jsx(rt,{group:b,isExpanded:j,headerId:R,onToggle:()=>d(b.id),onKeyDown:l,setItemRef:h,isFocused:a===R,onFocus:()=>x(R)}),j?e.jsx(ot,{group:b,selectedMarketId:p,onSelect:$=>{o($)},onDelete:f,onKeyDown:l,setItemRef:h,focusedItemId:a,onFocusItem:x}):null]},b.id)})}),lt=({groups:t,selectedMarketId:r,onSelect:a,onDelete:d,requestState:l})=>{const h=React.useMemo(()=>t.map((s,c)=>({...s,id:`group-${c}-${s.label||"group"}`,markets:ce(s.markets)})),[t]),x=React.useMemo(()=>{const s=ue(h).filter(c=>!!c.favorite);return s.length===0?null:{id:0,label:"Favorites",markets:ce(s),isFavorites:!0}},[h]),p=React.useMemo(()=>x?[x,...h]:h,[h,x]),[o,f]=React.useState(!1),[y,L]=React.useState(new Set),[b,j]=React.useState(null),[R,$]=React.useState({}),A=React.useRef(null),P=React.useRef(null),v=React.useRef(new Map),M=React.useMemo(()=>ue(p),[p]),I=React.useMemo(()=>M.length===0?{id:r,label:l==="loading"?"Loading markets...":"No markets available"}:M.find(s=>s.id===r)??M[0],[M,r,l]),S=React.useMemo(()=>et(p,y),[p,y]);React.useEffect(()=>{if(!o)return;const s=tt(p,r)??p[0];L(k=>{const D=s?new Set([s.id]):new Set;return k.size===D.size&&[...D].every(U=>k.has(U))?k:D});const c=s?.markets[0],w=s?.markets.find(k=>k.id===r)?.id??c?.id;j(w?`option-${w}`:null)},[p,o,r]),React.useEffect(()=>{const s=c=>{A.current&&!A.current.contains(c.target)&&f(!1)};return o&&document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[o]),React.useEffect(()=>{if(!o||!b)return;v.current.get(b)?.focus()},[b,o]),React.useEffect(()=>{if(!o)return;const s=()=>{if(!P.current)return;const c=P.current.getBoundingClientRect(),w=window.innerHeight,k=window.innerWidth,D=12,O=Math.min(720,k-D*2),ee=c.left+c.width/2-O/2,ae=Math.min(Math.max(ee,D),Math.max(D,k-O-D)),Y=w-c.bottom-D,q=c.top-D,J=Y<240&&q>Y,K=Math.max(140,Math.min(720,J?q:Y));$({position:"fixed",width:`${O}px`,maxHeight:`${K}px`,left:`${ae}px`,transform:"none",top:J?void 0:`${c.bottom+8}px`,bottom:J?`${w-c.top+8}px`:void 0})};return s(),window.addEventListener("resize",s),window.addEventListener("scroll",s,{passive:!0}),()=>{window.removeEventListener("resize",s),window.removeEventListener("scroll",s)}},[o,p,r]);const C=s=>{L(c=>c.has(s)?new Set:new Set([s]))},E=s=>{if(S.length===0)return;const c=S.findIndex(O=>O.id===b),w=c===-1?0:c,k=Math.min(S.length-1,Math.max(0,w+s)),D=S[k];j(D?.id??null)},F=(s,c)=>{if(s.key==="ArrowDown"&&(s.preventDefault(),E(1)),s.key==="ArrowUp"&&(s.preventDefault(),E(-1)),s.key==="Escape"){s.preventDefault(),f(!1);return}const w=S.find(k=>k.id===c);w&&(w.kind==="group"&&(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),C(w.groupId)),w.kind==="option"&&(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),a(w.marketId),f(!1)))},B=(s,c)=>{v.current.set(s,c)},g=()=>f(!1),n=()=>f(s=>!s),i=s=>{a(s),g()};return e.jsxs("div",{className:"relative flex min-w-[220px] flex-col gap-1 text-[#e8ecf5]",ref:A,children:[e.jsx(at,{selectedMarket:I??null,isOpen:o,onToggle:n,onClose:g,toggleRef:P}),o?e.jsx(it,{normalizedGroups:p,expandedGroupIds:y,focusedItemId:b,onToggleGroup:C,onKeyDown:F,setItemRef:B,onFocusItem:j,selectedMarketId:r,onSelect:i,onDelete:d,requestState:l,dropdownStyle:R}):null]})},me=({label:t,variant:r="danger",className:a="","aria-label":d})=>{const l={danger:"border-[rgba(230,57,70,0.45)] bg-[rgba(230,57,70,0.15)] text-[#e8ecf5]",warning:"border-[#ffd447] bg-[#ffd447] text-[#0e1422] animate-pulse shadow-[0_0_0_0_rgba(255,212,71,0.45)]"};return e.jsx("div",{className:`inline-flex items-center justify-center rounded-full border px-3 py-1 text-sm font-semibold ${l[r]} ${a}`,"aria-label":d,"data-testid":`status-badge-${t.toLowerCase()}`,children:t})},dt=({status:t,isLive:r,externalUrl:a,lastUpdated:d,stats:l})=>e.jsx("header",{className:"rounded-[24px] border border-white/10 bg-[linear-gradient(120deg,rgba(14,20,34,0.85),rgba(14,20,34,0.65))] p-[clamp(1.25rem,3vw,2rem)] shadow-[0_20px_60px_rgba(0,0,0,0.35)]","data-testid":"market-header",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[t!=="OPEN"&&t&&e.jsx(me,{label:t,"aria-label":"Market status"}),r&&e.jsx(me,{label:"LIVE",variant:"warning","aria-label":"Market live"}),e.jsxs("div",{className:"flex flex-col items-start gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-2",children:[e.jsx("a",{className:"text-sm font-semibold text-[#9aa5c0] underline decoration-slate-500 underline-offset-4 hover:text-[#e8ecf5]",href:a,target:"_blank",rel:"noreferrer noopener","data-testid":"external-market-link",children:"Original data"}),e.jsx("div",{className:"text-sm font-medium text-[#9aa5c0]","data-testid":"last-updated",children:d?`Updated ${d}`:"Fetching data..."})]}),l&&e.jsx("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-sm font-semibold text-[#e8ecf5]","aria-label":"Total runners","data-testid":"market-stats",children:l})]})]})}),ct=({message:t="Loading..."})=>e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 fixed right-6 bottom-6 z-50 flex items-center gap-3 rounded-2xl border border-white/10 bg-[#0e1422]/80 px-6 py-4 shadow-[0_20px_60px_rgba(0,0,0,0.5)] backdrop-blur-md","data-testid":"loading-toast",children:[e.jsx(he,{size:20,className:"animate-spin text-emerald-400"}),e.jsx("span",{className:"font-bold text-white",children:t})]}),ut={id:"valueLabel",afterDatasetsDraw(t,r,a){const d=t.config.type;if(d&&d!=="bar")return;const{ctx:l,data:h}=t,x=a?.color??"#e8ecf5";l.save();const p=t.getSortedVisibleDatasetMetas(),o=p[p.length-1];o&&(o.data.forEach((f,y)=>{const L=a?.impliedProbabilities?.[y],b=typeof L=="number"?L:h.datasets?.reduce((R,$)=>{const A=$?.data?.[y];return typeof A=="number"?R+A:R},0);if(typeof b!="number"||b<=0)return;const j=f.tooltipPosition(!0);j.x===null||j.y===null||(l.fillStyle=x,l.font='600 12px "Inter", system-ui, -apple-system, sans-serif',l.textBaseline="middle",l.textAlign="left",l.fillText(`${b.toFixed(1)}%`,j.x+6,j.y))}),l.restore())}};Chart.Chart.register(Chart.ArcElement,Chart.BarElement,Chart.CategoryScale,Chart.LinearScale,Chart.Legend,Chart.Title,Chart.Tooltip,ut);const te=["#ba0034","#0293d9","#ff901a","#50469d","#eb9fa2","#87365c","#97d76f","#ed2fa4","#0b6109","#ffa1e4","#01dbc6"],se=t=>t===null||Number.isNaN(t)?"—":`${(t*100).toFixed(1)}%`,mt=()=>typeof window>"u"?de:new URLSearchParams(window.location.search).get("marketId")??de,ht=({marketGroups:t,marketListState:r})=>{const[a,d]=React.useState(null),[l,h]=React.useState("idle"),[x,p]=React.useState(null),[o,f]=React.useState(()=>mt()),[y,L]=React.useState(!1),b=React.useRef(!0),j=React.useCallback(async(g,n=!1)=>{h("loading"),p(null),n&&L(!0);try{const i=await fetch(`${T}/odds/market-data/${g}`);if(!i.ok)throw new Error(`Request failed with status ${i.status}`);const s=await i.json(),c=Ze(s,new Date);d(c),h("success")}catch(i){console.error("Failed to fetch market",i),h("error"),p("We could not load market prices. Please retry.")}finally{n&&setTimeout(()=>L(!1),1e3)}},[]);React.useEffect(()=>{if(o){const g=!b.current;j(o,g),b.current=!1}},[j,o]),React.useEffect(()=>{if(typeof window>"u")return;const g=new URLSearchParams(window.location.search),n=g.get("marketId");if(o&&n!==o){g.set("marketId",o);const i=`${window.location.pathname}?${g.toString()}${window.location.hash}`;window.history.replaceState({},"",i)}},[o]);const R=React.useMemo(()=>a?new Date(a.fetchedAt).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",weekday:"short",month:"short",day:"numeric"}):null,[a]),$=React.useMemo(()=>{if(!a)return null;const g=a.runners.map(c=>c.name),n=a.runners.map((c,w)=>c.name.startsWith("Others")?"#9aa0ae":te[w%te.length]),i=a.runners.map(c=>Math.max(0,c.probabilityMin??0)*100),s=a.runners.map(c=>{const w=Math.max(0,c.probabilityMin??0),k=Math.max(w,c.probabilityMax??w);return Math.max(0,k-w)*100});return{labels:g,datasets:[{label:"Minimum probability (%)",data:i,backgroundColor:n,borderColor:n,borderWidth:1,borderSkipped:!1,stack:"probability"},{label:"Spread from min to max (%)",data:s,backgroundColor:"#ffffff",borderColor:"#ffffff",borderWidth:1,borderRadius:{topRight:3,bottomRight:3,topLeft:0,bottomLeft:0},borderSkipped:!1,stack:"probability"}]}},[a]),A=React.useMemo(()=>{if(!a)return null;const g=a.runners.map(s=>(s.impliedProbability??0)*100),n=a.runners.reduce((s,c)=>{const w=(c.probabilityMax??0)*100;return w>s?w:s},0),i=Math.max(5,n);return{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(s){const c=a.runners[s.dataIndex],w=se(c.probabilityMin),k=se(c.probabilityMax);return`${c.name} — ${w} to ${k}`}}},valueLabel:{color:"#e8ecf5",impliedProbabilities:g}},scales:{x:{stacked:!0,grid:{color:"rgba(232, 236, 245, 0.50)"},ticks:{color:"#e8ecf5",callback:s=>`${s}%`},suggestedMax:i},y:{stacked:!0,grid:{display:!1},ticks:{color:s=>{const c=s.tick?.label;if(typeof c=="string"){if(c.startsWith(be))return"#ff3b30";if(c.startsWith("Others"))return"#9aa0ae"}return"#e8ecf5"},autoSkip:!1}}}}},[a]),P=React.useMemo(()=>{if(!a)return null;const g=a.runners.map(i=>i.name),n=a.runners.map((i,s)=>i.name.startsWith("Others")?"#9aa0ae":te[s%te.length]);return{labels:g,datasets:[{label:"Implied probability",data:a.runners.map(i=>(i.impliedProbability??0)*100),backgroundColor:n,borderWidth:0}]}},[a]),v=React.useMemo(()=>a?{animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(g){const n=a.runners[g.dataIndex];return`${n.name}: ${se(n.impliedProbability)}`}}}}}:null,[a]),M=React.useMemo(()=>a?Math.max(320,a.runners.length*34):320,[a]),I=React.useMemo(()=>{if(!a)return"bar-empty";const g=a.runners.map(n=>n.id).join("-");return`${a.marketId}-${g}-${a.fetchedAt}`},[a]),S=React.useMemo(()=>{if(!a)return"";const g=a.runners.filter(s=>s.status==="ACTIVE"&&!s.name.startsWith("Others")).length,n=Math.max(0,a.activeRunnerCount-g),i=a.numberOfWinners-a.winnerRunnerCount;return[`${a.activeRunnerCount} still active`,n>0?` (${g} displayed + ${n} others below 1%)`:"",a.winnerRunnerCount>0?` + ${a.winnerRunnerCount} already won`:"",a.loserRunnerCount>0?` + ${a.loserRunnerCount} already lost`:"",a.winnerRunnerCount+a.loserRunnerCount>0?` = ${a.totalRunners} starters`:"",i>1?` ; ${i} winning spots left`:""].join("")},[a]),C=React.useMemo(()=>`https://www.betfair.com/exchange/plus/politics/market/${o}`,[o]),E=l==="loading"&&!a,F=a?.runners.length===0,B=a?.inplay??!1;return e.jsxs("div",{className:"mx-auto flex max-w-[1200px] flex-col gap-6 pt-2 pb-[clamp(1.25rem,4vw,2.5rem)] md:px-8 md:pt-8","data-testid":"public-view",children:[e.jsx("div",{className:"max-w-md","data-testid":"market-dropdown-container",children:e.jsx(lt,{groups:t,selectedMarketId:o,onSelect:f,requestState:r})}),e.jsx(dt,{status:a?.status,isLive:B,externalUrl:C,lastUpdated:R,stats:S}),x&&e.jsxs("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[rgba(230,57,70,0.5)] bg-[rgba(230,57,70,0.1)] px-4 py-3 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:flex-row md:items-center md:justify-between",role:"alert","aria-live":"assertive","data-testid":"error-message",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-lg font-bold text-[#e8ecf5]",children:"Price fetch failed"}),e.jsx("p",{className:"m-0 mt-1 text-sm text-[#9aa5c0]",children:x})]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-lg border border-white/15 bg-white/5 px-3 py-2 font-semibold text-[#e8ecf5] hover:border-white/30",onClick:()=>{j(o)},"data-testid":"retry-button",children:"Retry"})]}),e.jsx("section",{className:"grid grid-cols-1 gap-4","data-testid":"charts-section",children:e.jsxs("div",{className:"w-full rounded-2xl border border-white/10 bg-[#0e1422] py-4 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:p-4",children:[e.jsx("h2",{className:"mb-4 px-2 text-xl font-semibold",children:"Probability"}),E&&e.jsx("div",{className:"mt-3 flex flex-col gap-2","aria-hidden":"true","data-testid":"loading-skeleton",children:Array.from({length:5}).map((g,n)=>e.jsx("div",{className:"h-4 animate-pulse rounded-md bg-white/10"},n))}),!E&&a&&!F&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"bar-chart-container",children:$&&e.jsx("div",{className:"w-full",style:{height:`${M}px`},children:e.jsx(Ge,{data:$,options:A},I)})}),e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"pie-chart-container",children:P&&e.jsx("div",{className:"min-h-[260px] w-full",children:e.jsx(Fe,{data:P,options:v})})})]}),!E&&F&&e.jsx("p",{className:"mt-3 text-[#9aa5c0]",role:"status","data-testid":"no-runners-message",children:"No runners available right now."})]})}),y&&e.jsx(ct,{})]})},pt=()=>{const t=ze(),r=()=>t.user&&t.showEdit?e.jsx(He,{marketGroups:t.marketGroups,onAddMarket:t.handleAddMarket,onDeleteMarket:t.handleDeleteMarket,onToggleFavorite:t.handleToggleFavorite,onGetMarketName:t.handleGetMarketName,onAddGroup:t.handleAddGroup,onDeleteGroup:t.handleDeleteGroup,onReorderGroups:t.handleReorderGroups,onReorderMarkets:t.handleReorderMarkets,onImportYaml:t.handleImportYaml,onExportYaml:t.handleExportYaml,requestState:t.marketListState}):t.showLogin?e.jsx(qe,{}):e.jsx(ht,{marketGroups:t.marketGroups,marketListState:t.marketListState});return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_-10%,rgba(230,57,70,0.18),transparent_35%),radial-gradient(circle_at_80%_20%,rgba(118,174,255,0.12),transparent_40%),#060910] font-sans text-[#e8ecf5]",style:{colorScheme:"dark"},children:[e.jsx(Ye,{title:"Odds",isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,onLoginClick:t.navigateToLogin,onLogoutClick:t.logout,onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,showLoginButton:!t.user&&!t.showLogin}),r()]})},ye=document.getElementById("root");if(!ye)throw new Error("Root element #root not found");document.body.classList.add("odds-page");ReactDOM.createRoot(ye).render(e.jsx(React.StrictMode,{children:e.jsx(Oe,{children:e.jsx(pt,{})})}));
