import"./index-CiIqH9NT.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as be,P as ce,T as je}from"./Toast-CC0uQ94P.js";import{A as O}from"./api-CH_Pe6Vg.js";import{B as A}from"./button-BRMX--fC.js";import{M as ie,C as le,a as ve}from"./map-BsqQ6ULd.js";import{C as Ne}from"./chevron-left-CGHllpLw.js";import{c as F}from"./createLucideIcon-DtX1aPOG.js";import{L as pe,a as Y,I as J}from"./label-D6I6lMvU.js";import{L as Se}from"./log-out-B0TqtotO.js";import{U as ke,D as Ce,G as _e}from"./upload-CK6mc6ZD.js";import{P as de}from"./pen-vQk8amFZ.js";import{S as Le}from"./search-Cfl0sis-.js";import{X as Ie}from"./x-BS-d4QNZ.js";import{S as Re}from"./save-rN7CZjMN.js";import{T as De}from"./trash-2-DQbJ9aIh.js";import{L as Te}from"./index-BehiXGmn.js";import"./utils-CN4411gJ.js";import"./clsx-B-dksMZM.js";const Ae=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Pe=F("clock",Ae);const ze=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],ue=F("cloud-rain",ze);const Ee=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]],Ue=F("cloud-sun",Ee);const Me=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],$e=F("layers",Me);const We=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Oe=F("sun",We);const Fe=[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m4.93 10.93 1.41 1.41",key:"2a7f42"}],["path",{d:"M2 18h2",key:"j10viu"}],["path",{d:"M20 18h2",key:"wocana"}],["path",{d:"m19.07 10.93-1.41 1.41",key:"15zs5n"}],["path",{d:"M22 22H2",key:"19qnx5"}],["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M16 18a4 4 0 0 0-8 0",key:"1lzouq"}]],He=F("sunrise",Fe);const Ge=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],me=F("thermometer",Ge);const Ve=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],qe=F("zoom-in",Ve),re="e1f10a1e78da46f5b10a1e78da96f525";function oe(t,a){return t.map(s=>s!==null&&s<=a?0:s)}const te=()=>{const t=localStorage.getItem("weather_token"),a={"Content-Type":"application/json"};return t&&(a.Authorization=`Bearer ${t}`),a},E={async getPlaces(){const t=await fetch(`${O}/weather/data`);if(!t.ok)throw new Error("Failed to fetch places");return(await t.json()).places},async login(t,a){const s=await fetch(`${O}/weather/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a})});if(!s.ok)throw new Error("Login failed");return s.json()},async getMe(){const t=await fetch(`${O}/weather/me`,{headers:te()});if(!t.ok)throw new Error("Failed to get user");return t.json()},async addPlace(t){const a=await fetch(`${O}/weather/places`,{method:"POST",headers:te(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to add place");return a.json()},async updatePlace(t,a){const s=await fetch(`${O}/weather/places/${t}`,{method:"PUT",headers:te(),body:JSON.stringify(a)});if(!s.ok)throw new Error("Failed to update place");return s.json()},async deletePlace(t){const a=await fetch(`${O}/weather/places/${t}`,{method:"DELETE",headers:te()});if(!a.ok)throw new Error("Failed to delete place");return a.json()},async reorderPlaces(t){const a=await fetch(`${O}/weather/places/reorder`,{method:"POST",headers:te(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to reorder places");return a.json()},async searchPlace(t){const a=await fetch(`${O}/weather/search?link_wu=${encodeURIComponent(t)}`,{headers:te()});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.detail||"Failed to search place")}return a.json()},async fetchWUForecast(t){const a=`https://api.weather.com/v3/wx/forecast/hourly/15day?apiKey=${re}&geocode=${t.coords[0]}%2C${t.coords[1]}&units=m&language=en-US&format=json`,n=await(await fetch(a,{referrerPolicy:"no-referrer"})).json();return{tzOffset:n.validTimeLocal[0]?.slice(19),x:n.validTimeLocal.map(u=>new Date(u.slice(0,19))),y_precipitation:n.qpf,y_humidity:n.relativeHumidity,y_snow:oe(n.qpfSnow,0),y_temperature:n.temperature,y_windGust:n.windGust,y_precipChance:n.precipChance,y_uvIndex:oe(n.uvIndex,0),y_cloudCover:oe(n.cloudCover,0)}},async fetchWUHistory(t){const a=`https://api.weather.com/v3/wx/conditions/historical/hourly/1day?apiKey=${re}&geocode=${t.coords[0]}%2C${t.coords[1]}&units=m&language=en-US&format=json`,n=await(await fetch(a,{referrerPolicy:"no-referrer"})).json();return{tzOffset:n.validTimeLocal[0]?.slice(19),x:n.validTimeLocal.map(u=>new Date(u.slice(0,19))),y_precipitation:[],y_humidity:n.relativeHumidity,y_snow:[],y_temperature:n.temperature,y_windGust:n.windGust,y_precipChance:[],y_uvIndex:oe(n.uvIndex,0),y_cloudCover:[],sunriseTimeLocal:n.sunriseTimeLocal[0],sunsetTimeLocal:n.sunsetTimeLocal[0]}},async fetchWUPollen(t){const a=`https://api.weather.com/v2/turbo/vt1pollenforecast?apiKey=${re}&geocode=${t.coords[0]}%2C${t.coords[1]}&language=en&format=json`,n=await(await fetch(a)).json();return{x:n.vt1pollenforecast?.reportDate.map(u=>new Date(u.slice(0,19)))||[],y_tree:n.vt1pollenforecast?.tree||[],y_weed:n.vt1pollenforecast?.weed||[],y_grass:n.vt1pollenforecast?.grass||[]}}},Be=()=>{const[t,a]=React.useState([]),[s,n]=React.useState(null),[u,j]=React.useState(()=>{const o=localStorage.getItem("weather_zoom");return o==="STANDARD"?"z1x":o==="DETAILED"?"z2x":o==="MACRO"?"z3x":o==="COMPACT"?"z2x":o||"z2x"}),[d,w]=React.useState(!0),[v,b]=React.useState(null),[N,m]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[i,g]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit"),[S,_]=React.useState("idle"),H=React.useCallback(async()=>{_("loading");try{const o=await E.getPlaces();a(o);const D=new URLSearchParams(window.location.search).get("location"),Q=localStorage.getItem("weather_location"),ee=o.find(B=>B.name===D)||o.find(B=>B.name===Q)||o[0];n(ee),_("success")}catch(o){console.error("Failed to load places",o),_("error")}finally{w(!1)}},[]);React.useEffect(()=>{H(),localStorage.getItem("weather_token")&&E.getMe().then(b).catch(()=>{localStorage.removeItem("weather_token"),b(null)})},[H]),React.useEffect(()=>{const o=()=>{const p=new URLSearchParams(window.location.search);m(p.get("view")==="login"),g(p.get("view")==="edit");const D=p.get("location");D&&a(Q=>{const ee=Q.find(B=>B.name===D);return ee&&n(ee),Q})};return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]);const K=()=>{const o=new URLSearchParams(window.location.search);o.get("view")!=="login"&&(o.set("view","login"),window.history.pushState({},"",`?${o.toString()}`),m(!0),g(!1))},G=()=>{const o=new URLSearchParams(window.location.search);o.get("view")!=="edit"&&(o.set("view","edit"),window.history.pushState({},"",`?${o.toString()}`),g(!0),m(!1))},U=()=>{const o=new URLSearchParams(window.location.search);if(o.has("view")){o.delete("view");const p=o.toString();window.history.pushState({},"",p?`?${p}`:window.location.pathname),m(!1),g(!1)}else m(!1),g(!1)};return React.useEffect(()=>{v&&new URLSearchParams(window.location.search).get("view")!=="edit"&&G()},[v]),{places:t,selectedPlace:s,loading:d,user:v,showLogin:N,showEdit:i,requestState:S,zoomLevel:u,setZoomLevel:o=>{j(o),localStorage.setItem("weather_zoom",o)},handlePlaceChange:o=>{n(o),localStorage.setItem("weather_location",o.name);const p=new URLSearchParams(window.location.search);p.get("location")!==o.name&&(p.set("location",o.name),window.history.pushState({},"",`?${p.toString()}`))},login:async(o,p)=>{try{const D=await E.login(o,p);return localStorage.setItem("weather_token",D.access_token),b(D.user),!0}catch(D){return console.error("Login failed",D),!1}},logout:()=>{localStorage.removeItem("weather_token"),b(null),U()},navigateToLogin:K,navigateToEdit:G,navigateToPublic:U,handleAddPlace:async o=>{const p=await E.addPlace(o);a(p.places)},handleUpdatePlace:async(o,p)=>{const D=await E.updatePlace(o,p);a(D.places)},handleDeletePlace:async o=>{if(!window.confirm("Are you sure you want to delete this location?"))return;const p=await E.deletePlace(o);a(p.places)},handleReorderPlaces:async o=>{const p=await E.reorderPlaces(o);a(p.places)},handleSearchPlace:async o=>await E.searchPlace(o)}},he=({places:t,selectedPlace:a,onSelect:s})=>{const[n,u]=React.useState(!1),[j,d]=React.useState(null),w=React.useRef(null),v=React.useRef(null),{groups:b,standalone:N}=React.useMemo(()=>{const i={},g=[];return t.forEach(S=>{S.group?(i[S.group]||(i[S.group]=[]),i[S.group].push(S)):g.push(S)}),{groups:i,standalone:g}},[t]);React.useEffect(()=>{const i=g=>{w.current&&!w.current.contains(g.target)&&u(!1)};return n&&document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[n]),React.useEffect(()=>{n?a?.group&&d(a.group):d(null)},[n,a]);const m=i=>{s(i),u(!1)};return e.jsxs("div",{className:"relative inline-block w-full md:w-64",ref:w,"data-testid":"place-dropdown",children:[e.jsxs("button",{type:"button",ref:v,onClick:()=>u(!n),className:"flex w-full items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-2 text-left font-semibold text-slate-700 shadow-sm transition-all hover:bg-slate-50 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none","aria-haspopup":"listbox","aria-expanded":n,"data-testid":"place-dropdown-trigger",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(ie,{className:"size-4 shrink-0 text-indigo-500"}),e.jsx("span",{className:"truncate",children:a?.name||"Select location..."})]}),e.jsx(le,{className:`size-4 text-slate-400 transition-transform duration-200 ${n?"rotate-180":""}`})]}),n&&e.jsx("div",{className:"animate-in fade-in zoom-in absolute z-20 mt-2 max-h-80 w-full overflow-hidden rounded-xl border border-slate-200 bg-white p-1 shadow-xl duration-200",role:"listbox",children:j?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("button",{type:"button",onClick:()=>d(null),className:"flex w-full items-center gap-2 rounded-lg border-b border-slate-100 px-3 py-2 text-left text-xs font-bold text-indigo-600 transition-colors hover:bg-slate-50","data-testid":"group-back-button",children:[e.jsx(Ne,{className:"size-3.5"}),e.jsx("span",{children:"Back to all"}),e.jsx("span",{className:"ml-auto font-normal text-slate-400",children:j})]}),e.jsx("ul",{className:"max-h-60 overflow-auto p-1",children:b[j].map(i=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>m(i),className:`flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-sm transition-colors ${a?.name===i.name?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":a?.name===i.name,"data-testid":`place-item-${i.name}`,children:[e.jsx(ie,{className:`size-3.5 ${a?.name===i.name?"text-indigo-500":"text-slate-400"}`}),e.jsx("span",{className:"truncate",children:i.name}),i.country&&e.jsx("span",{className:"ml-auto text-[10px] font-medium tracking-wider text-slate-400 uppercase",children:i.country})]})},i.name))})]}):e.jsxs("ul",{className:"max-h-60 overflow-auto",children:[Object.keys(b).map(i=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>d(i),className:"flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm text-slate-600 transition-colors hover:bg-slate-50","data-testid":`group-item-${i}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"size-3.5 text-indigo-400"}),e.jsx("span",{className:"font-semibold",children:i})]}),e.jsx(le,{className:"size-3.5 -rotate-90 text-slate-300"})]})},i)),N.map(i=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>m(i),className:`flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-sm transition-colors ${a?.name===i.name?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":a?.name===i.name,"data-testid":`place-item-${i.name}`,children:[e.jsx(ie,{className:`size-3.5 ${a?.name===i.name?"text-indigo-500":"text-slate-400"}`}),e.jsx("span",{className:"truncate",children:i.name}),i.country&&e.jsx("span",{className:"ml-auto text-[10px] font-medium tracking-wider text-slate-400 uppercase",children:i.country})]})},i.name))]})})]})},Ze=({isAdmin:t,userEmail:a,userFirstName:s,onLoginClick:n,onLogoutClick:u,onLogoClick:j,showLoginButton:d,places:w=[],selectedPlace:v=null,onPlaceChange:b})=>e.jsxs("header",{className:"sticky top-0 z-10 w-full border-b bg-white shadow-sm","data-testid":"weather-navbar",children:[e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between gap-4 px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:j,className:"flex items-center gap-2 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:[e.jsx("img",{src:"/favicon_weather.png",alt:"",className:"size-8","aria-hidden":"true"}),e.jsx("h1",{className:"bg-gradient-to-r from-indigo-600 to-violet-600 bg-clip-text text-2xl font-bold text-transparent",children:"Weather"})]})}),b&&e.jsx("div",{className:"hidden max-w-md flex-1 items-center gap-3 md:flex","data-testid":"place-dropdown-desktop",children:e.jsx(he,{places:w,selectedPlace:v,onSelect:b})}),e.jsxs("div",{className:"flex items-center gap-4",children:[d&&e.jsxs(A,{variant:"ghost",className:"gap-2 text-slate-600 hover:bg-slate-100",onClick:n,"data-testid":"login-button",children:[e.jsx(pe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Login"})]}),a&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"hidden text-sm font-medium text-slate-500 md:inline","data-testid":"user-display-name",children:s||a}),e.jsx(A,{variant:"ghost",size:"icon",onClick:u,className:"text-slate-400 hover:bg-slate-100 hover:text-red-500",title:"Logout","data-testid":"logout-button",children:e.jsx(Se,{size:20})})]})]})]}),b&&e.jsx("div",{className:"border-t px-4 py-2 md:hidden","data-testid":"place-dropdown-mobile",children:e.jsx(he,{places:w,selectedPlace:v,onSelect:b})})]}),Ye=({onLogin:t,onCancel:a})=>{const[s,n]=React.useState(""),[u,j]=React.useState(""),[d,w]=React.useState(""),[v,b]=React.useState(!1),N=async m=>{m.preventDefault(),w(""),b(!0),await t(s,u)||(w("Invalid email or password"),b(!1))};return e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4","data-testid":"login-view",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-white p-8 shadow-xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 rounded-2xl bg-indigo-50 p-3",children:e.jsx(pe,{className:"size-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold","data-testid":"login-title",children:"Admin Login"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Access dashboard management"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"email",children:"Email address"}),e.jsx(J,{id:"email",type:"email",autoComplete:"email",value:s,onChange:m=>n(m.target.value),placeholder:"admin@example.com",required:!0,className:"rounded-xl","data-testid":"login-email-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"password",children:"Password"}),e.jsx(J,{id:"password",type:"password",autoComplete:"current-password",value:u,onChange:m=>j(m.target.value),placeholder:"••••••••",required:!0,className:"rounded-xl","data-testid":"login-password-input"})]}),d&&e.jsx("p",{className:"text-sm font-medium text-red-500","data-testid":"login-error-message",children:d}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[e.jsx(A,{type:"submit",disabled:v,className:"h-auto w-full rounded-xl py-6 text-lg","data-testid":"login-submit-button",children:v?"Logging in...":"Login"}),e.jsx(A,{type:"button",variant:"ghost",onClick:a,className:"w-full text-slate-500","data-testid":"login-cancel-button",children:"Cancel"})]})]})]})})},Je=({places:t,onAddPlace:a,onUpdatePlace:s,onDeletePlace:n,onReorderPlaces:u,onSearchPlace:j})=>{const{successToast:d,errorToast:w,warningToast:v}=be(),[b,N]=React.useState(!1),[m,i]=React.useState(!1),[g,S]=React.useState(!1),[_,H]=React.useState(null),[K,G]=React.useState(!1),U=React.useRef(null),[r,C]=React.useState({name:"",coords:[0,0],linkWU:"",country:"",group:""}),[P,V]=React.useState(""),[M,q]=React.useState(null),[X,z]=React.useState(null),$=()=>{C({name:"",coords:[0,0],linkWU:"",country:"",group:""}),V(""),N(!1),H(null),i(!1),S(!1)},o=l=>{C(l),V(`${l.coords[0]}, ${l.coords[1]}`),H(l.id||null),N(!1)},p=async()=>{if(r.linkWU){i(!0);try{const l=await j(r.linkWU);C(y=>({...y,name:l.city||y.name,coords:[l.lat,l.lon],country:l.countryCode||y.country})),V(`${l.lat}, ${l.lon}`)}catch(l){w(`Failed to fetch coordinates: ${l}`)}finally{i(!1)}}},D=()=>{const l={};t.forEach(({name:I,coords:x,linkWU:Z,country:k,group:se})=>{const ne=se||null,W=ne===null?"__standalone__":ne;l[W]||(l[W]={name:ne,items:[]}),l[W].items.push({name:I,lat:x[0],lon:x[1],link_wu:Z,country:k||""})});const y={places:Object.values(l)},c=jsyaml.dump(y),T=new Blob([c],{type:"text/yaml"}),L=URL.createObjectURL(T),R=document.createElement("a");R.href=L,R.download=`weather-places-${new Date().toISOString().split("T")[0]}.yml`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(L)},Q=async l=>{const y=l.target.files?.[0];if(!y)return;G(!0);const c=new FileReader;c.onload=async T=>{try{const L=T.target?.result,R=jsyaml.load(L),I=R?.places||(Array.isArray(R)?R:[]);if(!Array.isArray(I))throw new Error("Invalid YAML format: expected an array of places or groups");let x=0;const Z=async(k,se)=>{const ne=se||""||k.group||"",W={name:k.name||"",coords:k.coords||[k.lat||0,k.lon||0],linkWU:k.link_wu||k.linkWU||"",country:k.country||"",group:ne};W.name&&W.linkWU&&(t.some(we=>we.name.toLowerCase()===W.name.toLowerCase())||(await a(W),x++))};for(const k of I)if(k.items&&Array.isArray(k.items))for(const se of k.items)await Z(se,k.name);else await Z(k);d(`Successfully imported ${x} locations.`)}catch(L){w(`Failed to import YAML: ${L}`)}finally{G(!1),U.current&&(U.current.value="")}},c.readAsText(y)},ee=async l=>{l.preventDefault();let y=r.coords,c=r.name,T=r.country;const L=P.trim();if(L===""||L==="0, 0"||L==="0,0"){if(r.linkWU){S(!0);try{const x=await j(r.linkWU);y=[x.lat,x.lon],c=r.name||x.city||"",T=r.country||x.countryCode||""}catch(x){w(`Failed to fetch coordinates: ${x}`),S(!1);return}finally{S(!1)}}}else{const x=L.split(/[, ]+/);if(x.length>=2){const Z=parseFloat(x[0]),k=parseFloat(x[1]);!isNaN(Z)&&!isNaN(k)&&(y=[Z,k])}}const R={...r,name:c,country:T,coords:y};if(t.some(x=>x.name.toLowerCase()===c.toLowerCase()&&x.id!==_)){v(`A location with the name "${c}" already exists.`);return}try{_?await s(_,R):await a(R),$()}catch(x){w(`Failed to save location: ${x}`)}},B=l=>{q(l)},ge=(l,y)=>{if(l.preventDefault(),M===null||M===y)return;const c=t.findIndex(I=>I.id===M),T=t.findIndex(I=>I.id===y);if(c===-1||T===-1)return;const L=[...t],[R]=L.splice(c,1);if(L.splice(T,0,R),L.map(I=>I.id).join(",")!==t.map(I=>I.id).join(",")){const I=L.map(x=>x.id).filter(x=>x!==void 0);u(I).catch(x=>console.error("Failed to reorder",x))}},ye=()=>{q(null),z(null)};return e.jsxs("div",{className:"mx-auto max-w-4xl py-8 md:px-4","data-testid":"management-view",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-start justify-between gap-4 px-4 sm:flex-row sm:items-center",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold","data-testid":"management-title",children:"Manage"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("input",{type:"file",accept:".yml,.yaml",className:"hidden",ref:U,onChange:Q,disabled:K}),e.jsxs(A,{variant:"outline",onClick:()=>U.current?.click(),className:"gap-2 rounded-xl",disabled:K,"data-testid":"import-yaml-button",children:[e.jsx(ke,{size:18})," Import YAML"]}),e.jsxs(A,{variant:"outline",onClick:D,className:"gap-2 rounded-xl","data-testid":"export-yaml-button",children:[e.jsx(Ce,{size:18})," Export YAML"]}),e.jsxs(A,{onClick:()=>{$(),N(!0)},className:"gap-2 rounded-xl","data-testid":"add-place-button",children:[e.jsx(ce,{size:18})," Add New Location"]})]})]}),(b||_)&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-4 mb-8 rounded-2xl border bg-white p-6 shadow-lg duration-300","data-testid":"place-form-container",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-lg font-bold",children:[_?e.jsx(de,{size:20,className:"text-indigo-600"}):e.jsx(ce,{size:20,className:"text-indigo-600"}),_?"Edit Location":"Add New Location"]}),e.jsxs("form",{onSubmit:ee,className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{htmlFor:"name",children:["City Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(J,{id:"name",value:r.name,onChange:l=>C({...r,name:l.target.value}),required:!0,className:"rounded-xl","data-testid":"place-name-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"country",children:"Country Code"}),e.jsx(J,{id:"country",value:r.country||"",onChange:l=>C({...r,country:l.target.value}),placeholder:"GB, FRA, ZAF...",className:"rounded-xl","data-testid":"place-country-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"coords",children:"Coordinates (lat, lon)"}),e.jsx(J,{id:"coords",value:P,onChange:l=>V(l.target.value),placeholder:"51.507, -0.127 (Auto-fetch if empty)",className:"rounded-xl","data-testid":"place-coords-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Y,{htmlFor:"linkWU",children:["WU Path (or URL) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{id:"linkWU",value:r.linkWU,onChange:l=>{let y=l.target.value;const c="https://www.wunderground.com/weather/";y.startsWith(c)&&(y=y.substring(c.length)),C({...r,linkWU:y})},placeholder:"gb/london/ILONDO440",required:!0,className:"rounded-xl","data-testid":"place-link-wu-input"}),e.jsx(A,{type:"button",variant:"outline",size:"icon",onClick:p,disabled:!r.linkWU||m||g,className:"shrink-0 rounded-xl",title:"Fetch details from Wunderground","data-testid":"fetch-wu-details-button",children:e.jsx(Le,{size:18,className:m?"animate-pulse":""})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"group",children:"Group"}),e.jsx(J,{id:"group",value:r.group||"",onChange:l=>C({...r,group:l.target.value}),placeholder:"Europe, Asia...",className:"rounded-xl","data-testid":"place-group-input"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 md:col-span-2",children:[e.jsxs(A,{type:"button",variant:"outline",onClick:$,disabled:m||g,className:"rounded-xl","data-testid":"cancel-form-button",children:[e.jsx(Ie,{size:18,className:"mr-2"})," Cancel"]}),e.jsx(A,{type:"submit",className:"min-w-[120px] rounded-xl",disabled:m||g,"data-testid":"save-place-button",children:g?e.jsx(e.Fragment,{children:"Searching..."}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{size:18,className:"mr-2"})," ",_?"Update":"Save"]})})]})]})]}),e.jsx("div",{className:"custom-scrollbar overflow-x-auto rounded-2xl border bg-white shadow-sm","data-testid":"places-table-container",children:e.jsxs("table",{className:"w-full min-w-[600px] text-left",children:[e.jsx("thead",{className:"border-b bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold tracking-wider text-slate-500 uppercase",children:"Location"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold tracking-wider text-slate-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:Object.entries(t.reduce((l,y)=>{const c=y.group||"Standalone";return l[c]||(l[c]=[]),l[c].push(y),l},{})).map(([l,y])=>e.jsxs(React.Fragment,{children:[e.jsx("tr",{className:"bg-slate-50/50",children:e.jsx("td",{colSpan:2,className:"px-6 py-2 text-[0.75rem] font-bold tracking-widest text-indigo-500 uppercase",children:l})}),y.map(c=>(t.indexOf(c),e.jsxs("tr",{draggable:X===c.id,onDragStart:()=>c.id&&B(c.id),onDragOver:T=>c.id&&ge(T,c.id),onDragEnd:ye,className:`transition-colors hover:bg-slate-50 ${M===c.id?"bg-indigo-50/50 opacity-40":""} ${X===c.id?"select-none":""}`,"data-testid":`place-row-${c.id}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg bg-indigo-50 p-2",children:e.jsx(ie,{size:16,className:"text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:c.name}),e.jsx("div",{className:"flex gap-2 text-xs text-slate-400",children:e.jsx("span",{children:c.country||"N/A"})})]})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("a",{href:`https://www.wunderground.com/weather/${c.linkWU}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex rounded-lg p-2 text-slate-400 transition-colors hover:bg-indigo-50 hover:text-indigo-600",title:"View on Weather Underground","data-testid":"view-wu-link",children:e.jsx(Ue,{size:16})}),e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${c.coords[0]},${c.coords[1]}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex rounded-lg p-2 text-slate-400 transition-colors hover:bg-indigo-50 hover:text-indigo-600",title:"View on Google Maps","data-testid":"view-map-link",children:e.jsx(ve,{size:16})}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>o(c),className:"text-slate-400 hover:bg-indigo-50 hover:text-indigo-600",title:"Edit location","data-testid":`edit-place-${c.id}`,children:e.jsx(de,{size:16})}),e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>c.id&&n(c.id),className:"text-slate-400 hover:bg-red-50 hover:text-red-600",title:"Delete location","data-testid":`delete-place-${c.id}`,children:e.jsx(De,{size:16})}),e.jsx("div",{className:"cursor-grab touch-none p-2 text-slate-300 transition-colors hover:text-indigo-600 active:cursor-grabbing",title:"Hold to drag",onMouseDown:()=>z(c.id||null),onMouseUp:()=>z(null),onTouchStart:()=>z(c.id||null),onTouchEnd:()=>z(null),onTouchCancel:()=>z(null),onClick:T=>T.stopPropagation(),children:e.jsx(_e,{size:18})})]})})]},c.id)))]},l))})]})})]})},xe=[{value:"z1x",label:"1x"},{value:"z2x",label:"2x"},{value:"z3x",label:"3x"},{value:"z4x",label:"4x"}],Ke=({currentZoom:t,onSelect:a})=>{const[s,n]=React.useState(!1),u=React.useRef(null);React.useEffect(()=>{const d=w=>{u.current&&!u.current.contains(w.target)&&n(!1)};return s&&document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[s]);const j=xe.find(d=>d.value===t)?.label||t;return e.jsxs("div",{className:"relative inline-block",ref:u,"data-testid":"zoom-dropdown",children:[e.jsxs("button",{type:"button",onClick:()=>n(!s),className:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition-all hover:bg-slate-50 focus:outline-none",children:[e.jsx(qe,{className:"size-4 text-indigo-500"}),e.jsxs("span",{children:["Zoom: ",j]}),e.jsx(le,{className:`size-3 text-slate-400 transition-transform duration-200 ${s?"rotate-180":""}`})]}),s&&e.jsx("ul",{className:"animate-in fade-in zoom-in absolute right-0 z-20 mt-2 w-40 overflow-hidden rounded-xl border border-slate-200 bg-white p-1 shadow-xl duration-200",children:xe.map(d=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{a(d.value),n(!1)},className:`flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm transition-colors ${t===d.value?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,children:e.jsx("span",{children:d.label})})},d.value))})]})},f={LINE_WIDTH_DEFAULT:2,LINE_WIDTH_FILLED_AREA:2,TENSION:.3,POINT_RADIUS:1,HIT_RADIUS:16},Xe={z1x:"2000px",z2x:"4000px",z3x:"6000px",z4x:"8000px"},h={Temperature:"#ef4444",Precipitation:"#3b82f6",PrecipChance:"#0ea5e9",WindGust:"#8b5cf6",UV:"#f59e0b",CloudCover:"#94a3b8",Humidity:"#10b981",Snow:"#d946ef"};function Qe(){Chart.Chart.register(Chart.CategoryScale,Chart.LinearScale,Chart.PointElement,Chart.LineElement,Chart.BarElement,Chart.Title,Chart.Tooltip,Chart.Legend,Chart.Filler)}function fe(t){const a=new Date;if(!t||t==="Local")return a;let s=0;if(t!=="Z"){const u=t.startsWith("-")?-1:1,j=parseInt(t.slice(1,3)),d=parseInt(t.slice(3,5))||0;s=u*(j*36e5+d*6e4)}const n=a.getTime()+a.getTimezoneOffset()*6e4;return new Date(n+s)}const et={id:"nowLine",afterDatasetsDraw:t=>{const{ctx:a,chartArea:{top:s,bottom:n},scales:{x:u}}=t;if(!u)return;const j=t.options.plugins?.nowLine?.tzOffset,d=fe(j),w=t.data.labels;let v=-1,b=1/0;if(w.forEach((N,m)=>{const i=new Date(N),g=Math.abs(i.getTime()-d.getTime());g<b&&(b=g,v=m)}),v!==-1&&b<24*36e5){const N=u.getPixelForValue(w[v]);a.save(),a.beginPath(),a.lineWidth=2,a.strokeStyle="#0d9488",a.moveTo(N,s),a.lineTo(N,n),a.stroke(),a.fillStyle="#0d9488",a.font="bold 13px sans-serif",a.textAlign="left";const m=d.getHours().toString().padStart(2,"0"),i=d.getMinutes().toString().padStart(2,"0"),g=`${m}:${i}`,S=a.measureText(g);a.fillStyle="rgba(13, 148, 136, 0.9)",a.fillRect(N,s+10,S.width+16,24),a.fillStyle="#ffffff",a.fillText(g,N+8,s+27),a.restore()}}},tt=()=>({type:"category",grid:{color:t=>{const a=t.chart.data.labels[t.index];return new Date(a).getHours()===0?"#0f172a":"transparent"},lineWidth:t=>{const a=t.chart.data.labels[t.index];return new Date(a).getHours()===0?2:0},drawTicks:!0},ticks:{maxRotation:0,autoSkip:!1,padding:10,color:"#334155",font:{weight:"bold",size:14},callback:function(t){const a=this.getLabelForValue(t),s=new Date(a);return isNaN(s.getTime())?"":s.getHours()===12?s.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):""}}});Qe();const at=({place:t,zoomLevel:a})=>{const[s,n]=React.useState(null),[u,j]=React.useState(!0),d=React.useRef(null),w=React.useRef(null);if(React.useEffect(()=>{j(!0),Promise.all([E.fetchWUForecast(t),E.fetchWUHistory(t)]).then(([r,C])=>{n({forecast:r,history:C}),j(!1)})},[t]),React.useEffect(()=>{if(!u&&s&&d.current){const r=setTimeout(()=>{const C=w.current,P=d.current;if(C&&P){const V=fe(s.forecast.tzOffset),M=C.data.labels;let q=-1,X=1/0;if(M.forEach((z,$)=>{const o=new Date(z),p=Math.abs(o.getTime()-V.getTime());p<X&&(X=p,q=$)}),q!==-1){const $=C.scales.x.getPixelForValue(M[q])-P.offsetWidth/2;P.scrollTo({left:Math.max(0,$),behavior:"smooth"})}}},500);return()=>clearTimeout(r)}},[u,s,a]),u||!s)return e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-slate-400",children:"Loading forecast data..."})});const v=1440*60*1e3,b=[...s.history.x.slice().reverse(),...s.forecast.x].map(r=>r.toISOString()),N=s.history.x.length,m=s.history.sunriseTimeLocal?new Date(s.history.sunriseTimeLocal.slice(0,19)):null,i=s.history.sunsetTimeLocal?new Date(s.history.sunsetTimeLocal.slice(0,19)):null;let g=0,S=null;if(m&&i){const r=i.getTime()-m.getTime();g=r/v*100,S=new Date(m.getTime()+r/2)}const _=s.forecast.y_temperature.slice(0,24).filter(r=>r!==null),H=_.length>0?Math.min(..._):null,K=_.length>0?Math.max(..._):null,G={labels:b,datasets:[{label:"Temperature (°C)",data:[...s.history.y_temperature.slice().reverse(),...s.forecast.y_temperature],borderColor:h.Temperature,backgroundColor:h.Temperature+"20",yAxisID:"y_temp",tension:f.TENSION,pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,borderWidth:f.LINE_WIDTH_DEFAULT},{label:"Rain Probability (%)",data:[...Array(N).fill(null),...s.forecast.y_precipChance],borderColor:h.PrecipChance,backgroundColor:h.PrecipChance+"20",yAxisID:"y_perc",tension:f.TENSION,pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,borderWidth:f.LINE_WIDTH_DEFAULT},{label:"Rain (mm/h)",data:[...Array(N).fill(null),...s.forecast.y_precipitation],borderColor:h.Precipitation,backgroundColor:h.Precipitation+"40",yAxisID:"y_rain",fill:!0,pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,borderWidth:f.LINE_WIDTH_FILLED_AREA},{label:"Wind Gust (km/h)",data:[...s.history.y_windGust.slice().reverse(),...s.forecast.y_windGust],borderColor:h.WindGust,yAxisID:"y_wind",pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,borderDash:[5,5],borderWidth:f.LINE_WIDTH_DEFAULT},{label:"Cloud Cover (%)",data:[...s.history.y_cloudCover.slice().reverse(),...s.forecast.y_cloudCover],borderColor:h.CloudCover,yAxisID:"y_cloud",pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,fill:!1,borderWidth:f.LINE_WIDTH_DEFAULT},{label:"UV Index",data:[...s.history.y_uvIndex.slice().reverse(),...s.forecast.y_uvIndex],borderColor:h.UV,yAxisID:"y_uv",pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,fill:!1,borderWidth:f.LINE_WIDTH_DEFAULT},{label:"Humidity (%)",data:[...s.history.y_humidity.slice().reverse(),...s.forecast.y_humidity],borderColor:h.Humidity,yAxisID:"y_humidity",pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,fill:!1,borderWidth:f.LINE_WIDTH_DEFAULT},{label:"Snow (cm/h)",data:[...s.history.y_snow.slice().reverse(),...s.forecast.y_snow],borderColor:h.Snow,backgroundColor:h.Snow+"30",yAxisID:"y_snow",fill:"origin",pointRadius:f.POINT_RADIUS,pointHitRadius:f.HIT_RADIUS,borderWidth:f.LINE_WIDTH_FILLED_AREA}]},U={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!0},plugins:{legend:{position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{filter:r=>{const C=r.dataset.yAxisID,P=r.raw;return C==="y_temp"?!0:["y_perc","y_rain","y_uv","y_snow"].includes(C)?P!==0&&P!==null:!1},callbacks:{title:r=>new Date(r[0].label).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1})}},nowLine:{tzOffset:s.forecast.tzOffset}},scales:{x:tt(),y_temp:{type:"linear",display:!0,position:"left",grid:{color:"rgba(239, 68, 68, 0.15)",drawOnChartArea:!0},ticks:{color:h.Temperature,font:{size:10,weight:"bold"},stepSize:5,precision:0},title:{display:!0,text:"Temperature °C",color:h.Temperature,font:{size:12,weight:"bold"}},beginAtZero:!1,afterDataLimits:r=>{r.min=Math.floor(r.min/5)*5,r.max=Math.ceil(r.max/5)*5}},y_perc:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:h.PrecipChance,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"Rain %",color:h.PrecipChance,font:{size:12,weight:"bold"}}},y_rain:{type:"linear",display:!0,position:"left",min:0,suggestedMax:1,grid:{color:"rgba(59, 130, 246, 0.1)",drawOnChartArea:!0},ticks:{color:h.Precipitation,font:{size:10,weight:"bold"},stepSize:1},title:{display:!0,text:"Rain mm/h",color:h.Precipitation,font:{size:12,weight:"bold"}},afterDataLimits:r=>{r.max=Math.ceil(Math.max(r.max,1))}},y_snow:{type:"linear",display:!0,position:"left",min:0,suggestedMax:1,grid:{drawOnChartArea:!1},ticks:{color:h.Snow,font:{size:10,weight:"bold"},stepSize:1},title:{display:!0,text:"Snow cm/h",color:h.Snow,font:{size:12,weight:"bold"}},afterDataLimits:r=>{r.max=Math.ceil(Math.max(r.max,1))}},y_wind:{type:"linear",display:!0,position:"left",min:0,grid:{drawOnChartArea:!1},ticks:{color:h.WindGust,font:{size:10,weight:"bold"},stepSize:25},title:{display:!0,text:"Wind Gust km/h",color:h.WindGust,font:{size:12,weight:"bold"}}},y_cloud:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:h.CloudCover,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"Cloud Coverage %",color:h.CloudCover,font:{size:12,weight:"bold"}}},y_uv:{type:"linear",display:!0,position:"left",min:0,max:12,grid:{drawOnChartArea:!1},ticks:{color:h.UV,font:{size:10,weight:"bold"},stepSize:12},title:{display:!0,text:"UV",color:h.UV,font:{size:12,weight:"bold"}}},y_humidity:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:h.Humidity,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"Humidity %",color:h.Humidity,font:{size:12,weight:"bold"}}}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-4 md:grid-cols-3",children:[e.jsx(ae,{icon:e.jsx(me,{className:"text-red-500"}),label:"TEMP / UV index",value:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-red-500",children:[s.forecast.y_temperature[0],"°C"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-amber-500",children:["UV ",s.forecast.y_uvIndex[0]]})]})}),e.jsx(ae,{icon:e.jsx(me,{className:"text-slate-500"}),label:"Min / Max",value:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-blue-500",children:[H,"°"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-red-500",children:[K,"°"]})]})}),e.jsx(ae,{icon:e.jsx(ue,{className:"text-sky-500"}),label:"Rain / Precip",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsxs("span",{className:"text-sky-500",children:[s.forecast.y_precipChance[0],"%"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-blue-500",children:[s.forecast.y_precipitation[0]," mm/h"]})]})}),e.jsx(ae,{icon:e.jsx(ue,{className:"text-emerald-500"}),label:"Humidity / Cloud",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsxs("span",{className:"text-emerald-500",children:[s.forecast.y_humidity[0],"%"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-slate-400",children:[s.forecast.y_cloudCover[0],"%"]})]})}),e.jsx(ae,{icon:e.jsx(He,{className:"text-slate-500"}),label:"Sun rise / Set",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsx("span",{className:"text-slate-900",children:m?m.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsx("span",{className:"text-slate-900",children:i?i.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"})]})}),e.jsx(ae,{icon:e.jsx(Pe,{className:"text-slate-500"}),label:"Noon / Daylight %",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsx("span",{className:"text-slate-900",children:S?S.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}):"N/A"}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsx("span",{className:"text-slate-900",children:g>0?`${g.toFixed(1)}%`:"N/A"})]})})]}),e.jsx("div",{ref:d,className:"custom-scrollbar h-[400px] w-full overflow-x-auto",children:e.jsx("div",{className:"h-full",style:{width:Xe[a]},children:e.jsx(Te,{ref:w,data:G,options:U,plugins:[et]})})})]})},ae=({icon:t,label:a,value:s})=>e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-slate-50 p-2 md:p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-[10px] font-semibold tracking-wider text-slate-500 md:text-xs",children:a}),e.jsx("div",{className:"truncate text-base font-bold md:text-lg",children:s})]})]}),st=({selectedPlace:t,zoomLevel:a,onZoomChange:s})=>e.jsx("div",{className:"mx-auto max-w-7xl py-2 md:px-4 md:py-8","data-testid":"public-view",children:t&&e.jsxs("div",{className:"space-y-8","data-testid":"weather-details",children:[e.jsxs("div",{className:"rounded-2xl border bg-white py-4 shadow-sm md:p-6","data-testid":"weather-charts-container",children:[e.jsx(at,{place:t,zoomLevel:a}),e.jsx("div",{className:"mt-8 flex justify-center","data-testid":"zoom-dropdown-container",children:e.jsx(Ke,{currentZoom:a,onSelect:s})})]}),e.jsx("section",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 shadow-sm md:p-6","data-testid":"external-links-container",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-bold",children:[e.jsx(Oe,{className:"size-5 text-amber-500"})," External Links"]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:`https://www.wunderground.com/forecast/${t.linkWU}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"wu-link",children:"Weather Underground Forecast"})}),e.jsx("li",{children:e.jsx("a",{href:`https://www.lightningmaps.org/?lang=en#m=oss;y=${t.coords[0]};x=${t.coords[1]};z=13`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"lightning-maps-link",children:"Lightning Maps"})})]})]})})]})}),nt=()=>e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center","data-testid":"weather-loading-spinner",children:e.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-indigo-500"})}),ot=()=>{const t=Be(),a=()=>t.loading?e.jsx(nt,{}):t.showLogin?e.jsx(Ye,{onLogin:t.login,onCancel:t.navigateToPublic}):t.user&&t.showEdit?e.jsx(Je,{places:t.places,onAddPlace:t.handleAddPlace,onUpdatePlace:t.handleUpdatePlace,onDeletePlace:t.handleDeletePlace,onReorderPlaces:t.handleReorderPlaces,onSearchPlace:t.handleSearchPlace}):e.jsx(st,{selectedPlace:t.selectedPlace,zoomLevel:t.zoomLevel,onZoomChange:t.setZoomLevel});return e.jsxs("div",{className:"min-h-screen bg-slate-50 pb-12 font-sans text-slate-900","data-testid":"weather-page",children:[e.jsx(Ze,{isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,onLoginClick:t.navigateToLogin,onLogoutClick:t.logout,onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,showLoginButton:!t.user&&!t.showLogin,places:t.places,selectedPlace:t.selectedPlace,onPlaceChange:t.handlePlaceChange}),e.jsx("main",{"data-testid":"weather-main-content",children:a()})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(je,{children:e.jsx(ot,{})})}));
