import"./index-F_Pwjxo7.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as O}from"./api-CH_Pe6Vg.js";import{B as P}from"./button-ChVf0VhC.js";import{M as ne,C as oe}from"./map-pin-DpUOG5tc.js";import{c as q}from"./createLucideIcon-DtX1aPOG.js";import{L as xe,a as G,I as V}from"./label-BksqPqOg.js";import{L as ge}from"./log-out-B0TqtotO.js";import{U as ye,D as we,G as be}from"./upload-CK6mc6ZD.js";import{P as re}from"./plus-DDkdk0pc.js";import{P as le}from"./pen-vQk8amFZ.js";import{S as je}from"./search-Cfl0sis-.js";import{X as ve}from"./x-BS-d4QNZ.js";import{S as Ne}from"./save-rN7CZjMN.js";import{C as Se}from"./chevron-up-DUwvjlA1.js";import{E as Ie}from"./external-link-Bw0ICscN.js";import{T as Ce}from"./trash-2-DQbJ9aIh.js";import{L as _e}from"./index-BehiXGmn.js";import"./clsx-B-dksMZM.js";import"./utils-Bp7-rn4K.js";const ke=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Le=q("clock",ke);const De=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],ce=q("cloud-rain",De);const Re=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Te=q("cloud",Re);const Pe=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Ae=q("sun",Pe);const ze=[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m4.93 10.93 1.41 1.41",key:"2a7f42"}],["path",{d:"M2 18h2",key:"j10viu"}],["path",{d:"M20 18h2",key:"wocana"}],["path",{d:"m19.07 10.93-1.41 1.41",key:"15zs5n"}],["path",{d:"M22 22H2",key:"19qnx5"}],["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M16 18a4 4 0 0 0-8 0",key:"1lzouq"}]],Ee=q("sunrise",ze);const Ue=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],de=q("thermometer",Ue);const $e=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Me=q("zoom-in",$e),se="e1f10a1e78da46f5b10a1e78da96f525";function ae(t,a){return t.map(s=>s!==null&&s<=a?0:s)}const J=()=>{const t=localStorage.getItem("weather_token"),a={"Content-Type":"application/json"};return t&&(a.Authorization=`Bearer ${t}`),a},U={async getPlaces(){const t=await fetch(`${O}/weather/data`);if(!t.ok)throw new Error("Failed to fetch places");return(await t.json()).places},async login(t,a){const s=await fetch(`${O}/weather/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:a})});if(!s.ok)throw new Error("Login failed");return s.json()},async getMe(){const t=await fetch(`${O}/weather/me`,{headers:J()});if(!t.ok)throw new Error("Failed to get user");return t.json()},async addPlace(t){const a=await fetch(`${O}/weather/places`,{method:"POST",headers:J(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to add place");return a.json()},async updatePlace(t,a){const s=await fetch(`${O}/weather/places/${t}`,{method:"PUT",headers:J(),body:JSON.stringify(a)});if(!s.ok)throw new Error("Failed to update place");return s.json()},async deletePlace(t){const a=await fetch(`${O}/weather/places/${t}`,{method:"DELETE",headers:J()});if(!a.ok)throw new Error("Failed to delete place");return a.json()},async reorderPlaces(t){const a=await fetch(`${O}/weather/places/reorder`,{method:"POST",headers:J(),body:JSON.stringify(t)});if(!a.ok)throw new Error("Failed to reorder places");return a.json()},async searchPlace(t){const a=await fetch(`${O}/weather/search?link_wu=${encodeURIComponent(t)}`,{headers:J()});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.detail||"Failed to search place")}return a.json()},async fetchWUForecast(t){const a=`https://api.weather.com/v3/wx/forecast/hourly/15day?apiKey=${se}&geocode=${t.coords[0]}%2C${t.coords[1]}&units=m&language=en-US&format=json`,o=await(await fetch(a,{referrerPolicy:"no-referrer"})).json();return{tzOffset:o.validTimeLocal[0]?.slice(19),x:o.validTimeLocal.map(r=>new Date(r.slice(0,19))),y_precipitation:o.qpf,y_humidity:o.relativeHumidity,y_snow:ae(o.qpfSnow,0),y_temperature:o.temperature,y_windGust:o.windGust,y_precipChance:o.precipChance,y_uvIndex:ae(o.uvIndex,0),y_cloudCover:ae(o.cloudCover,0)}},async fetchWUHistory(t){const a=`https://api.weather.com/v3/wx/conditions/historical/hourly/1day?apiKey=${se}&geocode=${t.coords[0]}%2C${t.coords[1]}&units=m&language=en-US&format=json`,o=await(await fetch(a,{referrerPolicy:"no-referrer"})).json();return{tzOffset:o.validTimeLocal[0]?.slice(19),x:o.validTimeLocal.map(r=>new Date(r.slice(0,19))),y_precipitation:[],y_humidity:o.relativeHumidity,y_snow:[],y_temperature:o.temperature,y_windGust:o.windGust,y_precipChance:[],y_uvIndex:ae(o.uvIndex,0),y_cloudCover:[],sunriseTimeLocal:o.sunriseTimeLocal[0],sunsetTimeLocal:o.sunsetTimeLocal[0]}},async fetchBBCForecast(t){if(!t.bbcID)return null;const a=`https://weather-broker-cdn.api.bbci.co.uk/en/forecast/aggregated/${t.bbcID}`,o=await(await fetch(a)).json(),r={tzOffset:o.forecasts[0].detailed.issueDate.slice(19),hourly:{x:[],y_temperature:[],y_windGust:[],y_precipChance:[]},daily:{x:[],y_uvIndex:[],y_pollenIndex:[],y_pollutionIndex:[]}},w=[];return o.forecasts.forEach(c=>{c.detailed.reports.forEach(l=>{r.hourly.x.push(new Date(l.localDate+" "+l.timeslot)),r.hourly.y_temperature.push(l.temperatureC),w.push(l.gustSpeedKph),r.hourly.y_precipChance.push(l.precipitationProbabilityInPercent)});const x=c.summary.report;r.daily.x.push(new Date(x.localDate)),r.daily.y_uvIndex.push(x.uvIndex),r.daily.y_pollenIndex.push(x.pollenIndex),r.daily.y_pollutionIndex.push(x.pollutionIndex)}),r.hourly.y_windGust=ae(w,25),r},async fetchWUPollen(t){const a=`https://api.weather.com/v2/turbo/vt1pollenforecast?apiKey=${se}&geocode=${t.coords[0]}%2C${t.coords[1]}&language=en&format=json`,o=await(await fetch(a)).json();return{x:o.vt1pollenforecast?.reportDate.map(r=>new Date(r.slice(0,19)))||[],y_tree:o.vt1pollenforecast?.tree||[],y_weed:o.vt1pollenforecast?.weed||[],y_grass:o.vt1pollenforecast?.grass||[]}}},We=()=>{const[t,a]=React.useState([]),[s,o]=React.useState(null),[r,w]=React.useState(()=>{const i=localStorage.getItem("weather_zoom");return i==="STANDARD"?"z1x":i==="DETAILED"?"z2x":i==="MACRO"?"z3x":i==="COMPACT"?"z2x":i||"z2x"}),[c,x]=React.useState(!0),[l,b]=React.useState(null),[S,p]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[N,I]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit"),[z,A]=React.useState("idle"),$=React.useCallback(async()=>{A("loading");try{const i=await U.getPlaces();a(i);const L=new URLSearchParams(window.location.search).get("location"),Y=localStorage.getItem("weather_location"),K=i.find(B=>B.name===L)||i.find(B=>B.name===Y)||i[0];o(K),A("success")}catch(i){console.error("Failed to load places",i),A("error")}finally{x(!1)}},[]);React.useEffect(()=>{$(),localStorage.getItem("weather_token")&&U.getMe().then(b).catch(()=>{localStorage.removeItem("weather_token"),b(null)})},[$]),React.useEffect(()=>{const i=()=>{const f=new URLSearchParams(window.location.search);p(f.get("view")==="login"),I(f.get("view")==="edit");const L=f.get("location");L&&a(Y=>{const K=Y.find(B=>B.name===L);return K&&o(K),Y})};return window.addEventListener("popstate",i),()=>window.removeEventListener("popstate",i)},[]);const j=()=>{const i=new URLSearchParams(window.location.search);i.get("view")!=="login"&&(i.set("view","login"),window.history.pushState({},"",`?${i.toString()}`),p(!0),I(!1))},R=()=>{const i=new URLSearchParams(window.location.search);i.get("view")!=="edit"&&(i.set("view","edit"),window.history.pushState({},"",`?${i.toString()}`),I(!0),p(!1))},F=()=>{const i=new URLSearchParams(window.location.search);if(i.has("view")){i.delete("view");const f=i.toString();window.history.pushState({},"",f?`?${f}`:window.location.pathname),p(!1),I(!1)}else p(!1),I(!1)};return React.useEffect(()=>{l&&new URLSearchParams(window.location.search).get("view")!=="edit"&&R()},[l]),{places:t,selectedPlace:s,loading:c,user:l,showLogin:S,showEdit:N,requestState:z,zoomLevel:r,setZoomLevel:i=>{w(i),localStorage.setItem("weather_zoom",i)},handlePlaceChange:i=>{o(i),localStorage.setItem("weather_location",i.name);const f=new URLSearchParams(window.location.search);f.get("location")!==i.name&&(f.set("location",i.name),window.history.pushState({},"",`?${f.toString()}`))},login:async(i,f)=>{try{const L=await U.login(i,f);return localStorage.setItem("weather_token",L.access_token),b(L.user),!0}catch(L){return console.error("Login failed",L),!1}},logout:()=>{localStorage.removeItem("weather_token"),b(null),F()},navigateToLogin:j,navigateToEdit:R,navigateToPublic:F,handleAddPlace:async i=>{const f=await U.addPlace(i);a(f.places)},handleUpdatePlace:async(i,f)=>{const L=await U.updatePlace(i,f);a(L.places)},handleDeletePlace:async i=>{if(!window.confirm("Are you sure you want to delete this location?"))return;const f=await U.deletePlace(i);a(f.places)},handleReorderPlaces:async i=>{const f=await U.reorderPlaces(i);a(f.places)},handleSearchPlace:async i=>await U.searchPlace(i)}},ue=({places:t,selectedPlace:a,onSelect:s})=>{const[o,r]=React.useState(!1),w=React.useRef(null),c=React.useRef(null);React.useEffect(()=>{const l=b=>{w.current&&!w.current.contains(b.target)&&r(!1)};return o&&document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[o]);const x=l=>{s(l),r(!1)};return e.jsxs("div",{className:"relative inline-block w-full md:w-64",ref:w,children:[e.jsxs("button",{type:"button",ref:c,onClick:()=>r(!o),className:"flex w-full items-center justify-between rounded-xl border border-slate-200 bg-white px-4 py-2 text-left font-semibold text-slate-700 shadow-sm transition-all hover:bg-slate-50 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none","aria-haspopup":"listbox","aria-expanded":o,children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(ne,{className:"size-4 shrink-0 text-indigo-500"}),e.jsx("span",{className:"truncate",children:a?.name||"Select location..."})]}),e.jsx(oe,{className:`size-4 text-slate-400 transition-transform duration-200 ${o?"rotate-180":""}`})]}),o&&e.jsx("ul",{className:"animate-in fade-in zoom-in absolute z-20 mt-2 max-h-60 w-full overflow-auto rounded-xl border border-slate-200 bg-white p-1 shadow-xl duration-200",role:"listbox",children:t.map(l=>e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>x(l),className:`flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left text-sm transition-colors ${a?.name===l.name?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,role:"option","aria-selected":a?.name===l.name,children:[e.jsx(ne,{className:`size-3.5 ${a?.name===l.name?"text-indigo-500":"text-slate-400"}`}),e.jsx("span",{className:"truncate",children:l.name}),l.country&&e.jsx("span",{className:"ml-auto text-[10px] font-medium tracking-wider text-slate-400 uppercase",children:l.country})]})},l.name))})]})},Oe=({isAdmin:t,userEmail:a,userFirstName:s,onLoginClick:o,onLogoutClick:r,onLogoClick:w,showLoginButton:c,places:x=[],selectedPlace:l=null,onPlaceChange:b})=>e.jsxs("header",{className:"sticky top-0 z-10 w-full border-b bg-white shadow-sm","data-testid":"weather-navbar",children:[e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between gap-4 px-4 py-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:w,className:"flex items-center gap-2 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:[e.jsx(Te,{className:"size-8 text-indigo-600"}),e.jsxs("h1",{className:"bg-gradient-to-r from-indigo-600 to-violet-600 bg-clip-text text-2xl font-bold text-transparent",children:["Weather ",t&&"Admin"]})]})}),b&&e.jsx("div",{className:"hidden max-w-md flex-1 items-center gap-3 md:flex","data-testid":"place-dropdown-desktop",children:e.jsx(ue,{places:x,selectedPlace:l,onSelect:b})}),e.jsxs("div",{className:"flex items-center gap-4",children:[c&&e.jsxs(P,{variant:"ghost",className:"gap-2 text-slate-600 hover:bg-slate-100",onClick:o,"data-testid":"login-button",children:[e.jsx(xe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Login"})]}),a&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"hidden text-sm font-medium text-slate-500 md:inline","data-testid":"user-display-name",children:s||a}),e.jsx(P,{variant:"ghost",size:"icon",onClick:r,className:"text-slate-400 hover:bg-slate-100 hover:text-red-500",title:"Logout","data-testid":"logout-button",children:e.jsx(ge,{size:20})})]})]})]}),b&&e.jsx("div",{className:"border-t px-4 py-2 md:hidden","data-testid":"place-dropdown-mobile",children:e.jsx(ue,{places:x,selectedPlace:l,onSelect:b})})]}),Fe=({onLogin:t,onCancel:a})=>{const[s,o]=React.useState(""),[r,w]=React.useState(""),[c,x]=React.useState(""),[l,b]=React.useState(!1),S=async p=>{p.preventDefault(),x(""),b(!0),await t(s,r)||(x("Invalid email or password"),b(!1))};return e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4","data-testid":"login-view",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-white p-8 shadow-xl",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 rounded-2xl bg-indigo-50 p-3",children:e.jsx(xe,{className:"size-8 text-indigo-600"})}),e.jsx("h2",{className:"text-2xl font-bold","data-testid":"login-title",children:"Admin Login"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Access dashboard management"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"email",children:"Email address"}),e.jsx(V,{id:"email",type:"email",autoComplete:"email",value:s,onChange:p=>o(p.target.value),placeholder:"admin@example.com",required:!0,className:"rounded-xl","data-testid":"login-email-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"password",children:"Password"}),e.jsx(V,{id:"password",type:"password",autoComplete:"current-password",value:r,onChange:p=>w(p.target.value),placeholder:"••••••••",required:!0,className:"rounded-xl","data-testid":"login-password-input"})]}),c&&e.jsx("p",{className:"text-sm font-medium text-red-500","data-testid":"login-error-message",children:c}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[e.jsx(P,{type:"submit",disabled:l,className:"h-auto w-full rounded-xl py-6 text-lg","data-testid":"login-submit-button",children:l?"Logging in...":"Login"}),e.jsx(P,{type:"button",variant:"ghost",onClick:a,className:"w-full text-slate-500","data-testid":"login-cancel-button",children:"Cancel"})]})]})]})})},me=({label:t,variant:a="primary",className:s=""})=>{const o={primary:"bg-indigo-50 text-indigo-600 border-indigo-100",secondary:"bg-slate-100 text-slate-600 border-slate-200",success:"bg-emerald-50 text-emerald-600 border-emerald-100",danger:"bg-red-50 text-red-600 border-red-100",warning:"bg-orange-50 text-orange-600 border-orange-100",info:"bg-blue-50 text-blue-600 border-blue-100"};return e.jsx("span",{className:`inline-flex items-center rounded border px-2 py-0.5 text-[10px] font-bold uppercase ${o[a]} ${s}`,"data-testid":`badge-${t.toLowerCase()}`,children:t})},He=({places:t,onAddPlace:a,onUpdatePlace:s,onDeletePlace:o,onReorderPlaces:r,onSearchPlace:w})=>{const[c,x]=React.useState(!1),[l,b]=React.useState(!1),[S,p]=React.useState(!1),[N,I]=React.useState(null),[z,A]=React.useState(!1),$=React.useRef(null),[j,R]=React.useState({name:"",coords:[0,0],linkWU:"",bbcID:"",country:""}),[F,d]=React.useState(""),[T,H]=React.useState(null),[Q,E]=React.useState(null),W=()=>{R({name:"",coords:[0,0],linkWU:"",bbcID:"",country:""}),d(""),x(!1),I(null),b(!1),p(!1)},ee=n=>{R(n),d(`${n.coords[0]}, ${n.coords[1]}`),I(n.id||null),x(!1)},te=async()=>{if(j.linkWU){b(!0);try{const n=await w(j.linkWU);R(m=>({...m,name:n.city||m.name,coords:[n.lat,n.lon],country:n.countryCode||m.country})),d(`${n.lat}, ${n.lon}`)}catch(n){alert(`Failed to fetch coordinates: ${n}`)}finally{b(!1)}}},Z=()=>{const n={places:t.map(({id:_,name:k,coords:h,linkWU:D,bbcID:M,country:ie})=>({name:k,lat:h[0],lon:h[1],link_wu:D,bbc_id:M||"",country:ie||""}))},m=jsyaml.dump(n),g=new Blob([m],{type:"text/yaml"}),C=URL.createObjectURL(g),v=document.createElement("a");v.href=C,v.download=`weather-places-${new Date().toISOString().split("T")[0]}.yml`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(C)},i=async n=>{const m=n.target.files?.[0];if(!m)return;A(!0);const g=new FileReader;g.onload=async C=>{try{const v=C.target?.result,_=jsyaml.load(v),k=_?.places||(Array.isArray(_)?_:[]);if(!Array.isArray(k))throw new Error("Invalid YAML format: expected an array of places or a 'places' object");let h=0;for(const D of k){const M={name:D.name||"",coords:D.coords||[D.lat||0,D.lon||0],linkWU:D.link_wu||D.linkWU||"",bbcID:D.bbc_id||D.bbcID||"",country:D.country||""};M.name&&M.linkWU&&(t.some(fe=>fe.name.toLowerCase()===M.name.toLowerCase())||(await a(M),h++))}alert(`Successfully imported ${h} locations.`)}catch(v){alert(`Failed to import YAML: ${v}`)}finally{A(!1),$.current&&($.current.value="")}},g.readAsText(m)},f=async n=>{n.preventDefault();let m=j.coords,g=j.name,C=j.country;const v=F.trim();if(v===""||v==="0, 0"||v==="0,0"){if(j.linkWU){p(!0);try{const h=await w(j.linkWU);m=[h.lat,h.lon],g=j.name||h.city||"",C=j.country||h.countryCode||""}catch(h){alert(`Failed to fetch coordinates: ${h}`),p(!1);return}finally{p(!1)}}}else{const h=v.split(/[, ]+/);if(h.length>=2){const D=parseFloat(h[0]),M=parseFloat(h[1]);!isNaN(D)&&!isNaN(M)&&(m=[D,M])}}const _={...j,name:g,country:C,coords:m};if(t.some(h=>h.name.toLowerCase()===g.toLowerCase()&&h.id!==N)){alert(`A location with the name "${g}" already exists.`);return}try{N?await s(N,_):await a(_),W()}catch(h){alert(`Failed to save location: ${h}`)}},L=async(n,m)=>{const g=[...t],C=m==="up"?n-1:n+1;if(C<0||C>=g.length)return;[g[n],g[C]]=[g[C],g[n]];const v=g.map(_=>_.id).filter(_=>_!==void 0);try{await r(v)}catch(_){alert(`Failed to reorder: ${_}`)}},Y=n=>{H(n)},K=(n,m)=>{if(n.preventDefault(),T===null||T===m)return;const g=t.findIndex(k=>k.id===T),C=t.findIndex(k=>k.id===m);if(g===-1||C===-1)return;const v=[...t],[_]=v.splice(g,1);if(v.splice(C,0,_),v.map(k=>k.id).join(",")!==t.map(k=>k.id).join(",")){const k=v.map(h=>h.id).filter(h=>h!==void 0);r(k).catch(h=>console.error("Failed to reorder",h))}},B=()=>{H(null),E(null)};return e.jsxs("div",{className:"mx-auto max-w-4xl py-8 md:px-4","data-testid":"management-view",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-start justify-between gap-4 px-4 sm:flex-row sm:items-center",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold","data-testid":"management-title",children:"Manage"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("input",{type:"file",accept:".yml,.yaml",className:"hidden",ref:$,onChange:i,disabled:z}),e.jsxs(P,{variant:"outline",onClick:()=>$.current?.click(),className:"gap-2 rounded-xl",disabled:z,"data-testid":"import-yaml-button",children:[e.jsx(ye,{size:18})," Import YAML"]}),e.jsxs(P,{variant:"outline",onClick:Z,className:"gap-2 rounded-xl","data-testid":"export-yaml-button",children:[e.jsx(we,{size:18})," Export YAML"]}),e.jsxs(P,{onClick:()=>{W(),x(!0)},className:"gap-2 rounded-xl","data-testid":"add-place-button",children:[e.jsx(re,{size:18})," Add New Location"]})]})]}),(c||N)&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-4 mb-8 rounded-2xl border bg-white p-6 shadow-lg duration-300","data-testid":"place-form-container",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-lg font-bold",children:[N?e.jsx(le,{size:20,className:"text-indigo-600"}):e.jsx(re,{size:20,className:"text-indigo-600"}),N?"Edit Location":"Add New Location"]}),e.jsxs("form",{onSubmit:f,className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"name",children:["City Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"name",value:j.name,onChange:n=>R({...j,name:n.target.value}),required:!0,className:"rounded-xl","data-testid":"place-name-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"country",children:"Country Code"}),e.jsx(V,{id:"country",value:j.country||"",onChange:n=>R({...j,country:n.target.value}),placeholder:"GB, FRA, ZAF...",className:"rounded-xl","data-testid":"place-country-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"coords",children:"Coordinates (lat, lon)"}),e.jsx(V,{id:"coords",value:F,onChange:n=>d(n.target.value),placeholder:"51.507, -0.127 (Auto-fetch if empty)",className:"rounded-xl","data-testid":"place-coords-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:"linkWU",children:["WU Path (or URL) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{id:"linkWU",value:j.linkWU,onChange:n=>{let m=n.target.value;const g="https://www.wunderground.com/weather/";m.startsWith(g)&&(m=m.substring(g.length)),R({...j,linkWU:m})},placeholder:"gb/london/ILONDO440",required:!0,className:"rounded-xl","data-testid":"place-link-wu-input"}),e.jsx(P,{type:"button",variant:"outline",size:"icon",onClick:te,disabled:!j.linkWU||l||S,className:"shrink-0 rounded-xl",title:"Fetch details from Wunderground","data-testid":"fetch-wu-details-button",children:e.jsx(je,{size:18,className:l?"animate-pulse":""})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:"bbcID",children:"BBC ID"}),e.jsx(V,{id:"bbcID",value:j.bbcID||"",onChange:n=>R({...j,bbcID:n.target.value}),placeholder:"2643743",className:"rounded-xl","data-testid":"place-bbc-id-input"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 md:col-span-2",children:[e.jsxs(P,{type:"button",variant:"outline",onClick:W,disabled:l||S,className:"rounded-xl","data-testid":"cancel-form-button",children:[e.jsx(ve,{size:18,className:"mr-2"})," Cancel"]}),e.jsx(P,{type:"submit",className:"min-w-[120px] rounded-xl",disabled:l||S,"data-testid":"save-place-button",children:S?e.jsx(e.Fragment,{children:"Searching..."}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:18,className:"mr-2"})," ",N?"Update":"Save"]})})]})]})]}),e.jsx("div",{className:"custom-scrollbar overflow-x-auto rounded-2xl border bg-white shadow-sm","data-testid":"places-table-container",children:e.jsxs("table",{className:"w-full min-w-[600px] text-left",children:[e.jsx("thead",{className:"border-b bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-4 py-4"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold tracking-wider text-slate-500 uppercase",children:"Location"}),e.jsx("th",{className:"px-6 py-4 text-center text-xs font-bold tracking-wider text-slate-500 uppercase",children:"Map"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold tracking-wider text-slate-500 uppercase",children:"Providers"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold tracking-wider text-slate-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:t.map((n,m)=>e.jsxs("tr",{draggable:Q===n.id,onDragStart:()=>n.id&&Y(n.id),onDragOver:g=>n.id&&K(g,n.id),onDragEnd:B,className:`transition-colors hover:bg-slate-50 ${T===n.id?"bg-indigo-50/50 opacity-40":""} ${Q===n.id?"select-none":""}`,"data-testid":`place-row-${n.id}`,children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("button",{onClick:()=>L(m,"up"),disabled:m===0,className:"cursor-pointer text-slate-400 hover:text-indigo-600 disabled:opacity-30",title:"Move Up",children:e.jsx(Se,{size:16})}),e.jsx("div",{className:"cursor-grab touch-none p-1 text-slate-300 transition-colors hover:text-indigo-600 active:cursor-grabbing",title:"Hold to drag",onMouseDown:()=>E(n.id||null),onMouseUp:()=>E(null),onTouchStart:()=>E(n.id||null),onTouchEnd:()=>E(null),onTouchCancel:()=>E(null),onClick:g=>g.stopPropagation(),children:e.jsx(be,{size:16})}),e.jsx("button",{onClick:()=>L(m,"down"),disabled:m===t.length-1,className:"cursor-pointer text-slate-400 hover:text-indigo-600 disabled:opacity-30",title:"Move Down",children:e.jsx(oe,{size:16})})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg bg-indigo-50 p-2",children:e.jsx(ne,{size:16,className:"text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:n.name}),e.jsx("div",{className:"text-xs text-slate-400",children:n.country||"N/A"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${n.coords[0]},${n.coords[1]}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex rounded-lg bg-slate-100 p-2 text-slate-500 transition-colors hover:bg-indigo-100 hover:text-indigo-600",title:"View on Google Maps","data-testid":"view-map-link",children:e.jsx(Ie,{size:16})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(me,{label:"WU",variant:"info"}),n.bbcID&&e.jsx(me,{label:"BBC",variant:"warning"})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"ghost",size:"icon",onClick:()=>ee(n),className:"text-slate-400 hover:bg-indigo-50 hover:text-indigo-600",title:"Edit location","data-testid":`edit-place-${n.id}`,children:e.jsx(le,{size:16})}),e.jsx(P,{variant:"ghost",size:"icon",onClick:()=>n.id&&o(n.id),className:"text-slate-400 hover:bg-red-50 hover:text-red-600",title:"Delete location","data-testid":`delete-place-${n.id}`,children:e.jsx(Ce,{size:16})})]})})]},n.id))})]})})]})},he=[{value:"z1x",label:"1x"},{value:"z2x",label:"2x"},{value:"z3x",label:"3x"},{value:"z4x",label:"4x"}],Be=({currentZoom:t,onSelect:a})=>{const[s,o]=React.useState(!1),r=React.useRef(null);React.useEffect(()=>{const c=x=>{r.current&&!r.current.contains(x.target)&&o(!1)};return s&&document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[s]);const w=he.find(c=>c.value===t)?.label||t;return e.jsxs("div",{className:"relative inline-block",ref:r,"data-testid":"zoom-dropdown",children:[e.jsxs("button",{type:"button",onClick:()=>o(!s),className:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition-all hover:bg-slate-50 focus:outline-none",children:[e.jsx(Me,{className:"size-4 text-indigo-500"}),e.jsxs("span",{children:["Zoom: ",w]}),e.jsx(oe,{className:`size-3 text-slate-400 transition-transform duration-200 ${s?"rotate-180":""}`})]}),s&&e.jsx("ul",{className:"animate-in fade-in zoom-in absolute right-0 z-20 mt-2 w-40 overflow-hidden rounded-xl border border-slate-200 bg-white p-1 shadow-xl duration-200",children:he.map(c=>e.jsx("li",{children:e.jsx("button",{type:"button",onClick:()=>{a(c.value),o(!1)},className:`flex w-full items-center justify-between rounded-lg px-3 py-2 text-left text-sm transition-colors ${t===c.value?"bg-indigo-50 font-bold text-indigo-700":"text-slate-600 hover:bg-slate-50"}`,children:e.jsx("span",{children:c.label})})},c.value))})]})},y={LINE_WIDTH_DEFAULT:2,LINE_WIDTH_FILLED_AREA:2,TENSION:.3,POINT_RADIUS:1,HIT_RADIUS:10},Ge={z1x:"2000px",z2x:"4000px",z3x:"6000px",z4x:"8000px"},u={Temperature:"#ef4444",Precipitation:"#3b82f6",PrecipChance:"#0ea5e9",WindGust:"#8b5cf6",UV:"#f59e0b",CloudCover:"#94a3b8",Humidity:"#10b981",Snow:"#d946ef"};function Ve(){Chart.Chart.register(Chart.CategoryScale,Chart.LinearScale,Chart.PointElement,Chart.LineElement,Chart.BarElement,Chart.Title,Chart.Tooltip,Chart.Legend,Chart.Filler)}function pe(t){const a=new Date;if(!t||t==="Local")return a;let s=0;if(t!=="Z"){const r=t.startsWith("-")?-1:1,w=parseInt(t.slice(1,3)),c=parseInt(t.slice(3,5))||0;s=r*(w*36e5+c*6e4)}const o=a.getTime()+a.getTimezoneOffset()*6e4;return new Date(o+s)}const qe={id:"nowLine",afterDraw:t=>{const{ctx:a,chartArea:{top:s,bottom:o},scales:{x:r}}=t;if(!r)return;const w=t.options.plugins?.nowLine?.tzOffset,c=pe(w),x=t.data.labels;let l=-1,b=1/0;if(x.forEach((S,p)=>{const N=new Date(S),I=Math.abs(N.getTime()-c.getTime());I<b&&(b=I,l=p)}),l!==-1&&b<24*36e5){const S=r.getPixelForValue(x[l]);a.save(),a.beginPath(),a.lineWidth=2,a.strokeStyle="#0d9488",a.moveTo(S,s),a.lineTo(S,o),a.stroke(),a.fillStyle="#0d9488",a.font="bold 13px sans-serif",a.textAlign="left";const p=c.getHours().toString().padStart(2,"0"),N=c.getMinutes().toString().padStart(2,"0"),I=`${p}:${N}`,z=a.measureText(I);a.fillStyle="rgba(13, 148, 136, 0.9)",a.fillRect(S,s+10,z.width+16,24),a.fillStyle="#ffffff",a.fillText(I,S+8,s+27),a.restore()}}},Ze=()=>({type:"category",grid:{color:t=>{const a=t.chart.data.labels[t.index];return new Date(a).getHours()===0?"#0f172a":"transparent"},lineWidth:t=>{const a=t.chart.data.labels[t.index];return new Date(a).getHours()===0?2:0},drawTicks:!0},ticks:{maxRotation:0,autoSkip:!1,padding:10,color:"#334155",font:{weight:"bold",size:14},callback:function(t){const a=this.getLabelForValue(t),s=new Date(a);return isNaN(s.getTime())?"":s.getHours()===12?s.toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short"}):""}}});Ve();const Ye=({place:t,zoomLevel:a})=>{const[s,o]=React.useState(null),[r,w]=React.useState(!0),c=React.useRef(null),x=React.useRef(null);if(React.useEffect(()=>{w(!0),Promise.all([U.fetchWUForecast(t),U.fetchWUHistory(t)]).then(([d,T])=>{o({forecast:d,history:T}),w(!1)})},[t]),React.useEffect(()=>{if(!r&&s&&c.current){const d=setTimeout(()=>{const T=x.current,H=c.current;if(T&&H){const Q=pe(s.forecast.tzOffset),E=T.data.labels;let W=-1,ee=1/0;if(E.forEach((te,Z)=>{const i=new Date(te),f=Math.abs(i.getTime()-Q.getTime());f<ee&&(ee=f,W=Z)}),W!==-1){const Z=T.scales.x.getPixelForValue(E[W])-H.offsetWidth/2;H.scrollTo({left:Math.max(0,Z),behavior:"smooth"})}}},500);return()=>clearTimeout(d)}},[r,s,a]),r||!s)return e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx("div",{className:"animate-pulse text-slate-400",children:"Loading forecast data..."})});const l=1440*60*1e3,b=[...s.history.x.slice().reverse(),...s.forecast.x].map(d=>d.toISOString()),S=s.history.x.length,p=s.history.sunriseTimeLocal?new Date(s.history.sunriseTimeLocal.slice(0,19)):null,N=s.history.sunsetTimeLocal?new Date(s.history.sunsetTimeLocal.slice(0,19)):null;let I=0,z=null;if(p&&N){const d=N.getTime()-p.getTime();I=d/l*100,z=new Date(p.getTime()+d/2)}const A=s.forecast.y_temperature.slice(0,24).filter(d=>d!==null),$=A.length>0?Math.min(...A):null,j=A.length>0?Math.max(...A):null,R={labels:b,datasets:[{label:"Temperature (°C)",data:[...s.history.y_temperature.slice().reverse(),...s.forecast.y_temperature],borderColor:u.Temperature,backgroundColor:u.Temperature+"20",yAxisID:"y_temp",tension:y.TENSION,pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,borderWidth:y.LINE_WIDTH_DEFAULT},{label:"Rain Probability (%)",data:[...Array(S).fill(null),...s.forecast.y_precipChance],borderColor:u.PrecipChance,backgroundColor:u.PrecipChance+"20",yAxisID:"y_perc",tension:y.TENSION,pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,borderWidth:y.LINE_WIDTH_DEFAULT},{label:"Rain (mm/h)",data:[...Array(S).fill(null),...s.forecast.y_precipitation],borderColor:u.Precipitation,backgroundColor:u.Precipitation+"40",yAxisID:"y_rain",fill:!0,pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,borderWidth:y.LINE_WIDTH_FILLED_AREA},{label:"Wind Gust (km/h)",data:[...s.history.y_windGust.slice().reverse(),...s.forecast.y_windGust],borderColor:u.WindGust,yAxisID:"y_wind",pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,borderDash:[5,5],borderWidth:y.LINE_WIDTH_DEFAULT},{label:"Cloud Cover (%)",data:[...s.history.y_cloudCover.slice().reverse(),...s.forecast.y_cloudCover],borderColor:u.CloudCover,yAxisID:"y_cloud",pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,fill:!1,borderWidth:y.LINE_WIDTH_DEFAULT},{label:"UV Index",data:[...s.history.y_uvIndex.slice().reverse(),...s.forecast.y_uvIndex],borderColor:u.UV,yAxisID:"y_uv",pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,fill:!1,borderWidth:y.LINE_WIDTH_DEFAULT},{label:"Humidity (%)",data:[...s.history.y_humidity.slice().reverse(),...s.forecast.y_humidity],borderColor:u.Humidity,yAxisID:"y_humidity",pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,fill:!1,borderWidth:y.LINE_WIDTH_DEFAULT},{label:"Snow (cm/h)",data:[...s.history.y_snow.slice().reverse(),...s.forecast.y_snow],borderColor:u.Snow,backgroundColor:u.Snow+"30",yAxisID:"y_snow",fill:"origin",pointRadius:y.POINT_RADIUS,pointHitRadius:y.HIT_RADIUS,borderWidth:y.LINE_WIDTH_FILLED_AREA}]},F={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!0},plugins:{legend:{position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{callbacks:{title:d=>new Date(d[0].label).toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}},nowLine:{tzOffset:s.forecast.tzOffset}},scales:{x:Ze(),y_temp:{type:"linear",display:!0,position:"left",grid:{color:"rgba(239, 68, 68, 0.15)",drawOnChartArea:!0},ticks:{color:u.Temperature,font:{size:10,weight:"bold"},stepSize:5,precision:0},title:{display:!0,text:"°C",color:u.Temperature,font:{size:12,weight:"bold"}},beginAtZero:!1,afterDataLimits:d=>{d.min=Math.floor(d.min/5)*5,d.max=Math.ceil(d.max/5)*5}},y_perc:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:u.PrecipChance,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"%",color:u.PrecipChance,font:{size:12,weight:"bold"}}},y_rain:{type:"linear",display:!0,position:"left",min:0,suggestedMax:1,grid:{color:"rgba(59, 130, 246, 0.1)",drawOnChartArea:!0},ticks:{color:u.Precipitation,font:{size:10,weight:"bold"},stepSize:1},title:{display:!0,text:"mm/h",color:u.Precipitation,font:{size:12,weight:"bold"}},afterDataLimits:d=>{d.max=Math.ceil(Math.max(d.max,1))}},y_snow:{type:"linear",display:!0,position:"left",min:0,suggestedMax:1,grid:{drawOnChartArea:!1},ticks:{color:u.Snow,font:{size:10,weight:"bold"},stepSize:1},title:{display:!0,text:"cm/h",color:u.Snow,font:{size:12,weight:"bold"}},afterDataLimits:d=>{d.max=Math.ceil(Math.max(d.max,1))}},y_wind:{type:"linear",display:!0,position:"left",min:0,grid:{drawOnChartArea:!1},ticks:{color:u.WindGust,font:{size:10,weight:"bold"},stepSize:25},title:{display:!0,text:"km/h",color:u.WindGust,font:{size:12,weight:"bold"}}},y_cloud:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:u.CloudCover,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"☁%",color:u.CloudCover,font:{size:12,weight:"bold"}}},y_uv:{type:"linear",display:!0,position:"left",min:0,max:12,grid:{drawOnChartArea:!1},ticks:{color:u.UV,font:{size:10,weight:"bold"},stepSize:12},title:{display:!0,text:"UV",color:u.UV,font:{size:12,weight:"bold"}}},y_humidity:{type:"linear",display:!0,position:"left",min:0,max:100,grid:{drawOnChartArea:!1},ticks:{color:u.Humidity,font:{size:10,weight:"bold"},stepSize:100},title:{display:!0,text:"H%",color:u.Humidity,font:{size:12,weight:"bold"}}}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-4 md:grid-cols-3",children:[e.jsx(X,{icon:e.jsx(de,{className:"text-red-500"}),label:"TEMP / UV index",value:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-red-500",children:[s.forecast.y_temperature[0],"°C"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-amber-500",children:["UV ",s.forecast.y_uvIndex[0]]})]})}),e.jsx(X,{icon:e.jsx(de,{className:"text-slate-500"}),label:"Min / Max",value:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-blue-500",children:[$,"°"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-red-500",children:[j,"°"]})]})}),e.jsx(X,{icon:e.jsx(ce,{className:"text-sky-500"}),label:"Rain / Precip",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsxs("span",{className:"text-sky-500",children:[s.forecast.y_precipChance[0],"%"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-blue-500",children:[s.forecast.y_precipitation[0]," mm/h"]})]})}),e.jsx(X,{icon:e.jsx(ce,{className:"text-emerald-500"}),label:"Humidity / Cloud",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsxs("span",{className:"text-emerald-500",children:[s.forecast.y_humidity[0],"%"]}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsxs("span",{className:"text-slate-400",children:[s.forecast.y_cloudCover[0],"%"]})]})}),e.jsx(X,{icon:e.jsx(Ee,{className:"text-slate-500"}),label:"Sunrise / Set",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsx("span",{className:"text-slate-900",children:p?p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A"}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsx("span",{className:"text-slate-900",children:N?N.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A"})]})}),e.jsx(X,{icon:e.jsx(Le,{className:"text-slate-500"}),label:"Noon / Daylight %",value:e.jsxs("div",{className:"flex gap-2 text-sm md:text-base",children:[e.jsx("span",{className:"text-slate-900",children:z?z.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A"}),e.jsx("span",{className:"text-slate-300",children:"/"}),e.jsx("span",{className:"text-slate-900",children:I>0?`${I.toFixed(1)}%`:"N/A"})]})})]}),e.jsx("div",{ref:c,className:"custom-scrollbar h-[400px] w-full overflow-x-auto",children:e.jsx("div",{className:"h-full",style:{width:Ge[a]},children:e.jsx(_e,{ref:x,data:R,options:F,plugins:[qe]})})})]})},X=({icon:t,label:a,value:s})=>e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-slate-50 p-2 md:p-3",children:[e.jsx("div",{className:"flex-shrink-0",children:t}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-[10px] font-semibold tracking-wider text-slate-500 uppercase md:text-xs",children:a}),e.jsx("div",{className:"truncate text-base font-bold md:text-lg",children:s})]})]}),Ke=({selectedPlace:t,zoomLevel:a,onZoomChange:s})=>e.jsx("div",{className:"mx-auto max-w-7xl py-2 md:px-4 md:py-8","data-testid":"public-view",children:t&&e.jsxs("div",{className:"space-y-8","data-testid":"weather-details",children:[e.jsxs("div",{className:"rounded-2xl border bg-white py-4 shadow-sm md:p-6","data-testid":"weather-charts-container",children:[e.jsx(Ye,{place:t,zoomLevel:a}),e.jsx("div",{className:"mt-8 flex justify-center","data-testid":"zoom-dropdown-container",children:e.jsx(Be,{currentZoom:a,onSelect:s})})]}),e.jsx("section",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"rounded-2xl border bg-white p-4 shadow-sm md:p-6","data-testid":"external-links-container",children:[e.jsxs("h3",{className:"mb-4 flex items-center gap-2 text-lg font-bold",children:[e.jsx(Ae,{className:"size-5 text-amber-500"})," External Links"]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx("a",{href:`https://www.wunderground.com/forecast/${t.linkWU}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"wu-link",children:"Weather Underground Forecast"})}),t.bbcID&&e.jsx("li",{children:e.jsx("a",{href:`https://www.bbc.co.uk/weather/${t.bbcID}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"bbc-link",children:"BBC Weather"})}),e.jsx("li",{children:e.jsx("a",{href:`https://www.lightningmaps.org/?lang=en#m=oss;y=${t.coords[0]};x=${t.coords[1]};z=13`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-indigo-600 hover:underline","data-testid":"lightning-maps-link",children:"Lightning Maps"})})]})]})})]})}),Je=()=>e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center","data-testid":"weather-loading-spinner",children:e.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-indigo-500"})}),Xe=()=>{const t=We(),a=()=>t.loading?e.jsx(Je,{}):t.showLogin?e.jsx(Fe,{onLogin:t.login,onCancel:t.navigateToPublic}):t.user&&t.showEdit?e.jsx(He,{places:t.places,onAddPlace:t.handleAddPlace,onUpdatePlace:t.handleUpdatePlace,onDeletePlace:t.handleDeletePlace,onReorderPlaces:t.handleReorderPlaces,onSearchPlace:t.handleSearchPlace}):e.jsx(Ke,{selectedPlace:t.selectedPlace,zoomLevel:t.zoomLevel,onZoomChange:t.setZoomLevel});return e.jsxs("div",{className:"min-h-screen bg-slate-50 pb-12 font-sans text-slate-900","data-testid":"weather-page",children:[e.jsx(Oe,{isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,onLoginClick:t.navigateToLogin,onLogoutClick:t.logout,onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,showLoginButton:!t.user&&!t.showLogin,places:t.places,selectedPlace:t.selectedPlace,onPlaceChange:t.handlePlaceChange}),e.jsx("main",{"data-testid":"weather-main-content",children:a()})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Xe,{})}));
