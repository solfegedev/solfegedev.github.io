import"./index-F_Pwjxo7.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as m}from"./button-ChVf0VhC.js";import{A as k}from"./api-CH_Pe6Vg.js";import{c as _,f as M}from"./utils-Bp7-rn4K.js";import{S as L}from"./save-rN7CZjMN.js";import{R as G}from"./refresh-cw-pTx9cW3g.js";import{c as T}from"./createLucideIcon-DtX1aPOG.js";import"./clsx-B-dksMZM.js";const $=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],z=T("arrow-left-right",$),B=["USD","GBP","VND"],O=()=>{const[x,f]=React.useState({}),[u,h]=React.useState({}),[p,g]=React.useState(null),[q,b]=React.useState(!1),[v,j]=React.useState(!1),[N,c]=React.useState(null),[o,S]=React.useState(()=>{const t=localStorage.getItem("defaultFromCurrency");return B.includes(t)?t:"USD"}),[l,y]=React.useState(()=>{const t=localStorage.getItem("defaultToCurrency");return B.includes(t)?t:"GBP"}),[i,d]=React.useState("1"),[w,R]=React.useState(!1),C=t=>{if(!t)return"";const[r,a]=t.split("."),s=r.replace(/\B(?=(\d{3})+(?!\d))/g,",");return t.includes(".")?`${s}.${a}`:s},I=()=>{localStorage.setItem("defaultFromCurrency",o),localStorage.setItem("defaultToCurrency",l),R(!0),setTimeout(()=>R(!1),2e3)},D=React.useCallback(async()=>{b(!0),c(null);try{const t=await fetch(`${k}/currency/`);if(!t.ok)throw new Error("Failed to fetch rates");const r=await t.json(),a={},s={};r.rates.forEach(n=>{a[n.target_currency]=n.rate,s[n.target_currency]=n.default_amount}),f(a),h(s),g(r.last_updated),r.rates.length===0&&await E()}catch(t){c(t instanceof Error?t.message:"An error occurred")}finally{b(!1)}},[]),E=async()=>{j(!0),c(null);try{const t=await fetch(`${k}/currency/update`,{method:"POST"});if(!t.ok)throw new Error("Failed to update rates");const r=await t.json(),a={},s={};r.rates.forEach(n=>{a[n.target_currency]=n.rate,s[n.target_currency]=n.default_amount}),f(a),h(s),g(r.last_updated),s[o]&&d(s[o].toString())}catch(t){c(t instanceof Error?t.message:"An error occurred during update")}finally{j(!1)}};React.useEffect(()=>{D()},[D]),React.useEffect(()=>{u[o]&&d(u[o].toString())},[o,u]);const V=(t,r,a)=>{const s=parseFloat(t);if(isNaN(s))return"0";if(r===a)return t;const n=r==="USD"?s:s/(x[r]||1),U=a==="USD"?n:n*(x[a]||1);return a==="VND"?Math.round(U).toLocaleString():U.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},A=()=>{S(l),y(o)},F=V(i,o,l);return e.jsx("div",{className:"min-h-screen px-4 py-8 md:px-8",children:e.jsxs("div",{className:"mx-auto max-w-4xl overflow-hidden rounded-xl bg-white/80 p-6 shadow-xl backdrop-blur-sm","data-testid":"currency-container",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900","data-testid":"page-title",children:[e.jsx("img",{src:"/favicon_currency.png",alt:"Currency Converter",className:"aspect-square h-10 w-10 object-contain md:hidden"}),e.jsx("span",{className:"hidden md:inline",children:"Currency Converter"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(m,{variant:"outline",size:"default",onClick:I,className:_("flex items-center gap-2",w?"border-green-600 text-green-600":"bg-indigo-600 text-white"),"data-testid":"save-default-button",children:[e.jsx(L,{className:"h-4 w-4"}),w?"Saved!":"Save as default currencies"]}),e.jsxs(m,{variant:"outline",size:"default",onClick:E,disabled:v,className:"flex items-center gap-2 bg-indigo-600 text-white hover:bg-indigo-700","data-testid":"update-button",children:[e.jsx(G,{className:_("h-4 w-4",v&&"animate-spin")}),"Update Rates"]})]})]}),N&&e.jsx("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-600","data-testid":"error-message",children:N}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"Amount"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C(i),onChange:t=>{const a=t.target.value.replace(/,/g,"");/^\d*\.?\d*$/.test(a)&&d(a)},className:"w-full rounded-lg border border-slate-300 p-3 transition-all outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500",placeholder:"Enter amount","data-testid":"amount-input"}),e.jsx(m,{variant:"outline",className:"h-auto bg-indigo-600 px-4 text-white hover:bg-indigo-700",onClick:()=>{const t=parseFloat(i);t!==0&&!isNaN(t)&&d((1/t).toString())},title:"Inverse (1/x)","data-testid":"inverse-button",children:e.jsxs("div",{className:"flex flex-col items-center text-[10px] leading-tight font-bold",children:[e.jsx("span",{children:"1"}),e.jsx("div",{className:"h-px w-3 bg-current"}),e.jsx("span",{children:"x"})]})})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"From"}),e.jsxs("select",{value:o,onChange:t=>S(t.target.value),className:"w-full rounded-lg border border-slate-300 p-3 outline-none","data-testid":"from-currency-select",children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"}),e.jsx("option",{value:"VND",children:"VND - Vietnamese Dong"})]})]}),e.jsx("button",{onClick:A,className:"mb-0.5 rounded-lg bg-slate-100 p-3 transition-colors hover:bg-slate-200",title:"Swap Currencies","data-testid":"swap-button",children:e.jsx(z,{className:"h-5 w-5 text-slate-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700",children:"To"}),e.jsxs("select",{value:l,onChange:t=>y(t.target.value),className:"w-full rounded-lg border border-slate-300 p-3 outline-none","data-testid":"to-currency-select",children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"}),e.jsx("option",{value:"VND",children:"VND - Vietnamese Dong"})]})]})]}),e.jsxs("div",{className:"mt-8 rounded-xl bg-blue-50 p-6 text-center",children:[e.jsxs("p",{className:"mb-1 text-sm font-medium text-blue-600",children:[C(i)," ",o," ="]}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900","data-testid":"converted-value",children:[F," ",l]})]}),p&&e.jsxs("p",{className:"last-updated mt-4 text-center text-xs text-slate-500","data-testid":"last-updated",children:["Rates last updated: ",M(p,!1,!0)]})]})]})})},P=document.getElementById("root");if(!P)throw new Error("Root element not found");document.body.classList.add("currency");ReactDOM.createRoot(P).render(e.jsx(React.StrictMode,{children:e.jsx(O,{})}));
