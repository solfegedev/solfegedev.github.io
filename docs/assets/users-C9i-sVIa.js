import"./modulepreload-polyfill-B5Qt9EMX.js";import{r as u,j as e,R as j,a as y}from"./client-BsyqJ1xH.js";import{B as b}from"./button-BZSrPANe.js";import{g as _}from"./api-C-gcI8S5.js";const S=_(),d=s=>s.replace(/^value error,\s*/i,"").trim()||s,C=s=>{if(!s)return null;if(typeof s=="string")return d(s);if(typeof s=="object"){const a=s.detail;if(typeof a=="string")return d(a);if(Array.isArray(a)&&a.length>0){const o=a[0];if(o&&typeof o=="object"){const i=o.msg;if(typeof i=="string")return d(i);const l=o.ctx?.error;if(typeof l=="string")return d(l)}}}return null},E=()=>{const[s,a]=u.useState({email:"",password:"",confirm:""}),[o,i]=u.useState(!1),[l,n]=u.useState(null),[g,p]=u.useState(!1),f=u.useMemo(()=>{if(typeof window>"u")return null;const r=new URLSearchParams(window.location.search).get("back");return r&&r.startsWith("/")?r:null},[]),m=(t,r)=>{a(c=>({...c,[t]:r})),n(null)},w=async t=>{if(t.preventDefault(),!s.email.trim()||!s.password.trim()){n("Email and password are required.");return}if(s.password.length<8){n("Password must be at least 8 characters long.");return}if(s.password!==s.confirm){n("Passwords must match.");return}i(!0),n(null);try{const r=await fetch(`${S}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email.trim().toLowerCase(),password:s.password})});if(!r.ok){const c=await r.json().catch(()=>null),x=C(c)??"Unable to register.";throw new Error(x)}p(!0),n("Account created! You can now log in from the to-do list page."),a({email:"",password:"",confirm:""})}catch(r){const c=r instanceof Error?r.message:"Registration failed.";n(c),p(!1)}finally{i(!1)}};return e.jsx("div",{className:"users-app",children:e.jsxs("section",{className:"users-card","aria-live":"polite",children:[e.jsx("p",{className:"users-card__eyebrow",children:"Create account"}),e.jsx("h1",{children:"Register"}),e.jsx("p",{className:"users-card__subtitle",children:"Create a personal login to keep your to-do list private. You can log in from the to-do page once you finish."}),e.jsxs("form",{className:"users-form",onSubmit:w,children:[e.jsxs("label",{className:"users-form__field",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",value:s.email,onChange:t=>m("email",t.target.value),placeholder:"you@example.com",required:!0,autoComplete:"email"})]}),e.jsxs("label",{className:"users-form__field",children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",value:s.password,onChange:t=>m("password",t.target.value),placeholder:"********",required:!0,autoComplete:"new-password"})]}),e.jsxs("label",{className:"users-form__field",children:[e.jsx("span",{children:"Confirm password"}),e.jsx("input",{type:"password",value:s.confirm,onChange:t=>m("confirm",t.target.value),placeholder:"********",required:!0,autoComplete:"new-password"})]}),e.jsx(b,{type:"submit",className:"users-form__submit",disabled:o,children:o?"Creating accountâ€¦":"Register"})]}),l?e.jsx("p",{className:`users-card__feedback${g?" users-card__feedback--success":""}`,children:l}):null,f?e.jsx("a",{className:"users-card__link",href:f,children:"Back"}):null]})})},h=document.getElementById("root");if(!h)throw new Error("Root element #root not found");j.createRoot(h).render(e.jsx(y.StrictMode,{children:e.jsx(E,{})}));
