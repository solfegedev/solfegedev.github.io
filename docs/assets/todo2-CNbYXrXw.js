import"./index-BJcHZe8P.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import"./polyfills-BumHK8My.js";import{A as z}from"./api-CH_Pe6Vg.js";import{X as _}from"./x-BS-d4QNZ.js";import{P as $,A as X}from"./Auth-uEj7rJlD.js";import{C as Q}from"./check-CWX8rMms.js";import{T as U}from"./trash-2-DQbJ9aIh.js";import{P as O}from"./pen-vQk8amFZ.js";import{D as Z,U as ee}from"./upload--Rbr-3Yq.js";import{C as te}from"./circle-check-F4iM422t.js";import{c as A}from"./createLucideIcon-DtX1aPOG.js";import{F as se}from"./file-text-RVtngrx3.js";import{S as ae}from"./search-Cfl0sis-.js";import{L as F}from"./log-out-B0TqtotO.js";import{F as re}from"./funnel-BDdIBe_Y.js";import{S as oe}from"./settings-G074OJw9.js";import"./button-D6DGr86I.js";import"./clsx-B-dksMZM.js";import"./eye-Jn_UhOO1.js";const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],P=A("circle",le);const ne=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],de=A("menu",ne);const ie=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ce=A("square-check-big",ie),E="todo2_token",i={getToken:()=>localStorage.getItem(E),setToken:t=>localStorage.setItem(E,t),removeToken:()=>localStorage.removeItem(E),async request(t,s={}){const r=this.getToken(),o=new Headers(s.headers);r&&o.set("Authorization",`Bearer ${r}`),!(s.body instanceof FormData)&&!o.has("Content-Type")&&o.set("Content-Type","application/json");const l=await fetch(`${z}/todo2${t}`,{...s,headers:o});if(l.status===204)return{};if(!l.ok){l.status===401&&this.removeToken();const n=await l.json().catch(()=>({detail:"Unknown error"}));throw new Error(n.detail||"Request failed")}return l.json()},auth:{login:t=>i.request("/auth/login",{method:"POST",body:JSON.stringify(t)}).then(s=>(i.setToken(s.access_token),s)),logout:()=>(i.removeToken(),Promise.resolve()),me:()=>i.request("/auth/me")},categories:{list:()=>i.request("/categories"),create:(t,s)=>i.request("/categories",{method:"POST",body:JSON.stringify({name:t,color:s})}),update:(t,s,r)=>i.request(`/categories/${t}`,{method:"PUT",body:JSON.stringify({name:s,color:r})}),delete:t=>i.request(`/categories/${t}`,{method:"DELETE"})},tasks:{list:(t,s)=>{const r=new URLSearchParams;t&&r.set("category_id",t.toString()),s&&r.set("sort_by",s);const o=r.toString();return i.request(`/tasks${o?`?${o}`:""}`)},create:t=>i.request("/tasks",{method:"POST",body:JSON.stringify(t)}),update:(t,s)=>i.request(`/tasks/${t}`,{method:"PUT",body:JSON.stringify(s)}),delete:t=>i.request(`/tasks/${t}`,{method:"DELETE"})},data:{export:async()=>{const t=i.getToken(),s=await fetch(`${z}/todo2/export`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Export failed");return s.blob()},import:t=>i.request("/import",{method:"POST",body:t,headers:{"Content-Type":"application/x-yaml"}})}},I=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899","#6366f1","#14b8a6","#f97316","#06b6d4"],ue=({categories:t,onClose:s,onCreate:r,onUpdate:o,onDelete:l})=>{const[n,c]=React.useState(""),[m,y]=React.useState(I[0]),[b,g]=React.useState(null),[f,N]=React.useState(""),[u,j]=React.useState(""),x=a=>{a.preventDefault(),n.trim()&&(r(n.trim(),m),c(""))},p=a=>{a.preventDefault(),b&&f.trim()&&(o(b,f.trim(),u),g(null))},w=a=>{g(a.id),N(a.name),j(a.color)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-0 backdrop-blur-sm md:items-center md:p-4",children:e.jsxs("div",{className:"flex h-[80vh] w-full flex-col overflow-hidden rounded-t-2xl bg-white shadow-2xl md:h-auto md:max-w-md md:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-5",children:[e.jsx("h2",{className:"text-xl font-extrabold text-gray-900",children:"Categories"}),e.jsx("button",{onClick:s,className:"rounded-xl p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600",children:e.jsx(_,{size:24})})]}),e.jsxs("div",{className:"flex-1 space-y-8 overflow-y-auto p-6","data-testid":"category-manager",children:[e.jsxs("form",{onSubmit:x,className:"space-y-4 border-b border-gray-100 pb-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Add New Category"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,"data-testid":"new-category-input",className:"flex-1 rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",placeholder:"Work, Personal, etc...",value:n,onChange:a=>c(a.target.value)}),e.jsx("button",{type:"submit","data-testid":"add-category-button",disabled:!n.trim(),className:"flex items-center justify-center rounded-xl bg-blue-600 px-5 text-white shadow-lg shadow-blue-200 transition-all hover:bg-blue-700 active:scale-95 disabled:opacity-50 disabled:shadow-none",children:e.jsx($,{size:20})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Select Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(a=>e.jsx("button",{type:"button","data-testid":`color-preset-${a}`,onClick:()=>y(a),className:`h-8 w-8 rounded-full border-2 transition-all ${m===a?"scale-110 border-gray-900 shadow-md":"border-transparent hover:scale-105"}`,style:{backgroundColor:a}},a))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Current Categories"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2","data-testid":"category-list",children:[[...t].sort((a,v)=>a.name.localeCompare(v.name)).map(a=>e.jsx("div",{"data-testid":`category-item-${a.id}`,className:"space-y-2",children:b===a.id?e.jsxs("form",{onSubmit:p,className:"space-y-4 rounded-xl border border-blue-200 bg-blue-50/30 p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{autoFocus:!0,className:"flex-1 rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20",value:f,onChange:v=>N(v.target.value)}),e.jsx("button",{type:"submit",disabled:!f.trim(),className:"rounded-lg bg-blue-600 p-2 text-white shadow-sm hover:bg-blue-700 disabled:opacity-50",children:e.jsx(Q,{size:18})}),e.jsx("button",{type:"button",onClick:()=>g(null),className:"rounded-lg bg-gray-200 p-2 text-gray-600 hover:bg-gray-300",children:e.jsx(_,{size:18})})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:I.map(v=>e.jsx("button",{type:"button",onClick:()=>j(v),className:`h-6 w-6 rounded-full border-2 transition-all ${u===v?"scale-110 border-gray-900 shadow-sm":"border-transparent"}`,style:{backgroundColor:v}},v))}),e.jsx("div",{className:"flex justify-end border-t border-blue-100 pt-2",children:e.jsxs("button",{type:"button","data-testid":"delete-category-button-in-edit",onClick:()=>{confirm(`Delete category "${a.name}" and all its tasks?`)&&(l(a.id),g(null))},className:"flex items-center gap-1.5 text-[10px] font-black tracking-wider text-red-500 uppercase transition-colors hover:text-red-600",children:[e.jsx(U,{size:12}),"Delete Category"]})})]}):e.jsxs("div",{className:"group flex items-center justify-between rounded-xl border border-gray-100 bg-gray-50/50 p-4 transition-all hover:border-blue-100 hover:bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-3 w-3 rounded-full shadow-sm",style:{backgroundColor:a.color}}),e.jsx("span",{className:"font-bold text-gray-700","data-testid":"category-name",children:a.name})]}),e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{onClick:()=>w(a),"data-testid":"edit-category-button",className:"rounded-xl p-2.5 text-gray-400 transition-colors hover:bg-blue-50 hover:text-blue-600 active:scale-90",children:e.jsx(O,{size:18})})})]})},a.id)),t.length===0&&e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-sm font-medium text-gray-400",children:"No custom categories yet."})})]})]})]}),e.jsx("div",{className:"border-t border-gray-100 bg-gray-50 p-6 pb-8 md:pb-6",children:e.jsx("button",{onClick:s,"data-testid":"category-manager-done",className:"w-full rounded-xl border border-gray-200 bg-white px-4 py-4 text-sm font-bold text-gray-700 shadow-sm transition-all active:scale-95 active:bg-gray-50",children:"Done"})})]})})},xe=({onExport:t,onImport:s})=>{const r=React.useRef(null),o=l=>{const n=l.target.files?.[0];if(n){const c=new FileReader;c.onload=m=>{const y=m.target?.result;s(y),r.current&&(r.current.value="")},c.readAsText(n)}};return e.jsxs("div",{className:"space-y-2 border-t border-gray-200 p-4 text-gray-600","data-testid":"data-control",children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wider text-gray-500 uppercase",children:"Data Management"}),e.jsxs("button",{onClick:t,"data-testid":"export-button",className:"flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-50",children:[e.jsx(Z,{size:16}),"Export YAML"]}),e.jsxs("button",{onClick:()=>r.current?.click(),"data-testid":"import-button",className:"flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-50",children:[e.jsx(ee,{size:16}),"Import YAML"]}),e.jsx("input",{type:"file",ref:r,"data-testid":"import-input",className:"hidden",accept:".yml,.yaml",onChange:o})]})},me=({onSuccess:t})=>e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-4",children:e.jsx(X,{appName:"Todo2",loginEndpoint:"/todo2/auth/login",onSuccess:(s,r)=>t(s,r),className:"w-full max-w-md"})}),ge=({task:t,categories:s,categoryId:r,onSave:o,onClose:l})=>{const[n,c]=React.useState(t?.title||""),[m,y]=React.useState(t?.description||""),[b,g]=React.useState(t?.category_id||r||s[0]?.id),[f,N]=React.useState(t?.start_date?t.start_date.split("T")[0]:""),[u,j]=React.useState(t?.due_date?t.due_date.split("T")[0]:""),[x,p]=React.useState(t?.is_completed||!1),w=a=>{a.preventDefault(),o({title:n,description:m||null,category_id:b,is_completed:x,start_date:f?new Date(f).toISOString():null,due_date:u?new Date(u).toISOString():null})};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-end justify-center bg-black/50 p-0 backdrop-blur-sm md:items-center md:p-4",children:e.jsxs("div",{className:"flex h-[92vh] w-full flex-col overflow-hidden rounded-t-2xl bg-white shadow-2xl md:h-auto md:max-w-md md:rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-5",children:[e.jsx("h2",{className:"text-xl font-extrabold text-gray-900",children:t?"Edit Task":"New Task"}),e.jsx("button",{onClick:l,className:"rounded-xl p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600",children:e.jsx(_,{size:24})})]}),e.jsx("form",{onSubmit:w,className:"flex-1 space-y-6 overflow-y-auto p-6","data-testid":"task-form",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Title"}),e.jsx("input",{autoFocus:!0,required:!0,"data-testid":"task-title-input",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:n,onChange:a=>c(a.target.value),placeholder:"What needs to be done?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Description"}),e.jsx("textarea",{"data-testid":"task-description-input",className:"min-h-[120px] w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:m,onChange:a=>y(a.target.value),placeholder:"Add some details..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Category"}),e.jsx("select",{"data-testid":"task-category-select",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:b,onChange:a=>g(Number(a.target.value)),children:s.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Start Date"}),e.jsx("input",{type:"date","data-testid":"task-start-date-input",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:f,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1.5 block text-xs font-bold tracking-wider text-gray-400 uppercase",children:"Due Date"}),e.jsx("input",{type:"date","data-testid":"task-due-date-input",className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm font-medium transition-all outline-none focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-50",value:u,onChange:a=>j(a.target.value)})]})]}),t&&e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-gray-100 bg-gray-50 p-4 transition-colors active:bg-blue-50",onClick:()=>p(!x),"data-testid":"task-completed-toggle",children:[e.jsx("input",{type:"checkbox",id:"isCompleted","data-testid":"task-completed-checkbox",className:"h-5 w-5 rounded-md border-gray-300 text-blue-600 focus:ring-blue-500",checked:x,onChange:a=>p(a.target.checked),onClick:a=>a.stopPropagation()}),e.jsx("label",{htmlFor:"isCompleted",className:"text-sm font-bold text-gray-700 select-none",children:"Mark as completed"})]})]})}),e.jsxs("div",{className:"flex gap-3 border-t border-gray-100 bg-gray-50 p-6 pb-8 md:pb-6",children:[e.jsx("button",{type:"button",onClick:l,"data-testid":"task-form-cancel",className:"flex-1 rounded-xl border border-gray-200 bg-white px-4 py-4 text-sm font-bold text-gray-700 shadow-sm transition-all active:scale-95 active:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit","data-testid":"task-form-submit",onClick:a=>{a.preventDefault(),w(a)},className:"flex-1 rounded-xl bg-blue-600 px-4 py-4 text-sm font-bold text-white shadow-xl shadow-blue-200 transition-all active:scale-95 active:bg-blue-700",children:t?"Update Task":"Create Task"})]})]})})},C=({label:t,field:s,currentSort:r,onSort:o})=>e.jsx("th",{onClick:()=>o(s),"data-testid":`task-header-${s}`,className:"p-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1",children:[t,r===s&&e.jsx("span",{className:"text-[10px] text-blue-500 animate-in fade-in zoom-in duration-200",children:"â–¼"})]})}),he=({name:t,color:s})=>e.jsx("span",{"data-testid":"task-category-badge",className:"inline-flex rounded-full px-1 py-0.5 text-[10px] font-bold ring-1 ring-inset",style:{backgroundColor:`${s}15`,color:s,borderColor:`${s}30`},children:t}),pe=["all","upcoming","in_progress","overdue","completed"],M={in_progress:{label:"In Progress",className:"bg-green-100 text-green-700 ring-green-600/20"},completed:{label:"Completed",className:"bg-gray-100 text-gray-700 ring-gray-600/10"},upcoming:{label:"Upcoming",className:"bg-orange-100 text-orange-700 ring-orange-600/10"},overdue:{label:"Overdue",className:"bg-red-100 text-red-700 ring-red-600/10"}},be={all:"All",...Object.fromEntries(Object.entries(M).map(([t,s])=>[t,s.label]))},fe=({status:t})=>{const s=M[t];return e.jsx("span",{"data-testid":"task-status-badge",className:`inline-flex items-center rounded-md px-1 py-0.5 text-[10px] font-medium ring-1 ring-inset ${s.className}`,children:s.label})},ye=({task:t,category:s,isExpanded:r,onToggleNote:o,onToggleStatus:l,onEdit:n,onDelete:c})=>{const m=x=>x?new Date(x).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"-",y=x=>{if(!x)return!1;const p=new Date;return p.setHours(0,0,0,0),new Date(x)<p},b=x=>{if(!x)return!1;const p=new Date;return p.setHours(0,0,0,0),new Date(x)>p},g=x=>{if(!x)return null;const p=new Date;p.setHours(0,0,0,0);const w=new Date(x);w.setHours(0,0,0,0);const a=w.getTime()-p.getTime();return Math.ceil(a/864e5)},f=()=>t.is_completed?"completed":y(t.due_date)?"overdue":b(t.start_date)?"upcoming":"in_progress",N=g(t.due_date),u=f(),j="whitespace-nowrap p-1 align-top";return e.jsxs("tr",{"data-testid":`task-row-${t.id}`,className:`hover:bg-gray-50 transition-colors group ${t.is_completed?"bg-gray-50/50":""}`,children:[e.jsx("td",{className:j,children:e.jsx("button",{onClick:()=>l(t),"data-testid":"toggle-status-button",className:`cursor-pointer transition-colors ${t.is_completed?"text-gray-400":"text-gray-300 hover:text-blue-500"}`,children:t.is_completed?e.jsx(te,{size:20}):e.jsx(P,{size:20})})}),e.jsx("td",{className:j,children:e.jsx(fe,{status:u})}),e.jsxs("td",{"data-testid":"task-title-cell",className:`p-1 align-top text-sm font-medium ${t.is_completed?"font-normal text-gray-400 line-through":"text-gray-900"}`,children:[e.jsx("div",{className:"max-w-[150px] md:max-w-xs truncate",children:t.title}),r&&t.description&&e.jsx("div",{className:"whitespace-pre-wrap mt-2 max-w-[150px] md:max-w-xs text-xs font-normal text-gray-500 animate-in fade-in slide-in-from-top-1 duration-200",children:t.description})]}),e.jsx("td",{className:`${j} text-sm text-gray-500`,"data-testid":"task-start-date",children:m(t.start_date)}),e.jsx("td",{className:`${j} text-sm text-gray-500`,"data-testid":"task-due-date",children:e.jsx("span",{className:!t.is_completed&&y(t.due_date)?"font-semibold text-red-500":"",children:m(t.due_date)})}),e.jsx("td",{className:`${j} text-sm text-gray-500`,"data-testid":"task-days-due",children:N!==null&&e.jsx("span",{className:!t.is_completed&&N<0?"font-bold text-red-500":"",children:N})}),e.jsx("td",{className:`${j} text-sm`,"data-testid":"task-category",children:s&&e.jsx(he,{name:s.name,color:s.color})}),e.jsx("td",{className:`${j} text-right text-sm font-medium`,children:e.jsxs("div",{className:"flex justify-end gap-3 text-gray-400",children:[t.description&&e.jsx("button",{onClick:()=>o(t.id),"data-testid":"toggle-note-button",className:`hover:text-blue-600 transition-colors cursor-pointer ${r?"text-blue-600":""}`,title:"Show note",children:e.jsx(se,{size:18})}),e.jsx("button",{onClick:()=>n(t),"data-testid":"edit-task-button",className:"hover:text-blue-600 transition-colors cursor-pointer",children:e.jsx(O,{size:18})}),e.jsx("button",{onClick:()=>{confirm("Delete task?")&&c(t.id)},"data-testid":"delete-task-button",className:"hover:text-red-600 transition-colors cursor-pointer",children:e.jsx(U,{size:18})})]})})]})},je=({tasks:t,categories:s,sortBy:r,onSort:o,onToggleStatus:l,onEdit:n,onDelete:c})=>{const[m,y]=React.useState(null),b=g=>{y(m===g?null:g)};return e.jsx("div",{className:"flex-1 overflow-x-auto bg-gray-50/50",children:e.jsxs("div",{className:"min-w-full inline-block align-middle",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200","data-testid":"task-list-table",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-gray-50 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-1 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"Completed"}),e.jsx(C,{label:"Status",field:"status",currentSort:r,onSort:o}),e.jsx(C,{label:"Title",field:"title",currentSort:r,onSort:o}),e.jsx(C,{label:"Start Date",field:"start_date",currentSort:r,onSort:o}),e.jsx(C,{label:"Due Date",field:"due_date",currentSort:r,onSort:o}),e.jsx(C,{label:"Due In",field:"due_date",currentSort:r,onSort:o}),e.jsx(C,{label:"Category",field:"category",currentSort:r,onSort:o}),e.jsx("th",{className:"p-1 text-right text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white","data-testid":"task-list-body",children:t.map(g=>e.jsx(ye,{task:g,category:s.find(f=>f.id===g.category_id),isExpanded:m===g.id,onToggleNote:b,onToggleStatus:l,onEdit:n,onDelete:c},g.id))})]}),t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center px-6 py-20 text-center text-gray-500","data-testid":"task-list-empty",children:[e.jsx("div",{className:"mb-4 p-4 rounded-full bg-gray-100",children:e.jsx(P,{size:48,className:"opacity-20"})}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:"No tasks found"}),e.jsx("p",{className:"mt-1 text-sm",children:'Tap the "Add Task" button to get started.'})]})]})})},Ne=({filters:t,categories:s,onChange:r})=>{const o=l=>{const{name:n,value:c,type:m}=l.target,y=m==="checkbox"?l.target.checked:n==="categoryId"?c?Number(c):void 0:c;r({...t,[n]:y})};return e.jsx("div",{className:"z-10 border-b border-gray-200 bg-white p-4 shadow-sm","data-testid":"filter-bar",children:e.jsxs("div",{className:"mx-auto flex max-w-6xl flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative min-w-[200px] flex-1",children:[e.jsx("input",{type:"text",name:"search","data-testid":"search-input",value:t.search,onChange:o,placeholder:"Search tasks...",className:"w-full rounded-xl border border-gray-200 bg-gray-50 py-2 pr-4 pl-10 text-sm font-medium transition-all focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"}),e.jsx(ae,{className:"absolute top-2.5 left-3 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Category"}),e.jsxs("select",{name:"categoryId","data-testid":"category-filter-select-in-bar",value:t.categoryId||"",onChange:o,className:"rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-bold text-gray-700 focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Categories"}),[...s].sort((l,n)=>l.name.localeCompare(n.name)).map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx("input",{type:"checkbox",name:"excludeCompletedAndUpcoming",id:"excludeCompletedAndUpcoming","data-testid":"exclude-completed-upcoming-checkbox",checked:t.excludeCompletedAndUpcoming,onChange:o,className:"h-4 w-4 cursor-pointer rounded border-gray-300 text-blue-600 focus:ring-blue-500/20"}),e.jsx("label",{htmlFor:"excludeCompletedAndUpcoming",className:"cursor-pointer text-sm font-bold text-gray-700",children:"Exclude Completed & Upcoming"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black tracking-tight text-gray-400 uppercase",children:"Status"}),e.jsx("select",{name:"status","data-testid":"status-filter-select",value:t.status,onChange:o,className:"rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-bold text-gray-700 focus:ring-2 focus:ring-blue-500/20 focus:outline-none",children:pe.map(l=>e.jsx("option",{value:l,children:be[l]},l))})]})]})})},we=({user:t,onLogout:s,navbar:r,sidebar:o,children:l})=>{const[n,c]=React.useState(!1);return e.jsxs("div",{className:"flex h-screen flex-col overflow-hidden bg-gray-50",children:[e.jsxs("header",{className:"z-30 flex min-h-[4rem] shrink-0 items-center justify-between border-b border-gray-200 bg-white px-4 py-2 shadow-sm md:h-16 md:px-6 md:py-0",children:[e.jsx("div",{className:"mx-auto flex max-w-6xl flex-1 items-center justify-between",children:r}),o&&e.jsx("button",{onClick:()=>c(!0),className:"ml-4 rounded-xl p-2 text-gray-500 transition-colors hover:bg-gray-100 md:hidden",children:e.jsx(de,{size:24})})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("main",{className:"mx-auto flex max-w-6xl flex-1 flex-col overflow-hidden",children:l}),o&&e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm md:hidden",onClick:()=>c(!1)}),e.jsxs("aside",{className:`fixed inset-y-0 right-0 z-50 flex w-72 flex-col border-l border-gray-200 bg-white transition-transform duration-300 md:static md:flex md:w-64 md:translate-x-0 ${n?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 p-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Settings"}),e.jsx("button",{onClick:()=>c(!1),className:"rounded-lg p-2 text-gray-500 hover:bg-gray-100 md:hidden",children:e.jsx(_,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",onClick:()=>c(!1),children:o}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex min-w-0 flex-col",children:[e.jsx("span",{className:"truncate text-sm font-semibold text-gray-900",children:t.name}),e.jsx("span",{className:"truncate text-xs text-gray-500",children:t.email})]}),e.jsx("button",{onClick:s,className:"flex-shrink-0 rounded-lg p-2 text-gray-400 transition-colors hover:bg-red-50 hover:text-red-600",title:"Logout",children:e.jsx(F,{size:20})})]})})]})]})]})]})},ve=()=>{const[t,s]=React.useState(null),[r,o]=React.useState(!0);return React.useEffect(()=>{i.auth.me().then(s).catch(()=>s(null)).finally(()=>o(!1))},[]),{user:t,setUser:s,loading:r}},ke=t=>{const[s,r]=React.useState([]),[o,l]=React.useState(!1),n=()=>{t&&(l(!0),i.categories.list().then(r).catch(()=>r([])).finally(()=>l(!1)))};return React.useEffect(()=>{n()},[t]),{categories:s,loading:o,refetch:n}},Ce=(t,s,r)=>{const[o,l]=React.useState([]),[n,c]=React.useState(!1),m=()=>{t&&(c(!0),i.tasks.list(s,r).then(l).catch(()=>l([])).finally(()=>c(!1)))};return React.useEffect(()=>{m()},[t,s,r]),{tasks:o,loading:n,refetch:m}},Se=()=>{const{user:t,setUser:s,loading:r}=ve(),[o,l]=React.useState("created_at"),[n,c]=React.useState(!1),[m,y]=React.useState(!1),[b,g]=React.useState(null),[f,N]=React.useState(!1),[u,j]=React.useState({search:"",status:"all",categoryId:void 0,excludeCompletedAndUpcoming:!1}),{categories:x,refetch:p}=ke(t),{tasks:w,refetch:a}=Ce(t,u.categoryId,o),v=React.useMemo(()=>{const d=new Date;return d.setHours(0,0,0,0),w.filter(h=>{const k=!u.search||h.title.toLowerCase().includes(u.search.toLowerCase())||h.description&&h.description.toLowerCase().includes(u.search.toLowerCase()),S=h.is_completed,D=!S&&!!h.due_date&&new Date(h.due_date)<d,R=!S&&!D&&!!h.start_date&&new Date(h.start_date)>d,V=!S&&!D&&!R;let T=!0;u.status==="completed"?T=S:u.status==="in_progress"?T=V:u.status==="upcoming"?T=R:u.status==="overdue"&&(T=D);const W=!u.excludeCompletedAndUpcoming||!S&&!R,G=!u.categoryId||h.category_id===u.categoryId;return k&&T&&W&&G})},[w,u]);if(r)return e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50 px-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-blue-600 border-t-transparent shadow-lg shadow-blue-100"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:"Loading your tasks..."})]})});if(!t)return e.jsx(me,{onSuccess:d=>{i.setToken(d.access_token),s(d.user)}});const L=()=>{i.auth.logout().then(()=>s(null))},q=d=>{i.tasks.create(d).then(()=>{a(),c(!1)})},H=d=>{b&&i.tasks.update(b.id,d).then(()=>{a(),g(null)})},B=d=>{i.tasks.update(d.id,{is_completed:!d.is_completed}).then(a)},J=async()=>{try{const d=await i.data.export(),h=window.URL.createObjectURL(d),k=document.createElement("a");k.href=h,k.download="todo2_export.yml",document.body.appendChild(k),k.click(),window.URL.revokeObjectURL(h),document.body.removeChild(k)}catch{alert("Failed to export data")}},K=d=>{i.data.import(d).then(()=>{p(),a()}).catch(h=>alert("Import failed: "+h.message))},Y=(u.categoryId?x.find(d=>d.id===u.categoryId):null)?.name||"All Tasks";return e.jsxs(we,{user:t,onLogout:L,navbar:e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-between gap-y-3 md:flex-nowrap md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200",children:e.jsx(ce,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-lg font-extrabold tracking-tight text-gray-900 md:text-xl",children:"Todo2"}),e.jsx("span",{className:"text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:Y})]})]}),e.jsxs("div",{className:"flex w-full items-center justify-between gap-2 md:w-auto md:flex-1 md:justify-end md:gap-4",children:[e.jsxs("button",{onClick:()=>N(!f),"data-testid":"toggle-filters-button",className:`flex h-10 w-10 items-center justify-center rounded-xl transition-all md:w-auto md:gap-2 md:px-4 ${f?"bg-blue-600 text-white shadow-lg shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:"Toggle Filters",children:[e.jsx(re,{size:20}),e.jsx("span",{className:"hidden text-sm font-bold md:block",children:"Filters"})]}),e.jsxs("button",{onClick:()=>y(!0),"data-testid":"settings-button",className:"flex h-10 w-10 items-center justify-center rounded-xl bg-gray-100 text-gray-600 transition-all hover:bg-gray-200 md:w-auto md:gap-2 md:px-4",title:"Manage Categories",children:[e.jsx(oe,{size:20}),e.jsx("span",{className:"hidden text-sm font-bold md:block",children:"Settings"})]}),e.jsxs("div",{className:"hidden h-10 items-center gap-3 border-l border-gray-200 pl-4 md:flex",children:[e.jsxs("div",{className:"flex flex-col text-right",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900","data-testid":"user-first-name",children:t.first_name}),e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:"Pro User"})]}),e.jsx("button",{onClick:L,"data-testid":"logout-button",className:"flex h-10 w-10 items-center justify-center rounded-xl text-gray-400 transition-colors hover:bg-red-50 hover:text-red-500",title:"Logout",children:e.jsx(F,{size:20})})]})]})]}),sidebar:e.jsx("div",{className:"flex flex-col gap-6 p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"px-2 text-[10px] font-bold tracking-wider text-gray-400 uppercase",children:"Data Management"}),e.jsx(xe,{onExport:J,onImport:K})]})}),children:[e.jsxs("div",{className:"relative flex h-full flex-col overflow-hidden",children:[f&&e.jsx(Ne,{filters:u,categories:x,onChange:j}),e.jsx(je,{tasks:v,categories:x,sortBy:o,onSort:l,onToggleStatus:B,onEdit:g,onDelete:d=>i.tasks.delete(d).then(a)}),e.jsx("div",{className:"absolute right-8 bottom-8 z-30",children:e.jsx("button",{onClick:()=>c(!0),"data-testid":"add-task-button",className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-blue-600 text-white shadow-2xl shadow-blue-300 transition-all hover:scale-105 hover:bg-blue-700 active:scale-95",children:e.jsx($,{size:28})})})]}),(n||b)&&e.jsx(ge,{task:b,categories:x,categoryId:u.categoryId,onSave:b?H:q,onClose:()=>{c(!1),g(null)}}),m&&e.jsx(ue,{categories:x,onClose:()=>y(!1),onCreate:(d,h)=>i.categories.create(d,h).then(p),onUpdate:(d,h,k)=>i.categories.update(d,h,k).then(()=>{p(),a()}),onDelete:d=>i.categories.delete(d).then(()=>{p(),u.categoryId===d&&j(h=>({...h,categoryId:void 0}))})})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Se,{})}));
