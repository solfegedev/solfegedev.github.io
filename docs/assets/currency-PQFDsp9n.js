import"./index-Ch1IFy9t.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{B as C}from"./button-ChVf0VhC.js";import{A as D}from"./api-CH_Pe6Vg.js";import{c as U,f as A}from"./utils-Bp7-rn4K.js";import{c as E}from"./createLucideIcon-DtX1aPOG.js";import{R as F}from"./refresh-cw-pTx9cW3g.js";import"./clsx-B-dksMZM.js";const L=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],G=E("arrow-left-right",L);const T=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],$=E("save",T),k=["USD","GBP","VND"],z=()=>{const[d,i]=React.useState({}),[u,m]=React.useState(null),[H,x]=React.useState(!1),[h,p]=React.useState(!1),[f,c]=React.useState(null),[l,B]=React.useState("1"),[n,g]=React.useState(()=>{const t=localStorage.getItem("defaultFromCurrency");return k.includes(t)?t:"USD"}),[o,v]=React.useState(()=>{const t=localStorage.getItem("defaultToCurrency");return k.includes(t)?t:"GBP"}),[b,j]=React.useState(!1),y=t=>{if(!t)return"";const[s,a]=t.split("."),r=s.replace(/\B(?=(\d{3})+(?!\d))/g,",");return t.includes(".")?`${r}.${a}`:r},P=()=>{localStorage.setItem("defaultFromCurrency",n),localStorage.setItem("defaultToCurrency",o),j(!0),setTimeout(()=>j(!1),2e3)},N=React.useCallback(async()=>{x(!0),c(null);try{const t=await fetch(`${D}/currency/`);if(!t.ok)throw new Error("Failed to fetch rates");const s=await t.json(),a={};s.rates.forEach(r=>{a[r.target_currency]=r.rate}),i(a),m(s.last_updated),s.rates.length===0&&await S()}catch(t){c(t instanceof Error?t.message:"An error occurred")}finally{x(!1)}},[]),S=async()=>{p(!0),c(null);try{const t=await fetch(`${D}/currency/update`,{method:"POST"});if(!t.ok)throw new Error("Failed to update rates");const s=await t.json(),a={};s.rates.forEach(r=>{a[r.target_currency]=r.rate}),i(a),m(s.last_updated)}catch(t){c(t instanceof Error?t.message:"An error occurred during update")}finally{p(!1)}};React.useEffect(()=>{N()},[N]);const I=(t,s,a)=>{const r=parseFloat(t);if(isNaN(r))return"0";if(s===a)return t;const w=s==="USD"?r:r/(d[s]||1),R=a==="USD"?w:w*(d[a]||1);return a==="VND"?Math.round(R).toLocaleString():R.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})},M=()=>{g(o),v(n)},_=I(l,n,o);return e.jsx("div",{className:"min-h-screen bg-slate-50 px-4 md:px-8",children:e.jsxs("div",{className:"mx-auto max-w-[1440px] bg-white rounded-xl shadow-md overflow-hidden p-6","data-testid":"currency-container",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900","data-testid":"page-title",children:"Currency Converter"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{variant:"outline",size:"default",onClick:P,className:U("flex items-center gap-2",b&&"text-green-600 border-green-600"),"data-testid":"save-default-button",children:[e.jsx($,{className:"h-4 w-4"}),b?"Saved!":"Save as default currencies"]}),e.jsxs(C,{variant:"outline",size:"default",onClick:S,disabled:h,className:"flex items-center gap-2","data-testid":"update-button",children:[e.jsx(F,{className:U("h-4 w-4",h&&"animate-spin")}),"Update"]})]})]}),f&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm","data-testid":"error-message",children:f}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Amount"}),e.jsx("input",{type:"text",value:y(l),onChange:t=>{const a=t.target.value.replace(/,/g,"");/^\d*\.?\d*$/.test(a)&&B(a)},className:"w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all",placeholder:"Enter amount","data-testid":"amount-input"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"From"}),e.jsxs("select",{value:n,onChange:t=>g(t.target.value),className:"w-full p-3 border border-slate-300 rounded-lg outline-none","data-testid":"from-currency-select",children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"}),e.jsx("option",{value:"VND",children:"VND - Vietnamese Dong"})]})]}),e.jsx("button",{onClick:M,className:"p-3 mb-0.5 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors",title:"Swap Currencies","data-testid":"swap-button",children:e.jsx(G,{className:"h-5 w-5 text-slate-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"To"}),e.jsxs("select",{value:o,onChange:t=>v(t.target.value),className:"w-full p-3 border border-slate-300 rounded-lg outline-none","data-testid":"to-currency-select",children:[e.jsx("option",{value:"USD",children:"USD - US Dollar"}),e.jsx("option",{value:"GBP",children:"GBP - British Pound"}),e.jsx("option",{value:"VND",children:"VND - Vietnamese Dong"})]})]})]}),e.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-sm text-blue-600 font-medium mb-1",children:[y(l)," ",n," ="]}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900","data-testid":"converted-value",children:[_," ",o]})]}),u&&e.jsxs("p",{className:"text-center text-xs text-slate-500 mt-4 last-updated","data-testid":"last-updated",children:["Rates last updated: ",A(u,!1,!0)]})]})]})})},V=document.getElementById("root");if(!V)throw new Error("Root element not found");document.body.classList.add("currency-page");ReactDOM.createRoot(V).render(e.jsx(React.StrictMode,{children:e.jsx(z,{})}));
