import"./index-CoYRNWoz.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as we,T as We}from"./Toast-DyY2cq3X.js";import{A as G}from"./api-CH_Pe6Vg.js";import{B as J}from"./button-3erh_Qe6.js";import{T as de}from"./trash-2-DQbJ9aIh.js";import{L as Ve,a as ae,I as re}from"./label-Dy_o-Bkv.js";import{L as Ye}from"./log-out-B0TqtotO.js";import{A as qe,P as He}from"./Auth-Dw3S9KC1.js";import{U as Ke,D as Je,G as me}from"./upload-CK6mc6ZD.js";import{R as ye}from"./refresh-cw-pTx9cW3g.js";import{F as Qe}from"./folder-plus-BkAA-aX2.js";import{c as Xe}from"./createLucideIcon-DtX1aPOG.js";import{B as Ze,P as et}from"./index-BehiXGmn.js";import"./x-BS-d4QNZ.js";import"./clsx-B-dksMZM.js";import"./eye-Jn_UhOO1.js";const tt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],at=Xe("star",tt),ve=React.createContext(void 0),st=({children:t})=>{const[o,r]=React.useState(()=>({user:null,token:typeof window<"u"?localStorage.getItem("odds_token")||sessionStorage.getItem("odds_token"):null,status:"idle"})),s=React.useCallback((h,l,p)=>{p?localStorage.setItem("odds_token",h):sessionStorage.setItem("odds_token",h),r({user:l,token:h,status:"success"})},[]),d=React.useCallback(async()=>{try{await fetch(`${G}/bookmarks/logout`,{method:"POST",credentials:"include"})}catch(h){console.error("Logout API call failed",h)}localStorage.removeItem("odds_token"),sessionStorage.removeItem("odds_token"),r({user:null,token:null,status:"idle"})},[]),m=async(h,l,p=!0)=>{r(g=>({...g,status:"loading"}));try{const g=await fetch(`${G}/odds/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:h,password:l,remember:p})});if(!g.ok)throw new Error("Invalid credentials");const x=await g.json();p?localStorage.setItem("odds_token",x.access_token):sessionStorage.setItem("odds_token",x.access_token),r({user:x.user,token:x.access_token,status:"success"})}catch(g){throw r(x=>({...x,status:"error"})),g}},f=React.useCallback(async h=>{try{const l=await fetch(`${G}/odds/me`,{headers:h?{Authorization:`Bearer ${h}`}:{},credentials:"include"});if(l.ok){const p=await l.json();r(g=>({...g,user:p,status:"success"}))}else d()}catch(l){console.error("Failed to fetch user",l),d()}},[d]);return React.useEffect(()=>{o.token&&!o.user&&f(o.token)},[o.token,o.user,f]),e.jsx(ve.Provider,{value:{...o,login:m,logout:d,onAuthSuccess:s},children:t})},je=()=>{const t=React.useContext(ve);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},rt=t=>t.state?.status==="ACTIVE",nt=t=>t.state?.status==="LOSER",ot=t=>t.state?.status==="WINNER",he=t=>{if(!t||t.length===0)return null;const[o]=t;return typeof o.price!="number"||typeof o.size!="number"?null:{price:o.price,size:o.size}},it=(t,o,r,s)=>{const d=[],m=l=>typeof l!="number"?1:l<=0?0:1/l;if(typeof t=="number"&&t>0&&d.push({price:t,weight:m(r)}),typeof o=="number"&&o>0&&d.push({price:o,weight:m(s)}),d.length===0)return null;const f=d.reduce((l,p)=>l+p.weight,0);return f===0?null:1/(d.reduce((l,p)=>l+p.price*p.weight,0)/f)},ke="* ",pe="1.244214540",lt=(t,o)=>{const r=t.eventTypes?.[0]?.eventNodes?.[0]?.marketNodes?.[0],s=r?{marketId:r.marketId,status:r.state.status,inplay:r.state.inplay,numberOfWinners:r.state.numberOfWinners,description:r.description,runners:r.runners}:void 0,d=s?.description?.marketName??"—",m=s?.runners??[],f=m.filter(rt),h=m.filter(nt),l=m.filter(ot),p=k=>{const I=k.description?.runnerName??"Unknown runner",T=he(k.exchange?.availableToBack),M=he(k.exchange?.availableToLay),E=T?.price??(typeof k.state?.lastPriceTraded=="number"?k.state?.lastPriceTraded:null),L=M?.price??null,U=T?.size??null,N=M?.size??null,b=k.state?.status,j=b==="ACTIVE"||b==="LOSER"||b==="WINNER"?b:"UNKNOWN",n=j==="WINNER",a=n?ke+I:I,i=n?1:it(E,L,U,N),w=n?1:typeof L=="number"&&L>0?1/L:null,P=n?1:typeof E=="number"&&E>0?1/E:null;return{id:k.selectionId,name:a,status:j,bestBack:E,bestLay:L,impliedProbability:i,probabilityMin:w,probabilityMax:P}},x=[...[...f,...l].map(p)].sort((k,I)=>{const T=k.impliedProbability??0,M=I.impliedProbability??0;if(T!==M)return M-T;const E=k.bestBack??Number.POSITIVE_INFINITY,L=I.bestBack??Number.POSITIVE_INFINITY;return E!==L?E-L:0}),v=x.filter(k=>(k.impliedProbability??0)>=.01),y=v.reduce((k,I)=>k+(I.impliedProbability??0),0),S=Math.max(0,1-y),D=x.length-v.length,A={id:-1,name:D>0?`Others ${D}`:"Others",bestBack:null,bestLay:null,status:"AGGREGATE",impliedProbability:S,probabilityMin:S,probabilityMax:S},z=[...v,A].sort((k,I)=>{const T=k.impliedProbability??0,M=I.impliedProbability??0;return T!==M?M-T:0});return{marketId:s?.marketId??"unknown",marketName:d,runners:z,fetchedAt:o.toISOString(),status:s?.status??"UNKNOWN",inplay:!!s?.inplay,numberOfWinners:s?.numberOfWinners??1,activeRunnerCount:f.length,loserRunnerCount:h.length,winnerRunnerCount:l.length,totalRunners:f.length+h.length+l.length}},dt=()=>{const{errorToast:t}=we(),{user:o,token:r,logout:s}=je(),[d,m]=React.useState([]),[f,h]=React.useState("idle"),[l,p]=React.useState(()=>typeof window>"u"?pe:new URLSearchParams(window.location.search).get("marketId")??pe),[g,x]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[v,y]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit");React.useEffect(()=>{if(typeof window>"u")return;const n=new URLSearchParams(window.location.search),a=n.get("marketId");if(l&&a!==l){n.set("marketId",l);const i=`${window.location.pathname}?${n.toString()}${window.location.hash}`;window.history.replaceState({},"",i)}},[l]),React.useEffect(()=>{const n=()=>{const a=new URLSearchParams(window.location.search);x(a.get("view")==="login"),y(a.get("view")==="edit")};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]);const S=()=>{const n=new URLSearchParams(window.location.search);n.get("view")!=="login"&&(n.set("view","login"),window.history.pushState({},"",`?${n.toString()}`),x(!0),y(!1))},D=()=>{const n=new URLSearchParams(window.location.search);n.get("view")!=="edit"&&(n.set("view","edit"),window.history.pushState({},"",`?${n.toString()}`),y(!0),x(!1))},A=()=>{const n=new URLSearchParams(window.location.search);if(n.has("view")){n.delete("view");const a=n.toString();window.history.pushState({},"",a?`?${a}`:window.location.pathname),x(!1),y(!1)}else x(!1),y(!1)},z=React.useCallback(async()=>{h("loading");try{const n=await fetch(`${G}/odds/`);if(!n.ok)throw new Error("Fetch failed");const a=await n.json();m(Array.isArray(a)?a:a.markets??[]),h("success")}catch{h("error")}},[]),k=async(n,a)=>{if(r)try{const i=await fetch(`${G}/odds/markets/${n}/favorite`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({favorite:a})});if(!i.ok)throw new Error("Patch failed");const w=await i.json();m(w.markets)}catch{t("Failed to toggle favorite")}},I=async n=>{const a=await fetch(`${G}/odds/market-name/${n}`);if(!a.ok)throw new Error("Name fetch failed");return(await a.json()).name},T=async n=>{if(!r)return;const a=await fetch(`${G}/odds/markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)});if(!a.ok)throw new Error("Add failed");const i=await a.json();m(i.markets),p(n.id)},M=async n=>{if(!r||!window.confirm("Delete market?"))return;const a=await fetch(`${G}/odds/markets/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Delete failed");const i=await a.json();m(i.markets)},E=async n=>{if(!r)return;const a=await fetch(`${G}/odds/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({label:n})});if(!a.ok)throw new Error("Add failed");const i=await a.json();m(i.markets)},L=async n=>{if(!r||!window.confirm("Delete group?"))return;const a=await fetch(`${G}/odds/groups/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Delete failed");const i=await a.json();m(i.markets)},U=async n=>{if(!r)return;const i=await(await fetch(`${G}/odds/reorder-groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({group_ids:n})})).json();m(i.markets)},N=async(n,a)=>{if(!r)return;const w=await(await fetch(`${G}/odds/reorder-markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({group_id:n,market_ids:a})})).json();m(w.markets)},b=async n=>{if(!r)return;const i=await(await fetch(`${G}/odds/import`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)})).json();m(i.markets)},j=async()=>{if(!r)return;const a=await(await fetch(`${G}/odds/export`,{headers:{Authorization:`Bearer ${r}`}})).blob(),i=window.URL.createObjectURL(a),w=document.createElement("a");w.href=i,w.download="odds_backup.yml",w.click()};return React.useEffect(()=>{z()},[z]),React.useEffect(()=>{o&&new URLSearchParams(window.location.search).get("view")!=="edit"&&D()},[o]),{user:o,token:r,logout:s,marketGroups:d,marketListState:f,selectedMarketId:l,setSelectedMarketId:p,showLogin:g,showEdit:v,navigateToLogin:S,navigateToEdit:D,navigateToPublic:A,handleToggleFavorite:k,handleGetMarketName:I,handleAddMarket:T,handleDeleteMarket:M,handleAddGroup:E,handleDeleteGroup:L,handleReorderGroups:U,handleReorderMarkets:N,handleImportYaml:b,handleExportYaml:j}},fe=t=>{const o=t.filter(s=>!!s.favorite),r=t.filter(s=>!s.favorite);return[...o,...r]},ct=(t,o)=>{const r=[];return t.forEach(s=>{const d=`group-${s.id}`;r.push({kind:"group",id:d,groupId:s.id,label:s.label}),o.has(s.id)&&s.markets.forEach(m=>{r.push({kind:"option",id:`option-${m.id}`,groupId:s.id,marketId:m.id,label:m.label})})}),r},ut=(t,o)=>t.find(r=>r.markets.some(s=>s.id===o)),xe=t=>t.flatMap(o=>o.markets),Ne=({favorite:t})=>t?e.jsx("span",{className:"text-base leading-none text-[#ffdc00]","aria-hidden":"true",children:"★"}):null,mt=t=>{if(!t)return"";try{const o=new Date(t);return Number.isNaN(o.getTime())?t:o.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}catch{return t}},Re=({label:t,favorite:o,expiryDate:r})=>e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(Ne,{favorite:o}),e.jsx("span",{children:t}),r?e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{className:"text-sm font-semibold text-[#9aa5c0]",children:mt(r)})]}):null]}),ht=({selectedMarket:t,isOpen:o,onToggle:r,onClose:s,toggleRef:d})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-xl border border-white/10 bg-white/20 px-3 py-2.5 text-left font-semibold text-[#e8ecf5] shadow-[0_16px_32px_rgba(0,0,0,0.35)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946] focus-visible:ring-offset-2 focus-visible:ring-offset-transparent","aria-haspopup":"listbox","aria-expanded":o,onClick:r,onKeyDown:m=>{m.key==="Escape"&&s()},ref:d,"data-testid":"market-dropdown-trigger",children:[e.jsx(Re,{label:t?.label??"",favorite:t?.favorite,expiryDate:t?.expiry_date}),e.jsx("span",{className:"ml-1 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),pt=({requestState:t})=>e.jsx("li",{children:e.jsx("span",{className:"flex w-full items-center justify-between gap-2 rounded-lg border border-transparent bg-white/10 px-2.5 py-2 text-left font-semibold text-[#e8ecf5]",children:t==="loading"?"Loading markets...":"No markets available"})}),ft=({group:t,isExpanded:o,headerId:r,onToggle:s,onKeyDown:d,setItemRef:m,isFocused:f,onFocus:h})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-lg bg-[#26356d] px-2.5 py-2 text-left font-bold text-[#e8ecf5] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]","aria-expanded":o,"aria-controls":`${t.id}-options`,onClick:s,onKeyDown:l=>d(l,r),"data-kind":"group",tabIndex:f?0:-1,ref:l=>m(r,l),onFocus:h,children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[t.isFavorites?e.jsx(Ne,{favorite:!0}):null,e.jsx("span",{children:t.label})]}),e.jsx("span",{className:o?"text-sm font-bold text-[#9aa5c0]":"-rotate-90 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),xt=({market:t,isActive:o,optionId:r,onSelect:s,onDelete:d,onKeyDown:m,setItemRef:f,isFocused:h,onFocus:l})=>e.jsxs("div",{className:"group/item flex items-center gap-1",children:[e.jsx("button",{type:"button",className:o?"flex flex-1 items-center justify-between gap-3 rounded-lg border border-[rgba(230,57,70,0.35)] bg-[rgba(230,57,70,0.14)] px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-[rgba(230,57,70,0.18)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]":"flex flex-1 items-center justify-between gap-3 rounded-lg border border-transparent bg-white/20 px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]",role:"option","aria-selected":o,onClick:()=>s(t.id),onKeyDown:p=>m(p,r),"data-kind":"option",tabIndex:h?0:-1,ref:p=>f(r,p),onFocus:l,children:e.jsx(Re,{label:t.label,favorite:t.favorite,expiryDate:t.expiry_date})}),d&&e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),d(t.id)},className:"p-2 text-[#9aa5c0] opacity-0 transition-opacity group-hover/item:opacity-100 hover:text-[#e63946]",title:"Delete market",children:e.jsx(de,{size:16})})]}),bt=({group:t,selectedMarketId:o,onSelect:r,onDelete:s,onKeyDown:d,setItemRef:m,focusedItemId:f,onFocusItem:h})=>e.jsx("ul",{className:"mt-1 flex list-none flex-col gap-1 pr-1 pb-2 pl-4",id:`${t.id}-options`,role:"group",children:t.markets.map(l=>{const p=`option-${l.id}`,g=l.id===o;return e.jsx("li",{children:e.jsx(xt,{market:l,isActive:g,optionId:p,onSelect:x=>r(x),onDelete:s,onKeyDown:d,setItemRef:m,isFocused:f===p,onFocus:()=>h(p)})},p)})}),gt=({normalizedGroups:t,expandedGroupIds:o,focusedItemId:r,onToggleGroup:s,onKeyDown:d,setItemRef:m,onFocusItem:f,selectedMarketId:h,onSelect:l,onDelete:p,requestState:g,dropdownStyle:x})=>e.jsx("ul",{className:"fixed z-10 mt-1 list-none space-y-1 overflow-y-auto rounded-xl border border-white/10 bg-[#0b111d] p-1 shadow-[0_16px_40px_rgba(0,0,0,0.35)]",role:"listbox","aria-label":"Choose market",style:x,children:t.length===0?e.jsx(pt,{requestState:g}):t.map(v=>{const y=o.has(v.id),S=`group-${v.id}`;return e.jsxs("li",{className:"py-1",children:[e.jsx(ft,{group:v,isExpanded:y,headerId:S,onToggle:()=>s(v.id),onKeyDown:d,setItemRef:m,isFocused:r===S,onFocus:()=>f(S)}),y?e.jsx(bt,{group:v,selectedMarketId:h,onSelect:D=>{l(D)},onDelete:p,onKeyDown:d,setItemRef:m,focusedItemId:r,onFocusItem:f}):null]},v.id)})}),be=({groups:t,selectedMarketId:o,onSelect:r,onDelete:s,requestState:d})=>{const m=React.useMemo(()=>t.map((a,i)=>({...a,id:`group-${i}-${a.label||"group"}`,markets:fe(a.markets)})),[t]),f=React.useMemo(()=>{const a=xe(m).filter(i=>!!i.favorite);return a.length===0?null:{id:0,label:"Favorites",markets:fe(a),isFavorites:!0}},[m]),h=React.useMemo(()=>f?[f,...m]:m,[m,f]),[l,p]=React.useState(!1),[g,x]=React.useState(new Set),[v,y]=React.useState(null),[S,D]=React.useState({}),A=React.useRef(null),z=React.useRef(null),k=React.useRef(new Map),I=React.useMemo(()=>xe(h),[h]),T=React.useMemo(()=>I.length===0?{id:o,label:d==="loading"?"Loading markets...":"No markets available"}:I.find(a=>a.id===o)??I[0],[I,o,d]),M=React.useMemo(()=>ct(h,g),[h,g]);React.useEffect(()=>{if(!l)return;const a=ut(h,o)??h[0];x(P=>{const O=a?new Set([a.id]):new Set;return P.size===O.size&&[...O].every(H=>P.has(H))?P:O});const i=a?.markets[0],w=a?.markets.find(P=>P.id===o)?.id??i?.id;y(w?`option-${w}`:null)},[h,l,o]),React.useEffect(()=>{const a=i=>{A.current&&!A.current.contains(i.target)&&p(!1)};return l&&document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[l]),React.useEffect(()=>{if(!l||!v)return;k.current.get(v)?.focus()},[v,l]),React.useEffect(()=>{if(!l)return;const a=()=>{if(!z.current)return;const i=z.current.getBoundingClientRect(),w=window.innerHeight,P=window.innerWidth,O=12,Y=Math.min(720,P-O*2),se=i.left+i.width/2-Y/2,Q=Math.min(Math.max(se,O),Math.max(O,P-Y-O)),K=w-i.bottom-O,W=i.top-O,V=K<240&&W>K,ie=Math.max(140,Math.min(720,V?W:K));D({position:"fixed",width:`${Y}px`,maxHeight:`${ie}px`,left:`${Q}px`,transform:"none",top:V?void 0:`${i.bottom+8}px`,bottom:V?`${w-i.top+8}px`:void 0})};return a(),window.addEventListener("resize",a),window.addEventListener("scroll",a,{passive:!0}),()=>{window.removeEventListener("resize",a),window.removeEventListener("scroll",a)}},[l,h,o]);const E=a=>{x(i=>i.has(a)?new Set:new Set([a]))},L=a=>{if(M.length===0)return;const i=M.findIndex(Y=>Y.id===v),w=i===-1?0:i,P=Math.min(M.length-1,Math.max(0,w+a)),O=M[P];y(O?.id??null)},U=(a,i)=>{if(a.key==="ArrowDown"&&(a.preventDefault(),L(1)),a.key==="ArrowUp"&&(a.preventDefault(),L(-1)),a.key==="Escape"){a.preventDefault(),p(!1);return}const w=M.find(P=>P.id===i);w&&(w.kind==="group"&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),E(w.groupId)),w.kind==="option"&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),r(w.marketId),p(!1)))},N=(a,i)=>{k.current.set(a,i)},b=()=>p(!1),j=()=>p(a=>!a),n=a=>{r(a),b()};return e.jsxs("div",{className:"relative flex min-w-[220px] flex-col gap-1 text-[#e8ecf5]",ref:A,children:[e.jsx(ht,{selectedMarket:T??null,isOpen:l,onToggle:j,onClose:b,toggleRef:z}),l?e.jsx(gt,{normalizedGroups:h,expandedGroupIds:g,focusedItemId:v,onToggleGroup:E,onKeyDown:U,setItemRef:N,onFocusItem:y,selectedMarketId:o,onSelect:n,onDelete:s,requestState:d,dropdownStyle:S}):null]})},wt=({title:t,isAdmin:o,userEmail:r,userFirstName:s,onLoginClick:d,onLogoutClick:m,onLogoClick:f,showLoginButton:h,marketGroups:l,selectedMarketId:p,onSelectMarket:g,marketListState:x})=>e.jsxs("nav",{className:"sticky top-0 z-50 w-full border-b border-white/10 bg-[#0e1422]/90 shadow-sm backdrop-blur-md","data-testid":"navbar",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-1 items-center gap-4",children:e.jsx("button",{onClick:f,className:"flex items-center gap-3 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/favicon_odds.png",alt:"",className:"h-8 w-8 object-contain","aria-hidden":"true"}),e.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-white",children:[t," ",o&&"Admin"]})]})})}),e.jsx("div",{className:"mx-4 hidden max-w-md flex-1 md:block","data-testid":"navbar-market-dropdown",children:e.jsx(be,{groups:l,selectedMarketId:p,onSelect:g,requestState:x})}),e.jsxs("div",{className:"flex flex-1 items-center justify-end gap-4",children:[h&&e.jsxs(J,{variant:"ghost",className:"gap-2 text-[#e8ecf5] hover:bg-white/5",onClick:d,"data-testid":"login-button",children:[e.jsx(Ve,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Login"})]}),r&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"hidden text-sm font-medium text-[#9aa5c0] md:inline","data-testid":"user-display-name",children:s||r}),e.jsx(J,{variant:"ghost",size:"icon",onClick:m,className:"text-[#9aa5c0] hover:bg-white/5 hover:text-[#e63946]",title:"Logout","data-testid":"logout-button",children:e.jsx(Ye,{size:20})})]})]})]}),e.jsx("div",{className:"px-6 pb-4 md:hidden","data-testid":"mobile-navbar-market-dropdown",children:e.jsx(be,{groups:l,selectedMarketId:p,onSelect:g,requestState:x})})]}),yt=()=>{const{onAuthSuccess:t}=je();return e.jsx("div",{"data-testid":"login-view",children:e.jsx(qe,{appName:"Odds",loginEndpoint:"/odds/login",onSuccess:(o,r)=>t(o.access_token,o.user,r)})})},vt=({marketGroups:t,onAddMarket:o,onDeleteMarket:r,onToggleFavorite:s,onGetMarketName:d,onAddGroup:m,onDeleteGroup:f,onReorderGroups:h,onReorderMarkets:l,onImportYaml:p,onExportYaml:g,requestState:x})=>{const{errorToast:v}=we(),[y,S]=React.useState(t),[D,A]=React.useState(""),[z,k]=React.useState(""),[I,T]=React.useState(""),[M,E]=React.useState(""),[L,U]=React.useState(""),[N,b]=React.useState(""),[j,n]=React.useState(!1),[a,i]=React.useState(!1),[w,P]=React.useState(null),[O,Y]=React.useState(null),[H,se]=React.useState(!1),Q=React.useRef(null),K=React.useRef(y),W=React.useRef(null);React.useEffect(()=>{K.current=y},[y]),React.useEffect(()=>{S(t)},[t]),React.useEffect(()=>{!L&&t.length>0&&U(t[0].label)},[t,L]);const[V,oe]=React.useState(null),[ie,Z]=React.useState(null),[ee,ce]=React.useState(null),[Me,te]=React.useState(null),Le=async c=>{const u=c.trim();if(/^1\.\d{4,}$/.test(u)){se(!0);try{const R=await d(u);T(R),k(R)}catch(R){console.error("Failed to fetch market name",R)}finally{se(!1)}}},Ie=async c=>{c.preventDefault(),P(null),n(!0);try{const u=D.trim();await o({id:u,label:z,api_label:I,group_label:L,expiry_date:M||null}),A(""),k(""),T(""),E(""),U("")}catch{P("Failed to add market. Ensure the ID is unique.")}finally{n(!1)}},Ee=async c=>{c.preventDefault(),Y(null),i(!0);try{await m(N),b("")}catch{Y("Failed to add group. Ensure the label is unique.")}finally{i(!1)}},Ce=async c=>{const u=c.target.files?.[0];if(!u)return;const R=new FileReader;R.onload=async _=>{try{const B=(await Promise.resolve(jsyaml)).load(_.target?.result);await p(B),Q.current&&(Q.current.value="")}catch(C){console.error("Failed to import YAML",C);const B=C instanceof Error?C.message:String(C);v(`Failed to import YAML: ${B}`)}},R.readAsText(u)},$e=c=>{oe(c)},De=(c,u,R)=>{c.preventDefault(),!(V===null||V===u)&&S(_=>{const C=[..._],B=C.findIndex($=>$.markets.some(q=>q.id===V)),X=C.findIndex($=>$.id===R);if(B===-1||X===-1)return _;const F={...C[B]},Oe=F.markets.findIndex($=>$.id===V),[ue]=F.markets.splice(Oe,1);if(B===X){const $=F.markets.findIndex(q=>q.id===u);F.markets.splice($,0,ue),C[B]=F}else{const $={...C[X]},q=$.markets.findIndex(Ue=>Ue.id===u);$.markets.splice(q,0,ue),C[B]=F,C[X]=$}const Ge=_.flatMap($=>$.markets.map(q=>q.id)).join(","),Fe=C.flatMap($=>$.markets.map(q=>q.id)).join(","),ze=_.map($=>$.id).join(","),Be=C.map($=>$.id).join(",");return Ge!==Fe||ze!==Be?C:_})},Ae=async()=>{if(V===null)return;const c=V;oe(null),Z(null),W.current&&clearTimeout(W.current),W.current=setTimeout(async()=>{const u=K.current.find(R=>R.markets.some(_=>_.id===c));u&&await l(u.id,u.markets.map(R=>R.id)),W.current=null},100)},Te=c=>{ce(c)},Pe=(c,u)=>{c.preventDefault(),!(ee===null||ee===u)&&S(R=>{const _=[...R],C=_.findIndex(F=>F.id===ee),B=_.findIndex(F=>F.id===u);if(C===-1||B===-1)return R;const[X]=_.splice(C,1);return _.splice(B,0,X),_.map(F=>F.id).join(",")!==R.map(F=>F.id).join(",")?_:R})},_e=async()=>{ee!==null&&(ce(null),te(null),W.current&&clearTimeout(W.current),W.current=setTimeout(async()=>{await h(K.current.map(c=>c.id)),W.current=null},100))};return e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-8 px-6 pt-8 pb-12","data-testid":"management-view",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 px-2 sm:flex-row sm:items-center sm:gap-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Market Management"}),e.jsxs("div",{className:"flex w-full flex-col gap-3 sm:w-auto sm:flex-row",children:[e.jsx("input",{type:"file",ref:Q,onChange:Ce,accept:".yml,.yaml",className:"hidden"}),e.jsxs(J,{variant:"outline",onClick:()=>Q.current?.click(),className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"import-yaml-button",children:[e.jsx(Ke,{size:18}),"Import YAML"]}),e.jsxs(J,{variant:"outline",onClick:g,className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"export-yaml-button",children:[e.jsx(Je,{size:18}),"Export YAML"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-market-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(He,{className:"text-emerald-400",size:24}),"Add New Market"]}),e.jsxs("form",{onSubmit:Ie,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"marketId",children:["Betfair Market ID (or paste URL)",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(re,{id:"marketId",value:D,onChange:c=>{const u=c.target.value,R=u.match(/1\.\d{4,}/);R&&R[0]!==u?A(R[0]):A(u)},required:!0,placeholder:"e.g. 1.230433061 or https://...",className:"border-white/10 bg-white/5 text-white","data-testid":"market-id-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"label",children:["Market Label"," ",H&&e.jsx("span",{className:"ml-2 animate-pulse text-xs text-indigo-400",children:"(Fetching...)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{id:"label",value:z,onChange:c=>k(c.target.value),placeholder:H?"Fetching name...":"e.g. Premier League",className:"border-white/10 bg-white/5 text-white","data-testid":"market-label-input"}),e.jsxs(J,{type:"button",variant:"outline",onClick:()=>Le(D),disabled:H||!/^1\.\d{4,}$/.test(D.trim()),className:"gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white",title:"Fetch name from Betfair","data-testid":"fetch-market-name-button",children:[e.jsx(ye,{size:16,className:H?"animate-spin":""}),"Fetch"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"expiryDate",children:"Expiry Date (Optional)"}),e.jsx(re,{id:"expiryDate",type:"date",value:M,onChange:c=>E(c.target.value),className:"border-white/10 bg-white/5 text-white","data-testid":"market-expiry-date-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"group",children:["Group ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"group",value:L,onChange:c=>U(c.target.value),required:!0,className:"focus-visible:ring-ring flex h-11 w-full rounded-md border border-white/10 bg-white/5 px-3 py-1 text-sm text-white shadow-sm transition-colors focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50","data-testid":"group-select",children:[e.jsx("option",{value:"",disabled:!0,className:"bg-[#0e1422]",children:"Select a group"}),t.map(c=>e.jsx("option",{value:c.label,className:"bg-[#0e1422]",children:c.label},c.id))]})]}),e.jsxs("div",{className:"pt-2",children:[w&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"market-error-message",children:w}),e.jsx(J,{type:"submit",className:"h-11 w-full bg-emerald-600 text-white hover:bg-emerald-700",disabled:j,"data-testid":"add-market-button",children:j?"Adding...":"Add Market"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-group-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(Qe,{className:"text-indigo-400",size:24}),"Add New Group"]}),e.jsxs("form",{onSubmit:Ee,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"groupLabel",children:["Group Label ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(re,{id:"groupLabel",value:N,onChange:c=>b(c.target.value),required:!0,placeholder:"e.g. Misc",className:"border-white/10 bg-white/5 text-white","data-testid":"new-group-label"})]}),e.jsxs("div",{className:"pt-2",children:[O&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"group-error-message",children:O}),e.jsx(J,{type:"submit",className:"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700",disabled:a,"data-testid":"add-group-button",children:a?"Adding...":"Add Group"})]})]})]})]}),e.jsxs("section",{className:"flex flex-col gap-6","data-testid":"tracked-markets-section",children:[e.jsx("h3",{className:"px-2 text-xl font-bold text-white",children:"Tracked Markets"}),x==="loading"&&y.length===0?e.jsx("div",{className:"animate-pulse space-y-4","data-testid":"markets-loading-skeleton",children:[1,2,3].map(c=>e.jsx("div",{className:"h-20 rounded-xl bg-white/5"},c))}):e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[y.map(c=>e.jsxs("div",{className:`group-container overflow-hidden rounded-2xl border border-white/10 bg-[#0e1422] shadow-lg transition-all ${ee===c.id?"opacity-20":""}`,"data-testid":`group-container-${c.label}`,draggable:Me===c.id,onDragStart:()=>Te(c.id),onDragOver:u=>Pe(u,c.id),onDragEnd:_e,children:[e.jsxs("div",{className:"flex items-center justify-between bg-[#26356d] px-6 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"cursor-grab text-white/40 transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>te(c.id),onMouseUp:()=>te(null),onTouchStart:()=>te(c.id),onTouchEnd:()=>te(null),children:e.jsx(me,{size:20})}),e.jsx("h4",{className:"font-bold text-white",children:c.label})]}),e.jsx("button",{onClick:()=>f(c.id),className:"rounded-lg p-1.5 text-white/40 transition-all hover:bg-white/5 hover:text-red-400",title:"Delete group and all markets","data-testid":`delete-group-button-${c.label}`,children:e.jsx(de,{size:16})})]}),e.jsxs("div",{className:"divide-y divide-white/5",children:[c.markets.map(u=>e.jsxs("div",{className:`group flex items-center justify-between px-6 py-4 transition-colors hover:bg-white/5 ${V===u.id?"opacity-20":""}`,draggable:ie===u.id,onDragStart:()=>$e(u.id),onDragOver:R=>De(R,u.id,c.id),onDragEnd:Ae,"data-testid":`market-item-${u.id}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"cursor-grab text-[#9aa5c0] transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>Z(u.id),onMouseUp:()=>Z(null),onTouchStart:()=>Z(u.id),onTouchEnd:()=>Z(null),children:e.jsx(me,{size:18})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-[#e8ecf5]",children:u.label||u.api_label}),u.api_label&&u.api_label!==u.label&&e.jsx("span",{className:"text-xs text-[#9aa5c0] italic",children:u.api_label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>s(u.id,!u.favorite),className:`rounded-lg p-2 transition-all hover:bg-white/10 ${u.favorite?"text-yellow-400":"text-[#9aa5c0]"}`,title:u.favorite?"Remove from favorites":"Add to favorites","data-testid":`favorite-button-${u.id}`,children:e.jsx(at,{size:18,fill:u.favorite?"currentColor":"none"})}),e.jsx("button",{onClick:()=>r(u.id),className:"rounded-lg p-2 text-[#9aa5c0] transition-all hover:bg-white/10 hover:text-[#e63946]",title:"Delete market","data-testid":`delete-market-button-${u.id}`,children:e.jsx(de,{size:18})})]})]},u.id)),c.markets.length===0&&e.jsx("div",{className:"px-6 py-4 text-sm text-[#9aa5c0] italic","data-testid":"empty-group-message",children:"No markets in this group."})]})]},c.id)),y.length===0&&e.jsx("div",{className:"rounded-2xl border-2 border-dashed border-white/10 py-12 text-center",children:e.jsx("p",{className:"text-[#9aa5c0]",children:"No markets tracked yet."})})]})]})]})},ge=({label:t,variant:o="danger",className:r="","aria-label":s})=>{const d={danger:"border-[rgba(230,57,70,0.45)] bg-[rgba(230,57,70,0.15)] text-[#e8ecf5]",warning:"border-[#ffd447] bg-[#ffd447] text-[#0e1422] animate-pulse shadow-[0_0_0_0_rgba(255,212,71,0.45)]"};return e.jsx("div",{className:`inline-flex items-center justify-center rounded-full border px-3 py-1 text-sm font-semibold ${d[o]} ${r}`,"aria-label":s,"data-testid":`status-badge-${t.toLowerCase()}`,children:t})},jt=({status:t,isLive:o,externalUrl:r,lastUpdated:s,stats:d})=>e.jsxs("div",{className:"flex flex-col gap-2","data-testid":"market-header",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t!=="OPEN"&&t&&e.jsx(ge,{label:t,"aria-label":"Market status"}),o&&e.jsx(ge,{label:"LIVE",variant:"warning","aria-label":"Market live"})]}),e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1",children:[e.jsx("a",{className:"text-xs font-semibold text-[#9aa5c0] underline decoration-slate-500 underline-offset-4 hover:text-[#e8ecf5]",href:r,target:"_blank",rel:"noreferrer noopener","data-testid":"external-market-link",children:"Original data"}),e.jsx("div",{className:"text-xs font-medium text-[#9aa5c0]","data-testid":"last-updated",children:s?`Updated ${s}`:"Fetching data..."})]}),d&&e.jsx("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-xs font-semibold text-[#e8ecf5]","aria-label":"Total runners","data-testid":"market-stats",children:d})]})]}),kt=({message:t="Loading..."})=>e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-4 fixed right-6 bottom-6 z-50 flex items-center gap-3 rounded-2xl border border-white/10 bg-[#0e1422]/80 px-6 py-4 shadow-[0_20px_60px_rgba(0,0,0,0.5)] backdrop-blur-md","data-testid":"loading-toast",children:[e.jsx(ye,{size:20,className:"animate-spin text-emerald-400"}),e.jsx("span",{className:"font-bold text-white",children:t})]}),Nt={id:"valueLabel",afterDatasetsDraw(t,o,r){const s=t.config.type;if(s&&s!=="bar")return;const{ctx:d,data:m}=t,f=r?.color??"#e8ecf5";d.save();const h=t.getSortedVisibleDatasetMetas(),l=h[h.length-1];l&&(l.data.forEach((p,g)=>{const x=r?.impliedProbabilities?.[g],v=typeof x=="number"?x:m.datasets?.reduce((S,D)=>{const A=D?.data?.[g];return typeof A=="number"?S+A:S},0);if(typeof v!="number"||v<=0)return;const y=p.tooltipPosition(!0);y.x===null||y.y===null||(d.fillStyle=f,d.font='600 12px "Inter", system-ui, -apple-system, sans-serif',d.textBaseline="middle",d.textAlign="left",d.fillText(`${v.toFixed(1)}%`,y.x+6,y.y))}),d.restore())}};Chart.Chart.register(Chart.ArcElement,Chart.BarElement,Chart.CategoryScale,Chart.LinearScale,Chart.Legend,Chart.Title,Chart.Tooltip,Nt);const ne=["#ba0034","#0293d9","#ff901a","#50469d","#eb9fa2","#87365c","#97d76f","#ed2fa4","#0b6109","#ffa1e4","#01dbc6"],le=t=>t===null||Number.isNaN(t)?"—":`${(t*100).toFixed(1)}%`,Rt=({marketGroups:t,marketListState:o,selectedMarketId:r})=>{const[s,d]=React.useState(null),[m,f]=React.useState("idle"),[h,l]=React.useState(null),[p,g]=React.useState(!1),x=React.useRef(!0),v=React.useCallback(async(N,b=!1)=>{f("loading"),l(null),b&&g(!0);try{const j=await fetch(`${G}/odds/market-data/${N}`);if(!j.ok)throw new Error(`Request failed with status ${j.status}`);const n=await j.json(),a=lt(n,new Date);d(a),f("success")}catch(j){console.error("Failed to fetch market",j),f("error"),l("We could not load market prices. Please retry.")}finally{b&&setTimeout(()=>g(!1),1e3)}},[]);React.useEffect(()=>{if(r){const N=!x.current;v(r,N),x.current=!1}},[v,r]);const y=React.useMemo(()=>s?new Date(s.fetchedAt).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",weekday:"short",month:"short",day:"numeric",hour12:!1}):null,[s]),S=React.useMemo(()=>{if(!s)return null;const N=s.runners.map(a=>a.name),b=s.runners.map((a,i)=>a.name.startsWith("Others")?"#9aa0ae":ne[i%ne.length]),j=s.runners.map(a=>Math.max(0,a.probabilityMin??0)*100),n=s.runners.map(a=>{const i=Math.max(0,a.probabilityMin??0),w=Math.max(i,a.probabilityMax??i);return Math.max(0,w-i)*100});return{labels:N,datasets:[{label:"Minimum probability (%)",data:j,backgroundColor:b,borderColor:b,borderWidth:1,borderSkipped:!1,stack:"probability"},{label:"Spread from min to max (%)",data:n,backgroundColor:"#ffffff",borderColor:"#ffffff",borderWidth:1,borderRadius:{topRight:3,bottomRight:3,topLeft:0,bottomLeft:0},borderSkipped:!1,stack:"probability"}]}},[s]),D=React.useMemo(()=>{if(!s)return null;const N=s.runners.map(n=>(n.impliedProbability??0)*100),b=s.runners.reduce((n,a)=>{const i=(a.probabilityMax??0)*100;return i>n?i:n},0),j=Math.max(5,b);return{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(n){const a=s.runners[n.dataIndex],i=le(a.probabilityMin),w=le(a.probabilityMax);return`${a.name} — ${i} to ${w}`}}},valueLabel:{color:"#e8ecf5",impliedProbabilities:N}},scales:{x:{stacked:!0,grid:{color:"rgba(232, 236, 245, 0.50)"},ticks:{color:"#e8ecf5",callback:n=>`${n}%`},suggestedMax:j},y:{stacked:!0,grid:{display:!1},ticks:{color:n=>{const a=n.tick?.label;if(typeof a=="string"){if(a.startsWith(ke))return"#ff3b30";if(a.startsWith("Others"))return"#9aa0ae"}return"#e8ecf5"},autoSkip:!1}}}}},[s]),A=React.useMemo(()=>{if(!s)return null;const N=s.runners.map(j=>j.name),b=s.runners.map((j,n)=>j.name.startsWith("Others")?"#9aa0ae":ne[n%ne.length]);return{labels:N,datasets:[{label:"Implied probability",data:s.runners.map(j=>(j.impliedProbability??0)*100),backgroundColor:b,borderWidth:0}]}},[s]),z=React.useMemo(()=>s?{animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(N){const b=s.runners[N.dataIndex];return`${b.name}: ${le(b.impliedProbability)}`}}}}}:null,[s]),k=React.useMemo(()=>s?Math.max(320,s.runners.length*34):320,[s]),I=React.useMemo(()=>{if(!s)return"bar-empty";const N=s.runners.map(b=>b.id).join("-");return`${s.marketId}-${N}-${s.fetchedAt}`},[s]),T=React.useMemo(()=>{if(!s)return"";const N=s.runners.filter(n=>n.status==="ACTIVE"&&!n.name.startsWith("Others")).length,b=Math.max(0,s.activeRunnerCount-N),j=s.numberOfWinners-s.winnerRunnerCount;return[`${s.activeRunnerCount} still active`,b>0?` (${N} displayed + ${b} others below 1%)`:"",s.winnerRunnerCount>0?` + ${s.winnerRunnerCount} already won`:"",s.loserRunnerCount>0?` + ${s.loserRunnerCount} already lost`:"",s.winnerRunnerCount+s.loserRunnerCount>0?` = ${s.totalRunners} starters`:"",j>1?` ; ${j} winning spots left`:""].join("")},[s]),M=React.useMemo(()=>`https://www.betfair.com/exchange/plus/politics/market/${r}`,[r]),E=m==="loading"&&!s,L=s?.runners.length===0,U=s?.inplay??!1;return e.jsxs("div",{className:"mx-auto flex max-w-[1200px] flex-col gap-6 pt-2 pb-[clamp(1.25rem,4vw,2.5rem)] md:px-8 md:pt-8","data-testid":"public-view",children:[h&&e.jsxs("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[rgba(230,57,70,0.5)] bg-[rgba(230,57,70,0.1)] px-4 py-3 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:flex-row md:items-center md:justify-between",role:"alert","aria-live":"assertive","data-testid":"error-message",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-lg font-bold text-[#e8ecf5]",children:"Price fetch failed"}),e.jsx("p",{className:"m-0 mt-1 text-sm text-[#9aa5c0]",children:h})]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-lg border border-white/15 bg-white/5 px-3 py-2 font-semibold text-[#e8ecf5] hover:border-white/30",onClick:()=>{v(r)},"data-testid":"retry-button",children:"Retry"})]}),e.jsx("section",{className:"grid grid-cols-1 gap-4","data-testid":"charts-section",children:e.jsxs("div",{className:"w-full rounded-2xl border border-white/10 bg-[#0e1422] py-4 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-4 px-2 md:flex-row md:items-center md:justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Probability"}),e.jsx(jt,{status:s?.status,isLive:U,externalUrl:M,lastUpdated:y,stats:T})]}),E&&e.jsx("div",{className:"mt-3 flex flex-col gap-2","aria-hidden":"true","data-testid":"loading-skeleton",children:Array.from({length:5}).map((N,b)=>e.jsx("div",{className:"h-4 animate-pulse rounded-md bg-white/10"},b))}),!E&&s&&!L&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"bar-chart-container",children:S&&e.jsx("div",{className:"w-full",style:{height:`${k}px`},children:e.jsx(Ze,{data:S,options:D},I)})}),e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"pie-chart-container",children:A&&e.jsx("div",{className:"min-h-[260px] w-full",children:e.jsx(et,{data:A,options:z})})})]}),!E&&L&&e.jsx("p",{className:"mt-3 text-[#9aa5c0]",role:"status","data-testid":"no-runners-message",children:"No runners available right now."})]})}),p&&e.jsx(kt,{})]})},St=()=>{const t=dt(),o=()=>t.user&&t.showEdit?e.jsx(vt,{marketGroups:t.marketGroups,onAddMarket:t.handleAddMarket,onDeleteMarket:t.handleDeleteMarket,onToggleFavorite:t.handleToggleFavorite,onGetMarketName:t.handleGetMarketName,onAddGroup:t.handleAddGroup,onDeleteGroup:t.handleDeleteGroup,onReorderGroups:t.handleReorderGroups,onReorderMarkets:t.handleReorderMarkets,onImportYaml:t.handleImportYaml,onExportYaml:t.handleExportYaml,requestState:t.marketListState}):t.showLogin?e.jsx(yt,{}):e.jsx(Rt,{marketGroups:t.marketGroups,marketListState:t.marketListState,selectedMarketId:t.selectedMarketId});return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_-10%,rgba(230,57,70,0.18),transparent_35%),radial-gradient(circle_at_80%_20%,rgba(118,174,255,0.12),transparent_40%),#060910] font-sans text-[#e8ecf5]",style:{colorScheme:"dark"},children:[e.jsx(wt,{title:"Odds",isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,onLoginClick:t.navigateToLogin,onLogoutClick:t.logout,onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,showLoginButton:!t.user&&!t.showLogin,marketGroups:t.marketGroups,selectedMarketId:t.selectedMarketId,onSelectMarket:t.setSelectedMarketId,marketListState:t.marketListState}),o()]})},Se=document.getElementById("root");if(!Se)throw new Error("Root element #root not found");document.body.classList.add("odds-page");ReactDOM.createRoot(Se).render(e.jsx(React.StrictMode,{children:e.jsx(We,{children:e.jsx(st,{children:e.jsx(St,{})})})}));
