import"./index-q6kasbBJ.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{u as de,T as Ue}from"./Toast-COaeoAQl.js";import{A as O}from"./api-CH_Pe6Vg.js";import{B as J}from"./button-D6DGr86I.js";import{T as ce}from"./trash-2-DQbJ9aIh.js";import{L as We,a as ae,I as re}from"./label-j-A5YPyd.js";import{L as Ve}from"./log-out-B0TqtotO.js";import{A as Ye,P as qe}from"./Auth-uEj7rJlD.js";import{U as He,D as Ke}from"./upload--Rbr-3Yq.js";import{R as Je}from"./refresh-cw-pTx9cW3g.js";import{F as Qe}from"./folder-plus-BkAA-aX2.js";import{G as he}from"./grip-vertical-BjGCJcsX.js";import{c as Xe}from"./createLucideIcon-DtX1aPOG.js";import{B as Ze,P as et}from"./index-BehiXGmn.js";import"./circle-check-F4iM422t.js";import"./x-BS-d4QNZ.js";import"./clsx-B-dksMZM.js";import"./eye-Jn_UhOO1.js";const tt=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],at=Xe("star",tt),ye=React.createContext(void 0),st=({children:t})=>{const[i,r]=React.useState(()=>({user:null,token:typeof window<"u"?localStorage.getItem("odds_token")||sessionStorage.getItem("odds_token"):null,status:"idle"})),c=React.useCallback((h,l,p)=>{p?localStorage.setItem("odds_token",h):sessionStorage.setItem("odds_token",h),r({user:l,token:h,status:"success"})},[]),d=React.useCallback(async()=>{try{await fetch(`${O}/bookmarks/logout`,{method:"POST",credentials:"include"})}catch(h){console.error("Logout API call failed",h)}localStorage.removeItem("odds_token"),sessionStorage.removeItem("odds_token"),r({user:null,token:null,status:"idle"})},[]),s=async(h,l,p=!0)=>{r(v=>({...v,status:"loading"}));try{const v=await fetch(`${O}/odds/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:h,password:l,remember:p})});if(!v.ok)throw new Error("Invalid credentials");const x=await v.json();p?localStorage.setItem("odds_token",x.access_token):sessionStorage.setItem("odds_token",x.access_token),r({user:x.user,token:x.access_token,status:"success"})}catch(v){throw r(x=>({...x,status:"error"})),v}},b=React.useCallback(async h=>{try{const l=await fetch(`${O}/odds/me`,{headers:h?{Authorization:`Bearer ${h}`}:{},credentials:"include"});if(l.ok){const p=await l.json();r(v=>({...v,user:p,status:"success"}))}else d()}catch(l){console.error("Failed to fetch user",l),d()}},[d]);return React.useEffect(()=>{i.token&&!i.user&&b(i.token)},[i.token,i.user,b]),e.jsx(ye.Provider,{value:{...i,login:s,logout:d,onAuthSuccess:c},children:t})},ve=()=>{const t=React.useContext(ye);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},rt=t=>t.state?.status==="ACTIVE",nt=t=>t.state?.status==="LOSER",ot=t=>t.state?.status==="WINNER",pe=t=>{if(!t||t.length===0)return null;const[i]=t;return typeof i.price!="number"||typeof i.size!="number"?null:{price:i.price,size:i.size}},it=(t,i,r,c)=>{const d=[],s=l=>typeof l!="number"?1:l<=0?0:1/l;if(typeof t=="number"&&t>0&&d.push({price:t,weight:s(r)}),typeof i=="number"&&i>0&&d.push({price:i,weight:s(c)}),d.length===0)return null;const b=d.reduce((l,p)=>l+p.weight,0);return b===0?null:1/(d.reduce((l,p)=>l+p.price*p.weight,0)/b)},ke="* ",fe="1.244214540",lt=(t,i)=>{const r=t.eventTypes?.[0]?.eventNodes?.[0]?.marketNodes?.[0],c=r?{marketId:r.marketId,status:r.state.status,inplay:r.state.inplay,numberOfWinners:r.state.numberOfWinners,description:r.description,runners:r.runners}:void 0,d=c?.description?.marketName??"—",s=c?.runners??[],b=s.filter(rt),h=s.filter(nt),l=s.filter(ot),p=j=>{const I=j.description?.runnerName??"Unknown runner",A=pe(j.exchange?.availableToBack),S=pe(j.exchange?.availableToLay),D=A?.price??(typeof j.state?.lastPriceTraded=="number"?j.state?.lastPriceTraded:null),R=S?.price??null,z=A?.size??null,V=S?.size??null,y=j.state?.status,k=y==="ACTIVE"||y==="LOSER"||y==="WINNER"?y:"UNKNOWN",n=k==="WINNER",a=n?ke+I:I,o=n?1:it(D,R,z,V),f=n?1:typeof R=="number"&&R>0?1/R:null,M=n?1:typeof D=="number"&&D>0?1/D:null;return{id:j.selectionId,name:a,status:k,bestBack:D,bestLay:R,impliedProbability:o,probabilityMin:f,probabilityMax:M}},x=[...[...b,...l].map(p)].sort((j,I)=>{const A=j.impliedProbability??0,S=I.impliedProbability??0;if(A!==S)return S-A;const D=j.bestBack??Number.POSITIVE_INFINITY,R=I.bestBack??Number.POSITIVE_INFINITY;return D!==R?D-R:0}),g=x.filter(j=>(j.impliedProbability??0)>=.01),w=g.reduce((j,I)=>j+(I.impliedProbability??0),0),L=Math.max(0,1-w),E=x.length-g.length,T={id:-1,name:E>0?`Others ${E}`:"Others",bestBack:null,bestLay:null,status:"AGGREGATE",impliedProbability:L,probabilityMin:L,probabilityMax:L},G=[...g,T].sort((j,I)=>{const A=j.impliedProbability??0,S=I.impliedProbability??0;return A!==S?S-A:0});return{marketId:c?.marketId??"unknown",marketName:d,runners:G,fetchedAt:i.toISOString(),status:c?.status??"UNKNOWN",inplay:!!c?.inplay,numberOfWinners:c?.numberOfWinners??1,activeRunnerCount:b.length,loserRunnerCount:h.length,winnerRunnerCount:l.length,totalRunners:b.length+h.length+l.length}},ct=()=>{const{errorToast:t}=de(),{user:i,token:r,logout:c}=ve(),[d,s]=React.useState([]),[b,h]=React.useState("idle"),[l,p]=React.useState(()=>typeof window>"u"?fe:new URLSearchParams(window.location.search).get("marketId")??fe),[v,x]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="login"),[g,w]=React.useState(()=>typeof window>"u"?!1:new URLSearchParams(window.location.search).get("view")==="edit");React.useEffect(()=>{if(typeof window>"u")return;const n=new URLSearchParams(window.location.search),a=n.get("marketId");if(l&&a!==l){n.set("marketId",l);const o=`${window.location.pathname}?${n.toString()}${window.location.hash}`;window.history.replaceState({},"",o)}},[l]),React.useEffect(()=>{const n=()=>{const a=new URLSearchParams(window.location.search);x(a.get("view")==="login"),w(a.get("view")==="edit")};return window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]);const L=()=>{const n=new URLSearchParams(window.location.search);n.get("view")!=="login"&&(n.set("view","login"),window.history.pushState({},"",`?${n.toString()}`),x(!0),w(!1))},E=()=>{const n=new URLSearchParams(window.location.search);n.get("view")!=="edit"&&(n.set("view","edit"),window.history.pushState({},"",`?${n.toString()}`),w(!0),x(!1))},T=()=>{const n=new URLSearchParams(window.location.search);if(n.has("view")){n.delete("view");const a=n.toString();window.history.pushState({},"",a?`?${a}`:window.location.pathname),x(!1),w(!1)}else x(!1),w(!1)},G=React.useCallback(async()=>{h("loading");try{const n=await fetch(`${O}/odds/`);if(!n.ok)throw new Error("Fetch failed");const a=await n.json();s(Array.isArray(a)?a:a.markets??[]),h("success")}catch{h("error")}},[]),j=async(n,a)=>{if(r)try{const o=await fetch(`${O}/odds/markets/${n}/favorite`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({favorite:a})});if(!o.ok)throw new Error("Patch failed");const f=await o.json();s(f.markets)}catch{t("Failed to toggle favorite")}},I=async n=>{const a=await fetch(`${O}/odds/market-name/${n}`);if(!a.ok)throw new Error("Name fetch failed");return(await a.json()).name},A=async n=>{if(!r)return;const a=await fetch(`${O}/odds/markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)});if(!a.ok)throw new Error("Add failed");const o=await a.json();s(o.markets),p(n.id)},S=async n=>{if(!r||!window.confirm("Delete market?"))return;const a=await fetch(`${O}/odds/markets/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Delete failed");const o=await a.json();s(o.markets)},D=async n=>{if(!r)return;const a=await fetch(`${O}/odds/groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({label:n})});if(!a.ok)throw new Error("Add failed");const o=await a.json();s(o.markets)},R=async n=>{if(!r||!window.confirm("Delete group?"))return;const a=await fetch(`${O}/odds/groups/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}});if(!a.ok)throw new Error("Delete failed");const o=await a.json();s(o.markets)},z=async n=>{if(!r)return;const o=await(await fetch(`${O}/odds/reorder-groups`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({group_ids:n})})).json();s(o.markets)},V=async(n,a)=>{if(!r)return;const f=await(await fetch(`${O}/odds/reorder-markets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({group_id:n,market_ids:a})})).json();s(f.markets)},y=async n=>{if(!r)return;const o=await(await fetch(`${O}/odds/import`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(n)})).json();s(o.markets)},k=async()=>{if(!r)return;const a=await(await fetch(`${O}/odds/export`,{headers:{Authorization:`Bearer ${r}`}})).blob(),o=window.URL.createObjectURL(a),f=document.createElement("a");f.href=o,f.download="odds_backup.yml",f.click()};return React.useEffect(()=>{G()},[G]),React.useEffect(()=>{i&&new URLSearchParams(window.location.search).get("view")!=="edit"&&E()},[i]),{user:i,token:r,logout:c,marketGroups:d,marketListState:b,selectedMarketId:l,setSelectedMarketId:p,showLogin:v,showEdit:g,navigateToLogin:L,navigateToEdit:E,navigateToPublic:T,handleToggleFavorite:j,handleGetMarketName:I,handleAddMarket:A,handleDeleteMarket:S,handleAddGroup:D,handleDeleteGroup:R,handleReorderGroups:z,handleReorderMarkets:V,handleImportYaml:y,handleExportYaml:k}},xe=t=>{const i=t.filter(c=>!!c.favorite),r=t.filter(c=>!c.favorite);return[...i,...r]},dt=(t,i)=>{const r=[];return t.forEach(c=>{const d=`group-${c.id}`;r.push({kind:"group",id:d,groupId:c.id,label:c.label}),i.has(c.id)&&c.markets.forEach(s=>{r.push({kind:"option",id:`option-${s.id}`,groupId:c.id,marketId:s.id,label:s.label})})}),r},ut=(t,i)=>t.find(r=>r.markets.some(c=>c.id===i)),be=t=>t.flatMap(i=>i.markets),je=({favorite:t})=>t?e.jsx("span",{className:"text-base leading-none text-[#ffdc00]","aria-hidden":"true",children:"★"}):null,mt=t=>{if(!t)return"";try{const i=new Date(t);return Number.isNaN(i.getTime())?t:i.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}catch{return t}},Ne=({label:t,favorite:i,expiryDate:r})=>e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[e.jsx(je,{favorite:i}),e.jsx("span",{children:t}),r?e.jsxs(e.Fragment,{children:[" ",e.jsx("span",{className:"text-sm font-semibold text-[#9aa5c0]",children:mt(r)})]}):null]}),ht=({selectedMarket:t,isOpen:i,onToggle:r,onClose:c,toggleRef:d})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-xl border border-white/10 bg-white/20 px-3 py-2.5 text-left font-semibold text-[#e8ecf5] shadow-[0_16px_32px_rgba(0,0,0,0.35)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946] focus-visible:ring-offset-2 focus-visible:ring-offset-transparent","aria-haspopup":"listbox","aria-expanded":i,onClick:r,onKeyDown:s=>{s.key==="Escape"&&c()},ref:d,"data-testid":"market-dropdown-trigger",children:[e.jsx(Ne,{label:t?.label??"",favorite:t?.favorite,expiryDate:t?.expiry_date}),e.jsx("span",{className:"ml-1 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),pt=({requestState:t})=>e.jsx("li",{children:e.jsx("span",{className:"flex w-full items-center justify-between gap-2 rounded-lg border border-transparent bg-white/10 px-2.5 py-2 text-left font-semibold text-[#e8ecf5]",children:t==="loading"?"Loading markets...":"No markets available"})}),ft=({group:t,isExpanded:i,headerId:r,onToggle:c,onKeyDown:d,setItemRef:s,isFocused:b,onFocus:h})=>e.jsxs("button",{type:"button",className:"flex w-full items-center justify-between rounded-lg bg-[#26356d] px-2.5 py-2 text-left font-bold text-[#e8ecf5] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]","aria-expanded":i,"aria-controls":`${t.id}-options`,onClick:c,onKeyDown:l=>d(l,r),"data-kind":"group",tabIndex:b?0:-1,ref:l=>s(r,l),onFocus:h,children:[e.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[t.isFavorites?e.jsx(je,{favorite:!0}):null,e.jsx("span",{children:t.label})]}),e.jsx("span",{className:i?"text-sm font-bold text-[#9aa5c0]":"-rotate-90 text-sm font-bold text-[#9aa5c0]","aria-hidden":"true",children:"▾"})]}),xt=({market:t,isActive:i,optionId:r,onSelect:c,onDelete:d,onKeyDown:s,setItemRef:b,isFocused:h,onFocus:l})=>e.jsxs("div",{className:"group/item flex items-center gap-1",children:[e.jsx("button",{type:"button",className:i?"flex flex-1 items-center justify-between gap-3 rounded-lg border border-[rgba(230,57,70,0.35)] bg-[rgba(230,57,70,0.14)] px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-[rgba(230,57,70,0.18)] focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]":"flex flex-1 items-center justify-between gap-3 rounded-lg border border-transparent bg-white/20 px-2.5 py-2 text-left font-semibold text-[#e8ecf5] transition hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-[#e63946]",role:"option","aria-selected":i,onClick:()=>c(t.id),onKeyDown:p=>s(p,r),"data-kind":"option",tabIndex:h?0:-1,ref:p=>b(r,p),onFocus:l,children:e.jsx(Ne,{label:t.label,favorite:t.favorite,expiryDate:t.expiry_date})}),d&&e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),d(t.id)},className:"p-2 text-[#9aa5c0] opacity-0 transition-opacity group-hover/item:opacity-100 hover:text-[#e63946]",title:"Delete market",children:e.jsx(ce,{size:16})})]}),bt=({group:t,selectedMarketId:i,onSelect:r,onDelete:c,onKeyDown:d,setItemRef:s,focusedItemId:b,onFocusItem:h})=>e.jsx("ul",{className:"mt-1 flex list-none flex-col gap-1 pr-1 pb-2 pl-4",id:`${t.id}-options`,role:"group",children:t.markets.map(l=>{const p=`option-${l.id}`,v=l.id===i;return e.jsx("li",{children:e.jsx(xt,{market:l,isActive:v,optionId:p,onSelect:x=>r(x),onDelete:c,onKeyDown:d,setItemRef:s,isFocused:b===p,onFocus:()=>h(p)})},p)})}),gt=({normalizedGroups:t,expandedGroupIds:i,focusedItemId:r,onToggleGroup:c,onKeyDown:d,setItemRef:s,onFocusItem:b,selectedMarketId:h,onSelect:l,onDelete:p,requestState:v,dropdownStyle:x})=>e.jsx("ul",{className:"fixed z-10 mt-1 list-none space-y-1 overflow-y-auto rounded-xl border border-white/10 bg-[#0b111d] p-1 shadow-[0_16px_40px_rgba(0,0,0,0.35)]",role:"listbox","aria-label":"Choose market",style:x,children:t.length===0?e.jsx(pt,{requestState:v}):t.map(g=>{const w=i.has(g.id),L=`group-${g.id}`;return e.jsxs("li",{className:"py-1",children:[e.jsx(ft,{group:g,isExpanded:w,headerId:L,onToggle:()=>c(g.id),onKeyDown:d,setItemRef:s,isFocused:r===L,onFocus:()=>b(L)}),w?e.jsx(bt,{group:g,selectedMarketId:h,onSelect:E=>{l(E)},onDelete:p,onKeyDown:d,setItemRef:s,focusedItemId:r,onFocusItem:b}):null]},g.id)})}),ge=({groups:t,selectedMarketId:i,onSelect:r,onDelete:c,requestState:d})=>{const s=React.useMemo(()=>t.map((a,o)=>({...a,id:`group-${o}-${a.label||"group"}`,markets:xe(a.markets)})),[t]),b=React.useMemo(()=>{const a=be(s).filter(o=>!!o.favorite);return a.length===0?null:{id:0,label:"Favorites",markets:xe(a),isFavorites:!0}},[s]),h=React.useMemo(()=>b?[b,...s]:s,[s,b]),[l,p]=React.useState(!1),[v,x]=React.useState(new Set),[g,w]=React.useState(null),[L,E]=React.useState({}),T=React.useRef(null),G=React.useRef(null),j=React.useRef(new Map),I=React.useMemo(()=>be(h),[h]),A=React.useMemo(()=>I.length===0?{id:i,label:d==="loading"?"Loading markets...":"No markets available"}:I.find(a=>a.id===i)??I[0],[I,i,d]),S=React.useMemo(()=>dt(h,v),[h,v]);React.useEffect(()=>{if(!l)return;const a=ut(h,i)??h[0];x(M=>{const _=a?new Set([a.id]):new Set;return M.size===_.size&&[..._].every(H=>M.has(H))?M:_});const o=a?.markets[0],f=a?.markets.find(M=>M.id===i)?.id??o?.id;w(f?`option-${f}`:null)},[h,l,i]),React.useEffect(()=>{const a=o=>{T.current&&!T.current.contains(o.target)&&p(!1)};return l&&document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[l]),React.useEffect(()=>{if(!l||!g)return;j.current.get(g)?.focus()},[g,l]),React.useEffect(()=>{if(!l)return;const a=()=>{if(!G.current)return;const o=G.current.getBoundingClientRect(),f=window.innerHeight,M=window.innerWidth,_=12,Y=Math.min(720,M-_*2),se=o.left+o.width/2-Y/2,Q=Math.min(Math.max(se,_),Math.max(_,M-Y-_)),K=f-o.bottom-_,U=o.top-_,W=K<240&&U>K,ie=Math.max(140,Math.min(720,W?U:K));E({position:"fixed",width:`${Y}px`,maxHeight:`${ie}px`,left:`${Q}px`,transform:"none",top:W?void 0:`${o.bottom+8}px`,bottom:W?`${f-o.top+8}px`:void 0})};return a(),window.addEventListener("resize",a),window.addEventListener("scroll",a,{passive:!0}),()=>{window.removeEventListener("resize",a),window.removeEventListener("scroll",a)}},[l,h,i]);const D=a=>{x(o=>o.has(a)?new Set:new Set([a]))},R=a=>{if(S.length===0)return;const o=S.findIndex(Y=>Y.id===g),f=o===-1?0:o,M=Math.min(S.length-1,Math.max(0,f+a)),_=S[M];w(_?.id??null)},z=(a,o)=>{if(a.key==="ArrowDown"&&(a.preventDefault(),R(1)),a.key==="ArrowUp"&&(a.preventDefault(),R(-1)),a.key==="Escape"){a.preventDefault(),p(!1);return}const f=S.find(M=>M.id===o);f&&(f.kind==="group"&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),D(f.groupId)),f.kind==="option"&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),r(f.marketId),p(!1)))},V=(a,o)=>{j.current.set(a,o)},y=()=>p(!1),k=()=>p(a=>!a),n=a=>{r(a),y()};return e.jsxs("div",{className:"relative flex min-w-[220px] flex-col gap-1 text-[#e8ecf5]",ref:T,children:[e.jsx(ht,{selectedMarket:A??null,isOpen:l,onToggle:k,onClose:y,toggleRef:G}),l?e.jsx(gt,{normalizedGroups:h,expandedGroupIds:v,focusedItemId:g,onToggleGroup:D,onKeyDown:z,setItemRef:V,onFocusItem:w,selectedMarketId:i,onSelect:n,onDelete:c,requestState:d,dropdownStyle:L}):null]})},wt=({title:t,isAdmin:i,userEmail:r,userFirstName:c,onLoginClick:d,onLogoutClick:s,onLogoClick:b,showLoginButton:h,marketGroups:l,selectedMarketId:p,onSelectMarket:v,marketListState:x})=>e.jsxs("nav",{className:"sticky top-0 z-50 w-full border-b border-white/10 bg-[#0e1422]/90 shadow-sm backdrop-blur-md","data-testid":"navbar",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("div",{className:"flex flex-1 items-center gap-4",children:e.jsx("button",{onClick:b,className:"flex items-center gap-3 transition-opacity hover:opacity-80","data-testid":"navbar-logo",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/favicon_odds.png",alt:"",className:"h-8 w-8 object-contain","aria-hidden":"true"}),e.jsxs("h1",{className:"text-2xl font-bold tracking-tight text-white",children:[t," ",i&&"Admin"]})]})})}),e.jsx("div",{className:"mx-4 hidden max-w-md flex-1 md:block","data-testid":"navbar-market-dropdown",children:e.jsx(ge,{groups:l,selectedMarketId:p,onSelect:v,requestState:x})}),e.jsxs("div",{className:"flex flex-1 items-center justify-end gap-4",children:[h&&e.jsxs(J,{variant:"ghost",className:"gap-2 text-[#e8ecf5] hover:bg-white/5",onClick:d,"data-testid":"login-button",children:[e.jsx(We,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Login"})]}),r&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"hidden text-sm font-medium text-[#9aa5c0] md:inline","data-testid":"user-display-name",children:c||r}),e.jsx(J,{variant:"ghost",size:"icon",onClick:s,className:"text-[#9aa5c0] hover:bg-white/5 hover:text-[#e63946]",title:"Logout","data-testid":"logout-button",children:e.jsx(Ve,{size:20})})]})]})]}),e.jsx("div",{className:"px-6 pb-4 md:hidden","data-testid":"mobile-navbar-market-dropdown",children:e.jsx(ge,{groups:l,selectedMarketId:p,onSelect:v,requestState:x})})]}),yt=()=>{const{onAuthSuccess:t}=ve();return e.jsx("div",{"data-testid":"login-view",children:e.jsx(Ye,{appName:"Odds",loginEndpoint:"/odds/login",onSuccess:(i,r)=>t(i.access_token,i.user,r)})})},vt=({marketGroups:t,onAddMarket:i,onDeleteMarket:r,onToggleFavorite:c,onGetMarketName:d,onAddGroup:s,onDeleteGroup:b,onReorderGroups:h,onReorderMarkets:l,onImportYaml:p,onExportYaml:v,requestState:x})=>{const{errorToast:g}=de(),[w,L]=React.useState(t),[E,T]=React.useState(""),[G,j]=React.useState(""),[I,A]=React.useState(""),[S,D]=React.useState(""),[R,z]=React.useState(""),[V,y]=React.useState(""),[k,n]=React.useState(!1),[a,o]=React.useState(!1),[f,M]=React.useState(null),[_,Y]=React.useState(null),[H,se]=React.useState(!1),Q=React.useRef(null),K=React.useRef(w),U=React.useRef(null);React.useEffect(()=>{K.current=w},[w]),React.useEffect(()=>{L(t)},[t]),React.useEffect(()=>{!R&&t.length>0&&z(t[0].label)},[t,R]);const[W,oe]=React.useState(null),[ie,Z]=React.useState(null),[ee,ue]=React.useState(null),[Se,te]=React.useState(null),Me=async u=>{const m=u.trim();if(/^1\.\d{4,}$/.test(m)){se(!0);try{const N=await d(m);A(N),j(N)}catch(N){console.error("Failed to fetch market name",N)}finally{se(!1)}}},Le=async u=>{u.preventDefault(),M(null),n(!0);try{const m=E.trim();await i({id:m,label:G,api_label:I,group_label:R,expiry_date:S||null}),T(""),j(""),A(""),D(""),z("")}catch{M("Failed to add market. Ensure the ID is unique.")}finally{n(!1)}},Ie=async u=>{u.preventDefault(),Y(null),o(!0);try{await s(V),y("")}catch{Y("Failed to add group. Ensure the label is unique.")}finally{o(!1)}},Ee=async u=>{const m=u.target.files?.[0];if(!m)return;const N=new FileReader;N.onload=async P=>{try{const B=(await Promise.resolve(jsyaml)).load(P.target?.result);await p(B),Q.current&&(Q.current.value="")}catch(C){console.error("Failed to import YAML",C);const B=C instanceof Error?C.message:String(C);g(`Failed to import YAML: ${B}`)}},N.readAsText(m)},Ce=u=>{oe(u)},$e=(u,m,N)=>{u.preventDefault(),!(W===null||W===m)&&L(P=>{const C=[...P],B=C.findIndex($=>$.markets.some(q=>q.id===W)),X=C.findIndex($=>$.id===N);if(B===-1||X===-1)return P;const F={...C[B]},_e=F.markets.findIndex($=>$.id===W),[me]=F.markets.splice(_e,1);if(B===X){const $=F.markets.findIndex(q=>q.id===m);F.markets.splice($,0,me),C[B]=F}else{const $={...C[X]},q=$.markets.findIndex(Be=>Be.id===m);$.markets.splice(q,0,me),C[B]=F,C[X]=$}const Oe=P.flatMap($=>$.markets.map(q=>q.id)).join(","),Ge=C.flatMap($=>$.markets.map(q=>q.id)).join(","),Fe=P.map($=>$.id).join(","),ze=C.map($=>$.id).join(",");return Oe!==Ge||Fe!==ze?C:P})},De=async()=>{if(W===null)return;const u=W;oe(null),Z(null),U.current&&clearTimeout(U.current),U.current=setTimeout(async()=>{const m=K.current.find(N=>N.markets.some(P=>P.id===u));m&&await l(m.id,m.markets.map(N=>N.id)),U.current=null},100)},Ae=u=>{ue(u)},Te=(u,m)=>{u.preventDefault(),!(ee===null||ee===m)&&L(N=>{const P=[...N],C=P.findIndex(F=>F.id===ee),B=P.findIndex(F=>F.id===m);if(C===-1||B===-1)return N;const[X]=P.splice(C,1);return P.splice(B,0,X),P.map(F=>F.id).join(",")!==N.map(F=>F.id).join(",")?P:N})},Pe=async()=>{ee!==null&&(ue(null),te(null),U.current&&clearTimeout(U.current),U.current=setTimeout(async()=>{await h(K.current.map(u=>u.id)),U.current=null},100))};return e.jsxs("div",{className:"mx-auto flex max-w-[1000px] flex-col gap-8 px-6 pt-8 pb-12","data-testid":"management-view",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 px-2 sm:flex-row sm:items-center sm:gap-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Market Management"}),e.jsxs("div",{className:"flex w-full flex-col gap-3 sm:w-auto sm:flex-row",children:[e.jsx("input",{type:"file",ref:Q,onChange:Ee,accept:".yml,.yaml",className:"hidden"}),e.jsxs(J,{variant:"outline",onClick:()=>Q.current?.click(),className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"import-yaml-button",children:[e.jsx(He,{size:18}),"Import YAML"]}),e.jsxs(J,{variant:"outline",onClick:v,className:"w-full gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white sm:w-auto","data-testid":"export-yaml-button",children:[e.jsx(Ke,{size:18}),"Export YAML"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-market-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(qe,{className:"text-emerald-400",size:24}),"Add New Market"]}),e.jsxs("form",{onSubmit:Le,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"marketId",children:["Betfair Market ID (or paste URL)",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(re,{id:"marketId",value:E,onChange:u=>{const m=u.target.value,N=m.match(/1\.\d{4,}/);N&&N[0]!==m?T(N[0]):T(m)},required:!0,placeholder:"e.g. 1.230433061 or https://...",className:"border-white/10 bg-white/5 text-white","data-testid":"market-id-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"label",children:["Market Label"," ",H&&e.jsx("span",{className:"ml-2 animate-pulse text-xs text-indigo-400",children:"(Fetching...)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{id:"label",value:G,onChange:u=>j(u.target.value),placeholder:H?"Fetching name...":"e.g. Premier League",className:"border-white/10 bg-white/5 text-white","data-testid":"market-label-input"}),e.jsxs(J,{type:"button",variant:"outline",onClick:()=>Me(E),disabled:H||!/^1\.\d{4,}$/.test(E.trim()),className:"gap-2 border-white/10 text-[#9aa5c0] hover:bg-white/5 hover:text-white",title:"Fetch name from Betfair","data-testid":"fetch-market-name-button",children:[e.jsx(Je,{size:16,className:H?"animate-spin":""}),"Fetch"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"expiryDate",children:"Expiry Date (Optional)"}),e.jsx(re,{id:"expiryDate",type:"date",value:S,onChange:u=>D(u.target.value),className:"border-white/10 bg-white/5 text-white","data-testid":"market-expiry-date-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"group",children:["Group ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"group",value:R,onChange:u=>z(u.target.value),required:!0,className:"focus-visible:ring-ring flex h-11 w-full rounded-md border border-white/10 bg-white/5 px-3 py-1 text-sm text-white shadow-sm transition-colors focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50","data-testid":"group-select",children:[e.jsx("option",{value:"",disabled:!0,className:"bg-[#0e1422]",children:"Select a group"}),t.map(u=>e.jsx("option",{value:u.label,className:"bg-[#0e1422]",children:u.label},u.id))]})]}),e.jsxs("div",{className:"pt-2",children:[f&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"market-error-message",children:f}),e.jsx(J,{type:"submit",className:"h-11 w-full bg-emerald-600 text-white hover:bg-emerald-700",disabled:k,"data-testid":"add-market-button",children:k?"Adding...":"Add Market"})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-white/10 bg-[#0e1422] p-6 shadow-xl","data-testid":"add-group-section",children:[e.jsxs("h3",{className:"mb-6 flex items-center gap-2 text-xl font-bold text-white",children:[e.jsx(Qe,{className:"text-indigo-400",size:24}),"Add New Group"]}),e.jsxs("form",{onSubmit:Ie,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ae,{htmlFor:"groupLabel",children:["Group Label ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(re,{id:"groupLabel",value:V,onChange:u=>y(u.target.value),required:!0,placeholder:"e.g. Misc",className:"border-white/10 bg-white/5 text-white","data-testid":"new-group-label"})]}),e.jsxs("div",{className:"pt-2",children:[_&&e.jsx("p",{className:"mb-2 text-sm text-red-400","data-testid":"group-error-message",children:_}),e.jsx(J,{type:"submit",className:"h-11 w-full bg-indigo-600 text-white hover:bg-indigo-700",disabled:a,"data-testid":"add-group-button",children:a?"Adding...":"Add Group"})]})]})]})]}),e.jsxs("section",{className:"flex flex-col gap-6","data-testid":"tracked-markets-section",children:[e.jsx("h3",{className:"px-2 text-xl font-bold text-white",children:"Tracked Markets"}),x==="loading"&&w.length===0?e.jsx("div",{className:"animate-pulse space-y-4","data-testid":"markets-loading-skeleton",children:[1,2,3].map(u=>e.jsx("div",{className:"h-20 rounded-xl bg-white/5"},u))}):e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[w.map(u=>e.jsxs("div",{className:`group-container overflow-hidden rounded-2xl border border-white/10 bg-[#0e1422] shadow-lg transition-all ${ee===u.id?"opacity-20":""}`,"data-testid":`group-container-${u.label}`,draggable:Se===u.id,onDragStart:()=>Ae(u.id),onDragOver:m=>Te(m,u.id),onDragEnd:Pe,children:[e.jsxs("div",{className:"flex items-center justify-between bg-[#26356d] px-6 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"cursor-grab text-white/40 transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>te(u.id),onMouseUp:()=>te(null),onTouchStart:()=>te(u.id),onTouchEnd:()=>te(null),children:e.jsx(he,{size:20})}),e.jsx("h4",{className:"font-bold text-white",children:u.label})]}),e.jsx("button",{onClick:()=>b(u.id),className:"rounded-lg p-1.5 text-white/40 transition-all hover:bg-white/5 hover:text-red-400",title:"Delete group and all markets","data-testid":`delete-group-button-${u.label}`,children:e.jsx(ce,{size:16})})]}),e.jsxs("div",{className:"divide-y divide-white/5",children:[u.markets.map(m=>e.jsxs("div",{className:`group flex items-center justify-between px-6 py-4 transition-colors hover:bg-white/5 ${W===m.id?"opacity-20":""}`,draggable:ie===m.id,onDragStart:()=>Ce(m.id),onDragOver:N=>$e(N,m.id,u.id),onDragEnd:De,"data-testid":`market-item-${m.id}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"cursor-grab text-[#9aa5c0] transition-colors hover:text-white active:cursor-grabbing",onMouseDown:()=>Z(m.id),onMouseUp:()=>Z(null),onTouchStart:()=>Z(m.id),onTouchEnd:()=>Z(null),children:e.jsx(he,{size:18})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-[#e8ecf5]",children:m.label||m.api_label}),m.api_label&&m.api_label!==m.label&&e.jsx("span",{className:"text-xs text-[#9aa5c0] italic",children:m.api_label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(m.id,!m.favorite),className:`rounded-lg p-2 transition-all hover:bg-white/10 ${m.favorite?"text-yellow-400":"text-[#9aa5c0]"}`,title:m.favorite?"Remove from favorites":"Add to favorites","data-testid":`favorite-button-${m.id}`,children:e.jsx(at,{size:18,fill:m.favorite?"currentColor":"none"})}),e.jsx("button",{onClick:()=>r(m.id),className:"rounded-lg p-2 text-[#9aa5c0] transition-all hover:bg-white/10 hover:text-[#e63946]",title:"Delete market","data-testid":`delete-market-button-${m.id}`,children:e.jsx(ce,{size:18})})]})]},m.id)),u.markets.length===0&&e.jsx("div",{className:"px-6 py-4 text-sm text-[#9aa5c0] italic","data-testid":"empty-group-message",children:"No markets in this group."})]})]},u.id)),w.length===0&&e.jsx("div",{className:"rounded-2xl border-2 border-dashed border-white/10 py-12 text-center",children:e.jsx("p",{className:"text-[#9aa5c0]",children:"No markets tracked yet."})})]})]})]})},we=({label:t,variant:i="danger",className:r="","aria-label":c})=>{const d={danger:"border-[rgba(230,57,70,0.45)] bg-[rgba(230,57,70,0.15)] text-[#e8ecf5]",warning:"border-[#ffd447] bg-[#ffd447] text-[#0e1422] animate-pulse shadow-[0_0_0_0_rgba(255,212,71,0.45)]"};return e.jsx("div",{className:`inline-flex items-center justify-center rounded-full border px-3 py-1 text-sm font-semibold ${d[i]} ${r}`,"aria-label":c,"data-testid":`status-badge-${t.toLowerCase()}`,children:t})},kt=({status:t,isLive:i,externalUrl:r,lastUpdated:c,stats:d})=>e.jsxs("div",{className:"flex flex-col gap-2","data-testid":"market-header",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t!=="OPEN"&&t&&e.jsx(we,{label:t,"aria-label":"Market status"}),i&&e.jsx(we,{label:"LIVE",variant:"warning","aria-label":"Market live"})]}),e.jsxs("div",{className:"flex flex-col items-start gap-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1",children:[e.jsx("a",{className:"text-xs font-semibold text-[#9aa5c0] underline decoration-slate-500 underline-offset-4 hover:text-[#e8ecf5]",href:r,target:"_blank",rel:"noreferrer noopener","data-testid":"external-market-link",children:"Original data"}),e.jsx("div",{className:"text-xs font-medium text-[#9aa5c0]","data-testid":"last-updated",children:c?`Updated ${c}`:"Fetching data..."})]}),d&&e.jsx("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-xs font-semibold text-[#e8ecf5]","aria-label":"Total runners","data-testid":"market-stats",children:d})]})]}),jt={id:"valueLabel",afterDatasetsDraw(t,i,r){const c=t.config.type;if(c&&c!=="bar")return;const{ctx:d,data:s}=t,b=r?.color??"#e8ecf5";d.save();const h=t.getSortedVisibleDatasetMetas(),l=h[h.length-1];l&&(l.data.forEach((p,v)=>{const x=r?.impliedProbabilities?.[v],g=typeof x=="number"?x:s.datasets?.reduce((L,E)=>{const T=E?.data?.[v];return typeof T=="number"?L+T:L},0);if(typeof g!="number"||g<=0)return;const w=p.tooltipPosition(!0);w.x===null||w.y===null||(d.fillStyle=b,d.font='600 12px "Inter", system-ui, -apple-system, sans-serif',d.textBaseline="middle",d.textAlign="left",d.fillText(`${g.toFixed(1)}%`,w.x+6,w.y))}),d.restore())}};Chart.Chart.register(Chart.ArcElement,Chart.BarElement,Chart.CategoryScale,Chart.LinearScale,Chart.Legend,Chart.Title,Chart.Tooltip,jt);const ne=["#ba0034","#0293d9","#ff901a","#50469d","#eb9fa2","#87365c","#97d76f","#ed2fa4","#0b6109","#ffa1e4","#01dbc6"],le=t=>t===null||Number.isNaN(t)?"—":`${(t*100).toFixed(1)}%`,Nt=({marketGroups:t,marketListState:i,selectedMarketId:r})=>{const{loadingToast:c,removeToast:d}=de(),[s,b]=React.useState(null),[h,l]=React.useState("idle"),[p,v]=React.useState(null),x=React.useRef(!0),g=React.useRef(null),w=React.useCallback(async(y,k=!1)=>{l("loading"),v(null),k&&g.current===null&&(g.current=c("Refreshing prices..."));try{const n=await fetch(`${O}/odds/market-data/${y}`);if(!n.ok)throw new Error(`Request failed with status ${n.status}`);const a=await n.json(),o=lt(a,new Date);b(o),l("success")}catch(n){console.error("Failed to fetch market",n),l("error"),v("We could not load market prices. Please retry.")}finally{if(g.current!==null){const n=g.current;setTimeout(()=>{d(n),g.current===n&&(g.current=null)},1e3)}}},[c,d]);React.useEffect(()=>{if(r){const y=!x.current;w(r,y),x.current=!1}},[w,r]);const L=React.useMemo(()=>s?new Date(s.fetchedAt).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",weekday:"short",month:"short",day:"numeric",hour12:!1}):null,[s]),E=React.useMemo(()=>{if(!s)return null;const y=s.runners.map(o=>o.name),k=s.runners.map((o,f)=>o.name.startsWith("Others")?"#9aa0ae":ne[f%ne.length]),n=s.runners.map(o=>Math.max(0,o.probabilityMin??0)*100),a=s.runners.map(o=>{const f=Math.max(0,o.probabilityMin??0),M=Math.max(f,o.probabilityMax??f);return Math.max(0,M-f)*100});return{labels:y,datasets:[{label:"Minimum probability (%)",data:n,backgroundColor:k,borderColor:k,borderWidth:1,borderSkipped:!1,stack:"probability"},{label:"Spread from min to max (%)",data:a,backgroundColor:"#ffffff",borderColor:"#ffffff",borderWidth:1,borderRadius:{topRight:3,bottomRight:3,topLeft:0,bottomLeft:0},borderSkipped:!1,stack:"probability"}]}},[s]),T=React.useMemo(()=>{if(!s)return null;const y=s.runners.map(a=>(a.impliedProbability??0)*100),k=s.runners.reduce((a,o)=>{const f=(o.probabilityMax??0)*100;return f>a?f:a},0),n=Math.max(5,k);return{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(a){const o=s.runners[a.dataIndex],f=le(o.probabilityMin),M=le(o.probabilityMax);return`${o.name} — ${f} to ${M}`}}},valueLabel:{color:"#e8ecf5",impliedProbabilities:y}},scales:{x:{stacked:!0,grid:{color:"rgba(232, 236, 245, 0.50)"},ticks:{color:"#e8ecf5",callback:a=>`${a}%`},suggestedMax:n},y:{stacked:!0,grid:{display:!1},ticks:{color:a=>{const o=a.tick?.label;if(typeof o=="string"){if(o.startsWith(ke))return"#ff3b30";if(o.startsWith("Others"))return"#9aa0ae"}return"#e8ecf5"},autoSkip:!1}}}}},[s]),G=React.useMemo(()=>{if(!s)return null;const y=s.runners.map(n=>n.name),k=s.runners.map((n,a)=>n.name.startsWith("Others")?"#9aa0ae":ne[a%ne.length]);return{labels:y,datasets:[{label:"Implied probability",data:s.runners.map(n=>(n.impliedProbability??0)*100),backgroundColor:k,borderWidth:0}]}},[s]),j=React.useMemo(()=>s?{animation:!1,transitions:{active:{animation:{duration:0}},resize:{animation:{duration:0}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label(y){const k=s.runners[y.dataIndex];return`${k.name}: ${le(k.impliedProbability)}`}}}}}:null,[s]),I=React.useMemo(()=>s?Math.max(320,s.runners.length*34):320,[s]),A=React.useMemo(()=>{if(!s)return"bar-empty";const y=s.runners.map(k=>k.id).join("-");return`${s.marketId}-${y}-${s.fetchedAt}`},[s]),S=React.useMemo(()=>{if(!s)return"";const y=s.runners.filter(a=>a.status==="ACTIVE"&&!a.name.startsWith("Others")).length,k=Math.max(0,s.activeRunnerCount-y),n=s.numberOfWinners-s.winnerRunnerCount;return[`${s.activeRunnerCount} still active`,k>0?` (${y} displayed + ${k} others below 1%)`:"",s.winnerRunnerCount>0?` + ${s.winnerRunnerCount} already won`:"",s.loserRunnerCount>0?` + ${s.loserRunnerCount} already lost`:"",s.winnerRunnerCount+s.loserRunnerCount>0?` = ${s.totalRunners} starters`:"",n>1?` ; ${n} winning spots left`:""].join("")},[s]),D=React.useMemo(()=>`https://www.betfair.com/exchange/plus/politics/market/${r}`,[r]),R=h==="loading"&&!s,z=s?.runners.length===0,V=s?.inplay??!1;return e.jsxs("div",{className:"mx-auto flex max-w-[1200px] flex-col gap-6 pt-2 pb-[clamp(1.25rem,4vw,2.5rem)] md:px-8 md:pt-8","data-testid":"public-view",children:[p&&e.jsxs("div",{className:"flex flex-col gap-4 rounded-[14px] border border-[rgba(230,57,70,0.5)] bg-[rgba(230,57,70,0.1)] px-4 py-3 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:flex-row md:items-center md:justify-between",role:"alert","aria-live":"assertive","data-testid":"error-message",children:[e.jsxs("div",{children:[e.jsx("p",{className:"m-0 text-lg font-bold text-[#e8ecf5]",children:"Price fetch failed"}),e.jsx("p",{className:"m-0 mt-1 text-sm text-[#9aa5c0]",children:p})]}),e.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-lg border border-white/15 bg-white/5 px-3 py-2 font-semibold text-[#e8ecf5] hover:border-white/30",onClick:()=>{w(r)},"data-testid":"retry-button",children:"Retry"})]}),e.jsx("section",{className:"grid grid-cols-1 gap-4","data-testid":"charts-section",children:e.jsxs("div",{className:"w-full rounded-2xl border border-white/10 bg-[#0e1422] py-4 shadow-[0_20px_60px_rgba(0,0,0,0.35)] md:p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-4 px-2 md:flex-row md:items-center md:justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Probability"}),e.jsx(kt,{status:s?.status,isLive:V,externalUrl:D,lastUpdated:L,stats:S})]}),R&&e.jsx("div",{className:"mt-3 flex flex-col gap-2","aria-hidden":"true","data-testid":"loading-skeleton",children:Array.from({length:5}).map((y,k)=>e.jsx("div",{className:"h-4 animate-pulse rounded-md bg-white/10"},k))}),!R&&s&&!z&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"bar-chart-container",children:E&&e.jsx("div",{className:"w-full",style:{height:`${I}px`},children:e.jsx(Ze,{data:E,options:T},A)})}),e.jsx("div",{className:"w-full rounded-[14px] border border-white/10 bg-white/5 p-3 shadow-inner","data-testid":"pie-chart-container",children:G&&e.jsx("div",{className:"min-h-[260px] w-full",children:e.jsx(et,{data:G,options:j})})})]}),!R&&z&&e.jsx("p",{className:"mt-3 text-[#9aa5c0]",role:"status","data-testid":"no-runners-message",children:"No runners available right now."})]})})]})},Rt=()=>{const t=ct(),i=()=>t.user&&t.showEdit?e.jsx(vt,{marketGroups:t.marketGroups,onAddMarket:t.handleAddMarket,onDeleteMarket:t.handleDeleteMarket,onToggleFavorite:t.handleToggleFavorite,onGetMarketName:t.handleGetMarketName,onAddGroup:t.handleAddGroup,onDeleteGroup:t.handleDeleteGroup,onReorderGroups:t.handleReorderGroups,onReorderMarkets:t.handleReorderMarkets,onImportYaml:t.handleImportYaml,onExportYaml:t.handleExportYaml,requestState:t.marketListState}):t.showLogin?e.jsx(yt,{}):e.jsx(Nt,{marketGroups:t.marketGroups,marketListState:t.marketListState,selectedMarketId:t.selectedMarketId});return e.jsxs("div",{className:"min-h-screen bg-[radial-gradient(circle_at_20%_-10%,rgba(230,57,70,0.18),transparent_35%),radial-gradient(circle_at_80%_20%,rgba(118,174,255,0.12),transparent_40%),#060910] font-sans text-[#e8ecf5]",style:{colorScheme:"dark"},children:[e.jsx(wt,{title:"Odds",isAdmin:!!t.user,userEmail:t.user?.email,userFirstName:t.user?.first_name,userRole:t.user?.role,onLoginClick:t.navigateToLogin,onLogoutClick:t.logout,onLogoClick:t.user?t.navigateToEdit:t.navigateToPublic,showLoginButton:!t.user&&!t.showLogin,marketGroups:t.marketGroups,selectedMarketId:t.selectedMarketId,onSelectMarket:t.setSelectedMarketId,marketListState:t.marketListState}),i()]})},Re=document.getElementById("root");if(!Re)throw new Error("Root element #root not found");document.body.classList.add("odds-page");ReactDOM.createRoot(Re).render(e.jsx(React.StrictMode,{children:e.jsx(Ue,{children:e.jsx(st,{children:e.jsx(Rt,{})})})}));
