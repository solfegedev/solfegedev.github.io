import"./index-Ch1IFy9t.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as ge}from"./api-CH_Pe6Vg.js";import{S as xe,C as he}from"./search-XMVjuEej.js";import{c as w}from"./createLucideIcon-DtX1aPOG.js";import{C as ue}from"./copy-CzC7y2Qs.js";import{M as W,a as pe,L as fe}from"./map-21CgSxyq.js";import{X as be}from"./x-BS-d4QNZ.js";import{L as B}from"./leaflet-src-DBNPRDgh.js";const ye=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],Y=w("bike",ye);const we=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],je=w("book-open",we);const ve=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],J=w("chevron-left",ve);const Ne=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],K=w("chevron-right",Ne);const ke=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],_e=w("external-link",ke);const Ce=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Se=w("eye",Ce);const Pe=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],$e=w("file-text",Pe);const Me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Re=w("frown",Me);const Ie=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Le=w("funnel",Ie);const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],X=w("globe",De);const Be=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Te=w("heart",Be);const Ae=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],ee=w("house",Ae);const Fe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ze=w("image",Fe);const Ee=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Ge=w("maximize",Ee);const He=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],te=w("navigation",He);const Ve=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Oe=w("shield-alert",Ve),Ue=async t=>{const g=await fetch(`${ge}/properties/?source=${t}`);if(!g.ok){const d=await g.json();throw new Error(d.detail||"Failed to fetch properties")}return g.json()},qe=({filters:t,onChange:g,propertyGroups:d,sortBy:l,onSortChange:b})=>{const i=p=>{const{name:o,value:r,type:C}=p.target,c=C==="checkbox"?p.target.checked:o==="minPrice"||o==="maxPrice"||o==="minBedrooms"?Number(r):r;g({...t,[o]:c})};return e.jsx("div",{className:"bg-white border-b border-gray-200 p-4 shadow-sm z-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px] relative",children:[e.jsx("input",{type:"text",name:"searchQuery",value:t.searchQuery,onChange:i,placeholder:"Search location or features...",className:"w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-xl text-sm font-medium focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all"}),e.jsx(xe,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Type"}),e.jsx("select",{name:"propertyGroup",value:t.propertyGroup,onChange:i,className:"bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",children:d.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Beds"}),e.jsxs("select",{name:"minBedrooms",value:t.minBedrooms,onChange:i,className:"bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",children:[e.jsx("option",{value:0,children:"Any"}),e.jsx("option",{value:1,children:"1+"}),e.jsx("option",{value:2,children:"2+"}),e.jsx("option",{value:3,children:"3+"}),e.jsx("option",{value:4,children:"4+"}),e.jsx("option",{value:5,children:"5+"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Sold/Let"}),e.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 gap-2",children:[e.jsx("input",{type:"checkbox",name:"includeSoldLet",id:"includeSoldLet",checked:t.includeSoldLet,onChange:i,className:"w-4 h-4 rounded text-indigo-600 focus:ring-indigo-500/20 border-gray-300 cursor-pointer"}),e.jsx("label",{htmlFor:"includeSoldLet",className:"text-sm font-bold text-gray-700 cursor-pointer",children:"Include"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Price"}),e.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-xl overflow-hidden",children:[e.jsx("input",{type:"number",name:"minPrice",value:t.minPrice,onChange:i,placeholder:"Min",className:"w-20 md:w-24 px-3 py-2 text-sm font-bold text-gray-700 bg-transparent focus:outline-none"}),e.jsx("span",{className:"text-gray-300 px-1",children:"—"}),e.jsx("input",{type:"number",name:"maxPrice",value:t.maxPrice,onChange:i,placeholder:"Max",className:"w-20 md:w-24 px-3 py-2 text-sm font-bold text-gray-700 bg-transparent focus:outline-none"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-tight",children:"Sort"}),e.jsxs("select",{value:l,onChange:p=>b(p.target.value),className:"bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-sm font-bold text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/20",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"last-modified",children:"Last Modified"}),e.jsx("option",{value:"price-asc",children:"Price: Low to High"}),e.jsx("option",{value:"price-desc",children:"Price: High to Low"})]})]})]})})},ae=React.memo(({property:t,onSelect:g,onViewDetails:d,onShowOnMap:l,isSelected:b,index:i,total:p})=>{const[o,r]=React.useState(0),C=s=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(s),c=s=>{s.stopPropagation(),r(m=>(m+1)%t.images.length)},N=s=>{s.stopPropagation(),r(m=>(m-1+t.images.length)%t.images.length)},j=()=>{g(t)},y=s=>{s.stopPropagation(),d(t)},f=t.images[o]?.url||"https://via.placeholder.com/400x300?text=No+Image",x=s=>{s.stopPropagation();const m=new URLSearchParams;m.set("location",window.location.search.includes("location")?new URLSearchParams(window.location.search).get("location"):"chesterfield_ashgate"),m.set("id",t.id);const h=`${window.location.origin}${window.location.pathname}?${m.toString()}`;navigator.clipboard.writeText(h).then(()=>{console.log("Link copied to clipboard!")})};return e.jsxs("div",{id:`property-${t.id}`,"data-testid":"property-card",onClick:j,className:`group flex flex-col md:flex-row rounded-md overflow-hidden border transition-all duration-300 cursor-pointer mx-0.5 ${b?"border-indigo-600 ring-2 ring-indigo-600 shadow-lg z-10 bg-white":"border-gray-200 hover:border-indigo-300 hover:shadow-md z-0 bg-white"}`,children:[e.jsxs("div",{className:"relative w-full md:w-40 h-48 md:h-auto overflow-hidden bg-gray-100 pointer-events-none",children:[e.jsx("img",{src:f,alt:t.address,className:"w-full h-full object-cover transition-transform duration-500",loading:"lazy",referrerPolicy:"no-referrer"}),t.images.length>1&&e.jsxs("div",{className:"pointer-events-auto",children:[e.jsx("button",{onClick:N,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full backdrop-blur-sm transition-all opacity-70 hover:opacity-100 cursor-pointer z-10",children:e.jsx(J,{className:"w-6 h-6"})}),e.jsx("button",{onClick:c,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full backdrop-blur-sm transition-all opacity-70 hover:opacity-100 cursor-pointer z-10",children:e.jsx(K,{className:"w-6 h-6"})})]}),t.is_new&&e.jsx("div",{className:"absolute top-3 left-3 bg-indigo-600 text-white text-[0.625rem] font-black px-2 py-1 rounded-md uppercase tracking-wider shadow-sm",children:"New"}),t.sold_let&&e.jsx("div",{className:"absolute top-3 right-3 bg-yellow-400 text-black text-[0.625rem] font-black px-2 py-1 rounded-md uppercase tracking-wider shadow-sm border border-black/10",children:t.sold_let}),e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/50 backdrop-blur-sm text-white text-[0.625rem] font-bold px-2 py-1 rounded-md flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3"}),o+1," / ",t.images.length]})]}),e.jsxs("div",{className:"flex-1 p-4 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-start mb-1",children:e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("h3",{className:"text-lg font-black text-gray-900 leading-tight",children:C(t.price)}),e.jsxs("span",{className:"text-[0.8rem] font-bold text-gray-800 uppercase tracking-widest",children:[i+1," / ",p]}),e.jsxs("span",{className:"text-xs font-bold text-gray-400 bg-gray-50 px-2 py-1 rounded-md",children:[t.property_group_icon," ",t.property_group]})]})})}),e.jsx("p",{className:"text-sm font-bold text-gray-600 line-clamp-1 mb-2",children:t.address}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-black text-gray-700",children:[t.bedrooms," ",e.jsx("span",{className:"font-medium text-gray-500",children:"Beds"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-black text-gray-700",children:[t.bathrooms," ",e.jsx("span",{className:"font-medium text-gray-500",children:"Baths"})]})]}),t.size_sqm&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-gray-400",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-black text-gray-700",children:[Math.round(t.size_sqm)," ",e.jsx("span",{className:"font-medium text-gray-500",children:"m²"})]})]})]}),e.jsx("div",{className:"space-y-0.5 mb-3",children:(()=>{const s=new Date,m=t.date_added?new Date(t.date_added):null;let h=null;if(t.previous_prices&&t.previous_prices.length>0){const v=t.previous_prices[0].price;t.price<v&&t.date_updated&&(h=new Date(t.date_updated))}return e.jsxs("div",{className:"text-[0.8rem] font-bold leading-tight",children:[h&&e.jsxs("div",{className:"text-gray-400 mb-1",children:[e.jsxs("span",{className:"text-emerald-600",children:["Reduced"," ",((s.getTime()-h.getTime())/(1e3*60*60*24)).toFixed(1)," ","days ago"]})," ","(on"," ",h.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),")"]}),t.previous_prices&&t.previous_prices.length>0&&e.jsx("div",{className:"flex flex-wrap gap-x-2 gap-y-0.5 mb-1 opacity-80",children:[...t.previous_prices].reverse().map((v,M)=>e.jsxs("div",{className:"text-gray-400 bg-emerald-50 px-1.5 py-0.5 rounded border border-gray-100",children:[new Date(v.date).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),": ",C(v.price)]},M))}),m&&e.jsxs("div",{className:"text-gray-400",children:[e.jsxs("span",{className:h?"":"text-orange-500",children:["First added"," ",((s.getTime()-m.getTime())/(1e3*60*60*24)).toFixed(1)," ","days ago"]})," ","(on"," ",m.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),")"]})]})})()})]}),e.jsxs("div",{className:"flex gap-2 pointer-events-auto",children:[e.jsxs("button",{onClick:x,title:"Copy shareable link",className:"text-[0.625rem] font-bold text-gray-700 hover:text-gray-900 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded-md transition-all uppercase cursor-pointer flex items-center gap-1 border border-gray-200",children:["Copy",e.jsx(ue,{className:"w-3 h-3"})]}),e.jsx("button",{onClick:y,className:"text-[0.625rem] font-bold text-indigo-700 hover:text-indigo-900 bg-indigo-100 hover:bg-indigo-200 px-2 py-1 rounded-md transition-all uppercase cursor-pointer",children:"View Details"}),e.jsxs("a",{href:`https://www.rightmove.co.uk/properties/${t.id}#/?channel=RES_BUY`,target:"_blank",rel:"noopener noreferrer",className:"text-[0.625rem] font-bold text-teal-700 hover:text-teal-900 bg-teal-100 hover:bg-teal-200 px-2 py-1 rounded-md transition-all uppercase cursor-pointer flex items-center gap-1 border border-teal-200",onClick:s=>s.stopPropagation(),title:"View on Rightmove",children:["Original",e.jsx(_e,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-gray-50",children:[e.jsx("a",{href:`https://www.google.com/maps/@${t.coordinates[0]},${t.coordinates[1]},3a,90y,70t/data=!3m1!1e1`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-green-100 text-green-700 hover:bg-green-200 transition-colors border border-green-200 shadow-sm",title:"Street View",onClick:s=>s.stopPropagation(),children:e.jsx(W,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://open.xploria.co.uk/app/know-your-place?map=${t.coordinates[1]}*${t.coordinates[0]}*18&view=elcAu7IT4&theme=w0fDyvnN_`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-orange-100 text-orange-700 hover:bg-orange-200 transition-colors border border-orange-200 shadow-sm",title:"Crime Map",onClick:s=>s.stopPropagation(),children:e.jsx(Oe,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://open.xploria.co.uk/app/know-your-place?map=${t.coordinates[1]}*${t.coordinates[0]}*18&view=elcAu7IT4`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors border border-blue-200 shadow-sm",title:"Living Standard",onClick:s=>s.stopPropagation(),children:e.jsx(Te,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://www.cyclosm.org/#map=17/${t.coordinates[0]}/${t.coordinates[1]}/cyclosm`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors border border-purple-200 shadow-sm",title:"Cycle Map",onClick:s=>s.stopPropagation(),children:e.jsx(Y,{className:"w-3.5 h-3.5"})}),e.jsx("a",{href:`https://earth.google.com/web/@${t.coordinates[0]},${t.coordinates[1]},132a,25d,35y,0h,0t,0r`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-cyan-100 text-cyan-700 hover:bg-cyan-200 transition-colors border border-cyan-200 shadow-sm",title:"Google Earth",onClick:s=>s.stopPropagation(),children:e.jsx(X,{className:"w-3.5 h-3.5"})}),t.closest?.coords&&e.jsx("a",{href:`https://www.google.com/maps/dir/${t.closest.coords[0]},${t.closest.coords[1]}/${t.coordinates[0]},${t.coordinates[1]}/@2696m/data=!3m2!1e3!4b1!4m2!4m1!3e2`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 rounded-md bg-rose-100 text-rose-700 hover:bg-rose-200 transition-colors border border-rose-200 shadow-sm",title:"Directions from Nearest",onClick:s=>s.stopPropagation(),children:e.jsx(te,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2 border-t border-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.agency?.url&&e.jsx("img",{src:t.agency.url,alt:t.agency.caption,className:"h-4 max-w-[80px] object-contain opacity-70 grayscale hover:grayscale-0 transition-all",loading:"lazy",referrerPolicy:"no-referrer"}),!t.agency?.url&&t.agency?.caption&&e.jsx("span",{className:"text-[0.625rem] font-bold text-gray-400 uppercase tracking-tight",children:t.agency.caption})]}),e.jsx("div",{className:"flex items-center gap-1.5 pointer-events-auto",children:t.closest&&e.jsxs("button",{onClick:s=>{s.stopPropagation(),l?.(t)},"data-testid":"distance-button",className:"text-[0.625rem] font-bold text-indigo-700 hover:text-indigo-900 bg-indigo-100 hover:bg-indigo-200 px-2 py-1 rounded-md transition-colors uppercase cursor-pointer",children:[t.closest.miles?.toFixed(1)||0," miles to"," ",t.closest.place||"nearest"]})})]})]})]})});ae.displayName="PropertyCard";const Ze=({property:t,onClose:g})=>{const[d,l]=React.useState(0),b=o=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(o),i=o=>{o.stopPropagation(),l(r=>(r+1)%t.images.length)},p=o=>{o.stopPropagation(),l(r=>(r-1+t.images.length)%t.images.length)};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 md:p-6 bg-gray-900/40 backdrop-blur-sm animate-in fade-in duration-300",onClick:g,"data-testid":"x-property-modal",children:e.jsxs("div",{className:"bg-white w-full max-w-5xl max-h-[90vh] rounded-3xl shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-300",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"p-4 md:p-6 border-b border-gray-100 flex items-center justify-between bg-white sticky top-0 z-10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl md:text-2xl font-black text-gray-900 leading-tight",children:b(t.price)}),e.jsx("p",{className:"text-sm font-bold text-gray-500",children:t.address})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors text-gray-400 hover:text-gray-900",children:e.jsx(be,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-0 md:gap-8 p-0 md:p-8",children:[e.jsx("div",{className:"relative aspect-[16/10] md:aspect-square bg-gray-100 md:rounded-2xl overflow-hidden group/carousel",children:t.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.images[d].url,alt:t.images[d].caption||`Image ${d+1}`,className:"w-full h-full object-cover animate-in fade-in duration-500"},d),t.images[d].caption&&e.jsx("div",{className:"absolute bottom-0 inset-x-0 p-4 bg-black/40 backdrop-blur-md text-white text-[0.625rem] font-bold uppercase tracking-wider",children:t.images[d].caption}),t.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:p,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-md text-white transition-all opacity-0 group-hover/carousel:opacity-100 border border-white/10",children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:i,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-md text-white transition-all opacity-0 group-hover/carousel:opacity-100 border border-white/10",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"absolute top-4 right-4 px-3 py-1 bg-black/40 backdrop-blur-md rounded-full text-white text-[0.625rem] font-black tracking-widest uppercase border border-white/10",children:[d+1," / ",t.images.length]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 font-bold uppercase tracking-widest text-[0.625rem]",children:"No images available"})}),e.jsxs("div",{className:"p-6 md:p-0 space-y-8",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4",children:"Key Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.key_features.map((o,r)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsx("div",{className:"mt-1 w-1.5 h-1.5 rounded-full bg-indigo-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-bold text-gray-700",children:o})]},r))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4",children:"Description"}),e.jsx("div",{className:"text-gray-600 text-sm leading-relaxed font-medium bg-gray-50/50 p-4 rounded-2xl italic border-l-4 border-indigo-200",dangerouslySetInnerHTML:{__html:t.summary}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.floorplans.length>0&&e.jsxs("a",{href:t.floorplans[0].url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-indigo-50 text-indigo-700 font-black text-sm hover:bg-indigo-100 transition-colors border border-indigo-100",children:[e.jsx($e,{className:"w-5 h-5"}),"Floorplan"]}),t.brochures.length>0&&e.jsxs("a",{href:t.brochures[0].url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-emerald-50 text-emerald-700 font-black text-sm hover:bg-emerald-100 transition-colors border border-emerald-100",children:[e.jsx(je,{className:"w-5 h-5"}),"Brochure"]}),e.jsxs("a",{href:`https://www.google.com/maps/@${t.coordinates[0]},${t.coordinates[1]},3a,90y,70t/data=!3m1!1e1`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-green-50 text-green-700 font-black text-sm hover:bg-green-100 transition-colors border border-green-100",children:[e.jsx(W,{className:"w-5 h-5"}),"Street View"]}),e.jsxs("a",{href:`https://www.cyclosm.org/#map=17/${t.coordinates[0]}/${t.coordinates[1]}/cyclosm`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-purple-50 text-purple-700 font-black text-sm hover:bg-purple-100 transition-colors border border-purple-100",children:[e.jsx(Y,{className:"w-5 h-5"}),"Cycle Map"]}),e.jsxs("a",{href:`https://earth.google.com/web/@${t.coordinates[0]},${t.coordinates[1]},132a,25d,35y,0h,0t,0r`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-cyan-50 text-cyan-700 font-black text-sm hover:bg-cyan-100 transition-colors border border-cyan-100",children:[e.jsx(X,{className:"w-5 h-5"}),"Google Earth"]}),t.closest?.coords&&e.jsxs("a",{href:`https://www.google.com/maps/dir/${t.closest.coords[0]},${t.closest.coords[1]}/${t.coordinates[0]},${t.coordinates[1]}/@2696m/data=!3m2!1e3!4b1!4m2!4m1!3e2`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 p-4 rounded-2xl bg-rose-50 text-rose-700 font-black text-sm hover:bg-rose-100 transition-colors border border-rose-100",children:[e.jsx(te,{className:"w-5 h-5"}),"Directions"]})]}),t.previous_prices&&t.previous_prices.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"text-xs font-black text-indigo-600 uppercase tracking-[0.2em] mb-4",children:"Price History"}),e.jsx("div",{className:"space-y-2",children:t.previous_prices.map((o,r)=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-4 bg-gray-50 rounded-xl text-sm font-bold",children:[e.jsx("span",{className:"text-gray-500",children:new Date(o.date).toLocaleDateString()}),e.jsx("span",{className:"text-gray-900",children:b(o.price)})]},r))})]})]})]})}),e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-100 flex flex-col md:flex-row items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.agency?.url&&e.jsx("img",{src:t.agency.url,alt:t.agency.caption,className:"h-6 object-contain"}),e.jsx("span",{className:"text-sm font-bold text-gray-500",children:t.agency?.caption})]})})]})})},Qe=typeof window<"u"?window.innerWidth<768:!1,T=10,se=.5,We=se*1e3+500;function Ye(t,g){if(!t&&!g)return null;const d=new Date;let l,b;if(g?(l=new Date(g),b="updated"):(l=new Date(t),b="added"),isNaN(l.getTime()))return null;const i=d.getTime()-l.getTime();return{days:Math.max(0,i/(1e3*60*60*24)),type:b}}const Je=({properties:t,selectedProperty:g,onPropertySelect:d,zoom:l,onZoomChange:b,center:i,onCenterChange:p})=>{const o=React.useRef(null),r=React.useRef(null),C=React.useRef(null),c=React.useRef(new Map),N=React.useRef(i),j=React.useRef(l);return React.useEffect(()=>{N.current=i},[i]),React.useEffect(()=>{j.current=l},[l]),React.useEffect(()=>{if(!o.current)return;r.current=B.map(o.current,{zoomControl:!1,attributionControl:!1}).setView(i||[51.2627,-1.0856],l||15),B.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxZoom:19}).addTo(r.current),C.current=B.layerGroup().addTo(r.current),r.current.on("zoomend",()=>{r.current&&b&&b(r.current.getZoom())}),r.current.on("moveend",()=>{if(r.current&&p){const f=o.current;if(f&&(f.offsetWidth===0||f.offsetHeight===0))return;const x=r.current.getCenter();p([x.lat,x.lng])}});const y=new ResizeObserver(()=>{r.current&&(r.current.invalidateSize(),o.current&&o.current.offsetWidth>0&&N.current&&r.current.setView(N.current,j.current||r.current.getZoom(),{animate:!1}))});return o.current&&y.observe(o.current),()=>{y.disconnect(),r.current?.remove()}},[]),React.useEffect(()=>{if(r.current&&i){const y=r.current.getCenter(),f=1e-5,x=r.current.getZoom(),s=l!==void 0&&Math.abs(x-l)>.1;(Math.abs(y.lat-i[0])>f||Math.abs(y.lng-i[1])>f||s)&&r.current.setView(i,l!==void 0?l:x,{animate:!0,duration:se,noMoveStart:!1})}},[i,l]),React.useEffect(()=>{if(!r.current||!C.current||(C.current.clearLayers(),c.current.clear(),t.length===0))return;const y=B.latLngBounds([]);t.forEach(f=>{const[x,s]=f.coordinates;if(!x||!s)return;y.extend([x,s]);const m=B.marker([x,s]).on("click",()=>d(f)).addTo(C.current);c.current.set(f.id,m)}),!i&&t.length>0&&!g&&r.current.fitBounds(y,{padding:[50,50],maxZoom:15})},[t,d]),React.useEffect(()=>{c.current.forEach((y,f)=>{const x=t.find(_=>_.id===f);if(!x)return;const s=g?.id===f,m=Ye(x.date_added,x.date_updated);let h="";if(m){const _=Math.floor(m.days);h=`<span class="${m.type==="updated"?"text-green-600":"text-orange-500"} ml-1">${_}d</span>`}let v="bg-white text-gray-900 border-indigo-600",M="bg-white border-indigo-600";s?(v="bg-indigo-600 text-white border-white",M="bg-indigo-600 border-white"):x.sold_let&&(v="bg-white text-gray-900 border-yellow-600",M="bg-white border-yellow-600");const R=B.divIcon({className:"custom-div-icon",html:`
          <div class="flex items-center justify-center transition-all duration-300 ${s?"scale-125 z-50":"hover:scale-110"}">
            <div class="px-2 py-1 rounded-lg font-black text-xs shadow-lg border-2 flex items-center gap-1 ${v}">
              £${(x.price/1e3).toFixed(0)}k${h}
            </div>
            <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 rotate-45 border-r-2 border-b-2 ${M}"></div>
          </div>
        `,iconSize:[60,30],iconAnchor:[30,30]});y.setIcon(R),s?y.setZIndexOffset(1e3):y.setZIndexOffset(0)})},[g,t]),e.jsx("div",{ref:o,className:"w-full h-full z-0"})},Ke=()=>{const t=new URLSearchParams(window.location.search),g=t.get("location")||"chesterfield_ashgate",d=t.get("view")||"list",l=t.get("z")?parseInt(t.get("z")):15,b=t.get("id"),i=t.get("lat")?parseFloat(t.get("lat")):null,p=t.get("lng")?parseFloat(t.get("lng")):null,o=t.get("sold_let")!=="false",[r,C]=React.useState(g),[c,N]=React.useState(1),[j,y]=React.useState(null),[f,x]=React.useState(!0),[s,m]=React.useState(null),[h,v]=React.useState(null),[M,R]=React.useState(null),[_,I]=React.useState(d),[E,G]=React.useState(l),[A,L]=React.useState(i&&p?[i,p]:void 0),[H,re]=React.useState(!1),[k,Z]=React.useState({minPrice:0,maxPrice:2e6,minBedrooms:0,propertyGroup:"All",searchQuery:"",includeSoldLet:o}),[S,ne]=React.useState("last-modified"),[V,O]=React.useState(b),U=React.useRef(!0),P=React.useMemo(()=>{if(!j)return[];let a=j.items.filter(n=>{if(!k.includeSoldLet&&n.sold_let||n.price<k.minPrice||n.price>k.maxPrice||n.bedrooms<k.minBedrooms||k.propertyGroup!=="All"&&n.property_group!==k.propertyGroup)return!1;if(k.searchQuery){const u=k.searchQuery.toLowerCase();return n.address.toLowerCase().includes(u)||n.summary.toLowerCase().includes(u)}return!0});return a.sort((n,u)=>{if(S==="price-asc")return n.price-u.price;if(S==="price-desc")return u.price-n.price;if(S==="newest")return new Date(u.date_added||0).getTime()-new Date(n.date_added||0).getTime();if(S==="last-modified"){const z=new Date(n.date_updated||n.date_added||0).getTime();return new Date(u.date_updated||u.date_added||0).getTime()-z}return 0}),a},[j,k,S]),D=Math.ceil(P.length/T),Q=React.useMemo(()=>{const a=(c-1)*T;return P.slice(a,a+T)},[P,c]);React.useEffect(()=>{if(V&&_==="list"){const a=document.getElementById(`property-${V}`);if(a){const n=setTimeout(()=>{a.scrollIntoView({behavior:"smooth",block:"center"}),O(null)},100);return()=>clearTimeout(n)}}},[V,_,c,Q]);const oe=React.useCallback(a=>{v(a),L([...a.coordinates]);const n=new URLSearchParams(window.location.search);n.set("id",a.id);const u=`${window.location.pathname}?${n.toString()}`;window.history.replaceState({},"",u)},[]),ie=React.useCallback(a=>{v(a),R(a);const n=new URLSearchParams(window.location.search);n.set("id",a.id);const u=`${window.location.pathname}?${n.toString()}`;window.history.replaceState({},"",u)},[]),le=React.useCallback(a=>{v(a),L([...a.coordinates]),I("map"),G(15)},[]);React.useEffect(()=>{const a=new URLSearchParams;a.set("location",r),_==="map"&&a.set("view","map"),a.set("z",E.toString()),A&&(a.set("lat",A[0].toFixed(6)),a.set("lng",A[1].toFixed(6))),h&&a.set("id",h.id),k.includeSoldLet||a.set("sold_let","false");const n=`${window.location.pathname}?${a.toString()}`;window.history.replaceState({},"",n)},[r,_,h,E,A,k.includeSoldLet]),React.useEffect(()=>{(async()=>{x(!0),U.current?R(null):(v(null),R(null),I("list"),G(15),L(void 0),N(1));try{const n=await Ue(r);if(y(n),m(null),U.current&&b){const u=n.items.find(z=>z.id===b);if(u){v(u);const q=[...n.items].sort(($,F)=>{if(S==="price-asc")return $.price-F.price;if(S==="price-desc")return F.price-$.price;if(S==="newest")return new Date(F.date_added||0).getTime()-new Date($.date_added||0).getTime();if(S==="last-modified"){const me=new Date($.date_updated||$.date_added||0).getTime();return new Date(F.date_updated||F.date_added||0).getTime()-me}return 0}).findIndex($=>$.id===b);if(q>=0){const $=Math.floor(q/T)+1;N($)}d==="list"&&O(u.id)}}}catch(n){m(n.message)}finally{x(!1),U.current=!1}})()},[r]);const ce=React.useCallback(a=>{v(a),L([...a.coordinates]),Qe&&setTimeout(()=>{I("list")},We);const n=P.findIndex(u=>u.id===a.id);if(n>=0){const u=Math.floor(n/T)+1;N(u)}O(a.id)},[P]),de=React.useMemo(()=>{if(!j)return["All"];const a=new Set(j.items.map(n=>n.property_group));return["All",...Array.from(a)]},[j]);return React.useEffect(()=>{N(1)},[k,S]),e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 overflow-hidden font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-3 flex flex-col md:flex-row md:items-center justify-between gap-4 shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg transform transition-hover hover:scale-105",children:e.jsx(ee,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-extrabold text-gray-900 tracking-tight",children:"Properties"}),e.jsx("p",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:j?.region||"Loading..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>re(!H),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all ${H?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Le,{className:"w-4 h-4"}),"Filters"]}),e.jsx("label",{htmlFor:"location-select",className:"text-xs font-black text-gray-400 uppercase tracking-tight hidden md:block ml-2",children:"Location"}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{id:"location-select",name:"location",value:r,"data-testid":"source-select",onChange:a=>C(a.target.value),className:"appearance-none bg-gray-50 border border-gray-200 rounded-xl px-4 py-2 pr-10 text-sm font-bold text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 transition-all cursor-pointer relative",children:[e.jsx("option",{value:"chesterfield_ashgate",children:"Chesterfield (Ashgate)"}),e.jsx("option",{value:"chesterfield",children:"Chesterfield"}),e.jsx("option",{value:"chesterfield_rent",children:"Chesterfield (Rent)"}),e.jsx("option",{value:"herts",children:"Herts"}),e.jsx("option",{value:"hitchin_johnsonpl",children:"Hitchin (Johnson Pl)"}),e.jsx("option",{value:"hitchin_rent",children:"Hitchin (Rent)"}),e.jsx("option",{value:"london",children:"London"}),e.jsx("option",{value:"basingstoke",children:"Basingstoke"})]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-indigo-600",children:e.jsx(he,{className:"w-4 h-4"})})]})]})]}),H&&e.jsx(qe,{filters:k,onChange:Z,propertyGroups:de,sortBy:S,onSortChange:ne}),e.jsxs("main",{className:"flex-1 flex flex-col md:flex-row overflow-hidden relative",children:[e.jsxs("div",{className:`w-full md:w-2/5 flex flex-col bg-stone-200 overflow-hidden border-r border-gray-200 ${_==="map"?"hidden md:flex":"flex"}`,children:[!f&&!s&&j&&e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white/80 backdrop-blur-sm flex items-center justify-center gap-1 relative","data-testid":"pagination-controls",children:[e.jsxs("div",{className:"flex flex-col items-start md:absolute md:left-4 md:top-1/2 md:-translate-y-1/2 text-gray-900 font-bold text-sm px-2",children:[e.jsx("span",{children:f?"Searching...":h?`Property ${P.findIndex(a=>a.id===h.id)+1} / ${P.length}`:`${P.length} properties`}),j&&e.jsxs("span",{className:"text-xs text-gray-800 font-medium",children:["Updated:"," ",new Date(j.updated_on).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})]})]}),D>1&&e.jsxs("div",{className:"flex items-center justify-center gap-1 ml-auto md:ml-0",children:[c>3&&e.jsx("button",{onClick:()=>N(1),className:"px-3 py-2 rounded-lg text-sm font-bold transition-all bg-gray-100 text-gray-600 hover:bg-gray-200","data-testid":"pagination-first",title:"First page",children:"1"}),c>3&&e.jsx("span",{className:"px-2 py-2 text-sm text-gray-400",children:"..."}),[c-2,c-1,c,c+1,c+2].filter(a=>a>=1&&a<=D).map(a=>e.jsx("button",{onClick:()=>N(a),className:`px-3 py-2 rounded-lg text-sm font-bold transition-all ${a===c?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,"data-testid":`pagination-page-${a}`,children:a},a)),c<D-2&&e.jsx("span",{className:"px-2 py-2 text-sm text-gray-400",children:"..."}),c<D-2&&e.jsx("button",{onClick:()=>N(D),className:"px-3 py-2 rounded-lg text-sm font-bold transition-all bg-gray-100 text-gray-600 hover:bg-gray-200","data-testid":"pagination-last",title:"Last page",children:D})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto md:px-2 space-y-1 md:space-y-2 scrollbar-thin scrollbar-thumb-gray-200 scrollbar-track-transparent","data-testid":"property-list",children:f?e.jsx("div",{className:"flex items-center justify-center h-64","data-testid":"loading-spinner",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"})}):s?e.jsx("div",{className:"bg-red-50 text-red-600 p-4 rounded-xl border border-red-100 text-center font-medium",children:s}):P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-300 mb-4 flex justify-center",children:e.jsx(Re,{className:"w-16 h-16"})}),e.jsx("p",{className:"text-gray-500 font-bold",children:"No properties found matching your criteria."}),e.jsx("button",{onClick:()=>Z({minPrice:0,maxPrice:2e6,minBedrooms:0,propertyGroup:"All",searchQuery:"",includeSoldLet:!0}),className:"mt-4 text-indigo-600 font-bold hover:underline",children:"Clear all filters"})]}):Q.map((a,n)=>e.jsx(ae,{property:a,onSelect:oe,onViewDetails:ie,onShowOnMap:le,isSelected:h?.id===a.id,index:(c-1)*T+n,total:P.length},a.id))})]}),e.jsx("div",{className:`w-full md:w-3/5 relative ${_==="list"?"hidden md:block":"flex-1 md:block"}`,children:e.jsx(Je,{properties:P,selectedProperty:h,onPropertySelect:ce,zoom:E,onZoomChange:G,center:A,onCenterChange:L})}),e.jsx("button",{onClick:()=>{_==="list"?(h&&L([...h.coordinates]),I("map")):I("list")},className:"md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-[40] bg-gray-900 text-white px-6 py-3 rounded-full font-bold shadow-2xl flex items-center gap-2 border border-white/10 active:scale-95 transition-transform",children:_==="list"?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-5 h-5"}),"Show Map"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-5 h-5"}),"Show List"]})})]}),M&&e.jsx(Ze,{property:M,onClose:()=>R(null)})]})};ReactDOM.createRoot(document.getElementById("root")).render(e.jsx(React.StrictMode,{children:e.jsx(Ke,{})}));
