import"./index-mXque6HO.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{A as fe}from"./api-CH_Pe6Vg.js";import{B as V}from"./button-D7urtJzA.js";import"./clsx-B-dksMZM.js";const we="todo.jwt",Ce=t=>{if(!t)return null;if(typeof t=="string"){const a=t.trim();return a||null}if(Array.isArray(t)){for(const a of t){const r=Ce(a);if(r)return r}return null}if(typeof t=="object"){const a=t;if("detail"in a){const n=Ce(a.detail);if(n)return n}if(typeof a.msg=="string"){const n=a.msg.trim();if(n)return n}if(typeof a.message=="string"){const n=a.message.trim();if(n)return n}const r=Object.values(a).find(n=>typeof n=="string"&&!!n.trim());return r?r.trim():null}return null},ft=()=>{const t=React.useMemo(()=>`${fe}/todolist/auth`,[]),[a,r]=React.useState(()=>typeof window>"u"?null:window.localStorage.getItem(we)),[n,g]=React.useState(null),[b,p]=React.useState(!1),[m,c]=React.useState(null),[T,_]=React.useState(!1),d=React.useCallback(f=>{r(f),!(typeof window>"u")&&(f?window.localStorage.setItem(we,f):window.localStorage.removeItem(we))},[]),N=React.useCallback(f=>{c(f||null),d(null),g(null)},[d]),L=React.useCallback(async f=>{const k=await fetch(`${t}/me`,{headers:{Authorization:`Bearer ${f}`}});if(!k.ok)throw new Error(k.status===401?"Session expired. Please log in again.":"Unable to load profile.");const j=await k.json();g({id:j.id,email:j.email}),c(null)},[t]);React.useEffect(()=>{if(!a){g(null),p(!0);return}p(!1),L(a).catch(f=>{const k=f instanceof Error?f.message:"Session expired.";N(k)}).finally(()=>{p(!0)})},[N,L,a]);const y=React.useCallback(async(f,k)=>{_(!0),p(!1);try{const j=await fetch(`${fe}/todolist/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f,password:k})});if(!j.ok){const O=await j.json().catch(()=>null),X=Ce(O)??"Invalid credentials";throw new Error(X)}const D=await j.json();d(D.access_token),await L(D.access_token)}catch(j){const D=j instanceof Error?j.message:"Unable to log in.";throw N(D),new Error(D)}finally{_(!1)}},[t,N,L,d]),C=React.useCallback(()=>{N()},[N]),S=React.useCallback(async(f,k)=>{if(!a)throw new Error("Not authenticated");const j=new Headers(k?.headers);j.set("Authorization",`Bearer ${a}`);const D=await fetch(f,{...k,headers:j});if(D.status===401)throw N("Session expired. Please log in again."),new Error("Session expired. Please log in again.");return D},[N,a]),I=React.useCallback(()=>c(null),[]);return{user:n,token:a,ready:b,isAuthenticated:!!(n&&a),login:y,logout:C,authenticatedFetch:S,sessionError:m,clearSessionError:I,loginPending:T}};function ht({categoryOptions:t,categoryForm:a,categorySaving:r,categoryActionFeedback:n,handleCategoryFormChange:g,handleCategorySubmit:b,handleCategoryDelete:p,defaultCategorySlug:m}){return e.jsx("section",{className:"rounded-[28px] border border-slate-400/30 bg-[#070b1a]/80 p-5 shadow-[0_20px_50px_rgba(2,6,23,0.55)]","aria-label":"Category manager",children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.15em] text-slate-400",children:"Categories"}),e.jsx("h3",{className:"mt-1 text-xl font-semibold text-slate-50",children:"Manage categories"})]}),e.jsxs("form",{className:"grid grid-cols-1 gap-3 md:grid-cols-[repeat(auto-fit,minmax(220px,1fr))] md:items-end",onSubmit:b,children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:"Category label"}),e.jsx("input",{type:"text",value:a.label,onChange:c=>g("label",c.target.value),placeholder:"can include spaces",required:!0,className:"rounded-full border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-300",children:"Category slug"}),e.jsx("input",{type:"text",value:a.slug,onChange:c=>g("slug",c.target.value),placeholder:"DESIGN",required:!0,className:"rounded-full border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsx(V,{type:"submit",className:"h-full rounded-xl bg-gradient-to-r from-indigo-400 to-indigo-500 text-slate-900 shadow-[0_10px_30px_rgba(99,102,241,0.35)] hover:brightness-110",disabled:r,children:r?"Adding…":"Add category"})]}),e.jsx("ul",{className:"flex flex-col gap-2",children:t.map(c=>e.jsxs("li",{className:"flex items-center justify-between rounded-2xl border border-slate-400/25 bg-slate-900/60 px-3 py-2 text-sm text-slate-100","data-testid":"todo-category-item",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("strong",{className:"text-slate-50",children:c.label}),e.jsx("small",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:c.value})]}),e.jsx(V,{type:"button",variant:"outline",className:"rounded-lg border border-rose-400/50 bg-rose-500/15 px-3 py-2 text-xs font-semibold text-rose-100 hover:bg-rose-500/20",onClick:()=>{p(c.value)},disabled:c.value===m,children:"Delete"})]},c.value))}),n?e.jsx("p",{className:"m-0 text-sm text-slate-300","data-testid":"todo-categories-feedback",role:"status",children:n}):null]})})}function bt({isAuthenticated:t,userEmail:a,showCategoryManager:r,setShowCategoryManager:n,showLoginForm:g,openLoginForm:b,closeLoginForm:p,loginForm:m,handleLoginFieldChange:c,handleLoginSubmit:T,loginPending:_,loginError:d,sessionError:N,openRegisterPanel:L,registerPanelOpen:y,handleLogoutClick:C}){return e.jsxs("nav",{className:"mb-6 flex flex-col gap-4 rounded-full border border-slate-400/25 bg-[#090912]/80 px-5 py-3 text-sm font-medium text-slate-200 shadow-[0_15px_40px_rgba(2,6,23,0.55)] md:flex-row md:items-center md:justify-between","aria-label":"Primary navigation",children:[e.jsx("div",{className:"text-sm font-bold uppercase tracking-[0.12em] text-indigo-300",children:"To Do list"}),e.jsxs("ul",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("li",{children:e.jsx("button",{type:"button",className:`inline-flex items-center rounded-full border px-3 py-2 ${r?"border-transparent bg-transparent text-slate-300 hover:text-white":"border-indigo-400/40 bg-indigo-500/15 text-white"}`,"aria-pressed":!r,onClick:()=>n(!1),children:"Tasks"})}),e.jsx("li",{children:e.jsx("button",{type:"button",className:`inline-flex items-center rounded-full border px-3 py-2 ${r?"border-indigo-400/40 bg-indigo-500/15 text-white":"border-transparent bg-transparent text-slate-300 hover:text-white"}`,"aria-pressed":r,onClick:()=>n(S=>!S),children:"Manage categories"})})]}),e.jsx("div",{className:"flex flex-1 flex-col gap-2 text-sm md:flex-row md:items-center md:justify-end md:gap-3",children:t?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex flex-col leading-tight",children:e.jsx("span",{className:"text-sm font-semibold text-slate-50",children:a??""})}),e.jsx("button",{type:"button",className:"rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-2 text-xs font-semibold text-slate-50 hover:border-indigo-300/60 hover:text-indigo-200",onClick:C,children:"Logout"})]}):e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:gap-3",children:[g?e.jsxs("form",{className:"grid w-full grid-cols-1 gap-2 md:grid-cols-[repeat(auto-fit,minmax(160px,1fr))]",onSubmit:T,children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Email"}),e.jsx("input",{type:"email",value:m.email,onChange:S=>c("email",S.target.value),autoComplete:"email",required:!0,className:"rounded-xl border border-slate-400/35 bg-slate-900/70 px-3 py-2 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Password"}),e.jsx("input",{type:"password",value:m.password,onChange:S=>c("password",S.target.value),autoComplete:"current-password",required:!0,className:"rounded-xl border border-slate-400/35 bg-slate-900/70 px-3 py-2 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 md:col-span-2",children:[e.jsx("button",{type:"submit",className:"rounded-full border border-indigo-300/60 bg-indigo-500/30 px-3 py-2 text-xs font-semibold text-white",disabled:_,children:_?"Signing in…":"Sign in"}),e.jsx("button",{type:"button",className:"rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-2 text-xs font-semibold text-slate-100",onClick:p,children:"Cancel"})]})]}):e.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-2 text-xs font-semibold text-slate-100 hover:border-indigo-300/60 hover:text-indigo-200",onClick:b,children:"Login"}),!g&&e.jsx("button",{type:"button",className:"inline-flex items-center rounded-full border border-slate-400/20 bg-slate-900/60 px-3 py-2 text-xs font-semibold text-slate-50 hover:border-indigo-300/60 hover:text-indigo-200",onClick:L,"aria-expanded":y,children:"Register"}),(d||N)&&e.jsx("p",{className:"m-0 text-xs font-semibold text-rose-300",role:"status",children:d??N})]})})]})}function yt({isOpen:t,registerForm:a,registerSubmitting:r,registerFeedback:n,registerSuccess:g,closeRegisterPanel:b,handleRegisterSubmit:p,updateRegisterField:m}){return t?e.jsx("section",{className:"fixed inset-0 z-20 flex items-center justify-center bg-[rgba(5,8,22,0.82)] px-[clamp(1rem,4vw,2.75rem)] backdrop-blur-md",role:"dialog","aria-modal":"true","aria-labelledby":"todo-register-title",children:e.jsxs("div",{className:"w-full max-w-[480px] rounded-[30px] border border-slate-400/25 bg-slate-900/95 p-[clamp(1.5rem,4vw,2.75rem)] shadow-[0_25px_60px_rgba(2,6,23,0.65)]",children:[e.jsxs("header",{className:"mb-4 flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"m-0 text-xs font-semibold uppercase tracking-[0.2em] text-indigo-300",children:"Create account"}),e.jsx("h1",{className:"m-0 text-2xl font-semibold text-slate-50",id:"todo-register-title",children:"Register"}),e.jsx("p",{className:"m-0 text-sm leading-6 text-slate-300",children:"Create a personal login to keep your to-do list private. You can log in from the to-do page once you finish."})]}),e.jsx("button",{type:"button",className:"rounded-full border border-slate-400/30 bg-slate-800/70 px-3 py-1 text-xs font-semibold text-slate-100 hover:border-indigo-300/60",onClick:b,"aria-label":"Close registration dialog",children:"Close"})]}),e.jsxs("form",{className:"flex flex-col gap-3",onSubmit:p,noValidate:!0,children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:c=>m("email",c.target.value),placeholder:"you@example.com",required:!0,autoComplete:"email",className:"rounded-full border border-slate-400/35 bg-slate-900/70 px-3 py-3 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:c=>m("password",c.target.value),placeholder:"********",required:!0,autoComplete:"new-password","data-testid":"register-password",className:"rounded-full border border-slate-400/35 bg-slate-900/70 px-3 py-3 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Confirm password"}),e.jsx("input",{type:"password",value:a.confirm,onChange:c=>m("confirm",c.target.value),placeholder:"********",required:!0,autoComplete:"new-password","data-testid":"register-confirm-password",className:"rounded-full border border-slate-400/35 bg-slate-900/70 px-3 py-3 text-slate-100 placeholder:text-slate-500"})]}),e.jsx(V,{type:"submit",className:"mt-1 rounded-xl bg-gradient-to-r from-indigo-400 to-indigo-500 px-4 py-3 font-bold text-slate-900 shadow-[0_12px_30px_rgba(99,102,241,0.35)] hover:brightness-110",disabled:r,children:r?"Creating account…":"Create account"})]}),n?e.jsx("p",{className:`mt-3 text-sm font-semibold ${g?"text-emerald-200":"text-rose-200"}`,role:"status","data-testid":"register-feedback",children:n}):null]})}):null}function jt({editingId:t,loading:a,draft:r,categoryOptions:n,categoryLabelMap:g,saveFeedback:b,saving:p,updateDraft:m,handleReset:c,handleSubmit:T,onRefresh:_}){return e.jsxs("section",{className:"flex flex-col gap-6 rounded-[22px] border border-slate-400/30 bg-slate-900/70 p-5 shadow-[0_25px_60px_rgba(2,6,23,0.55)]","aria-labelledby":"todo-form-title",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.12em] text-indigo-300",children:t?"Edit":"Create"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-50",id:"todo-form-title",children:t?"Update task":"New task"})]}),e.jsx("div",{children:e.jsx(V,{type:"button",variant:"outline",className:"rounded-xl border-slate-400/35 bg-white/5 px-4 py-2 font-semibold text-slate-100 hover:border-indigo-300/60",onClick:_,disabled:a,children:a?"Syncing…":"Refresh"})})]}),t?e.jsxs("p",{className:"mt-1 text-sm font-semibold text-indigo-200","data-testid":"todo-form-notice",children:["Editing task #",t]}):null,e.jsxs("form",{className:"mt-4 grid grid-cols-1 gap-3",onSubmit:T,children:[e.jsxs("label",{className:"grid gap-1",htmlFor:"task-name",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Name"}),e.jsx("input",{id:"task-name",type:"text",value:r.name,onChange:d=>m("name",d.target.value),placeholder:"Write the task title",required:!0,className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"grid gap-1",htmlFor:"task-description",children:[e.jsxs("span",{className:"text-sm text-slate-200",children:["Description"," ",e.jsx("span",{className:"text-xs text-slate-400",children:"(optional)"})]}),e.jsx("textarea",{id:"task-description",value:r.description,onChange:d=>m("description",d.target.value),rows:3,className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"grid gap-1",htmlFor:"task-start",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Start date"}),e.jsx("input",{id:"task-start",type:"date",value:r.startDate,onChange:d=>m("startDate",d.target.value),className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]}),e.jsxs("label",{className:"grid gap-1",htmlFor:"task-due",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Due date"}),e.jsx("input",{id:"task-due",type:"date",value:r.dueDate,onChange:d=>m("dueDate",d.target.value),className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100 placeholder:text-slate-500"})]})]}),e.jsxs("label",{className:"grid gap-1",htmlFor:"task-category",children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Category"}),e.jsx("select",{id:"task-category",value:r.category,onChange:d=>m("category",d.target.value),className:"rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2.5 text-slate-100",children:n.length===0?e.jsx("option",{value:r.category,children:g[r.category]??r.category}):n.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("label",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-400/30 bg-slate-900/70 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-200",children:"Status"}),e.jsx("p",{className:"m-0 text-xs text-slate-400",children:"Is the task complete?"})]}),e.jsx("input",{id:"task-completed",type:"checkbox",checked:r.isCompleted,onChange:d=>m("isCompleted",d.target.checked),className:"h-5 w-5 accent-indigo-400"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(V,{type:"button",variant:"outline",className:"rounded-xl border-slate-400/35 bg-white/5 px-4 py-2 font-semibold text-slate-100 hover:border-indigo-300/60",onClick:c,children:t?"Cancel edit":"Clear"}),e.jsx(V,{type:"submit",className:"rounded-xl bg-gradient-to-r from-indigo-400 to-indigo-500 px-5 py-2 font-bold text-slate-900 shadow-[0_10px_30px_rgba(99,102,241,0.35)] hover:brightness-110",disabled:p,children:p?"Saving…":t?"Save changes":"Save"})]}),b?e.jsx("p",{className:"m-0 text-sm text-slate-300","data-testid":"todo-form-feedback",role:"status",children:b}):null]})]})}function wt({showBlocked:t,showCompleted:a,setShowBlocked:r,setShowCompleted:n,stats:g,handleBulkDelete:b,bulkDeleting:p,selectedCount:m,deleteFeedback:c,loading:T,syncError:_,loadTasks:d,tasks:N,sortedTasks:L,getTaskStatus:y,getDaysUntilDue:C,isOverdue:S,editingId:I,beginEditing:f,handleRowKeyDown:k,selectedIds:j,toggleSelection:D,categoryLabelMap:O,formatDueOffsetLabel:X,formatDisplayDate:Y,lastSyncedAt:G,sortConfig:M,handleSortChange:le}){const W=u=>M.key!==u?"none":M.direction==="asc"?"ascending":"descending",A=(u,R)=>{const U=M.key===u?M.direction:null,q=U?`Sort by ${R} (${U==="asc"?"ascending":"descending"})`:`Sort by ${R}`;return e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-lg border border-transparent px-2 py-1 text-left text-slate-200 hover:border-slate-500/40",onClick:()=>le(u),"aria-label":q,children:[e.jsx("span",{children:R}),e.jsx("span",{className:"text-xs text-slate-400","aria-hidden":"true",children:U?U==="asc"?"↑":"↓":"↕"})]})},re=m;return e.jsxs("section",{className:"flex flex-col gap-4 rounded-[22px] border border-slate-400/30 bg-slate-900/70 p-5 shadow-[0_25px_60px_rgba(2,6,23,0.55)]","aria-live":"polite","aria-busy":T,children:[e.jsx("header",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:flex-wrap md:items-start md:gap-4",children:[e.jsxs("label",{className:"flex flex-1 min-w-[240px] items-center justify-between gap-3 rounded-2xl border border-slate-400/30 bg-white/5 px-3 py-3",htmlFor:"toggle-show-blocked",children:[e.jsxs("div",{className:"text-sm text-slate-200",children:[e.jsx("span",{className:"block font-semibold text-slate-50",children:"Show blocked tasks"}),e.jsx("p",{className:"m-0 text-xs text-slate-400",children:"Tasks that cannot be started yet"})]}),e.jsx("input",{id:"toggle-show-blocked",type:"checkbox",role:"switch","aria-checked":t,checked:t,onChange:u=>r(u.target.checked),className:"h-5 w-5 accent-indigo-400"})]}),e.jsxs("label",{className:"flex flex-1 min-w-[240px] items-center justify-between gap-3 rounded-2xl border border-slate-400/30 bg-white/5 px-3 py-3",htmlFor:"toggle-show-completed",children:[e.jsxs("div",{className:"text-sm text-slate-200",children:[e.jsx("span",{className:"block font-semibold text-slate-50",children:"Show completed tasks"}),e.jsx("p",{className:"m-0 text-xs text-slate-400",children:"Tasks done"})]}),e.jsx("input",{id:"toggle-show-completed",type:"checkbox",role:"switch","aria-checked":a,checked:a,onChange:u=>n(u.target.checked),className:"h-5 w-5 accent-indigo-400"})]}),e.jsxs("dl",{className:"grid grid-cols-3 gap-2 rounded-2xl border border-slate-400/30 bg-white/5 px-3 py-3 text-center text-sm text-slate-200 md:w-auto md:min-w-[280px]",children:[e.jsxs("div",{className:"rounded-xl bg-white/5 px-2 py-1",children:[e.jsx("dt",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:"Blocked"}),e.jsx("dd",{className:"m-0 text-lg font-semibold text-slate-50",children:g.blocked})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 px-2 py-1",children:[e.jsx("dt",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:"Active"}),e.jsx("dd",{className:"m-0 text-lg font-semibold text-slate-50",children:g.ready})]}),e.jsxs("div",{className:"rounded-xl bg-white/5 px-2 py-1",children:[e.jsx("dt",{className:"text-xs uppercase tracking-[0.08em] text-slate-400",children:"Overdue"}),e.jsx("dd",{className:"m-0 text-lg font-semibold text-slate-50",children:g.overdue})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(V,{type:"button",variant:"outline",className:"rounded-xl border-rose-400/50 bg-rose-500/15 px-4 py-2 text-sm font-semibold text-rose-100 hover:bg-rose-500/20",onClick:()=>{b()},disabled:p||re===0,children:p?"Deleting…":"Delete selected"}),c?e.jsx("p",{className:"m-0 text-xs font-semibold text-rose-300","data-testid":"todo-list-feedback",role:"status",children:c}):null]})]})}),T?e.jsx("p",{className:"text-sm text-slate-300",children:"Loading tasks…"}):_?e.jsxs("div",{className:"flex flex-wrap items-center gap-3 rounded-xl border border-rose-400/50 bg-rose-500/10 px-3 py-2 text-sm text-rose-100",children:[e.jsx("p",{className:"m-0",children:_}),e.jsx(V,{type:"button",className:"rounded-lg border border-slate-400/35 bg-white/5 px-3 py-2 text-xs font-semibold text-slate-100 hover:border-indigo-300/60",onClick:()=>{d()},children:"Try again"})]}):N.length===0?e.jsx("div",{className:"rounded-xl border border-slate-400/30 bg-white/5 px-3 py-2 text-sm text-slate-200",children:e.jsx("p",{className:"m-0",children:"No tasks yet. Save your first task on the left."})}):e.jsx("div",{className:"overflow-auto rounded-2xl border border-slate-400/30 bg-[#0b1224]/70",children:e.jsxs("table",{className:"min-w-full border-collapse text-sm text-slate-100",children:[e.jsx("thead",{className:"bg-white/5 text-left text-xs uppercase tracking-wide text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-3",children:"Select"}),e.jsx("th",{scope:"col","aria-sort":W("status"),className:"px-3 py-3",children:A("status","Status")}),e.jsx("th",{scope:"col",className:"px-3 py-3",children:"Task"}),e.jsx("th",{scope:"col","aria-sort":W("category"),className:"px-3 py-3",children:A("category","Category")}),e.jsx("th",{scope:"col",className:"px-3 py-3",children:"Days left"}),e.jsx("th",{scope:"col","aria-sort":W("start_date"),className:"px-3 py-3",children:A("start_date","Start date")}),e.jsx("th",{scope:"col","aria-sort":W("due_date"),className:"px-3 py-3",children:A("due_date","Due date")})]})}),e.jsx("tbody",{children:L.map(u=>{const R=y(u),U=R.tone==="completed"?"border-emerald-400/40 bg-emerald-500/15 text-emerald-200":R.tone==="active"?"border-indigo-400/40 bg-indigo-500/20 text-indigo-100":"border-slate-400/40 bg-slate-500/20 text-slate-100",q=C(u.due_date),oe=q<0?"bg-rose-500/20 text-rose-100":q===0?"bg-amber-400/20 text-amber-100":"bg-cyan-400/20 text-cyan-100",ee=["cursor-pointer border-b border-slate-800/80 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400/60 hover:bg-white/5"];return S(u.due_date,u.is_completed)&&ee.push("bg-rose-500/5"),I===u.id&&ee.push("bg-indigo-500/5 border-indigo-400/50"),e.jsxs("tr",{className:ee.join(" "),onClick:()=>f(u),onKeyDown:z=>k(z,u),tabIndex:0,"data-testid":"todo-table-row",children:[e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-indigo-400","aria-label":`Select task ${u.name}`,checked:j.has(u.id),onChange:z=>D(u.id,z.target.checked),onClick:z=>z.stopPropagation(),"data-testid":"todo-select"})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:`inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold ${U}`,children:R.label})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:"font-semibold text-slate-50",children:u.name})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:"inline-flex rounded-full bg-white/10 px-3 py-1 text-xs font-semibold text-slate-100",children:(O[u.category]??u.category)||"Uncategorized"})}),e.jsx("td",{className:"px-3 py-3 align-middle",children:e.jsx("span",{className:`inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-semibold ${oe}`,"data-testid":"todo-due-offset",children:X(q)})}),e.jsx("td",{className:"px-3 py-3 align-middle text-slate-100",children:Y(u.start_date)}),e.jsx("td",{className:"px-3 py-3 align-middle text-slate-100",children:e.jsx("span",{className:"font-semibold",children:Y(u.due_date)})})]},u.id)})})]})}),G?e.jsxs("p",{className:"text-xs text-slate-400",children:["Last synced ",G.toLocaleTimeString()]}):null]})}const Nt=t=>t.toISOString().split("T")[0],Ne=()=>{const t=Nt(new Date);return{name:"",description:"",startDate:t,dueDate:t,category:"",isCompleted:!1}},ae=t=>{const a=t.slice(0,10),[r,n,g]=a.split("-"),b=Number(r),p=Number(n),m=Number(g);if([b,p,m].some(c=>Number.isNaN(c))){const c=new Date(t);return c.setHours(0,0,0,0),c}return new Date(b,p-1,m)},Ee=()=>{const t=new Date;return t.setHours(0,0,0,0),t},vt=1440*60*1e3,St=t=>({name:t.name,description:t.description,startDate:t.start_date,dueDate:t.due_date,category:t.category,isCompleted:t.is_completed}),pe=t=>t.replace(/^value error,\s*/i,"").trim()||t,kt=t=>/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(t),Ct=t=>{if(!t)return null;if(typeof t=="string")return pe(t);if(typeof t=="object"){const a=t.detail;if(typeof a=="string")return pe(a);if(Array.isArray(a)&&a.length>0){const r=a[0];if(r&&typeof r=="object"){const n=r.msg;if(typeof n=="string")return pe(n);const g=r.ctx?.error;if(typeof g=="string")return pe(g)}}}return null},ve=()=>({email:"",password:"",confirm:""}),J=`${fe}/todolist`,Ue="NONE",Me="todoLastLoginEmail",Se=()=>{if(typeof window>"u")return"";try{return window.localStorage.getItem(Me)??""}catch{return""}},Rt=t=>{if(typeof window>"u")return;const a=t.trim();if(a)try{window.localStorage.setItem(Me,a)}catch{}},Et=t=>{const a=ae(t);return Number.isNaN(a.valueOf())?t:new Intl.DateTimeFormat(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"}).format(a)},Be=(t,a=!1)=>{if(a)return!1;const r=Ee(),n=ae(t);return n.setHours(0,0,0,0),n<r},_t=t=>{const a=ae(t);if(Number.isNaN(a.valueOf()))return 0;a.setHours(0,0,0,0);const r=Ee();return Math.round((a.getTime()-r.getTime())/vt)},Dt=t=>t>0?`+${t}d`:`${t}d`,Ie=t=>t.trim().toUpperCase().replace(/[^A-Z0-9]+/g,"_").replace(/^_+|_+$/g,""),Re=t=>{const a=Ee(),r=ae(t);return r.setHours(0,0,0,0),r.getTime()<=a.getTime()},ke=t=>t.is_completed?{label:"Completed",tone:"completed"}:Re(t.start_date)?{label:"Active",tone:"active"}:{label:"Blocked",tone:"blocked"},Tt=()=>{const[t,a]=React.useState([]),[r,n]=React.useState(Ne),[g,b]=React.useState(!0),[p,m]=React.useState(null),[c,T]=React.useState(!1),[_,d]=React.useState(null),[N,L]=React.useState(null),[y,C]=React.useState([]),[S,I]=React.useState(null),[f,k]=React.useState(!1),[j,D]=React.useState(!1),[O,X]=React.useState({key:"due_date",direction:"asc"}),[Y,G]=React.useState(()=>new Set),[M,le]=React.useState(!1),[W,A]=React.useState(null),[re,u]=React.useState(!1),[R,U]=React.useState({label:"",slug:""}),[q,oe]=React.useState(!1),[ee,z]=React.useState(!1),[ze,F]=React.useState(null),{user:He,ready:ne,isAuthenticated:h,login:_e,logout:De,authenticatedFetch:$,sessionError:Ke,clearSessionError:ie,loginPending:Ve}=ft(),[Ye,te]=React.useState(!1),[se,ce]=React.useState(()=>({email:Se(),password:""})),[he,de]=React.useState(null),[Te,Le]=React.useState(!1),[xe,be]=React.useState(ve),[Ge,$e]=React.useState(!1),[Ae,B]=React.useState(null),[Fe,H]=React.useState(!1),P=React.useCallback(()=>{de(null),ie()},[ie]),Je=React.useCallback((s,l)=>{ce(i=>({...i,[s]:l})),he&&de(null),ie()},[ie,he]),me=React.useCallback(()=>{be(ve()),B(null),H(!1)},[]),We=React.useCallback(()=>{me(),Le(!0)},[me]),ye=React.useCallback(()=>{Le(!1),me()},[me]),Ze=(s,l)=>{be(i=>({...i,[s]:l})),Ae&&B(null),Fe&&H(!1)},Qe=async s=>{s.preventDefault();const l=xe.email.trim(),i=xe.password,x=xe.confirm;if(!l||!i){B("Email and password are required."),H(!1);return}if(!kt(l)){B("Invalid email address"),H(!1);return}if(i.length<8){B("Password must be at least 8 characters long."),H(!1);return}if(i!==x){B("Passwords must match."),H(!1);return}$e(!0),B(null);try{const o=await fetch(`${fe}/todolist/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l.toLowerCase(),password:i})});if(!o.ok){const w=await o.json().catch(()=>null),v=Ct(w)??"Unable to register.";throw new Error(v)}H(!0),B("Account created! You can now log in from the to-do list page."),be(ve())}catch(o){const w=o instanceof Error?o.message:"Registration failed.";B(w),H(!1)}finally{$e(!1)}},Xe=React.useMemo(()=>{const s=t.filter(o=>!o.is_completed),l=s.filter(o=>Be(o.due_date,o.is_completed)).length,i=s.filter(o=>Re(o.start_date)).length,x=s.filter(o=>!Re(o.start_date)).length;return{overdue:l,ready:i,blocked:x,total:t.length}},[t]),Pe=React.useMemo(()=>t.filter(s=>{const l=ke(s).label;return!(!f&&l==="Blocked"||!j&&l==="Completed")}),[t,f,j]),Z=React.useCallback(async()=>{if(!h){a([]),b(!1),L(null),m("Log in to view your tasks.");return}b(!0),m(null);try{const i=(await(await $(`${J}/?limit=100`)).json()).map(x=>({...x,category:x.category??"",is_completed:!!x.is_completed}));a(i),L(new Date)}catch(s){const l=s instanceof Error?s.message:"Unable to load tasks.";m(l)}finally{b(!1)}},[$,h]);React.useEffect(()=>{ne&&Z()},[ne,Z]);const ue=React.useCallback(async()=>{if(!h){C([]);return}try{const s=await $(`${J}/categories`);if(!s.ok)throw new Error("Unable to load categories");const l=await s.json();C(l)}catch{C([])}},[$,h]);React.useEffect(()=>{ne&&ue()},[ne,ue]);const et=React.useCallback(async s=>{s.preventDefault(),P();const l=se.email.trim(),i=se.password;if(!l||!i){de("Enter email and password.");return}Rt(l);const x=l.toLowerCase();try{await _e(x,i),te(!1),ce({email:l,password:""}),m(null),Z(),ue()}catch(o){const w=o instanceof Error?o.message:"Unable to log in.";de(w)}},[ue,Z,_e,se.email,se.password,P]),tt=React.useCallback(()=>{De(),a([]),C([]),n(Ne()),I(null),G(new Set),m("Log in to view your tasks."),te(!1),P()},[De,P]),st=React.useCallback(()=>{P(),te(!0)},[P]),at=React.useCallback(()=>{P(),te(!1)},[P]);React.useEffect(()=>{const s=Se();s&&ce(l=>l.email?l:{...l,email:s})},[]),React.useEffect(()=>{h&&(te(!1),ce(s=>({email:s.email||Se(),password:""})),P())},[h,P]),React.useEffect(()=>{h&&ye()},[h,ye]),React.useEffect(()=>{h||u(!1)},[h]),React.useEffect(()=>{G(s=>{if(s.size===0)return s;const l=new Set(t.map(o=>o.id));let i=!1;const x=new Set;return s.forEach(o=>{l.has(o)?x.add(o):i=!0}),i?x:s})},[t]);const je=React.useCallback(()=>{const s=Ne(),l=y[0]?.value;return l?{...s,category:l}:s},[y]);React.useEffect(()=>{y.length!==0&&n(s=>s.category&&y.some(l=>l.value===s.category)?s:{...s,category:y[0].value})},[y]);const ge=React.useMemo(()=>y.reduce((s,l)=>(s[l.value]=l.label,s),{}),[y]),lt=React.useMemo(()=>{const s=[...Pe],l=o=>{const w=ae(o).getTime();return Number.isNaN(w)?0:w},i={Blocked:0,Active:1,Completed:2},x=o=>{switch(O.key){case"start_date":return l(o.start_date);case"due_date":return l(o.due_date);case"status":return i[ke(o).label]??0;default:return(ge[o.category]??o.category??"").toLowerCase()}};return s.sort((o,w)=>{const v=x(o),E=x(w);if(typeof v=="number"&&typeof E=="number")return v===E?o.id-w.id:O.direction==="asc"?v-E:E-v;const K=v.toString(),Q=E.toString();return K===Q?o.id-w.id:O.direction==="asc"?K.localeCompare(Q,void 0,{sensitivity:"base"}):Q.localeCompare(K,void 0,{sensitivity:"base"})})},[ge,O,Pe]),rt=(s,l)=>{n(i=>({...i,[s]:l}))},ot=async s=>{s.preventDefault(),d(null);const l=r.name.trim(),i=r.description.trim();if(!l){d("Please provide a name.");return}if(!r.category){d("Select a category for this task.");return}if(r.startDate>r.dueDate){d("Start date must be on or before the due date.");return}if(!h){d("Log in to manage tasks.");return}const x=S!==null,o=x?`${J}/${S}`:`${J}/`,w=x?"PUT":"POST";T(!0);try{const v=await $(o,{method:w,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,description:i,start_date:r.startDate,due_date:r.dueDate,category:r.category,is_completed:r.isCompleted})});if(!v.ok)throw new Error("Failed to save the task");const E=await v.json();a(K=>x?K.map(Q=>Q.id===E.id?E:Q):[E,...K]),n(je()),I(null),d(x?"Task updated":"Task saved")}catch(v){const E=v instanceof Error?v.message:"Unexpected error";d(E)}finally{T(!1)}},Oe=React.useCallback(s=>{n(St(s)),I(s.id),d(null)},[]),nt=React.useCallback(()=>{n(je()),I(null),d(null)},[je]),it=s=>{X(l=>l.key===s?{key:s,direction:l.direction==="asc"?"desc":"asc"}:{key:s,direction:"asc"})},ct=React.useCallback((s,l)=>{G(i=>{const x=new Set(i);return l?x.add(s):x.delete(s),x})},[]),dt=React.useCallback(async()=>{const s=Array.from(Y);if(s.length===0||M){A(s.length===0?"Select at least one task to delete.":null);return}if(!h){A("Log in to delete tasks.");return}le(!0),A(null);const l=new Set(s);try{await Promise.all(s.map(async i=>{if(!(await $(`${J}/${i}`,{method:"DELETE"})).ok)throw new Error("Unable to delete selected tasks.")})),a(i=>i.filter(x=>!l.has(x.id))),G(new Set),A(s.length===1?"Deleted 1 task.":`Deleted ${s.length} tasks.`)}catch(i){const x=i instanceof Error?i.message:"Failed to delete selected tasks.";A(x)}finally{le(!1)}},[$,M,h,Y]),xt=(s,l)=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),Oe(l))},mt=Y.size,ut=React.useCallback((s,l)=>{U(i=>s==="label"&&!q?{label:l,slug:Ie(l)}:{...i,[s]:l}),s==="slug"&&oe(!0),F(null)},[q]),gt=React.useCallback(async s=>{s.preventDefault();const l=R.label.trim(),i=R.slug||l,x=Ie(i);if(!l||!x){F("Provide both a label and a slug.");return}if(y.some(o=>o.value===x)){F("That slug already exists.");return}if(!h){F("Log in to manage categories.");return}z(!0),F(null);try{const o=await $(`${J}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:x,label:l})});if(!o.ok)throw new Error("Unable to add category.");const w=await o.json();C(v=>[...v,w].sort((E,K)=>E.label.localeCompare(K.label))),U({label:"",slug:""}),oe(!1),F("Category added.")}catch(o){const w=o instanceof Error?o.message:"Failed to add category.";F(w)}finally{z(!1)}},[$,R.label,R.slug,y,h]),pt=React.useCallback(async s=>{if(!(!s||s===Ue)){if(!h){F("Log in to manage categories.");return}try{if(!(await $(`${J}/categories/${s}`,{method:"DELETE"})).ok)throw new Error("Unable to delete category.");C(i=>i.filter(x=>x.value!==s)),F("Category removed.")}catch(l){const i=l instanceof Error?l.message:"Failed to delete category.";F(i)}}},[$,h,C]);return e.jsxs("div",{className:"flex min-h-screen w-full justify-center px-6 py-8 text-slate-100",children:[e.jsx(yt,{isOpen:Te&&!h,registerForm:xe,registerSubmitting:Ge,registerFeedback:Ae,registerSuccess:Fe,closeRegisterPanel:ye,handleRegisterSubmit:Qe,updateRegisterField:Ze}),e.jsxs("div",{className:"flex w-full max-w-6xl flex-col",children:[e.jsx(bt,{isAuthenticated:h,userEmail:He?.email,showCategoryManager:re,setShowCategoryManager:u,showLoginForm:Ye,openLoginForm:st,closeLoginForm:at,loginForm:se,handleLoginFieldChange:Je,handleLoginSubmit:et,loginPending:Ve,loginError:he,sessionError:Ke,openRegisterPanel:We,registerPanelOpen:Te,handleLogoutClick:tt}),h?re?e.jsx(ht,{categoryOptions:y,categoryForm:R,categorySaving:ee,categoryActionFeedback:ze,handleCategoryFormChange:ut,handleCategorySubmit:gt,handleCategoryDelete:pt,defaultCategorySlug:Ue}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.12em] text-indigo-300",children:"Personal board"}),e.jsx("h1",{className:"text-3xl font-semibold text-slate-50",children:"Organise your tasks"}),e.jsx("p",{className:"max-w-3xl text-slate-300",children:"Create tasks, group them with custom categories, and keep everything in sync with your account."})]}),e.jsxs("main",{className:"grid grid-cols-1 gap-4 md:grid-cols-[minmax(320px,420px),1fr]",children:[e.jsx(jt,{editingId:S,loading:g,draft:r,categoryOptions:y,categoryLabelMap:ge,saveFeedback:_,saving:c,updateDraft:rt,handleReset:nt,handleSubmit:ot,onRefresh:()=>{Z()}}),e.jsx(wt,{showBlocked:f,showCompleted:j,setShowBlocked:k,setShowCompleted:D,stats:Xe,handleBulkDelete:dt,bulkDeleting:M,selectedCount:mt,deleteFeedback:W,loading:g,syncError:p,loadTasks:()=>{Z()},tasks:t,sortedTasks:lt,getTaskStatus:ke,getDaysUntilDue:_t,isOverdue:Be,editingId:S,beginEditing:Oe,handleRowKeyDown:xt,selectedIds:Y,toggleSelection:ct,categoryLabelMap:ge,formatDueOffsetLabel:Dt,formatDisplayDate:Et,lastSyncedAt:N,sortConfig:O,handleSortChange:it})]})]}):e.jsxs("section",{className:"rounded-3xl border border-slate-400/30 bg-slate-900/70 px-5 py-8 text-slate-200 shadow-[0_25px_60px_rgba(2,6,23,0.55)]","aria-live":"polite",children:[e.jsx("h3",{className:"text-2xl font-semibold text-slate-50",children:"Welcome"}),e.jsx("p",{className:"mt-2 max-w-2xl text-slate-300",children:"Use the Login button above to access and manage your personal task board."})]})]})]})},qe=document.getElementById("root");if(!qe)throw new Error("Root element #root not found");document.body.classList.add("todo-page");ReactDOM.createRoot(qe).render(e.jsx(React.StrictMode,{children:e.jsx(Tt,{})}));
